{"version":3,"sources":["docs/js/app.js"],"names":["app","angular","module","config","$routeProvider","$locationProvider","when","title","templateUrl","controller","resolve","user","api","isLoggedOrGoTo","html5Mode","hashPrefix","$httpProvider","defaults","withCredentials","run","$rootScope","$route","$routeParams","$window","$document","$q","$timeout","closeModal","modal","index","forEach","modals","m","i","active","splice","standalone","navigator","$on","current","value","key","replace","RegExp","log","console","info","apply","arguments","addModal","modalType","params","deferred","defer","template","data","this","reject","push","scrollTo","promise","$scope","$location","signout","auth","then","path","State","state","ready","model","extend","glControls","navigation","enabled","options","scale","attribution","geolocate","geocoder","directions","draw","submit","busy","users","save","response","success","error","items","signin","$$lastRequestedPath","signup","$interval","Hash","Calendar","GanttRow","serializeDate","date","pad","v","s","z","length","Array","join","yyyy","getFullYear","MM","getMonth","dd","getDate","hh","getHours","mm","getMinutes","ss","getSeconds","getRandomDay","Date","setDate","Math","floor","random","setHours","setMinutes","setSeconds","ceil","getTime","mKey","getRandomItem","day","item","id","uid","hours","activityId","row","taskId","prototype","slice","call","activity","name","budgetHours","project","type","deliveryDate","addItem","slots","add","update","updateMonths","updateItem","clearItems","ranges","removeAll","months","days","intervalId","start","stop","cancel","constant","ACTIVITY","CUSTOMER","DEPARTMENT","GROUP","MANAGER","PROJECT","RESOURCE","USER","factory","pool","get","Object","defineProperties","enumerable","writable","has","undefined","getId","hash","set","newItem","p","keys","remove","oldItem","indexOf","addMany","removeMany","shift","each","callback","forward","reverse","sort","c","d","a","b","backward","differs","t","updatePool","pools","ArrayFrom","len","today","todayKey","clearMonth","month","tasks","fromDay","getDay","monthDays","weeks","r","$today","getKey","ganttGroups","colors","assignedHours","useBudget","customer","department","manager","resource","color","lastTaskId","canSelect","canEdit","toLowerCase","mergeSlot","slot","insertSlot","min","max","removeSlots","toggleSlots","assign","col","$key","$date","write","erase","toggle","total","copy","task","updateRanges","previous","lastDay","rKey","range","getRange","from","to","firstKey","lastKey","updateRange","previousKey","nextKey","n","canMoveRange","dir","can","first","getOffsetKey","startDate","k","moveRange","addDays","toggleOpened","opened","compress","Utils","where","serialNumber","number","toString","directive","restrict","transclude","header","link","scope","element","attributes","message","$http","$templateCache","$compile","$parse","formatLabel","string","prepend","expression","splitted","split","formatted","uniqueId","control","ngModel","required","form","placeholder","require","compile","pre","label","filter","optionLabel","source","field","minLength","maxLength","Number","POSITIVE_INFINITY","focus","getType","visible","getClasses","$parent","control-focus","control-success","$valid","control-error","$invalid","$submitted","$touched","control-empty","$viewValue","getMessages","$error","onClick","$eval","onValidate","button","removeListeners","off","stateClass","isBusy","successing","isSuccessing","isSuccess","errorring","isErroring","isError","stateDisabled","on","_format","templateFunction","aid","formKey","formFocus","decoration","disabled","change","onChange","onFocus","blur","onBlur","inputCols","cols","colInput","colLabel","readonly","validate","format","precision","ngDisabled","controlRow","match","validation","click","mouseover","mouseout","icon","nameHi","formKeyHi","modelHi","validationHi","requiredHi","messageHi","decorationHi","himodel","canCreate","flatten","queryable","onSelected","rows","taDisabled","templateElement","templateAttributes","html","contents","onRemove","e","getter","numberPicker","setter","onAdd","nodeRemove","nodeAdd","node","querySelectorAll","$filter","$modelValue","$setViewValue","doBlur","validateType","$formatters","$parsers","unshift","valid","String","$setValidity","isReady","idle","errors","bind","errorMessage","submitClass","submitMessage","idleMessage","busyMessage","successMessage","service","redirect","$firebaseAuth","$firebaseObject","$firebaseArray","storage","connect","presence","$signInAnonymously","remember","logged","catch","token","firebase","database","ref","child","orderByChild","equalTo","snap","firstOrDefault","email","password","root","usersRef","userRef","updateUser","delete","getUserItems","getArray","getField","query","fields","collection","limit","array","queryRef","limitToLast","$loaded","numChildren","val","window","apiKey","authDomain","databaseURL","projectId","storageBucket","messagingSenderId","initializeApp","url","onError","post","DEBUG","put","patch","blob","method","headers","Content-type","responseType","_service","userId","Cookie","TIMEOUT","_set","expires","setTime","toGMTString","document","cookie","cache","json","JSON","stringify","cookieName","ca","charAt","substring","parse","checkCookie","elapsed","timeout","interval","setTimeout","LocalStorage","isSupported","supported","localStorage","setItem","removeItem","storageEvent","clearTimeout","originalEvent","newValue","SessionStorage","sessionStorage"],"mappings":"AAEA,YAEA,IAAIA,KAAMC,QAAQC,OAAO,OAAQ,UAAW,aAAc,qBAAsB,WAAY,iBAE5FF,KAAIG,QAAQ,iBAAkB,oBAAqB,SAASC,EAAgBC,GAExED,EAAeE,KAAK,KAChBC,MAAO,WACPC,YAAa,qBACbC,WAAY,aAEbH,KAAK,YACJC,MAAO,UACPC,YAAa,wBACbC,WAAY,cACZC,SACIC,MAAO,cAAe,SAASC,GAC3B,MAAOA,GAAIC,eAAe,gBAInCP,KAAK,WACJC,MAAO,SACPC,YAAa,uBACbC,WAAY,eAEbH,KAAK,WACJC,MAAO,gBACPC,YAAa,uBACbC,WAAY,eAEbH,KAAK,cACJC,MAAO,YACPC,YAAa,0BACbC,WAAY,gBACZC,SACIC,MAAO,cAAe,SAASC,GAC3B,MAAOA,GAAIC,eAAe,gBAInCP,KAAK,iBACJC,MAAO,OACPC,YAAa,qBACbC,WAAY,WACZC,SACIC,MAAO,cAAe,SAASC,GAC3B,MAAOA,GAAIC,eAAe,gBAInCP,KAAK,QACJC,MAAO,YACPC,YAAa,iBAOjBH,EAAkBS,WAAU,GAC5BT,EAAkBU,WAAW,OAIjCf,IAAIG,QAAQ,gBAAiB,SAASa,GAClCA,EAAcC,SAASC,iBAAkB,KAG7ClB,IAAImB,KAAK,aAAc,SAAU,eAAgB,UAAW,YAAa,KAAM,WAAY,SAASC,EAAYC,EAAQC,EAAcC,EAASC,EAAWC,EAAIC,GAqB1J,QAASC,GAAWC,GAChB,GAAIC,IAAS,CACb5B,SAAQ6B,QAAQV,EAAWW,OAAQ,SAASC,EAAGC,GACvCD,IAAMJ,IACNC,EAAQI,MAGD,IAAXJ,IACAD,EAAMM,QAAS,EACfR,EAAS,WACLN,EAAWW,OAAOI,OAAON,EAAO,IACjC,MA9BXT,EAAWgB,WAAab,EAAQc,UAAUD,WAE1ChB,EAAWkB,IAAI,sBAAuB,WAClC,GAAI/B,GAAQc,EAAOkB,QAAQhC,KAC3BN,SAAQ6B,QAAQR,EAAc,SAASkB,EAAOC,GAC1ClC,EAAQA,EAAMmC,QAAQ,GAAIC,QAAO,IAAMF,EAAK,KAAMD,KAEtDhB,EAAUjB,MAAQA,GAAS,KAG/Ba,EAAWwB,IAAM,WACTrB,EAAQsB,SAAWtB,EAAQsB,QAAQC,MACnCvB,EAAQsB,QAAQC,KAAKC,MAAMxB,EAAQsB,QAASG,YAKpD5B,EAAWW,UAiBXX,EAAW6B,SAAW,SAASC,EAAW3C,EAAO4C,GAC7C,GAAIC,GAAW3B,EAAG4B,OAClBF,GAASA,GAAU,IACnB,IAAIvB,IACArB,MAAO,WACPE,WAAY,KACZ6C,SAAU,KACVH,OAAQA,EAEZ,QAAQD,GACJ,IAAK,eACDtB,GACIrB,MAAOA,GAAS,YAChBE,WAAY,mBACZ6C,SAAU,0BACVH,OAAQA,GAqBpB,MAjBAvB,GAAMwB,SAAWA,EACjBxB,EAAMlB,QAAU,SAAS6C,GACrB5B,EAAW6B,MACX5B,EAAMwB,SAAS1C,QAAQ6C,EAAM3B,IAEjCA,EAAM6B,OAAS,WACX9B,EAAW6B,MACX5B,EAAMwB,SAASK,OAAO7B,IAE1BR,EAAWW,OAAO2B,KAAK9B,GACvB3B,QAAQ6B,QAAQV,EAAWW,OAAQ,SAASC,EAAGC,GAC3CD,EAAEE,QAAS,IAEfR,EAAS,WACLE,EAAMM,QAAS,EACfX,EAAQoC,SAAS,EAAG,IACrB,KACIP,EAASQ,YAQxB5D,IAAIS,WAAW,YAAa,SAAU,YAAa,cAAe,SAASoD,EAAQC,EAAWlD,GAE1FiD,EAAOjD,IAAMA,EAEbiD,EAAOE,QAAU,WACblB,QAAQD,IAAIhC,GACZA,EAAIoD,KAAKD,UAAUE,KAAK,WACpBH,EAAUI,KAAK,QAIvBtD,EAAI2B,UAAU0B,KAAK,SAAStD,GACxBkC,QAAQD,IAAIjC,QAKpBX,IAAIS,WAAW,YAAa,SAAU,YAAa,WAAY,QAAS,cAAe,SAASoD,EAAQC,EAAWpC,EAAUyC,EAAOvD,IAEpHiD,EAAOO,MAAQ,GAAID,IAEzBE,WAIVrE,IAAIS,WAAW,eAAgB,SAAU,YAAa,WAAY,QAAS,cAAe,SAASoD,EAAQC,EAAWpC,EAAUyC,EAAOvD,GAEnI,GAAIwD,GAAQP,EAAOO,MAAQ,GAAID,GAE3BG,EAAQT,EAAOS,QAEnB1D,GAAI2B,UAAU0B,KAAK,SAAStD,GACxBV,QAAQsE,OAAOD,EAAO3D,GACtByD,EAAMC,SAGV,IAAIG,IACAC,YACIC,SAAS,EACTC,YAEJC,OACIF,SAAS,EACTC,YAEJE,aACIH,SAAS,EACTC,YAEJG,WACIJ,SAAS,EACTC,YAEJI,UACIL,SAAS,EACTC,YAEJK,YACIN,SAAS,EACTC,YAEJM,MACIP,SAAS,EACTC,YAIRd,GAAOW,WAAaA,EAEpBX,EAAOqB,OAAS,WACRd,EAAMe,QACNvE,EAAIwE,MAAMC,KAAKf,GAAOL,KAAK,SAAiBqB,GACxClB,EAAMmB,WACP,SAAeD,GACdlB,EAAMoB,MAAMF,SAO5BtF,IAAIS,WAAW,iBAAkB,SAAU,YAAa,WAAY,QAAS,cAAe,SAASoD,EAAQC,EAAWpC,EAAUyC,EAAOvD,IAEzHiD,EAAOO,MAAQ,GAAID,IAEzBE,QAENzD,EAAI6E,QAAQxB,KAAK,SAASwB,GACtB5C,QAAQD,IAAI,sBAAuB6C,GACnC5B,EAAO4B,MAAQA,OAKvBzF,IAAIS,WAAW,cAAe,SAAU,YAAa,WAAY,QAAS,cAAe,SAASoD,EAAQC,EAAWpC,EAAUyC,EAAOvD,GAElI,GAAIwD,GAAQP,EAAOO,MAAQ,GAAID,GAE3BG,EAAQT,EAAOS,QAEnBT,GAAOqB,OAAS,WACRd,EAAMe,QACNvE,EAAIoD,KAAK0B,OAAOpB,GAAOL,KAAK,SAAiBqB,GACzClB,EAAMmB,SAEN,IAAIrB,GAAOJ,EAAU6B,qBAAuB,YAC5C9C,SAAQD,IAAI,aAAcsB,EAAMoB,GAChCxB,EAAUI,KAAKA,GACfJ,EAAU6B,oBAAsB,MAEjC,SAAeL,GACdzC,QAAQD,IAAI,mBAAoB0C,GAChClB,EAAMoB,MAAMF,SAO5BtF,IAAIS,WAAW,cAAe,SAAU,YAAa,WAAY,QAAS,cAAe,SAASoD,EAAQC,EAAWpC,EAAUyC,EAAOvD,GAElI,GAAIwD,GAAQP,EAAOO,MAAQ,GAAID,GAE3BG,EAAQT,EAAOS,QAEnBT,GAAOqB,OAAS,WACRd,EAAMe,QACNvE,EAAIoD,KAAK4B,OAAOtB,GAAOL,KAAK,SAAiBqB,GACzClB,EAAMmB,SAEN,IAAIrB,GAAOJ,EAAU6B,qBAAuB,YAC5C9C,SAAQD,IAAI,aAAcsB,EAAMoB,GAChCxB,EAAUI,KAAKA,GACfJ,EAAU6B,oBAAsB,MAEjC,SAAeL,GACdzC,QAAQD,IAAI,mBAAoB0C,GAChClB,EAAMoB,MAAMF,SAO5BtF,IAAIS,WAAW,YAAa,SAAU,YAAa,OAAQ,WAAY,WAAY,SAASoD,EAAQgC,EAAWC,EAAMC,EAAUC,GA0D3H,QAASC,GAAcC,GACnB,QAASC,GAAIC,EAAGC,EAAGC,GAIf,MAHAF,IAAKA,GAAK,GAAK,GACfC,EAAKA,GAAK,EACVC,EAAKA,GAAK,IACHF,EAAEG,QAAUF,EAAID,EAAI,GAAII,OAAMH,EAAID,EAAEG,OAAS,GAAGE,KAAKH,GAAKF,EAErE,GAAIM,GAAOR,EAAKS,cACZC,EAAKV,EAAKW,WAAa,EACvBC,EAAKZ,EAAKa,UACVC,EAAKd,EAAKe,WACVC,EAAKhB,EAAKiB,aACVC,EAAKlB,EAAKmB,YACd,OAAOX,GAAO,IAAMP,EAAIS,GAAM,IAAMT,EAAIW,GAAM,IAAMX,EAAIa,GAAM,IAAMb,EAAIe,GAAM,IAAMf,EAAIiB,GAO5F,QAASE,KACL,GACIpB,GAAO,GAAIqB,KACfrB,GAAKsB,QAAQtB,EAAKa,UAAYU,KAAKC,MAAsB,GAAhBD,KAAKE,WAE9CzB,EAAK0B,SAAS,GACd1B,EAAK2B,WAAW,GAChB3B,EAAK4B,WAAW,EAChB,IAAIpB,GAAOR,EAAKS,cACZC,EAAKV,EAAKW,UAGd,QACIpE,IAHMgF,KAAKM,KAAK7B,EAAK8B,UATZ,OAaTC,KAHc,GAAPvB,EAAYE,EAInBV,KAAMD,EAAcC,IAM5B,QAASgC,KACL,GAAIC,GAAMb,IACNc,GACAC,GAAIC,EACJC,MAAO,EAAId,KAAKC,MAAsB,EAAhBD,KAAKE,UAC3BzB,KAAM,GAAIqB,MAAKY,EAAIjC,MACnBzD,IAAK0F,EAAI1F,IACTwF,KAAME,EAAIF,KACVO,WAAYC,EAAIJ,GAMpB,OAJsC,KAAlCZ,KAAKC,MAAsB,EAAhBD,KAAKE,YAChBS,EAAKM,OAAS,IAAQjB,KAAKC,MAAsB,GAAhBD,KAAKE,WAE1CW,IACOF,EAGX,QAASxF,KACLiB,EAAOjB,IAAM4D,MAAMmC,UAAUC,MAAMC,KAAK7F,WAnH5C,GAAIyF,GAAM5E,EAAO4E,IAAM,GAAIzC,IACvB8C,UACIT,GAAI,IAsEZ,WACI,MAAO,KAAUZ,KAAKC,MAAsB,IAAhBD,KAAKE,aAtE7BoB,KAAM,WACNC,YAAa,GAAKvB,KAAKC,MAAsB,GAAhBD,KAAKE,WAEtCsB,SACIC,KAAMzB,KAAKC,MAAsB,EAAhBD,KAAKE,UACtBwB,aAAc,GAAI5B,WAI1B1D,GAAOuF,QAAU,WACb,GAAIhB,GAAOF,GACXO,GAAIY,MAAMC,IAAIlB,GACdK,EAAIc,SACJd,EAAIe,eACJ3F,EAAOuE,KAAOA,EAEdxF,EAAI,UAAWwF,EAAKC,KAExBxE,EAAO4F,WAAa,WAChB,GAAI5F,EAAOuE,KAAM,CACb,GAAIC,GAAKxE,EAAOuE,KAAKC,EACrBD,MAAOF,IACPE,KAAOnI,QAAQsE,OAAOV,EAAOuE,KAAMA,MACnCA,KAAKC,GAAKA,EACVI,EAAIY,MAAMC,IAAIlB,MACdK,EAAIc,SACJd,EAAIe,eACJ3F,EAAOuE,KAAOA,KACdxF,EAAI,aAAcwF,KAAKC,MAG/BxE,EAAO6F,WAAa,WAChBjB,EAAIkB,OAAOC,YACXnB,EAAIoB,OAAOD,YACXnB,EAAIqB,KAAKF,YACTnB,EAAIY,MAAMO,YACVnB,EAAIc,SACJd,EAAIe,qBACG3F,GAAOuE,KACdxF,EAAI,cAGR,IAAImH,EACJlG,GAAOmG,MAAQ,WACXnG,EAAOoG,OACPF,EAAalE,EAAUhC,EAAOuF,QAAS,IAAO,KAElDvF,EAAOoG,KAAO,WACNF,GACAlE,EAAUqE,OAAOH,GA2CzB,IAAIzB,GAAM,KAwBdtI,IAAImK,SAAS,eACTC,SAAU,EACVC,SAAU,EACVC,WAAY,EACZC,MAAO,EACPC,QAAS,EACTC,QAAS,EACTC,SAAU,EACVC,KAAM,IAGV3K,IAAI4K,QAAQ,QAAS,WAGjB,QAAS9E,GAAKrD,EAAKoI,GACfpI,EAAMA,GAAO,KACboI,EAAOA,EAAO/E,EAAKgF,IAAID,MACvBE,OAAOC,iBAAiBxH,MACpBf,KACID,MAAOC,EACPwI,YAAY,EACZC,UAAU,GAEdL,MACIrI,MAAOqI,EACPI,YAAY,EACZC,UAAU,GAEd3E,QACI/D,MAAO,EACPyI,YAAY,EACZC,UAAU,KAKtB,QAASC,GAAI9C,GACT,WAAyB+C,KAAlB5H,KAAKqH,KAAKxC,GAGrB,QAASgD,GAAMhD,GACX,MAAO7E,MAAKqH,KAAKxC,GAGrB,QAASyC,GAAI1C,GACT,GAAIkD,GAAO9H,KACPf,EAAMe,KAAKf,GACf,OAAO2F,GAAOkD,EAAKD,MAAMjD,EAAK3F,IAAQ,KAG1C,QAAS8I,GAAInD,GACT,GAAIkD,GAAO9H,IAKX,OAJWA,MAAKqH,KAEXzC,EADK5E,KAAKf,MACG2F,EAClBkD,EAAK5H,KAAK0E,GACHA,EAGX,QAASkB,GAAIkC,GACT,GAAIF,GAAO9H,KACP4E,EAAOkD,EAAKR,IAAIU,EACpB,IAAIpD,EACA,IAAK,GAAwCqD,GAApCxJ,EAAI,EAAGyJ,EAAOX,OAAOW,KAAKF,GAAavJ,EAAIyJ,EAAKnF,OAAQtE,IAC7DwJ,EAAIC,EAAKzJ,GACTmG,EAAKqD,GAAKD,EAAQC,OAGtBrD,GAAOkD,EAAKC,IAAIC,EAEpB,OAAOpD,GAGX,QAASuD,GAAOC,GACZ,GAAIN,GAAO9H,KACPqH,EAAOrH,KAAKqH,KACZpI,EAAMe,KAAKf,IACX2F,EAAOkD,EAAKR,IAAIc,EACpB,IAAIxD,EAAM,CACN,GAAIvG,GAAQyJ,EAAKO,QAAQzD,IACV,IAAXvG,GACAyJ,EAAKnJ,OAAON,EAAO,SAEhBgJ,GAAKzC,EAAK3F,IAErB,MAAO6I,GAGX,QAASQ,GAAQrG,GACb,GAAI6F,GAAO9H,IACX,KAAKiC,EACD,MAAO6F,EAGX,KADA,GAAIrJ,GAAI,EACDA,EAAIwD,EAAMc,QACb+E,EAAKhC,IAAI7D,EAAMxD,IACfA,GAEJ,OAAOqJ,GAGX,QAASS,GAAWtG,GAChB,GAAI6F,GAAO9H,IACX,KAAKiC,EACD,MAAO6F,EAGX,KADA,GAAIrJ,GAAI,EACDA,EAAIwD,EAAMc,QACb+E,EAAKK,OAAOlG,EAAMxD,IAClBA,GAEJ,OAAOqJ,GAGX,QAAS1B,KACL,GAKIxB,GALAkD,EAAO9H,KACPf,EAAM6I,EAAK7I,IACXoI,EAAOS,EAAKT,KACZ5I,EAAI,CAGR,KAFQqJ,EAAK/E,OAEN+E,EAAK/E,QACR6B,EAAOkD,EAAKU,cACLnB,GAAKzC,EAAK3F,IACjBR,GAEJ,OAAOqJ,GAGX,QAASW,GAAKC,GACV,GAAIZ,GAAO9H,IACX,IAAI0I,EAEA,IADA,GAAIjK,GAAI,EACDA,EAAIqJ,EAAK/E,QACZ2F,EAASZ,EAAKrJ,GAAIA,GAClBA,GAGR,OAAOqJ,GAGX,QAASa,GAAQ1J,EAAK2J,GAClB,GAAId,GAAO9H,IAOX,OANAf,GAAOA,GAAOe,KAAKf,IACnB6I,EAAKe,KAAK,SAASC,EAAGC,GAClB,GAAIC,GAAIJ,EAAUG,EAAID,EAClBG,EAAIL,EAAUE,EAAIC,CACtB,OAAOC,GAAE/J,GAAOgK,EAAEhK,KAEf6I,EAGX,QAASoB,GAASjK,GACd,MAAOe,MAAK2I,QAAQ1J,GAAK,GAG7B,QAASkK,GAAQrB,GACb,GAAIA,EAAK7I,MAAQe,KAAKf,KAAO6I,EAAK/E,SAAW/C,KAAK+C,OAC9C,OAAO,CAMP,KAJA,GAAIoG,IAAU,EACV1K,EAAI,EACJ2K,EAAIpJ,KAAK+C,OACT9D,EAAMe,KAAKf,IACRkK,GAAW1K,EAAI2K,GAClBD,EAAUnJ,KAAKvB,GAAGQ,KAAS6I,EAAKrJ,GAAGQ,GACnCR,IAKZ,QAAS4K,KACL,GAAIvB,GAAO9H,KACPqH,EAAOrH,KAAKqH,KACZpI,EAAMe,KAAKf,GACfsI,QAAOW,KAAKb,GAAM/I,QAAQ,SAASW,SACxBoI,GAAKpI,KAEhBxC,QAAQ6B,QAAQwJ,EAAM,SAASlD,GAC3ByC,EAAKzC,EAAK3F,IAAQ2F,IAvK1B,GAAI0E,KA4LJ,OAlBAhH,GAAKgF,IAAM,SAASD,GAChB,MAAQiC,GAAMjC,GAAQiC,EAAMjC,QAEhC/E,EAAK6C,UAAY,GAAInC,OACrBV,EAAK6C,UAAUwC,IAAMA,EACrBrF,EAAK6C,UAAU0C,MAAQA,EACvBvF,EAAK6C,UAAUmC,IAAMA,EACrBhF,EAAK6C,UAAU4C,IAAMA,EACrBzF,EAAK6C,UAAUW,IAAMA,EACrBxD,EAAK6C,UAAUgD,OAASA,EACxB7F,EAAK6C,UAAUsD,KAAOA,EACtBnG,EAAK6C,UAAUmD,QAAUA,EACzBhG,EAAK6C,UAAUoD,WAAaA,EAC5BjG,EAAK6C,UAAUiB,UAAYA,EAC3B9D,EAAK6C,UAAUwD,QAAUA,EACzBrG,EAAK6C,UAAU+D,SAAWA,EAC1B5G,EAAK6C,UAAUgE,QAAUA,EACzB7G,EAAK6C,UAAUkE,WAAaA,EACrB/G,KAGX9F,IAAI4K,QAAQ,YAAa,OAAQ,SAAS9E,GAQtC,QAASiH,GAAUC,EAAKd,GAEpB,IADA,GAAIM,MACGA,EAAEjG,OAASyG,GACdR,EAAE9I,KAAKwI,EAASM,EAAEjG,QAEtB,OAAOiG,GAIX,QAASzG,MAhBT,GACIkH,GAAQ,GAAI1F,KAChB0F,GAAMrF,SAAS,GACfqF,EAAMpF,WAAW,GACjBoF,EAAMnF,WAAW,EACjB,IAAIoF,GAAWzF,KAAKM,KAAKkF,EAAMjF,UALlB,OAcT6B,EAAS,GAAI/D,GAAK,OAiFtB,OA9EAC,GAASgB,QAAU,SAASoB,GACxB,MAAiC,kBAAtBA,GAAIjC,KAAKW,SACTsB,EAAIjC,KAEJ,GAAIqB,MAAKY,EAAIjC,OAG5BH,EAASoH,WAAa,SAASC,GAC3BA,EAAMtD,KAAKmC,KAAK,SAAS9D,GACjBA,IACAA,EAAII,MAAQ,EACZJ,EAAIkF,aAIhBtH,EAASc,SAAW,SAASsB,GACzB8E,EAAQ,GAAI1F,MACZ0F,EAAMrF,SAAS,GACfqF,EAAMpF,WAAW,GACjBoF,EAAMnF,WAAW,GACjBoF,EAAWzF,KAAKM,KAAKkF,EAAMjF,UArClB,MAuCT,IAAI9B,GAAOH,EAASgB,QAAQoB,GACxBzB,EAAOR,EAAKS,cACZC,EAAKV,EAAKW,WAEVoB,GADMR,KAAKM,KAAK7B,EAAK8B,UA1ChB,OA2CS,GAAPtB,EAAYE,GACnBwG,EAAQvD,EAAOwB,MAAMpD,EACzB,KAAKmF,EAAO,CACR,GAAIE,GAAU,GAAI/F,MAAKb,EAAME,EAAI,GAAG2G,SAChCC,EAAY,GAAIjG,MAAKb,EAAME,EAAK,EAAG,GAAGG,UACtC0G,EAAQhG,KAAKM,KAAKyF,EAAY,EAClCJ,IACIlH,KAAMA,EACN+B,KAAMA,EACNmF,MAAOxG,EACP4G,UAAWA,EACXF,QAASA,EACTxD,KAAM,GAAIhE,GAAK,QAEnBsH,EAAMK,MAAQV,EAAUU,EAAO,SAASC,GACpC,GAAI5D,GAAOiD,EAAU,EAAG,SAAST,GAC7B,GAAIlE,GAAO,KACPmE,EAAQ,EAAJmB,EAAQpB,GAAKgB,EAAU,EAC/B,IAAIf,GAAK,GAAKA,EAAIiB,EAAW,CACzB,GAAItH,GAAO,GAAIqB,MAAKb,EAAME,EAAI2F,EAAI,GAC9B9J,EAAMgF,KAAKM,KAAK7B,EAAK8B,UA/DhC,MAgEOI,IACIuF,OAAQlL,IAAQyK,EAChBZ,EAAGA,EACHoB,EAAGA,EACHnB,EAAGA,EAAI,EACPrG,KAAMA,EACNzD,IAAKA,EACL8F,MAAO,EACP8E,UAEJjF,EAAOgF,EAAMtD,KAAKR,IAAIlB,GAE1B,MAAOA,IAEX,QACIsF,EAAGA,EACH5D,KAAMA,KAGdsD,EAAQvD,EAAOP,IAAI8D,GAEvB,MAAOA,IAEXrH,EAASwH,OAAS,SAASzD,GACvB,GAAI5D,GAAO,GAAIqB,MAAK0F,EAEpB,OADA/G,GAAKsB,QAAQtB,EAAKa,UAAY+C,GACvB5D,GAEXH,EAAS6H,OAAS,SAAS1H,GACvB,MAAOuB,MAAKM,KAAK7B,EAAK8B,UA7Fb,QA+FNjC,KAGX/F,IAAI4K,QAAQ,YAAa,OAAQ,WAAY,cAAe,SAAS9E,EAAMC,EAAU8H,GAUjF,QAAS7H,GAASzC,EAAMuK,GACpBtK,KAAK0F,KAAO2E,EAAYzD,SACxB5G,KAAKuK,cAAgB,EACrBvK,KAAK6F,MAAQ,GAAIvD,GAAK,MACtBtC,KAAKsG,KAAO,GAAIhE,GAAK,OACrBtC,KAAKqG,OAAS,GAAI/D,GAAK,QACvBtC,KAAKmG,OAAS,GAAI7D,GAAK,QACvBtC,KAAK6J,MAAQ,GAAIvH,GAAK,MAElBvC,IACAC,KAAK6E,GAAK9E,EAAKuF,SAAST,GACxB7E,KAAKuF,KAAOxF,EAAKuF,SAASC,KAC1BvF,KAAKwF,YAAczF,EAAKuF,SAASE,YACjCxF,KAAKwK,UAAkC,IAAtBzK,EAAK0F,QAAQC,MAAoC,IAAtB3F,EAAK0F,QAAQC,KACzD1F,KAAKyK,SAAW1K,EAAK0K,SACrBzK,KAAK0K,WAAa3K,EAAK2K,WACvB1K,KAAK2K,QAAU5K,EAAK4K,QACpB3K,KAAKyF,QAAU1F,EAAK0F,QACpBzF,KAAK4K,SAAW7K,EAAK6K,SACrB5K,KAAK6K,MAAQP,EAAOtK,KAAK6E,IAAMyF,EAAOvH,QAAU,KAGpD/C,KAAK8K,WAAa,KAClB9K,KAAK+F,SAhCT,GAAIjB,GAAM,EAGN2E,EAAQ,GAAI1F,KAChB0F,GAAMrF,SAAS,GACfqF,EAAMpF,WAAW,GACjBoF,EAAMnF,WAAW,EACjB,IAAIoF,GAAWzF,KAAKM,KAAKkF,EAAMjF,UALlB,MA+Tb,OA/RAhC,GAAS2C,WACL4F,UAAW,WACP,MAAO/K,MAAK0F,OAAS2E,EAAYzD,UAAY5G,KAAKwF,YAAc,GAEpEwF,QAAS,WACL,MAAOhL,MAAK+K,cAA4E,IAA7D/K,KAAK4K,SAASrF,KAAK0F,cAAc5C,QAAQ,gBAExE6C,UAAW,SAASC,GAChB,GAAItF,GAAQ7F,KAAK6F,KACbsF,GAAKpG,MACLc,EAAMC,IAAIqF,GAEVtF,EAAMsC,OAAOgD,IAGrBC,WAAY,SAASnM,EAAK8F,EAAOG,GAC7B,GAAIiG,GAAO,IAKX,IAJInL,KAAKwK,YACLzF,EAAQd,KAAKoH,IAAItG,EAAO/E,KAAKwF,YAAcxF,KAAKuK,iBAEpDxF,EAAQd,KAAKqH,IAAI,EAAGvG,IACR,EAAG,CACX,GAAIH,IACAC,GAAI,QAAWC,IACf7F,IAAKA,EACLyD,KAAM,GAAIqB,MAzDb,MAyDkB9E,GACf8F,MAAOA,EACPC,WAAYhF,KAAK6E,GAEjBK,KACAN,EAAKM,OAASA,EACdlF,KAAK8K,WAAa5F,GAEtBlF,KAAK6F,MAAMC,IAAIlB,GACfuG,EAAOnL,KAAK6F,MAAMgC,MAAMjD,EAAKC,IAGjC,MADA7E,MAAK+F,SACEoF,GAEXI,YAAa,SAAStM,GAClB,GAAI0F,GAAM3E,KAAKsG,KAAKuB,MAAM5I,EAC1B0F,GAAIkF,MAAMpB,KAAK,SAAS7D,GACpBA,EAAKG,MAAQ,GAEjB,IAAIc,GAAQlB,EAAIkF,MAAMzE,OAGtB,OAFApF,MAAK6F,MAAM0C,WAAW1C,GACtB7F,KAAK+F,SACEF,GAEX2F,YAAa,SAASvM,EAAK8F,GACvB,MAAI/E,MAAKsG,KAAKqB,IAAI1I,GACPe,KAAKuL,YAAYtM,IAEbe,KAAKoL,WAAWnM,EAAK8F,EAAO/E,KAAK8K,cAKpDW,OAAQ,SAASC,EAAK1M,GAClBK,QAAQD,IAAI,SACZ,IAAIyG,GAAQ7F,KAAK6F,MACb5G,EAAMyM,EAAIC,KACV/G,GAEAC,GAAI,QAAWC,IACf7F,IAAKA,EACLyD,KAAMgJ,EAAIE,MACV7G,MAAO/F,GAAS,EAChBgG,WAAYhF,KAAK6E,GAQrB,OANI7F,GACA6G,EAAMC,IAAIlB,GAEViB,EAAMsC,OAAOvD,GAEjB5E,KAAK+F,SACE/F,KAAKsG,KAAKuB,MAAM5I,IAE3B4M,MAAO,SAASH,EAAK1M,EAAOsM,GAMxB,GALAtM,EAAQiF,KAAKoH,IAAIrM,EAAOsM,GACpBtL,KAAKwK,YACLxL,EAAQiF,KAAKoH,IAAIrM,EAAOgB,KAAKwF,YAAcxF,KAAKuK,iBAEpDvL,EAAQiF,KAAKqH,IAAI,EAAGtM,MACNgB,KAAKsG,KAAKqB,IAAI+D,EAAIC,OAASD,EAAIE,OAASnC,EAClD,MAAOzJ,MAAKyL,OAAOC,EAAK1M,IAGhC8M,MAAO,SAASJ,EAAK1M,EAAOsM,GACxB,GAAItL,KAAKsG,KAAKqB,IAAI+D,EAAIC,OAASD,EAAIE,OAASnC,EACxC,MAAOzJ,MAAKyL,OAAOC,EAAK,OAGhCK,OAAQ,SAASL,EAAK1M,EAAOsM,GACzB,MAAItL,MAAKsG,KAAKqB,IAAI+D,EAAIC,MACX3L,KAAK8L,MAAMJ,EAAK1M,EAAOsM,GAEvBtL,KAAK6L,MAAMH,EAAK1M,EAAOsM,IAItCvF,OAAQ,WACJ,GAAIiG,GAAQ,EACRnG,EAAQ7F,KAAK6F,MACbS,EAAOtG,KAAKsG,IAChBA,GAAKF,WACL,IAAIlB,GAAS,IACbW,GAAM4C,KAAK,SAAS7D,GAChBM,EAASN,EAAKM,QAAUA,EACxB8G,GAASpH,EAAOA,EAAKG,MAAQ,CAC7B,IAAIJ,GAAM2B,EAAKR,KACX7G,IAAK2F,EAAK3F,IACVyD,KAAMkC,EAAKlC,KACXqC,MAAO,GAEXJ,GAAIkF,MAAQlF,EAAIkF,OAAS,GAAIvH,GAAK,MAClCqC,EAAIkF,MAAM/D,IAAIrJ,QAAQwP,KAAKrH,IAC3BD,EAAIkF,MAAMpB,KAAK,SAASyD,GACpBvH,EAAII,OAASmH,EAAKnH,UAG1B/E,KAAK8K,WAAa5F,GAAUlF,KAAK8K,WACjCxE,EAAKqC,UACL3I,KAAKuK,cAAgByB,EACrBhM,KAAKmM,gBAETnG,aAAc,WACV,GAAIM,GAAOtG,KAAKsG,KACZD,EAASrG,KAAKqG,MAClBA,GAAOD,WACP,IAAIgG,EACJ9F,GAAKmC,KAAK,SAAS7D,GACf,GAAIgF,GAAQrH,EAASc,SAASuB,EAC1BgF,KAAUwC,IACVA,EAAWxC,EACXrH,EAASoH,WAAWC,IAExBvD,EAAOP,IAAI8D,EACX,IAAIjF,GAAMiF,EAAMtD,KAAKuB,MAAMjD,EAAK3F,IAC5B0F,KACAA,EAAII,MAAQH,EAAKG,MACjBJ,EAAIkF,MAAQjF,EAAKiF,SAGzBxD,EAAOsC,WAEXwD,aAAc,WACV,GAAI7F,GAAOtG,KAAKsG,KACZH,EAASnG,KAAKmG,MAClBA,GAAOC,WACP,IACIiG,GADAC,EAAO,CAEXhG,GAAKmC,KAAK,SAAS9D,EAAKlG,GAChB4N,IACI1H,EAAI1F,IAAMoN,EAAQpN,IAAM,GAAK0F,EAAIkF,MAAMV,QAAQkD,EAAQxC,SACvDyC,IAGRD,EAAU1H,CACV,IAAI4H,GAAQpG,EAAOL,KACfwG,KAAMA,GAEVC,GAAMjG,KAAOiG,EAAMjG,SACnBiG,EAAMjG,KAAKpG,KAAKyE,EAAI1F,OAExBkH,EAAOwC,WAEX6D,SAAU,SAASd,EAAKe,EAAMC,GAC1B,GAAIvG,GAASnG,KAAKmG,OACdoG,EAAQ,KACRtN,EAAMyM,EAAIC,IAUd,OATAxF,GAAOsC,KAAK,SAAS7D,GACjB,GAAIvG,GAAQuG,EAAK0B,KAAK+B,QAAQpJ,IACf,IAAXZ,IACAuG,EAAKkE,EAAIzK,EACTuG,EAAK+H,SAAW1I,KAAKqH,IAAImB,EAAM7H,EAAK0B,KAAK,IACzC1B,EAAKgI,QAAU3I,KAAKoH,IAAIqB,EAAI9H,EAAK0B,KAAK1B,EAAK0B,KAAKvD,OAAS,IACzDwJ,EAAQ3H,KAGT2H,GAEXM,YAAa,SAASnB,EAAKe,EAAMC,GAC7B,GAAIvG,GAASnG,KAAKmG,OACdoG,EAAQvM,KAAKwM,SAASd,EAAKe,EAAMC,EACrC,IAAIH,EAAO,CACPA,EAAMO,YAAc,KACpBP,EAAMQ,QAAU,IAChB,IAAI7C,GAAIqC,EAAMD,IACd,IAAIpC,EAAI,EAAG,CACP,GAAIjC,GAAI9B,EAAO+D,EAAI,EACnBqC,GAAMO,YAAc7E,EAAE3B,KAAK2B,EAAE3B,KAAKvD,OAAS,GAE/C,GAAImH,EAAI/D,EAAOpD,OAAS,EAAG,CACvB,GAAIiK,GAAI7G,EAAO+D,EAAI,EACnBqC,GAAMQ,QAAUC,EAAE1G,KAAK,IAG/B,MAAOiG,IAEXU,aAAc,SAASV,EAAOW,GAS1B,IAPA,GAAIC,IAAM,EACNlI,EAAMjF,KACNoN,EAAQb,EAAMtK,MAAM,GAEpBhD,GADOsN,EAAMtK,MAAMsK,EAAMtK,MAAMc,OAAS,GAClCkC,EAAIoI,aAAaD,EAAME,UAAWJ,IACxCzO,EAAI,EACJ2K,EAAImD,EAAMtK,MAAMc,OACbtE,EAAI2K,GAAG,CACV,GAAImE,GAAItO,EAAMR,GACV8O,EAAI7D,GAAazE,EAAIqB,KAAKuB,MAAM0F,KAAkD,IAA5ChB,EAAMtK,MAAMoG,QAAQpD,EAAIqB,KAAKuB,MAAM0F,OACzEJ,GAAM,EACN1O,EAAI2K,GAER3K,IAEJ,MAAO0O,IAEXK,UAAW,SAASjB,EAAOW,GACvB,GAAIX,EAAMtK,MAAMc,OAAQ,CACpB,GAAIkC,GAAMjF,IACNiF,GAAIgI,aAAaV,EAAOW,KACxBzQ,QAAQ6B,QAAQiO,EAAMtK,MAAO,SAAS2C,GAClCK,EAAIwI,QAAQ7I,EAAMsI,KAEtBjI,EAAIc,YAIhB0H,QAAS,SAAS7I,EAAM0B,GAEpB,GAAI5D,GAAO,GAAIqB,MAAKa,EAAK0I,UAIzB,OAHA5K,GAAKsB,QAAQtB,EAAKa,UAAY+C,GAC9B1B,EAAKlC,KAAOA,EACZkC,EAAK3F,IAAMgF,KAAKM,KAAK7B,EAAK8B,UA3QrB,OA4QEI,GAEXyI,aAAc,SAAS3K,EAAMiC,GAIzB,MAHAjC,GAAO,GAAIqB,MAAKrB,GAChBA,EAAKsB,QAAQtB,EAAKa,UAAYoB,GACpBV,KAAKM,KAAK7B,EAAK8B,UAjRpB,QAoRTf,SAAU,SAASxE,GACf,GAAI8F,GAAQ,EACRJ,EAAM3E,KAAKsG,KAAKuB,MAAM5I,EAM1B,OALI0F,IACAA,EAAIkF,MAAMpB,KAAK,SAASyD,GACpBnH,GAASmH,EAAKnH,QAGfA,GAEX2I,aAAc,WAEV1N,KAAK2N,QAAU3N,KAAK2N,QAExBC,SAAU,SAAS3O,GACf,GAAKe,KAAKiC,MAAMc,OAAhB,CAGA/C,KAAKiC,MAAM4G,KAAK,SAASG,EAAGC,GACxB,MAAOD,GAAE/J,IAAMgK,EAAEhK,KAErB,IAAI2F,GAAOiJ,MAAMC,MAAM9N,KAAKiC,OAAShD,IAAKA,GAC1C2F,GAAOA,GAAQ5E,KAAKiC,MAAM,EAC1B,IAAI5D,GAAQ2B,KAAKiC,MAAMoG,QAAQzD,GAC3BnG,EAAIJ,EACJ+K,EAAIpJ,KAAKiC,MAAMc,MAMnB,KALA9D,EAAMgF,KAAKqH,IAAIrM,EAAKyK,GAKbjL,EAAI2K,GACPxE,EAAO5E,KAAKiC,MAAMxD,GAClBmG,EAAK3F,IAAMA,EAAMR,EAAIJ,EACrBuG,EAAKlC,KAAO,GAAIqB,MAtTf,MAsToBa,EAAK3F,KAC1BR,GAEJuB,MAAK+F,YAGbvD,EAASuL,aAAe,SAASC,EAAQ1C,GACrC,MAAO,IAAItI,OAAO,EAAKsI,EAAI2C,WAAiB,OAAKD,EAAOC,WAAiB,QAAIhL,KAAK,MAE/ET,KAIXhG,IAAI0R,UAAU,UAAW,WACrB,OACIC,SAAU,IACVnR,YAAa,kBACboR,YACIC,OAAU,gBAEdC,KAAM,SAASC,EAAOC,EAASC,EAAY3N,SAInDtE,IAAI0R,UAAU,mBAAoB,WAC9B,OACIC,SAAU,IACVnR,YAAa,4BACboR,YACIM,QAAW,iBAEfJ,KAAM,SAASC,EAAOC,EAASC,EAAY3N,SAInDtE,IAAI0R,UAAU,WAAY,QAAS,iBAAkB,WAAY,SAAU,SAASS,EAAOC,EAAgBC,EAAUC,GACjH,QAASC,GAAYC,EAAQC,EAASC,GAClCF,EAASA,GAAU,GACnBC,EAAUA,GAAW,EACrB,IAAIE,GAAWH,EAAOI,MAAM,IAC5B,IAAID,EAASpM,OAAS,EAAG,CACrB,GAAIsM,GAAYF,EAAS3G,OAQzB,OAPA/L,SAAQ6B,QAAQ6Q,EAAU,SAASnQ,EAAOX,GAElCgR,EADAH,EACYG,EAAUD,MAAM,IAAM/Q,EAAQ,KAAK4E,KAAK,OAAUgM,EAAUjQ,EAAQ,QAEpEqQ,EAAUD,MAAM,IAAM/Q,EAAQ,KAAK4E,KAAKgM,EAAUjQ,KAGlEkQ,EACO,IAAOG,EAAY,IAEnBA,EAGX,MAAOJ,GAAUD,EAGzB,GAAIM,GAAW,CACf,QACInB,SAAU,IACVnR,YAAa,SAASwR,EAASC,GAC3B,GAAI3O,GAAW,kBACf,QAAQ2O,EAAWc,SACf,IAAK,SACDzP,EAAW,0BAGnB,MAAOA,IAEXyO,OACIiB,QAAS,IACTC,SAAU,IACVC,KAAM,IACN3S,MAAO,IACP4S,YAAa,KAEjBC,QAAS,UACTtB,KAAM,SAASC,EAAOC,EAASC,EAAY3N,KAG3C+O,QAAS,SAASrB,EAASC,GACnB,OACIqB,IAAK,SAASvB,EAAOC,EAASC,GAC1B,GAA2B,WAAvBA,EAAWc,QAAsB,CACjC,GAAIQ,GAAStB,EAAWsB,MAAQtB,EAAWsB,MAAQ,OAC/C9Q,EAAOwP,EAAWxP,IAAMwP,EAAWxP,IAAM,KACzC+Q,EAAUvB,EAAWpD,IAAM,kBAAqBpM,EAAM,MAASwP,EAAWpD,IAAM,IAAM,GACtF4E,EAAclB,EAAYgB,EAAO,SAAS,EAC9CxB,GAAMpN,QAAUsN,EAAWT,OACvB,QAAU/O,EAAM,OAASgR,EAAc,2CAA6CxB,EAAWyB,OAASF,EACxGC,EAAc,2CAA6CxB,EAAWyB,OAASF,EAAS,kBAAoB/Q,EAChHI,QAAQD,IAAI,sBAAuBmP,EAAMpN,SAE7C,GAEIpE,IAFOwR,EAAM7I,KAAO+I,EAAWc,QACxBhB,EAAMmB,KAAOnB,EAAMmB,MAAQ,OAC1BnB,EAAMxR,MAAQwR,EAAMxR,OAAS,WACvBwR,GAAMoB,YAAcpB,EAAMoB,aAAe5S,EAC/CwR,EAAM4B,MAAQpT,EAAMmC,QAAQ,gBAAiB,IAAIkQ,MAAM,KAAKnM,KAAK,OAASqM,CACtFf,GAAM6B,UAAY3B,EAAWpD,KAAO,EACpCkD,EAAM8B,UAAY5B,EAAWnD,KAAOgF,OAAOC,kBAC3ChC,EAAMiC,OAAQ,EACdjC,EAAMkC,QAAU,WACZ,GAAI/K,GAAO,MACX,QAAQ+I,EAAWc,SACf,IAAK,WAGD7J,EAAO6I,EAAMmC,QAAU,OAAS,UAChC,MACJ,SACIhL,EAAO+I,EAAWc,QAG1B,MAAO7J,IAEX6I,EAAMoC,WAAa,WACf,GAAIjB,GAAOZ,EAAOP,EAAMmB,MAAMnB,EAAMqC,SAChCT,EAAQrB,EAAOP,EAAMmB,KAAO,IAAMnB,EAAM4B,OAAO5B,EAAMqC,QACzD,QACIC,gBAAiBtC,EAAMiC,MACvBM,kBAAmBX,EAAMY,OACzBC,gBAAiBb,EAAMc,WAAavB,EAAKwB,YAAcf,EAAMgB,UAC7DC,iBAAkBjB,EAAMkB,aAGhC9C,EAAM+C,YAAc,WAChB,GAAI5B,GAAOZ,EAAOP,EAAMmB,MAAMnB,EAAMqC,SAChCT,EAAQrB,EAAOP,EAAMmB,KAAO,IAAMnB,EAAM4B,OAAO5B,EAAMqC,QACzD,QAAQlB,EAAKwB,YAAcf,EAAMgB,WAAahB,EAAMoB,eAkBhF/U,IAAI0R,UAAU,SAAU,WAAY,SAAShQ,GACzC,OACIiQ,SAAU,KACVnR,YAAa,iBACboR,YAAY,EACZlP,SAAS,EACTqP,OACI3N,MAAO,KAEX0N,KAAM,SAASC,EAAOC,EAASC,EAAY3N,GAsBvC,QAAS0Q,KACLtT,EAAS,WACL,IAAKqQ,EAAMqC,QAAQa,MAAMhD,EAAWiD,YAGhC,MADAnD,GAAM3N,MAAM+Q,OAASnD,EACdD,EAAMqC,QAAQa,MAAMhD,EAAW+C,QAEtCjD,GAAMqC,QAAQa,MAAM,0BAShC,QAASG,KACLpD,EAAQqD,IAAI,mBAAoBL,GAtCpCjD,EAAMuD,WAAa,WACf,GAAIvD,EAAM3N,MAAM+Q,SAAWnD,EAAS,CAShC,OAPI7M,KAAM4M,EAAM3N,MAAMmR,OAClBC,WAAYzD,EAAM3N,MAAMqR,aACxBlQ,QAASwM,EAAM3N,MAAMsR,UACrBC,UAAW5D,EAAM3N,MAAMwR,WACvBpQ,MAAOuM,EAAM3N,MAAMyR,SAKvB,MAAO,OAGf9D,EAAM+D,cAAgB,WAGlB,MAFgB/D,GAAM3N,MAAM+Q,QAAUpD,EAAM3N,MAAM+Q,SAAWnD,GAwBjED,EAAMzP,IAAI,WAAY,WAClB8S,MARJ,WACIpD,EAAQ+D,GAAG,mBAAoBf,WAc/ChV,IAAI0R,UAAU,cAAe,QAAS,iBAAkB,WAAY,SAASS,EAAOC,EAAgBC,GAGhG,QAAS2D,GAAQxD,EAAQC,EAASC,GAC9BF,EAASA,GAAU,GACnBC,EAAUA,GAAW,EACrB,IAAIE,GAAWH,EAAOI,MAAM,IAC5B,IAAID,EAASpM,OAAS,EAAG,CACrB,GAAIsM,GAAYF,EAAS3G,OAQzB,OAPA/L,SAAQ6B,QAAQ6Q,EAAU,SAASnQ,EAAOX,GAElCgR,EADAH,EACYG,EAAUD,MAAM,IAAM/Q,EAAQ,KAAK4E,KAAK,OAAUgM,EAAUjQ,EAAQ,QAEpEqQ,EAAUD,MAAM,IAAM/Q,EAAQ,KAAK4E,KAAKgM,EAAUjQ,KAGlEkQ,EACO,IAAOG,EAAY,IAEnBA,EAGX,MAAOJ,GAAUD,EAIzB,QAASyD,GAAiBjE,EAASC,GAC/B,GAAIiB,GAAOjB,EAAWiB,MAAQ,OAC1B3S,EAAQ0R,EAAW1R,OAAS,WAC5B4S,EAAclB,EAAWkB,aAAe5S,EACxCwI,EAAOxI,EAAMmC,QAAQ,gBAAiB,IAAIkQ,MAAM,KAAKnM,KAAK,OAASyP,EACnEC,EAAUjD,EAAO,IAAMnK,EACvBqN,EAAY,cAAgBD,EAAU,4BAA8BA,EAAU,mBAC9EjE,EAAU,GACVmE,EAAa,GACbC,EAAW,GACX/C,EAAStB,EAAWsB,MAAQtB,EAAWsB,MAAQ,OAC/C9Q,EAAOwP,EAAWxP,IAAMwP,EAAWxP,IAAM,KACzC6B,EAAQ2N,EAAW3N,MACnBiS,EAAUtE,EAAWuE,SAAW,eAAiBvE,EAAWuE,SAAW,IAAM,GAC7ExC,EAAS/B,EAAWwE,QAAU,cAAgBxE,EAAWwE,QAAU,IAAM,GACzEC,EAAQzE,EAAW0E,OAAS,aAAe1E,EAAW0E,OAAS,IAAM,GACrEC,EAAY3E,EAAW4E,KAAO,EAAI,EAClCC,EAAW,UAAYF,EACvBG,EAAW,WAAa,GAAKH,EACT,QAApB3E,EAAW4E,OACXE,EAAWD,EAAW,YAE1B,IAAI7D,GAAYhB,EAAWgB,SAAW,mBAAqB,GACvD+D,EAAY/E,EAAW+E,SAAW,YAAc,GAChDrS,EAAWsN,EAAWtN,QAAU,sBAAwBsN,EAAWtN,QAAU,KAAO,GACpFsS,EAAYhF,EAAWgF,SAAW,mBAAqBhF,EAAWgF,SAAW,KAAO,GACpFC,EAAUjF,EAAWiF,OAAS,YAAcjF,EAAWiF,OAAS,KAAO,GACvEC,EAAalF,EAAWkF,UAAY,eAAiBlF,EAAWkF,UAAY,KAAO,EAYvF,QAXIlF,EAAWqE,WACXA,EAAW,aAEXrE,EAAWmF,aACXd,EAAW,iBAAmBrE,EAAWmF,WAAa,KAEtDnF,EAAWgB,WACXoD,EAAapE,EAAW+E,UAAY/E,EAAWqE,SAAW,GAAK,kBAEnEpE,EAAU,uBAAyBD,EAAW+E,SAAW,GAAK,IAAM9D,EAAO,kBAAoBiD,EAAU,kBAAoBA,EAAU,yBACvIjE,GAAoB,yFACZD,EAAWoF,YACf,IAAK,WACDnF,GAAoB,+FACpB,MACJ,KAAK,QACDA,GAAoB,4FACpB,MACJ,KAAK,SACL,IAAK,QACDA,GAAoB,iGACpBA,GAAoB,mGAGH9G,KAArB6G,EAAWqF,QACXpF,GAAoB,6FAExBA,GAAoB,SACpB,IAAIqF,GAAa,kCAAqCpB,EAAU,iCAAqCA,EAAU,6BAAiCA,EAAU,iBAAmBjD,EAAO,kBAAoBiD,EAAU,iCAAqCA,EAAU,iBAC7P7S,EAAW,oBAAsBiU,EAAa,gBAAkBxO,EAAO,YAAcgO,EAAW,oBAAsBxW,EAAQ8V,EAAa,uBAAyBS,EAAW,QAAU7E,EAAWoF,WAAa,IACrN,QAAQpF,EAAWoF,YACf,IAAK,SAKD/T,GAAY,4BAJC2O,EAAWuF,MAAQ,cAAgBvF,EAAWuF,MAAQ,IAAM,KACxDvF,EAAWwF,UAAY,kBAAoBxF,EAAWwF,UAAY,IAAM,KACzExF,EAAWyF,SAAW,kBAAoBzF,EAAWyF,SAAW,IAAM,IAEd,wBAA0BpT,EAAQ,0BAD9F2N,EAAW0F,KAAO,2BAA6B1F,EAAW0F,KAAO,SAAW,IACqD,MAC7I,MACJ,KAAK,WACDrU,EAAW,eAAiBwT,EAAW,IAAMS,EAAa,yEAC1DjU,GAAY,oEAAsEgB,EAAQ,KAC1FhB,GAAY,oDACZA,GAAY,+CAAiD/C,EAAQ,UACrE+C,GAAY,UAQZ,MACJ,KAAK,QACDA,EAAW,oBAAsBiU,EAAa,2DAA6DhX,EAAQ8V,EAAa,WAChI/S,GAAY,eAAiByT,EAAW,mDACxCzT,GAAY,oEAAsEgB,EAAQ,gBAAkBA,EAAQ,OAASA,EAAQ,KACrIhB,GAAY,oDACZA,GAAY,yDACZA,GAAY,iBACZA,GAAY,eAAiByT,EAAW,mDACxCzT,GAAY,oEAAsEgB,EAAQ,kBAAoBA,EAAQ,KAAOA,EAAQ,OACrIhB,GAAY,oDACZA,GAAY,wDACZA,GAAY,UAQZ,MACJ,KAAK,SACG2O,EAAWqE,WACXA,EAAW,oBAEXrE,EAAWmF,aACXd,EAAW,cAAgBrE,EAAWmF,WAAa,KAEvD9T,EAAW,mCAAqCiU,EAAa,gBAAkBxO,EAAO,YAAcgO,EAAW,oBAAsBxW,EAAQ8V,EAAa,WAC1J/S,GAAY,eAAiBwT,EAAW,KACxCxT,GAAY,iBAAmByF,EAAO,eAAiBzE,EAAQ,KAAOiS,EAASvC,EAAQ0C,EAAO/R,EAAU,sBAAwBsO,EAAWqD,EAAWU,EAAWZ,EAAY,YAC7K,MACJ,KAAK,QACDa,EAAW,yBACX,IAAIW,GAAS7O,EAAO,KAChB8O,EAAY3E,EAAO,IAAM0E,EACzBE,EAAU7F,EAAW6F,QACrBC,EAAe,kCAAqCF,EAAY,iCAAqCA,EAAY,6BAAiCA,EAAY,iBAAmB3E,EAAO,kBAAoB2E,EAAY,iCAAqCA,EAAY,iBACzQG,EAAa/E,CACY,SAAzBhB,EAAW+F,WACXA,EAAa,mBACmB,SAAzB/F,EAAW+F,aAClBA,EAAa,GAEjB,IAAIC,GAAY,IACZC,EAAe,GAMnB,QALIjG,EAAWgB,UAAsC,UAA1BhB,EAAW+F,aAClCE,EAAejG,EAAW+E,UAAY/E,EAAWqE,SAAW,GAAK,kBAErE2B,EAAY,uBAAyBhG,EAAW+E,SAAW,GAAK,IAAM9D,EAAO,kBAAoB2E,EAAY,kBAAoBA,EAAY,yBAC7II,GAAwB,yFAChBhG,EAAWoF,YACf,IAAK,WACDY,GAAwB,+FACxB,MACJ,KAAK,QACDA,GAAwB,4FACxB,MACJ,KAAK,SACL,IAAK,QACDA,GAAwB,iGACxBA,GAAwB,+FAUhC,WAPyB7M,KAArB6G,EAAWqF,QACXW,GAAwB,6FAE5BA,GAAwB,UACxB3U,EAAW,gCAAkCyF,EAAO,YAAcgO,EAAW,oBAAsBxW,EAAQ,uBAAyBuW,EAAW,QAAU7E,EAAWoF,WAAa,KACjL/T,GAAY,0DAA4DiU,EAAa,IAAMlB,EAAa,qCAAuCtN,EAAO,eAAiBzE,EAAQ,KAAOiS,EAASvC,EAAQ0C,EAAO/R,EAAU,iBAAmBwO,EAAc,gBAAkBF,EAAWqD,EAAWU,EAAWZ,EAAYa,EAAWC,EAASC,EAAY,IAAMjF,EAAU,UACxW5O,GAAY,0DAA4DyU,EAAe,IAAMG,EAAe,qCAAuCN,EAAS,eAAiBE,EAAU,KAAOvB,EAASvC,EAAQ0C,EAAO/R,EAAU,iBAAmBwO,EAAc,gBAAkB6E,EAAa1B,EAAWU,EAAWZ,EAAYa,EAAWC,EAASC,EAAY,IAAMc,EAAY,UAClW,cAEtB,KAAK,eACD,GAAIE,GAAWlG,EAAWkG,QAAU,oBAAsBlG,EAAWkG,QAAU,KAAO,EACtFxT,GAAWsN,EAAWtN,QAAU,uBAAyBsN,EAAWtN,QAAU,KAAO,GACrFrB,GAAY,8BAAgCgB,EAAQ,KAAO6T,EAAUxT,EAAU,eAC/E,MACJ,KAAK,SACD,GAAI6O,GAAUvB,EAAWpD,IAAM,kBAAqBpM,EAAM,MAASwP,EAAWpD,IAAM,IAAM,GACtF4E,EAAcuC,EAAQzC,EAAO,SAAS,GACtC5O,EAAUsN,EAAWT,OACrB,QAAU/O,EAAM,OAASgR,EAAc,2CAA6CxB,EAAWyB,OAASF,EACxGC,EAAc,2CAA6CxB,EAAWyB,OAASF,EAAS,kBAAoB/Q,CAChHa,IAAY,iBAAmByF,EAAO,oCAAsCzE,EAAQ,KAAOiS,EAASvC,EAAQ0C,EAAO,gBAAkB/R,EAAU,MAAQsN,EAAWT,OAAS,oBAAsB,IAAMyB,EAAWqD,EAAW,8CAAgDnD,EAAc,oBAC3R,MACJ,KAAK,eACD,GAAIiF,KAAanG,EAAWmG,WAAYnG,EAAWmG,UAC/CC,IAAWpG,EAAWoG,SAAUpG,EAAWoG,QAC3CC,IAAarG,EAAWqG,WAAYrG,EAAWqG,UAC/CC,EAActG,EAAWsG,WAAa,iBAAmBtG,EAAWsG,WAAa,IAAM,EAC3FjV,IAAY,gBAAkByF,EAAO,eAAiBzE,EAAQ,oBAAsB2N,EAAWgB,SAAW,WAAa,IAAM,IAC7H3P,GAAY,8BAAgC2O,EAAWyB,OAAS,YAAcpP,EAAQ,YAAciP,EAAQ,WAAa9Q,EAAM,iBAAmB2V,EAAY,cAAgBC,EAAU,gBAAkBC,EAAY,kBAAoBnF,EAAc,eAAiBgD,EAAU,4BAA8BA,EAAU,mBAAqBoC,EAAa,SAC7V,MACJ,KAAK,WAEDjV,GAAY,mBAAqByF,EAAO,oCAAsCzE,EAAQ,KAAOiS,EAASvC,EAAQ0C,EAAO/R,EAAU,iBAAmBwO,EAAc,KAAOF,EAAWqD,EAAW,WADjLrE,EAAWuG,KAAOvG,EAAWuG,KAAO,KACgK,IAAMpC,EAAY,cAClO,MACJ,KAAK,WACD,GAAIqC,GAAa,EACbxG,GAAWqE,WACXmC,EAAa,uBAEbxG,EAAWmF,aACXqB,EAAa,iBAAmBxG,EAAWmF,WAAa,KAE5D9T,GAAY,2BAA6ByF,EAAO,6CAA+CzE,EAAQ,KAAOiS,EAASvC,EAAQ0C,EAAO/R,EAAU,iBAAmBwO,EAAc,KAAOF,EAAWwF,EAAazB,EAAWZ,GAAanE,EAAWgB,SAAW,mBAAqB,IAAM,SACzR,MACJ,KAAK,WACD3P,GAAY,yCAA2CyF,EAAO,oCAAsCzE,EAAQ,KAAOiS,EAASvC,EAAQ0C,EAAO/R,EAAU,iBAAmBwO,EAAc,kBAAoBpK,EAAO,iDAAoDkK,EAAWqD,EAAWF,EAAY,2CAA6C9R,EAAQ,2CAA6CyE,EAAO,YAAcA,EAAO,wBACra,MACJ,KAAK,QACDzF,GAAY,gBAAkByF,EAAO,oCAAsCzE,EAAQ,KAAOiS,EAASvC,EAAQ0C,EAAO/R,EAAU,iBAAmBwO,EAAc,kBAAoBF,EAAWqD,EAAWF,EAAY,GACnN,MACJ,KAAK,gBACDa,EAAW,6BAkBX3T,GAAY,uBAAyBgB,EAAQ,UAAY2N,EAAWpD,IAAM,UAAYoD,EAAWnD,IAAM,KACvGxL,GAAY,mBAAqByF,EAAO,oCAAsCzE,EAAQ,KAAOiS,EAASvC,EAAQ0C,EAAO/R,EAAU,iBAAmBwO,EAAc,gBAAkBF,EAAWqD,EAAWU,EAAWZ,EAAYa,EAAWC,EAASC,EAAY,IAC/P7T,GAAY,QACZ,MACJ,KAAK,SACD2T,EAAW,0BACX3T,GAAY,gBAAkByF,EAAO,oCAAsCzE,EAAQ,KAAOiS,EAASvC,EAAQ0C,EAAO/R,EAAU,iBAAmBwO,EAAc,gBAAkBF,EAAWqD,EAAWU,EAAWZ,EAAYa,EAAWC,EAASC,EAAY,GAC5P,MACJ,KAAK,YACDF,EAAW,6BACX3T,GAAY,gBAAkByF,EAAO,oCAAsCzE,EAAQ,KAAOiS,EAASvC,EAAQ0C,EAAO/R,EAAU,iBAAmBwO,EAAc,gBAAkBF,EAAWqD,EAAWU,EAAWZ,EAAYa,EAAWC,EAASC,EAAY,GAC5P,MACJ,KAAK,OACDF,EAAW,wBACXC,EAAS,uBACLjF,EAAWqE,UAAYrE,EAAW+E,SAClC1T,GAAY,0EAA4EyF,EAAO,eAAiBzE,EAAQ,kBAAoB6O,EAAc,KAAOF,EAAWqD,EAAWU,EAAWZ,EAAYa,EAAWC,EAAS,+EAElO5T,GAAY,4BAA8ByF,EAAO,6DAA+DA,EAAO,eAAiBzE,EAAQ,8BAAgC2O,EAAWqD,EAAWU,EAAWZ,EAAY,+NAC7N9S,GAAY,yBAA2ByF,EAAO,wFAA0FA,EAAO,eAAiBzE,EAAQ,kBAAoB6O,EAAc,KAAOF,EAAWqD,EAAWU,EAAWZ,EAAYa,EAAWC,EAAS,8EAEtR,MAOJ,KAAK,iBACD/D,EAAcA,GAAe,sBAE7B7P,GAAY,gBAAkByF,EAAO,oCAAsCzE,EAAQ,KAAOiS,EAASvC,EAAQ0C,EAAO/R,EAAU,iBAAmBwO,EAAc,0BAA4BF,EAAWqD,EAAWU,EAAWZ,EAAY,GACtO,MACJ,KAAK,OACL,QACI9S,GAAY,gBAAkByF,EAAO,oCAAsCzE,EAAQ,KAAOiS,EAASvC,EAAQ0C,EAAO/R,EAAU,iBAAmBwO,EAAc,gBAAkBF,EAAWqD,EAAWU,EAAWZ,EAAYa,EAAWC,EAASC,EAAY,IAGpQ,MAAO7T,GAAW4O,EAAU,eAnRhC,GAAIgE,GAAM,CAqRV,QACIvE,SAAU,IACVjP,SAAS,EACT2Q,QAAS,SAASqF,EAAiBC,GAC/B,MAAO,UAAS5G,EAAOC,EAASC,GAC5BD,EAAQ4G,KAAK3C,EAAiByC,EAAiBC,IAC/CtG,EAASL,EAAQ6G,YAAY9G,SAM7C/R,IAAI0R,UAAU,gBAAiB,SAAU,WAAY,SAASY,EAAQ5Q,GAClE,OACIiQ,SAAU,IACVrO,SAAU,8QAKVZ,SAAS,EACTkP,YAAY,EACZE,KAAM,SAASC,EAAOC,EAASC,EAAY3N,GAKvC,QAASwU,GAASC,GACd,GAAIlK,GAAMyD,EAAOL,EAAWpD,KAAKkD,GAC7BiH,EAAS1G,EAAOL,EAAWgH,cAC3BC,EAASF,EAAO/J,MACpBvN,GAAS,WACLwX,EAAOnH,EAAOtK,KAAKqH,IAAID,EAAKmK,EAAOjH,GAAS,MAKpD,QAASoH,GAAMJ,GACX,GAAIjK,GAAMwD,EAAOL,EAAWnD,KAAKiD,GAC7BiH,EAAS1G,EAAOL,EAAWgH,cAC3BC,EAASF,EAAO/J,MACpBvN,GAAS,WACLwX,EAAOnH,EAAOtK,KAAKoH,IAAIC,EAAKkK,EAAOjH,GAAS,MAUpD,QAASqD,KACLnV,QAAQ+R,QAAQoH,GAAY/D,IAAI,uBAAwByD,GACxD7Y,QAAQ+R,QAAQqH,GAAShE,IAAI,uBAAwB8D,GA/BzD,GAAIG,GAAOtH,EAAQ,GACfoH,EAAaE,EAAKC,iBAAiB,2BAA2B,GAC9DF,EAAUC,EAAKC,iBAAiB,2BAA2B,EA+B/DxH,GAAMzP,IAAI,WAAY,WAClB8S,MAVJ,WACInV,QAAQ+R,QAAQoH,GAAYrD,GAAG,uBAAwB+C,GACvD7Y,QAAQ+R,QAAQqH,GAAStD,GAAG,uBAAwBoD,WAepEnZ,IAAI0R,UAAU,gBAAiB,UAAW,SAAS8H,GAC/C,OACIpG,QAAS,UACTtB,KAAM,SAASC,EAAOC,EAASC,EAAY3N,GA0GvC,QAASmS,KACLzC,GAAQ,EACJkD,IACAlF,EAAQ,GAAGxP,MAAQ8B,EAAMmV,aAAe,KACnCnV,EAAMmV,aACPnV,EAAMoV,cAAc,OAKhC,QAASC,KACL,GAAIzC,IAAW5S,EAAMmQ,SACjB,OAAQmF,GACJ,IAAK,OACL,IAAK,WACL,IAAK,iBACD5H,EAAQ,GAAGxP,MAAQ8B,EAAMmV,YAAcD,EAAQ,QAAQlV,EAAMmV,YAAavC,GAAU,GACpF,MACJ,SACIlF,EAAQ,GAAGxP,MAAQ8B,EAAMmV,YAAcD,EAAQ,UAAUlV,EAAMmV,YAAatC,GAAa,IAAMD,EAAS,KAMxH,QAASP,KACL3C,GAAQ,EACR2F,IAQJ,QAASvE,KACLpD,EAAQqD,IAAI,QAASoB,GACrBzE,EAAQqD,IAAI,OAAQsB,GA9IxB,GAAIiD,GAAe3H,EAAW2H,aAC1B1C,EAASjF,EAAWiF,QAAU,GAC9BC,EAAYlF,EAAWkF,WAAa,EACpCnD,GAAQ,CACZ,QAAQ4F,GACJ,IAAK,OACL,IAAK,WACL,IAAK,iBACDtV,EAAMuV,YAAYnW,KAAK,SAASlB,GAC5B,MAAIA,GACOgX,EAAQ,QAAQhX,EAAO0U,GAEvB,MAGf,MACJ,KAAK,SACD5S,EAAMwV,SAASC,QAAQ,SAASvX,GAC5B,GAAIwX,IAAQ,CAwCZ,YAtCc5O,KAAV5I,GAAiC,KAAVA,GACvBwX,GAA6D,IAArDC,OAAOzX,GAAOqJ,QAAQiI,OAAOtR,GAAOiP,YAC5CjP,EAAQsR,OAAOtR,GACf8B,EAAM4V,aAAa,SAAUF,GACzBA,IACA1V,EAAM4V,aAAa,WAAY1X,GAAS,SACrB4I,KAAnB6G,EAAWpD,KAAoBvK,EAAM4V,aAAa,QAAS1X,GAASsR,OAAO7B,EAAWpD,UACnEzD,KAAnB6G,EAAWnD,KAAoBxK,EAAM4V,aAAa,QAAS1X,GAASsR,OAAO7B,EAAWnD,SAwB1FkL,GAAQ,EACRxX,EAAQsR,OAAOtR,GACf8B,EAAM4V,aAAa,UAAU,GAC7B5V,EAAM4V,aAAa,YAAY,OACZ9O,KAAnB6G,EAAWpD,KAAoBvK,EAAM4V,aAAa,SAAS,OACxC9O,KAAnB6G,EAAWnD,KAAoBxK,EAAM4V,aAAa,SAAS,IAExD1X,IAEX8B,EAAMuV,YAAYnW,KAAK,SAASlB,GAC5B,MAAIA,GACOgX,EAAQ,UAAUhX,EAAO2U,GAAa,IAAMD,EAE5C,MASf,MACJ,KAAK,YACD5S,EAAMwV,SAASC,QAAQ,SAASvX,GAC5B,GAAIwX,IAAQ,CAiBZ,YAfc5O,KAAV5I,GAAiC,KAAVA,GACvBwX,GAA6D,IAArDC,OAAOzX,GAAOqJ,QAAQiI,OAAOtR,GAAOiP,YAC5CjP,EAAQsR,OAAOtR,GACf8B,EAAM4V,aAAa,SAAUF,GACzBA,QACmB5O,KAAnB6G,EAAWpD,KAAoBvK,EAAM4V,aAAa,QAAS1X,GAASsR,OAAO7B,EAAWpD,UACnEzD,KAAnB6G,EAAWnD,KAAoBxK,EAAM4V,aAAa,QAAS1X,GAASsR,OAAO7B,EAAWnD,SAG1FkL,GAAQ,EACRxX,EAAQsR,OAAOtR,GACf8B,EAAM4V,aAAa,UAAU,OACV9O,KAAnB6G,EAAWpD,KAAoBvK,EAAM4V,aAAa,SAAS,OACxC9O,KAAnB6G,EAAWnD,KAAoBxK,EAAM4V,aAAa,SAAS,IAExD1X,IAEX8B,EAAMuV,YAAYnW,KAAK,SAASlB,GAC5B,MAAIA,IAAmB,IAAVA,EACFgX,EAAQ,UAAUhX,EAAO2U,GAAa,IAAMD,EAE5C,OA6CvBnF,EAAMzP,IAAI,WAAY,WAClB8S,MAVJ,WACIpD,EAAQ+D,GAAG,QAASU,GACpBzE,EAAQ+D,GAAG,OAAQY,WAkBnC3W,IAAI4K,QAAQ,SAAU,WAAY,SAASlJ,GACvC,QAASyC,KACLX,KAAK2W,SAAU,EACf3W,KAAK4W,OAmFT,MAjFAjW,GAAMwE,WACFyR,KAAM,WACF5W,KAAK+R,QAAS,EACd/R,KAAKqS,SAAU,EACfrS,KAAKoS,YAAa,EAClBpS,KAAKkS,WAAY,EACjBlS,KAAKiS,cAAe,EACpBjS,KAAK2R,OAAS,KACd3R,KAAK6W,WAET3V,QAAS,WACL,OAAQlB,KAAK+R,SAAW/R,KAAKoS,aAAepS,KAAKiS,cAErDtQ,KAAM,WACF,OAAK3B,KAAK+R,SACN/R,KAAK+R,QAAS,EACd/R,KAAKqS,SAAU,EACfrS,KAAKoS,YAAa,EAClBpS,KAAKkS,WAAY,EACjBlS,KAAKiS,cAAe,EACpBjS,KAAK6W,WAEE,IAKf9U,QAAS,WACL/B,KAAK+R,QAAS,EACd/R,KAAKqS,SAAU,EACfrS,KAAKoS,YAAa,EAClBpS,KAAKkS,WAAY,EACjBlS,KAAKiS,cAAe,EACpBjS,KAAK6W,UACL3Y,EAAS,WACL8B,KAAKiS,cAAe,EACpBjS,KAAK2R,OAAS,MAChBmF,KAAK9W,MAAO,MAElBgC,MAAO,SAASA,GACZhC,KAAK+R,QAAS,EACd/R,KAAKqS,SAAU,EACfrS,KAAKoS,YAAa,EAClBpS,KAAKkS,WAAY,EACjBlS,KAAKiS,cAAe,EACpBjS,KAAK6W,OAAO3W,KAAK8B,GACjB9D,EAAS,WACL8B,KAAKoS,YAAa,EAClBpS,KAAK2R,OAAS,MAChBmF,KAAK9W,MAAO,MAElBa,MAAO,WACHb,KAAK2W,SAAU,EACf3W,KAAK+B,WAETgV,aAAc,WACV,MAAO/W,MAAKqS,QAAUrS,KAAK6W,OAAO7W,KAAK6W,OAAO9T,OAAS,GAAK,MAEhEiU,YAAa,WACT,OACIrV,KAAM3B,KAAK+R,OACXlR,MAAOb,KAAK2W,QACZ3E,WAAYhS,KAAKiS,aACjBlQ,QAAS/B,KAAKkS,UACdC,UAAWnS,KAAKoS,WAChBpQ,MAAOhC,KAAKqS,UAGpB4E,cAAe,SAASC,EAAaC,EAAaC,EAAgBL,GAE9D,MADAG,GAAcA,GAAe,SACzBlX,KAAK+R,OACEoF,GAAeD,EACflX,KAAKkS,UACLkF,GAAkBF,EAClBlX,KAAKqS,QACL0E,GAAgBG,EAEhBA,IAIZvW,KAIXnE,IAAI6a,QAAQ,UAAW,YAAa,SAAS/W,GAKzC,QAASgX,GAAS5W,GACdJ,EAAU6B,oBAAsB7B,EAAUI,OAC1CJ,EAAUI,KAAKA,GALLV,KACNsX,SAAWA,KASvB9a,IAAI6a,QAAQ,eAAgB,KAAM,YAAa,gBAAiB,kBAAmB,iBAAkB,eAAgB,SAASpZ,EAAIqC,EAAWiX,EAAeC,EAAiBC,EAAgBC,GAgCzL,QAASC,KACL,GAAI/X,GAAW3B,EAAG4B,OAClB,IAAIwX,EAAQO,SACRhY,EAAS1C,QAAQma,EAAQO,cACtB,CACQL,IACNM,oBAAqBC,SAAU,gBAAiBrX,KAAK,SAASsX,GAC/D,GAAIH,GAAWP,EAAQO,UACnB9S,IAAKiT,EAAOjT,IAEhBlF,GAAS1C,QAAQ0a,KAClBI,MAAM,SAAShW,GACd3C,QAAQD,IAAI,QAAS4C,GACrBpC,EAASK,OAAO+B,KAGxB,MAAOpC,GAASQ,QAGpB,QAASrB,KACL,GAAIa,GAAW3B,EAAG4B,OAClB,IAAIwX,EAAQla,KACRyC,EAAS1C,QAAQma,EAAQla,UACtB,CACH,GAAI8a,GAAQP,EAAQpQ,IAAI,QACpB2Q,GACAN,IAAUlX,KAAK,SAASwH,GACTiQ,EAASC,WAAWC,MACXC,MAAM,SACjBC,aAAa,SAASC,QAAQN,GAAO1F,GAAG,QAAS,SAASiG,GAC/D,GAAIrb,GAAOka,EAAQla,KAAOsb,EAAeD,EACrCrb,IACAua,EAAQ3P,IAAI,QAAS5K,EAAK8a,OAC1BrY,EAAS1C,QAAQC,IAEjByC,EAASK,YAGlB,WACCL,EAASK,WAGbL,EAASK,SAGjB,MAAOL,GAASQ,QAGpB,QAAS8B,GAAOpB,GACZzB,QAAQD,IAAI,qBAAsB0B,EAClC,IAAIlB,GAAW3B,EAAG4B,OAuBlB,OAtBIwX,GAAQla,MACRkC,QAAQD,IAAI,SAAUiY,EAAQla,MAC9ByC,EAAS1C,QAAQma,EAAQla,OAEzBwa,IAAUlX,KAAK,SAASmX,GACTM,EAASC,WAAWC,MACXC,MAAM,SACjBC,aAAa,SAASC,QAAQzX,EAAM4X,OAAOnG,GAAG,QAAS,SAASiG,GACrE,GAAIrb,GAAOka,EAAQla,KAAOsb,EAAeD,EACrCrb,IAAQA,EAAKwb,WAAa7X,EAAM6X,UAChCjB,EAAQ3P,IAAI,QAAS5K,EAAK8a,OAC1BrY,EAAS1C,QAAQC,IAEjByC,EAASK,QACLyO,QAAS,iBAItB,WACC9O,EAASK,WAGVL,EAASQ,QAGpB,QAASgC,GAAOtB,GACZzB,QAAQD,IAAI,qBAAsB0B,EAClC,IAAIlB,GAAW3B,EAAG4B,OAiBlB,OAhBA8X,KAAUlX,KAAK,SAASwH,GACpB5I,QAAQD,IAAI,YAAa6I,EACzB,IAAI2Q,GAAOV,EAASC,WAAWC,MAC3BS,EAAWD,EAAKP,MAAM,SACtBS,EAAUD,EAAS3Y,MACvBY,GAAMmX,MAAQZ,EAAQO,SAAS9S,IAC/B4S,EAAQ3P,IAAI,QAASjH,EAAMmX,OAC3Ba,EAAQ/Q,IAAIjH,GACZuW,EAAQla,KAAO2D,EACfuW,EAAQ0B,WAAa,WACjBD,EAAQ/Q,IAAIjH,IAEhBlB,EAAS1C,QAAQ4D,IAClB,WACClB,EAASK,WAENL,EAASQ,QAGpB,QAASG,KACLlB,QAAQD,IAAI,sBACZ,IAAIQ,GAAW3B,EAAG4B,OAIlB,OAHA6X,GAAQsB,OAAO,SACf3B,EAAQla,KAAO,KACfyC,EAAS1C,UACF0C,EAASQ,QAGpB,QAAS6Y,KACL,MAAOC,GAAS,SAAWjB,MAAO,UAGtC,QAAS5a,GAAeia,GACpB,GAAI1X,GAAW3B,EAAG4B,OAQlB,OAPAd,KAAU0B,KAAK,SAAStD,GACpByC,EAAS1C,QAAQma,EAAQla,OAC1B,WACCyC,EAASK;WACTK,EAAU6B,oBAAsB7B,EAAUI,OAC1CJ,EAAUI,KAAK4W,KAEZ1X,EAASQ,QAwCpB,QAAS+Y,GAASC,GACd,GAAIC,KACJ,KAAK,GAAIpR,KAAKmR,GACVC,EAAOnZ,MACHjB,IAAKgJ,EACLjJ,MAAOoa,EAAMnR,IAGrB,IAAIkI,GAAQ,IAIZ,OAHIkJ,GAAOtW,SACPoN,EAAQkJ,EAAO7Q,SAEZ2H,EAGX,QAAS+I,GAASI,EAAYF,EAAOG,GACjC,GAAI3Z,GAAW3B,EAAG4B,QACd+Y,EAAOV,EAASC,WAAWC,MAC3BA,EAAMQ,EAAKP,MAAMiB,GACjBE,EAAQ,IACZ,IAAIJ,EAAO,CACP,GAAIjJ,GAAQgJ,EAASC,EACrB,IAAIjJ,EAAO,CACP,GAAIsJ,GAAWrB,EAAIE,aAAanI,EAAMlR,KAAKsZ,QAAQpI,EAAMnR,MACrDua,KACAE,EAAWA,EAASC,YAAYH,IAEpCC,EAAQ/B,EAAegC,IAS/B,MANAD,GAAQA,GAAS/B,EAAeW,GAChCoB,EAAMG,QAAQ,SAASH,GACnB5Z,EAAS1C,QAAQsc,IAClB,SAASxX,GACRpC,EAASK,OAAO+B,KAEbpC,EAASQ,QAGpB,QAASqY,GAAeD,GACpB,GAAI5T,GAAO,IACX,IAAI4T,EAAKoB,cAAe,CACpB,GAAI3X,GAAQuW,EAAKqB,KAEjBjV,GAAO3C,EADIsF,OAAOW,KAAKjG,GACL,IAEtB,MAAO2C,GA5OX,GAAIsT,GAAW4B,OAAO5B,UAAY,IAClC,KAAIA,EAWA,KAAM,qBAVN,IAAIvb,IACAod,OAAQ,0CACRC,WAAY,iCACZC,YAAa,wCACbC,UAAW,iBACXC,cAAe,6BACfC,kBAAmB,eAEvBlC,GAASmC,cAAc1d,EAK3B,IAAI0a,GAAUrX,IACdqX,GAAQla,SAAOyK,GACfyP,EAAQO,aAAWhQ,GACnByP,EAAQpV,MAAQgX,EAChB5B,EAAQ7W,MACJ0B,OAAQA,EACRE,OAAQA,EACR7B,QAASA,GAEb8W,EAAQzV,OACJC,KAAM,MAEVwV,EAAQtY,QAAUA,EAClBsY,EAAQha,eAAiBA,KAmV7Bb,IAAI6a,QAAQ,UAAW,QAAS,KAAM,WAAY,YAAa,SAAS1I,EAAO1Q,EAAIC,EAAUoC,GAEzF,GAAI+W,GAAUrX,IAEHA,MAAKsH,IAAM,SAASgT,EAAK3a,GAChC,GAAIC,GAAW3B,EAAG4B,OAMlB,OALA8O,GAAMrH,IAAIgT,GAAO3a,OAAQA,IAAUc,KAAK,SAASqB,GAC7ClC,EAAS1C,QAAQ4E,EAAS/B,OAC3B,SAAS+B,GACRyY,QAAQ3a,EAAU,MAAO0a,GAAO3a,OAAQA,GAAUmC,KAE/ClC,EAASQ,SAERJ,KAAKwa,KAAO,SAASF,EAAKxZ,GAClC,GAAIlB,GAAW3B,EAAG4B,OAWlB,OAVIwX,GAAQoD,OACRpb,QAAQD,IAAI,YAAakb,EAAKxZ,GAC9BlB,EAAS1C,QAAQ4D,IAEjB6N,EAAM6L,KAAKF,EAAKxZ,GAAOL,KAAK,SAASqB,GACjClC,EAAS1C,QAAQ4E,EAAS/B,OAC3B,SAAS+B,GACRyY,QAAQ3a,EAAU,OAAQ0a,EAAKxZ,EAAOgB,KAGvClC,EAASQ,SAETJ,KAAK0a,IAAM,SAASJ,EAAKxZ,GAChC,GAAIlB,GAAW3B,EAAG4B,OAMlB,OALA8O,GAAM+L,IAAIJ,EAAKxZ,GAAOL,KAAK,SAASqB,GAChClC,EAAS1C,QAAQ4E,EAAS/B,OAC3B,SAAS+B,GACRyY,QAAQ3a,EAAU,MAAO0a,EAAKxZ,EAAOgB,KAElClC,EAASQ,SAEPJ,KAAK2a,MAAQ,SAASL,EAAKxZ,GACpC,GAAIlB,GAAW3B,EAAG4B,OAMlB,OALA8O,GAAMgM,MAAML,EAAKxZ,GAAOL,KAAK,SAASqB,GAClClC,EAAS1C,QAAQ4E,EAAS/B,OAC3B,SAAS+B,GACRyY,QAAQ3a,EAAU,QAAS0a,EAAKxZ,EAAOgB,KAEpClC,EAASQ,SAENJ,KAAKgZ,OAAS,SAASsB,GACjC,GAAI1a,GAAW3B,EAAG4B,OAMlB,OALA8O,GAAMqK,OAAOsB,GAAK7Z,KAAK,SAASqB,GAC5BlC,EAAS1C,QAAQ4E,EAAS/B,OAC3B,SAAS+B,GACRyY,QAAQ3a,EAAU,SAAU0a,EAAK,KAAMxY,KAEpClC,EAASQ,SAERJ,KAAK4a,KAAO,SAASN,EAAKxZ,GAClC,GAAIlB,GAAW3B,EAAG4B,OAmBlB,OAlBIwX,GAAQoD,OACRpb,QAAQD,IAAI,YAAakb,EAAKxZ,GAC9BlB,EAAS1C,QAAQ4D,IAEjB6N,GACI2L,IAAKA,EACLO,OAAQ,OACR9a,KAAMe,EACNga,SACIC,eAAgB,oBAEpBC,aAAc,gBACfva,KAAK,SAASqB,GACblC,EAAS1C,QAAQ4E,IAClB,SAASA,GACRyY,QAAQ3a,EAAU,OAAQ0a,EAAKxZ,EAAOgB,KAGvClC,EAASQ,QAGpBJ,MAAKQ,MACD0B,OAAQ+Y,SAAS/Y,OAEjB3B,QAAS,SAAS2a,KAGlBnc,QAAS,WACL,GAAIa,GAAW3B,EAAG4B,OAMlB,OALIob,UAAS9d,KACTyC,EAAS1C,QAAQ+d,SAAS9d,MAE1ByC,EAASK,SAENL,EAASQ,aAO5B5D,IAAI4K,QAAQ,UAAW,KAAM,UAAW,SAASnJ,EAAIF,GACjD,QAASod,MAiFT,MAhFAA,GAAOC,QAAU,IACjBD,EAAOE,KAAO,SAAS9V,EAAMvG,EAAOsH,GAChC,GAAIgV,EACJ,IAAIhV,EAAM,CACN,GAAI5D,GAAO,GAAIqB,KACfrB,GAAK6Y,QAAQ7Y,EAAK8B,UAAoB,GAAP8B,EAAY,GAAK,GAAK,KACrDgV,EAAU,aAAe5Y,EAAK8Y,kBAE9BF,GAAU,EAEdvd,GAAQ0d,SAASC,OAASnW,EAAO,IAAMvG,EAAQsc,EAAU,YAE7DH,EAAOpT,IAAM,SAASxC,EAAMvG,EAAOsH,GAC/B,IACI,GAAIqV,MACAC,EAAOC,KAAKC,UAAU9c,EAAO,SAASC,EAAKD,GAC3C,GAAY,SAARC,EAAJ,CAGA,GAAqB,gBAAVD,IAAgC,OAAVA,EAAgB,CAC7C,IAA8B,IAA1B2c,EAAMtT,QAAQrJ,GAEd,MAEJ2c,GAAMzb,KAAKlB,GAEf,MAAOA,KAEX2c,GAAQ,KACRR,EAAOE,KAAK9V,EAAMqW,EAAMtV,GAC1B,MAAOiP,GACLlW,QAAQD,IAAI,+BAAgCmG,EAAMvG,EAAOuW,KAGjE4F,EAAO7T,IAAM,SAAS/B,GAGlB,IAAK,GAFDwW,GAAaxW,EAAO,IACpByW,EAAKje,EAAQ0d,SAASC,OAAOtM,MAAM,KAC9B3Q,EAAI,EAAGA,EAAIud,EAAGjZ,OAAQtE,IAAK,CAEhC,IADA,GAAIqK,GAAIkT,EAAGvd,GACW,KAAfqK,EAAEmT,OAAO,IACZnT,EAAIA,EAAEoT,UAAU,EAAGpT,EAAE/F,OAEzB,IAA8B,IAA1B+F,EAAET,QAAQ0T,GAAmB,CAC7B,GAAI/c,GAAQ8J,EAAEoT,UAAUH,EAAWhZ,OAAQ+F,EAAE/F,QACzCjC,EAAQ,IACZ,KACIA,EAAQ+a,KAAKM,MAAMnd,GACrB,MAAOuW,GACLlW,QAAQD,IAAI,2BAA4BH,IAAKsW,GAEjD,MAAOzU,IAGf,MAAO,OAEXqa,EAAOnC,OAAS,SAASzT,GACrB4V,EAAOE,KAAK9V,EAAM,IAAK,IAE3B4V,EAAO5I,GAAK,SAAShN,GAMjB,QAAS6W,KACL,GAAIC,EAAUC,EACV1c,EAASK,OAAO,eACb,CACH,GAAI6I,GAAIqS,EAAO7T,IAAI/B,EACfuD,GACAlJ,EAAS1C,QAAQ4L,IAEjBuT,GAAWE,EACX9d,EAAI+d,WAAWJ,EAAaG,KAdxC,GACI9d,GADAmB,EAAW3B,EAAG4B,QACX0c,EAAW,IACdF,EAAU,EACVC,EAAUnB,EAAOC,OAgBrB,OADAgB,KACOxc,EAASQ,SAEb+a,KAGX3e,IAAI4K,QAAQ,gBAAiB,KAAM,UAAW,SAAU,SAASnJ,EAAIF,EAASod,GAC1E,QAASsB,MAqFT,MApEAA,GAAaC,YAfb,WACI,GAAIC,IAAY,CAChB,KACIA,EAAY,gBAAkB5e,IAAoC,OAAzBA,EAAQ6e,aAC7CD,GACA5e,EAAQ6e,aAAaC,QAAQ,OAAQ,KACrC9e,EAAQ6e,aAAaE,WAAW,SAEhCH,GAAY,EAElB,MAAOpH,GACLoH,GAAY,EAEhB,MAAOA,MAGPF,EAAaC,aACbD,EAAa1U,IAAM,SAASxC,EAAMvG,GAC9B,IACI,GAAI2c,MACAC,EAAOC,KAAKC,UAAU9c,EAAO,SAASC,EAAKD,GAC3C,GAAY,SAARC,EAAJ,CAGA,GAAqB,gBAAVD,IAAgC,OAAVA,EAAgB,CAC7C,IAA8B,IAA1B2c,EAAMtT,QAAQrJ,GAEd,MAEJ2c,GAAMzb,KAAKlB,GAEf,MAAOA,KAEX2c,GAAQ,KACR5d,EAAQ6e,aAAaC,QAAQtX,EAAMqW,GACrC,MAAOrG,GACLlW,QAAQD,IAAI,qCAAsCmG,EAAMvG,EAAOuW,KAGvEkH,EAAanV,IAAM,SAAS/B,GACxB,GAAIvG,GAAQ,IACZ,QAAmC4I,KAA/B7J,EAAQ6e,aAAarX,GACrB,IACIvG,EAAQ6c,KAAKM,MAAMpe,EAAQ6e,aAAarX,IAC1C,MAAOgQ,GACLlW,QAAQD,IAAI,iCAAkCmG,EAAMgQ,GAG5D,MAAOvW,IAEXyd,EAAazD,OAAS,SAASzT,GAC3BxH,EAAQ6e,aAAaE,WAAWvX,IAEpCkX,EAAalK,GAAK,SAAShN,GAIvB,QAASwX,GAAaxH,GAGlB,GADAyH,aAAave,GACT8W,EAAE0H,cAAche,KAAOsG,EACvB,IACI,GAAIvG,GAAQ6c,KAAKM,MAAM5G,EAAE0H,cAAcC,SACvCtd,GAAS1C,QAAQ8B,GACnB,MAAOgD,GACL3C,QAAQD,IAAI,gCAAiCmG,EAAMvD,GACnDpC,EAASK,OAAO,iBAAmBsF,IAZ/C,GACI9G,GADAmB,EAAW3B,EAAG4B,QACXyc,EAAUnB,EAAOC,OAmBxB,OAJA3e,SAAQ+R,QAAQzQ,GAASwU,GAAG,UAAWwK,GACvCte,EAAI+d,WAAW,WACX5c,EAASK,OAAO,YACjBqc,GACI1c,EAASQ,WAGpBf,QAAQD,IAAI,iDACZqd,EAAa1U,IAAMoT,EAAOpT,IAC1B0U,EAAanV,IAAM6T,EAAO7T,IAC1BmV,EAAazD,OAASmC,EAAOnC,OAC7ByD,EAAalK,GAAK4I,EAAO5I,IAEtBkK,KAGXjgB,IAAI4K,QAAQ,kBAAmB,KAAM,UAAW,SAAU,SAASnJ,EAAIF,EAASod,GAC5E,QAASgC,MAqFT,MApEAA,GAAeT,YAff,WACI,GAAIC,IAAY,CAChB,KACIA,EAAY,kBAAoB5e,QAAsC6J,KAA3B7J,EAAQqf,eAC/CT,GACA5e,EAAQqf,eAAeP,QAAQ,OAAQ,KACvC9e,EAAQqf,eAAeN,WAAW,SAElCH,GAAY,EAElB,MAAOpH,GACLoH,GAAY,EAEhB,MAAOA,MAGPQ,EAAeT,aACfS,EAAepV,IAAM,SAASxC,EAAMvG,GAChC,IACI,GAAI2c,MACAC,EAAOC,KAAKC,UAAU9c,EAAO,SAASC,EAAKD,GAC3C,GAAY,SAARC,EAAJ,CAGA,GAAqB,gBAAVD,IAAgC,OAAVA,EAAgB,CAC7C,IAA8B,IAA1B2c,EAAMtT,QAAQrJ,GAEd,MAEJ2c,GAAMzb,KAAKlB,GAEf,MAAOA,KAEX2c,GAAQ,KACR5d,EAAQqf,eAAeP,QAAQtX,EAAMqW,GACvC,MAAOrG,GACLlW,QAAQD,IAAI,uCAAwCmG,EAAMvG,EAAOuW,KAGzE4H,EAAe7V,IAAM,SAAS/B,GAC1B,GAAIvG,GAAQ,IACZ,QAAqC4I,KAAjC7J,EAAQqf,eAAe7X,GACvB,IACIvG,EAAQ6c,KAAKM,MAAMpe,EAAQqf,eAAe7X,IAC5C,MAAOgQ,GACLlW,QAAQD,IAAI,mCAAoCmG,EAAMgQ,GAG9D,MAAOvW,IAEXme,EAAenE,OAAS,SAASzT,GAC7BxH,EAAQqf,eAAeN,WAAWvX,IAEtC4X,EAAe5K,GAAK,SAAShN,GAIzB,QAASwX,GAAaxH,GAGlB,GADAyH,aAAave,GACT8W,EAAE0H,cAAche,MAAQsG,EACxB,IACI,GAAIvG,GAAQ6c,KAAKM,MAAM5G,EAAE0H,cAAcC,SACvCtd,GAAS1C,QAAQ8B,GACnB,MAAOgD,GACL3C,QAAQD,IAAI,kCAAmCmG,EAAMvD,GACrDpC,EAASK,OAAO,iBAAmBsF,IAZ/C,GACI9G,GADAmB,EAAW3B,EAAG4B,QACXyc,EAAUnB,EAAOC,OAmBxB,OAJA3e,SAAQ+R,QAAQzQ,GAASwU,GAAG,UAAWwK,GACvCte,EAAI+d,WAAW,WACX5c,EAASK,OAAO,YACjBqc,GACI1c,EAASQ,WAGpBf,QAAQD,IAAI,mDACZ+d,EAAepV,IAAMoT,EAAOpT,IAC5BoV,EAAe7V,IAAM6T,EAAO7T,IAC5B6V,EAAenE,OAASmC,EAAOnC,OAC/BmE,EAAe5K,GAAK4I,EAAO5I,IAExB4K","file":"app.min.js","sourcesContent":["/* global angular */\r\n\r\n\"use strict\";\r\n\r\nvar app = angular.module('app', ['ngRoute', 'ngMessages', 'mapboxgl-directive', 'firebase', 'jsonFormatter']);\r\n\r\napp.config(['$routeProvider', '$locationProvider', function($routeProvider, $locationProvider) {\r\n\r\n    $routeProvider.when('/', {\r\n        title: 'Homepage',\r\n        templateUrl: 'partials/home.html',\r\n        controller: 'HomeCtrl',\r\n\r\n    }).when('/profile', {\r\n        title: 'Profile',\r\n        templateUrl: 'partials/profile.html',\r\n        controller: 'ProfileCtrl',\r\n        resolve: {\r\n            user: ['FirebaseApi', function(api) {\r\n                return api.isLoggedOrGoTo('/signin');\r\n            }],\r\n        },\r\n\r\n    }).when('/signin', {\r\n        title: 'Accedi',\r\n        templateUrl: 'partials/signin.html',\r\n        controller: 'SigninCtrl',\r\n\r\n    }).when('/signup', {\r\n        title: 'Registrazione',\r\n        templateUrl: 'partials/signup.html',\r\n        controller: 'SignupCtrl',\r\n\r\n    }).when('/dashboard', {\r\n        title: 'Dashboard',\r\n        templateUrl: 'partials/dashboard.html',\r\n        controller: 'DashboardCtrl',\r\n        resolve: {\r\n            user: ['FirebaseApi', function(api) {\r\n                return api.isLoggedOrGoTo('/signin');\r\n            }],\r\n        },\r\n\r\n    }).when('/user/:userId', {\r\n        title: 'User',\r\n        templateUrl: 'partials/user.html',\r\n        controller: 'UserCtrl',\r\n        resolve: {\r\n            user: ['FirebaseApi', function(api) {\r\n                return api.isLoggedOrGoTo('/signin');\r\n            }],\r\n        },\r\n\r\n    }).when('/404', {\r\n        title: 'Error 404',\r\n        templateUrl: 'partials/404',\r\n\r\n    });\r\n\r\n    // $routeProvider.otherwise('/'); // stream\r\n\r\n    // HTML5 MODE url writing method (false: #/anchor/use, true: /html5/url/use)\r\n    $locationProvider.html5Mode(false);\r\n    $locationProvider.hashPrefix('');\r\n\r\n}]);\r\n\r\napp.config(['$httpProvider', function($httpProvider) {\r\n    $httpProvider.defaults.withCredentials = true;\r\n}]);\r\n\r\napp.run(['$rootScope', '$route', '$routeParams', '$window', '$document', '$q', '$timeout', function($rootScope, $route, $routeParams, $window, $document, $q, $timeout) {\r\n\r\n    $rootScope.standalone = $window.navigator.standalone;\r\n\r\n    $rootScope.$on('$routeChangeSuccess', function() {\r\n        var title = $route.current.title;\r\n        angular.forEach($routeParams, function(value, key) {\r\n            title = title.replace(new RegExp(':' + key, 'g'), value);\r\n        });\r\n        $document.title = title || '';\r\n    });\r\n\r\n    $rootScope.log = function() {\r\n        if ($window.console && $window.console.info) {\r\n            $window.console.info.apply($window.console, arguments);\r\n        }\r\n    };\r\n\r\n    // MODALS\r\n    $rootScope.modals = [];\r\n\r\n    function closeModal(modal) {\r\n        var index = -1;\r\n        angular.forEach($rootScope.modals, function(m, i) {\r\n            if (m === modal) {\r\n                index = i;\r\n            }\r\n        });\r\n        if (index !== -1) {\r\n            modal.active = false;\r\n            $timeout(function() {\r\n                $rootScope.modals.splice(index, 1);\r\n            }, 500);\r\n        }\r\n    }\r\n\r\n    $rootScope.addModal = function(modalType, title, params) {\r\n        var deferred = $q.defer();\r\n        params = params || null;\r\n        var modal = {\r\n            title: 'Untitled',\r\n            controller: null,\r\n            template: null,\r\n            params: params,\r\n        };\r\n        switch (modalType) {\r\n            case 'messageModal':\r\n                modal = {\r\n                    title: title || 'Messaggio',\r\n                    controller: 'MessageModalCtrl',\r\n                    template: 'partials/modals/message',\r\n                    params: params,\r\n                };\r\n                break;\r\n        }\r\n        modal.deferred = deferred;\r\n        modal.resolve = function(data) {\r\n            closeModal(this);\r\n            modal.deferred.resolve(data, modal);\r\n        };\r\n        modal.reject = function() {\r\n            closeModal(this);\r\n            modal.deferred.reject(modal);\r\n        };\r\n        $rootScope.modals.push(modal);\r\n        angular.forEach($rootScope.modals, function(m, i) {\r\n            m.active = false;\r\n        });\r\n        $timeout(function() {\r\n            modal.active = true;\r\n            $window.scrollTo(0, 0);\r\n        }, 500);\r\n        return deferred.promise;\r\n    };\r\n\r\n}]);\n/* global angular, app */\r\n\n/* global angular, app */\r\n\r\napp.controller('RootCtrl', ['$scope', '$location', 'FirebaseApi', function($scope, $location, api) {\r\n\r\n    $scope.api = api;\r\n\r\n    $scope.signout = function() {\r\n        console.log(api);\r\n        api.auth.signout().then(function() {\r\n            $location.path('/');\r\n        });\r\n    };\r\n\r\n    api.current().then(function(user) {\r\n        console.log(user);\r\n    });\r\n\r\n}]);\r\n\r\napp.controller('HomeCtrl', ['$scope', '$location', '$timeout', 'State', 'FirebaseApi', function($scope, $location, $timeout, State, api) {\r\n\r\n    var state = $scope.state = new State();\r\n\r\n    state.ready();\r\n\r\n}]);\r\n\r\napp.controller('ProfileCtrl', ['$scope', '$location', '$timeout', 'State', 'FirebaseApi', function($scope, $location, $timeout, State, api) {\r\n\r\n    var state = $scope.state = new State();\r\n\r\n    var model = $scope.model = {};\r\n\r\n    api.current().then(function(user) {\r\n        angular.extend(model, user);\r\n        state.ready();\r\n    });\r\n\r\n    var glControls = {\r\n        navigation: {\r\n            enabled: true,\r\n            options: {} // Navigation control options --> https://www.mapbox.com/mapbox-gl-js/api/#Navigation\r\n        },\r\n        scale: {\r\n            enabled: true,\r\n            options: {} // Scale control options --> https://www.mapbox.com/mapbox-gl-js/api/#Scale\r\n        },\r\n        attribution: {\r\n            enabled: false,\r\n            options: {} // Attribution control options --> https://www.mapbox.com/mapbox-gl-js/api/#Attribution\r\n        },\r\n        geolocate: {\r\n            enabled: true,\r\n            options: {} // Geolocate control options --> https://www.mapbox.com/mapbox-gl-js/api/#Geolocate\r\n        },\r\n        geocoder: {\r\n            enabled: true,\r\n            options: {} // Geocoder control options --> https://github.com/mapbox/mapbox-gl-geocoder/blob/master/API.md\r\n        },\r\n        directions: {\r\n            enabled: false,\r\n            options: {} // Directions control options --> https://github.com/mapbox/mapbox-gl-directions/blob/master/API.md#mapboxgldirections\r\n        },\r\n        draw: {\r\n            enabled: false,\r\n            options: {} // Draw control options -> https://github.com/mapbox/mapbox-gl-draw/blob/master/API.md#options\r\n        }\r\n    };\r\n\r\n    $scope.glControls = glControls;\r\n\r\n    $scope.submit = function() {\r\n        if (state.busy()) {\r\n            api.users.save(model).then(function success(response) {\r\n                state.success();\r\n            }, function error(response) {\r\n                state.error(response);\r\n            });\r\n        }\r\n    };\r\n\r\n}]);\r\n\r\napp.controller('DashboardCtrl', ['$scope', '$location', '$timeout', 'State', 'FirebaseApi', function($scope, $location, $timeout, State, api) {\r\n\r\n    var state = $scope.state = new State();\r\n\r\n    state.ready();\r\n\r\n    api.items().then(function(items) {\r\n        console.log('DashboardCtrl.items', items);\r\n        $scope.items = items;\r\n    });\r\n\r\n}]);\r\n\r\napp.controller('SigninCtrl', ['$scope', '$location', '$timeout', 'State', 'FirebaseApi', function($scope, $location, $timeout, State, api) {\r\n\r\n    var state = $scope.state = new State();\r\n\r\n    var model = $scope.model = {};\r\n\r\n    $scope.submit = function() {\r\n        if (state.busy()) {\r\n            api.auth.signin(model).then(function success(response) {\r\n                state.success();\r\n                // $timeout(function() {\r\n                var path = $location.$$lastRequestedPath || '/dashboard';\r\n                console.log('SigninCtrl', path, response);\r\n                $location.path(path);\r\n                $location.$$lastRequestedPath = null;\r\n                // }, 1000);\r\n            }, function error(response) {\r\n                console.log('SigninCtrl.error', response);\r\n                state.error(response);\r\n            });\r\n        }\r\n    };\r\n\r\n}]);\r\n\r\napp.controller('SignupCtrl', ['$scope', '$location', '$timeout', 'State', 'FirebaseApi', function($scope, $location, $timeout, State, api) {\r\n\r\n    var state = $scope.state = new State();\r\n\r\n    var model = $scope.model = {};\r\n\r\n    $scope.submit = function() {\r\n        if (state.busy()) {\r\n            api.auth.signup(model).then(function success(response) {\r\n                state.success();\r\n                // $timeout(function() {\r\n                var path = $location.$$lastRequestedPath || '/dashboard';\r\n                console.log('SignupCtrl', path, response);\r\n                $location.path(path);\r\n                $location.$$lastRequestedPath = null;\r\n                // }, 1000);\r\n            }, function error(response) {\r\n                console.log('SignupCtrl.error', response);\r\n                state.error(response);\r\n            });\r\n        }\r\n    };\r\n\r\n}]);\r\n\r\napp.controller('DemoCtrl', ['$scope', '$interval', 'Hash', 'Calendar', 'GanttRow', function($scope, $interval, Hash, Calendar, GanttRow) {\r\n\r\n    var row = $scope.row = new GanttRow({\r\n        activity: {\r\n            id: 1000000 + getRandom(),\r\n            name: 'Activity',\r\n            budgetHours: 10 + Math.floor(Math.random() * 50),\r\n        },\r\n        project: {\r\n            type: Math.floor(Math.random() * 5),\r\n            deliveryDate: new Date(),\r\n        },\r\n    }, []);\r\n\r\n    $scope.addItem = function() {\r\n        var item = getRandomItem();\r\n        row.slots.add(item);\r\n        row.update();\r\n        row.updateMonths();\r\n        $scope.item = item;\r\n        // console.log('addItem', item.id);\r\n        log('addItem', item.id);\r\n    };\r\n    $scope.updateItem = function() {\r\n        if ($scope.item) {\r\n            var id = $scope.item.id;\r\n            item = getRandomItem();\r\n            item = angular.extend($scope.item, item);\r\n            item.id = id;\r\n            row.slots.add(item);\r\n            row.update();\r\n            row.updateMonths();\r\n            $scope.item = item;\r\n            log('updateItem', item.id);\r\n        }\r\n    };\r\n    $scope.clearItems = function() {\r\n        row.ranges.removeAll();\r\n        row.months.removeAll();\r\n        row.days.removeAll();\r\n        row.slots.removeAll();\r\n        row.update();\r\n        row.updateMonths();\r\n        delete $scope.item;\r\n        log('clearItems');\r\n    };\r\n\r\n    var intervalId;\r\n    $scope.start = function() {\r\n        $scope.stop();\r\n        intervalId = $interval($scope.addItem, 1000 / 60);\r\n    };\r\n    $scope.stop = function() {\r\n        if (intervalId) {\r\n            $interval.cancel(intervalId);\r\n        }\r\n    };\r\n\r\n    function serializeDate(date) {\r\n        function pad(v, s, z) {\r\n            v = (v || 0) + '';\r\n            s = (s || 2);\r\n            z = (z || '0');\r\n            return v.length >= s ? v : new Array(s - v.length + 1).join(z) + v;\r\n        }\r\n        var yyyy = date.getFullYear();\r\n        var MM = date.getMonth() + 1; // getMonth() is zero-based\r\n        var dd = date.getDate();\r\n        var hh = date.getHours();\r\n        var mm = date.getMinutes();\r\n        var ss = date.getSeconds();\r\n        return yyyy + '-' + pad(MM) + '-' + pad(dd) + 'T' + pad(hh) + ':' + pad(mm) + ':' + pad(ss);\r\n    }\r\n\r\n    function getRandom() {\r\n        return 1000000 + Math.floor(Math.random() * 100000);\r\n    }\r\n\r\n    function getRandomDay() {\r\n        var oneday = (24 * 60 * 60 * 1000);\r\n        var date = new Date();\r\n        date.setDate(date.getDate() + Math.floor(Math.random() * 60));\r\n        // date.setMonth(date.getMonth() + Math.floor(Math.random() * 2));\r\n        date.setHours(0);\r\n        date.setMinutes(0);\r\n        date.setSeconds(0);\r\n        var yyyy = date.getFullYear();\r\n        var MM = date.getMonth();\r\n        var key = Math.ceil(date.getTime() / oneday);\r\n        var mKey = yyyy * 12 + MM;\r\n        return {\r\n            key: key,\r\n            mKey: mKey,\r\n            date: serializeDate(date)\r\n        };\r\n    }\r\n\r\n    var uid = 1;\r\n\r\n    function getRandomItem() {\r\n        var day = getRandomDay();\r\n        var item = {\r\n            id: uid,\r\n            hours: 1 + Math.floor(Math.random() * 6),\r\n            date: new Date(day.date),\r\n            key: day.key,\r\n            mKey: day.mKey,\r\n            activityId: row.id,\r\n        };\r\n        if (Math.floor(Math.random() * 3) === 0) {\r\n            item.taskId = 10000 + Math.floor(Math.random() * 50);\r\n        }\r\n        uid++;\r\n        return item;\r\n    }\r\n\r\n    function log() {\r\n        $scope.log = Array.prototype.slice.call(arguments);\r\n    }\r\n}]);\r\n\r\napp.constant('ganttGroups', {\r\n    ACTIVITY: 1,\r\n    CUSTOMER: 2,\r\n    DEPARTMENT: 3,\r\n    GROUP: 4,\r\n    MANAGER: 5,\r\n    PROJECT: 6,\r\n    RESOURCE: 7,\r\n    USER: 9,\r\n});\r\n\r\napp.factory('Hash', [function() {\r\n    var pools = {};\r\n\r\n    function Hash(key, pool) {\r\n        key = key || 'id';\r\n        pool = pool ? Hash.get(pool) : {};\r\n        Object.defineProperties(this, {\r\n            key: {\r\n                value: key,\r\n                enumerable: false,\r\n                writable: false\r\n            },\r\n            pool: {\r\n                value: pool,\r\n                enumerable: false,\r\n                writable: false\r\n            },\r\n            length: {\r\n                value: 0,\r\n                enumerable: false,\r\n                writable: true\r\n            }\r\n        });\r\n    }\r\n\r\n    function has(id) {\r\n        return this.pool[id] !== undefined;\r\n    }\r\n\r\n    function getId(id) {\r\n        return this.pool[id];\r\n    }\r\n\r\n    function get(item) {\r\n        var hash = this,\r\n            key = this.key;\r\n        return item ? hash.getId(item[key]) : null;\r\n    }\r\n\r\n    function set(item) {\r\n        var hash = this,\r\n            pool = this.pool,\r\n            key = this.key;\r\n        pool[item[key]] = item;\r\n        hash.push(item);\r\n        return item;\r\n    }\r\n\r\n    function add(newItem) {\r\n        var hash = this;\r\n        var item = hash.get(newItem);\r\n        if (item) {\r\n            for (var i = 0, keys = Object.keys(newItem), p; i < keys.length; i++) {\r\n                p = keys[i];\r\n                item[p] = newItem[p];\r\n            }\r\n        } else {\r\n            item = hash.set(newItem);\r\n        }\r\n        return item;\r\n    }\r\n\r\n    function remove(oldItem) {\r\n        var hash = this,\r\n            pool = this.pool,\r\n            key = this.key;\r\n        var item = hash.get(oldItem);\r\n        if (item) {\r\n            var index = hash.indexOf(item);\r\n            if (index !== -1) {\r\n                hash.splice(index, 1);\r\n            }\r\n            delete pool[item[key]];\r\n        }\r\n        return hash;\r\n    }\r\n\r\n    function addMany(items) {\r\n        var hash = this;\r\n        if (!items) {\r\n            return hash;\r\n        }\r\n        var i = 0;\r\n        while (i < items.length) {\r\n            hash.add(items[i]);\r\n            i++;\r\n        }\r\n        return hash;\r\n    }\r\n\r\n    function removeMany(items) {\r\n        var hash = this;\r\n        if (!items) {\r\n            return hash;\r\n        }\r\n        var i = 0;\r\n        while (i < items.length) {\r\n            hash.remove(items[i]);\r\n            i++;\r\n        }\r\n        return hash;\r\n    }\r\n\r\n    function removeAll() {\r\n        var hash = this,\r\n            key = hash.key,\r\n            pool = hash.pool;\r\n        var i = 0,\r\n            t = hash.length,\r\n            item;\r\n        while (hash.length) {\r\n            item = hash.shift();\r\n            delete pool[item[key]];\r\n            i++;\r\n        }\r\n        return hash;\r\n    }\r\n\r\n    function each(callback) {\r\n        var hash = this;\r\n        if (callback) {\r\n            var i = 0;\r\n            while (i < hash.length) {\r\n                callback(hash[i], i);\r\n                i++;\r\n            }\r\n        }\r\n        return hash;\r\n    }\r\n\r\n    function forward(key, reverse) {\r\n        var hash = this;\r\n        key = (key || this.key);\r\n        hash.sort(function(c, d) {\r\n            var a = reverse ? d : c;\r\n            var b = reverse ? c : d;\r\n            return a[key] - b[key];\r\n        });\r\n        return hash;\r\n    }\r\n\r\n    function backward(key) {\r\n        return this.forward(key, true);\r\n    }\r\n\r\n    function differs(hash) {\r\n        if (hash.key !== this.key || hash.length !== this.length) {\r\n            return true;\r\n        } else {\r\n            var differs = false,\r\n                i = 0,\r\n                t = this.length,\r\n                key = this.key;\r\n            while (differs && i < t) {\r\n                differs = this[i][key] !== hash[i][key];\r\n                i++;\r\n            }\r\n        }\r\n    }\r\n\r\n    function updatePool() {\r\n        var hash = this,\r\n            pool = this.pool,\r\n            key = this.key;\r\n        Object.keys(pool).forEach(function(key) {\r\n            delete pool[key];\r\n        });\r\n        angular.forEach(hash, function(item) {\r\n            pool[item[key]] = item;\r\n        });\r\n    }\r\n    Hash.get = function(pool) {\r\n        return (pools[pool] = pools[pool] || {});\r\n    };\r\n    Hash.prototype = new Array;\r\n    Hash.prototype.has = has;\r\n    Hash.prototype.getId = getId;\r\n    Hash.prototype.get = get;\r\n    Hash.prototype.set = set;\r\n    Hash.prototype.add = add;\r\n    Hash.prototype.remove = remove;\r\n    Hash.prototype.each = each;\r\n    Hash.prototype.addMany = addMany;\r\n    Hash.prototype.removeMany = removeMany;\r\n    Hash.prototype.removeAll = removeAll;\r\n    Hash.prototype.forward = forward;\r\n    Hash.prototype.backward = backward;\r\n    Hash.prototype.differs = differs;\r\n    Hash.prototype.updatePool = updatePool;\r\n    return Hash;\r\n}]);\r\n\r\napp.factory('Calendar', ['Hash', function(Hash) {\r\n    var oneday = (24 * 60 * 60 * 1000);\r\n    var today = new Date();\r\n    today.setHours(0);\r\n    today.setMinutes(0);\r\n    today.setSeconds(0);\r\n    var todayKey = Math.ceil(today.getTime() / oneday);\r\n\r\n    function ArrayFrom(len, callback) {\r\n        var a = [];\r\n        while (a.length < len) {\r\n            a.push(callback(a.length));\r\n        }\r\n        return a;\r\n    }\r\n    var months = new Hash('mKey');\r\n\r\n    function Calendar() {}\r\n    Calendar.getDate = function(day) {\r\n        if (typeof day.date.getMonth === 'function') {\r\n            return day.date;\r\n        } else {\r\n            return new Date(day.date);\r\n        }\r\n    };\r\n    Calendar.clearMonth = function(month) {\r\n        month.days.each(function(day) {\r\n            if (day) {\r\n                day.hours = 0;\r\n                day.tasks = [];\r\n            }\r\n        });\r\n    };\r\n    Calendar.getMonth = function(day) {\r\n        today = new Date();\r\n        today.setHours(0);\r\n        today.setMinutes(0);\r\n        today.setSeconds(0);\r\n        todayKey = Math.ceil(today.getTime() / oneday);\r\n        //\r\n        var date = Calendar.getDate(day);\r\n        var yyyy = date.getFullYear();\r\n        var MM = date.getMonth();\r\n        var key = Math.ceil(date.getTime() / oneday);\r\n        var mKey = yyyy * 12 + MM;\r\n        var month = months.getId(mKey);\r\n        if (!month) {\r\n            var fromDay = new Date(yyyy, MM, 1).getDay();\r\n            var monthDays = new Date(yyyy, MM + 1, 0).getDate();\r\n            var weeks = Math.ceil(monthDays / 7);\r\n            month = {\r\n                date: date,\r\n                mKey: mKey,\r\n                month: MM,\r\n                monthDays: monthDays,\r\n                fromDay: fromDay,\r\n                days: new Hash('key'),\r\n            };\r\n            month.weeks = ArrayFrom(weeks, function(r) {\r\n                var days = ArrayFrom(7, function(c) {\r\n                    var item = null;\r\n                    var d = r * 7 + c - (fromDay - 1);\r\n                    if (d >= 0 && d < monthDays) {\r\n                        var date = new Date(yyyy, MM, d + 1);\r\n                        var key = Math.ceil(date.getTime() / oneday);\r\n                        item = {\r\n                            $today: key === todayKey,\r\n                            c: c,\r\n                            r: r,\r\n                            d: d + 1,\r\n                            date: date,\r\n                            key: key,\r\n                            hours: 0,\r\n                            tasks: [],\r\n                        };\r\n                        item = month.days.add(item);\r\n                    }\r\n                    return item;\r\n                });\r\n                return {\r\n                    r: r,\r\n                    days: days,\r\n                };\r\n            });\r\n            month = months.add(month);\r\n        }\r\n        return month;\r\n    };\r\n    Calendar.getDay = function(days) {\r\n        var date = new Date(today);\r\n        date.setDate(date.getDate() + days);\r\n        return date;\r\n    };\r\n    Calendar.getKey = function(date) {\r\n        return Math.ceil(date.getTime() / oneday);\r\n    };\r\n    return Calendar;\r\n}]);\r\n\r\napp.factory('GanttRow', ['Hash', 'Calendar', 'ganttGroups', function(Hash, Calendar, ganttGroups) {\r\n    var uid = 1;\r\n\r\n    var oneday = (24 * 60 * 60 * 1000);\r\n    var today = new Date();\r\n    today.setHours(0);\r\n    today.setMinutes(0);\r\n    today.setSeconds(0);\r\n    var todayKey = Math.ceil(today.getTime() / oneday);\r\n\r\n    function GanttRow(data, colors) {\r\n        this.type = ganttGroups.ACTIVITY;\r\n        this.assignedHours = 0;\r\n        this.slots = new Hash('id');\r\n        this.days = new Hash('key');\r\n        this.months = new Hash('mKey');\r\n        this.ranges = new Hash('rKey');\r\n        this.tasks = new Hash('id'); // 'taskId'\r\n        // angular.isObject(data) ? angular.extend(this, data) : null;\r\n        if (data) {\r\n            this.id = data.activity.id;\r\n            this.name = data.activity.name;\r\n            this.budgetHours = data.activity.budgetHours;\r\n            this.useBudget = data.project.type !== 2 && data.project.type !== 4;\r\n            this.customer = data.customer;\r\n            this.department = data.department;\r\n            this.manager = data.manager;\r\n            this.project = data.project;\r\n            this.resource = data.resource;\r\n            this.color = colors[this.id % (colors.length || 1)];\r\n        }\r\n        // this.items = new Hash().fill(data.items);\r\n        this.lastTaskId = null;\r\n        this.update();\r\n    }\r\n    GanttRow.prototype = {\r\n        canSelect: function() {\r\n            return this.type === ganttGroups.ACTIVITY && this.budgetHours > 0;\r\n        },\r\n        canEdit: function() {\r\n            return this.canSelect() && this.resource.name.toLowerCase().indexOf('nondefinito') === -1;\r\n        },\r\n        mergeSlot: function(slot) {\r\n            var slots = this.slots;\r\n            if (slot.hours) {\r\n                slots.add(slot);\r\n            } else {\r\n                slots.remove(slot);\r\n            }\r\n        },\r\n        insertSlot: function(key, hours, taskId) {\r\n            var slot = null;\r\n            if (this.useBudget) {\r\n                hours = Math.min(hours, this.budgetHours - this.assignedHours);\r\n            }\r\n            hours = Math.max(0, hours);\r\n            if (hours > 0) {\r\n                var item = {\r\n                    id: 'temp-' + (uid++),\r\n                    key: key,\r\n                    date: new Date(key * oneday),\r\n                    hours: hours,\r\n                    activityId: this.id,\r\n                };\r\n                if (taskId) {\r\n                    item.taskId = taskId;\r\n                    this.lastTaskId = taskId;\r\n                }\r\n                this.slots.add(item);\r\n                slot = this.slots.getId(item.id);\r\n            }\r\n            this.update();\r\n            return slot;\r\n        },\r\n        removeSlots: function(key) {\r\n            var day = this.days.getId(key);\r\n            day.tasks.each(function(item) {\r\n                item.hours = 0;\r\n            });\r\n            var slots = day.tasks.slice();\r\n            this.slots.removeMany(slots);\r\n            this.update();\r\n            return slots;\r\n        },\r\n        toggleSlots: function(key, hours) {\r\n            if (this.days.has(key)) {\r\n                return this.removeSlots(key);\r\n            } else {\r\n                var slot = this.insertSlot(key, hours, this.lastTaskId);\r\n                return [slot];\r\n            }\r\n        },\r\n        // WRITE CANCEL DAY SLOT\r\n        assign: function(col, value) {\r\n            console.log('assign');\r\n            var slots = this.slots,\r\n                key = col.$key;\r\n            var item = {\r\n                // errore\r\n                id: 'temp-' + (uid++),\r\n                key: key,\r\n                date: col.$date,\r\n                hours: value || 0,\r\n                activityId: this.id,\r\n            };\r\n            if (value) {\r\n                slots.add(item);\r\n            } else {\r\n                slots.remove(item);\r\n            }\r\n            this.update();\r\n            return this.days.getId(key);\r\n        },\r\n        write: function(col, value, max) {\r\n            value = Math.min(value, max);\r\n            if (this.useBudget) {\r\n                value = Math.min(value, this.budgetHours - this.assignedHours);\r\n            }\r\n            value = Math.max(0, value);\r\n            if (value && !this.days.has(col.$key) && col.$date >= today) {\r\n                return this.assign(col, value);\r\n            }\r\n        },\r\n        erase: function(col, value, max) {\r\n            if (this.days.has(col.$key) && col.$date >= today) {\r\n                return this.assign(col, null);\r\n            }\r\n        },\r\n        toggle: function(col, value, max) {\r\n            if (this.days.has(col.$key)) {\r\n                return this.erase(col, value, max);\r\n            } else {\r\n                return this.write(col, value, max);\r\n            }\r\n        },\r\n        // WRITE CANCEL DAY SLOT\r\n        update: function() {\r\n            var total = 0;\r\n            var slots = this.slots,\r\n                days = this.days;\r\n            days.removeAll();\r\n            var taskId = null;\r\n            slots.each(function(item) {\r\n                taskId = item.taskId || taskId;\r\n                total += item ? item.hours : 0;\r\n                var day = days.add({\r\n                    key: item.key,\r\n                    date: item.date,\r\n                    hours: 0,\r\n                });\r\n                day.tasks = day.tasks || new Hash('id'); // 'taskId'\r\n                day.tasks.add(angular.copy(item));\r\n                day.tasks.each(function(task) {\r\n                    day.hours += task.hours;\r\n                });\r\n            });\r\n            this.lastTaskId = taskId || this.lastTaskId;\r\n            days.forward(); // sort by key       \r\n            this.assignedHours = total;\r\n            this.updateRanges();\r\n        },\r\n        updateMonths: function() {\r\n            var days = this.days,\r\n                months = this.months;\r\n            months.removeAll();\r\n            var previous;\r\n            days.each(function(item) {\r\n                var month = Calendar.getMonth(item);\r\n                if (month !== previous) {\r\n                    previous = month;\r\n                    Calendar.clearMonth(month);\r\n                }\r\n                months.add(month);\r\n                var day = month.days.getId(item.key);\r\n                if (day) {\r\n                    day.hours = item.hours;\r\n                    day.tasks = item.tasks;\r\n                }\r\n            });\r\n            months.forward(); // sort by key  \r\n        },\r\n        updateRanges: function() {\r\n            var days = this.days,\r\n                ranges = this.ranges;\r\n            ranges.removeAll();\r\n            var rKey = 0,\r\n                lastDay;\r\n            days.each(function(day, i) {\r\n                if (lastDay) {\r\n                    if (day.key - lastDay.key > 1 || day.tasks.differs(lastDay.tasks)) {\r\n                        rKey++;\r\n                    }\r\n                }\r\n                lastDay = day;\r\n                var range = ranges.add({\r\n                    rKey: rKey,\r\n                });\r\n                range.days = range.days || [];\r\n                range.days.push(day.key);\r\n            });\r\n            ranges.forward(); // sort by key   \r\n        },\r\n        getRange: function(col, from, to) {\r\n            var ranges = this.ranges,\r\n                range = null,\r\n                key = col.$key;\r\n            ranges.each(function(item) {\r\n                var index = item.days.indexOf(key);\r\n                if (index !== -1) {\r\n                    item.c = index;\r\n                    item.firstKey = Math.max(from, item.days[0]);\r\n                    item.lastKey = Math.min(to, item.days[item.days.length - 1]);\r\n                    range = item;\r\n                }\r\n            });\r\n            return range;\r\n        },\r\n        updateRange: function(col, from, to) {\r\n            var ranges = this.ranges,\r\n                range = this.getRange(col, from, to);\r\n            if (range) {\r\n                range.previousKey = null;\r\n                range.nextKey = null;\r\n                var r = range.rKey;\r\n                if (r > 0) {\r\n                    var p = ranges[r - 1];\r\n                    range.previousKey = p.days[p.days.length - 1];\r\n                }\r\n                if (r < ranges.length - 1) {\r\n                    var n = ranges[r + 1];\r\n                    range.nextKey = n.days[0];\r\n                }\r\n            }\r\n            return range;\r\n        },\r\n        canMoveRange: function(range, dir) {\r\n            // rifare !!!\r\n            var can = true;\r\n            var row = this;\r\n            var first = range.items[0];\r\n            var last = range.items[range.items.length - 1];\r\n            var key = row.getOffsetKey(first.startDate, dir);\r\n            var i = 0,\r\n                t = range.items.length;\r\n            while (i < t) {\r\n                var k = key + i;\r\n                if (k < todayKey || (row.days.getId(k) && range.items.indexOf(row.days.getId(k)) === -1)) { // sistemare!!\r\n                    can = false;\r\n                    i = t;\r\n                }\r\n                i++;\r\n            }\r\n            return can;\r\n        },\r\n        moveRange: function(range, dir) {\r\n            if (range.items.length) {\r\n                var row = this;\r\n                if (row.canMoveRange(range, dir)) {\r\n                    angular.forEach(range.items, function(item) {\r\n                        row.addDays(item, dir);\r\n                    });\r\n                    row.update();\r\n                }\r\n            }\r\n        },\r\n        addDays: function(item, days) {\r\n            // console.log('GanttRow.addDay', item, days);\r\n            var date = new Date(item.startDate);\r\n            date.setDate(date.getDate() + days);\r\n            item.date = date;\r\n            item.key = Math.ceil(date.getTime() / oneday);\r\n            return item;\r\n        },\r\n        getOffsetKey: function(date, day) {\r\n            date = new Date(date);\r\n            date.setDate(date.getDate() + day);\r\n            var key = Math.ceil(date.getTime() / oneday);\r\n            return key;\r\n        },\r\n        getHours: function(key) {\r\n            var hours = 0;\r\n            var day = this.days.getId(key);\r\n            if (day) {\r\n                day.tasks.each(function(task) {\r\n                    hours += task.hours;\r\n                });\r\n            }\r\n            return hours;\r\n        },\r\n        toggleOpened: function() {\r\n            // console.log('toggleOpened');\r\n            this.opened = !this.opened;\r\n        },\r\n        compress: function(key) {\r\n            if (!this.items.length) {\r\n                return;\r\n            }\r\n            this.items.sort(function(a, b) {\r\n                return a.key - b.key;\r\n            });\r\n            var item = Utils.where(this.items, { key: key });\r\n            item = item || this.items[0];\r\n            var index = this.items.indexOf(item);\r\n            var i = index,\r\n                t = this.items.length;\r\n            key = Math.max(key, todayKey);\r\n            // da rifare\r\n            // collezionare ore totali\r\n            // redistribuire records in base a carico giornaliero\r\n            // spostare su gantt\r\n            while (i < t) {\r\n                item = this.items[i];\r\n                item.key = key + i - index;\r\n                item.date = new Date(item.key * oneday);\r\n                i++;\r\n            }\r\n            this.update();\r\n        },\r\n    };\r\n    GanttRow.serialNumber = function(number, max) {\r\n        return new Array((1 + (max.toString().length) - (number.toString().length))).join('0');\r\n    };\r\n    return GanttRow;\r\n}]);\n/* global angular, app */\r\n\r\napp.directive('header', [function() {\r\n    return {\r\n        restrict: 'E',\r\n        templateUrl: 'partials/header',\r\n        transclude: {\r\n            'header': '?headerItems',\r\n        },\r\n        link: function(scope, element, attributes, model) {}\r\n    };\r\n}]);\r\n\r\napp.directive('controlMessages', [function() {\r\n    return {\r\n        restrict: 'E',\r\n        templateUrl: 'partials/control-messages',\r\n        transclude: {\r\n            'message': '?messageItems',\r\n        },\r\n        link: function(scope, element, attributes, model) {}\r\n    };\r\n}]);\r\n\r\napp.directive('control', ['$http', '$templateCache', '$compile', '$parse', function($http, $templateCache, $compile, $parse) {\r\n    function formatLabel(string, prepend, expression) {\r\n        string = string || '';\r\n        prepend = prepend || '';\r\n        var splitted = string.split(',');\r\n        if (splitted.length > 1) {\r\n            var formatted = splitted.shift();\r\n            angular.forEach(splitted, function(value, index) {\r\n                if (expression) {\r\n                    formatted = formatted.split('{' + index + '}').join('\\' + ' + prepend + value + ' + \\'');\r\n                } else {\r\n                    formatted = formatted.split('{' + index + '}').join(prepend + value);\r\n                }\r\n            });\r\n            if (expression) {\r\n                return '\\'' + formatted + '\\'';\r\n            } else {\r\n                return formatted;\r\n            }\r\n        } else {\r\n            return prepend + string;\r\n        }\r\n    }\r\n    var uniqueId = 0;\r\n    return {\r\n        restrict: 'A',\r\n        templateUrl: function(element, attributes) {\r\n            var template = 'partials/control';\r\n            switch (attributes.control) {\r\n                case 'select':\r\n                    template = 'partials/control-select';\r\n                    break;\r\n            }\r\n            return template;\r\n        },\r\n        scope: {\r\n            ngModel: '=',\r\n            required: '=',\r\n            form: '@',\r\n            title: '@',\r\n            placeholder: '@',\r\n        },\r\n        require: 'ngModel',\r\n        link: function(scope, element, attributes, model) {\r\n\r\n        },\r\n        compile: function(element, attributes) {\r\n                return {\r\n                    pre: function(scope, element, attributes) {\r\n                        if (attributes.control === 'select') {\r\n                            var label = (attributes.label ? attributes.label : 'name');\r\n                            var key = (attributes.key ? attributes.key : 'id');\r\n                            var filter = (attributes.min ? ' | filter:gte(\\'' + key + '\\', ' + attributes.min + ')' : '');\r\n                            var optionLabel = formatLabel(label, 'item.', true);\r\n                            scope.options = attributes.number ?\r\n                                'item.' + key + ' as ' + optionLabel + ' disable when item.disabled for item in ' + attributes.source + filter :\r\n                                optionLabel + ' disable when item.disabled for item in ' + attributes.source + filter + ' track by item.' + key;\r\n                            console.log('control.compile.pre', scope.options);\r\n                        }\r\n                        var type = scope.type = attributes.control;\r\n                        var form = scope.form = scope.form || 'form';\r\n                        var title = scope.title = scope.title || 'untitled';\r\n                        var placeholder = scope.placeholder = scope.placeholder || title;\r\n                        var field = scope.field = title.replace(/[^0-9a-zA-Z]/g, \"\").split(' ').join('') + (++uniqueId);\r\n                        scope.minLength = attributes.min || 0;\r\n                        scope.maxLength = attributes.max || Number.POSITIVE_INFINITY;\r\n                        scope.focus = false;\r\n                        scope.getType = function() {\r\n                            var type = 'text';\r\n                            switch (attributes.control) {\r\n                                case 'password':\r\n                                    // var form = $parse(scope.form)(scope.$parent);\r\n                                    // var field = $parse(scope.form + '.' + scope.field)(scope.$parent);\r\n                                    type = scope.visible ? 'text' : 'password';\r\n                                    break;\r\n                                default:\r\n                                    type = attributes.control;\r\n                            }\r\n                            // console.log('control.getType', type);\r\n                            return type;\r\n                        };\r\n                        scope.getClasses = function() {\r\n                            var form = $parse(scope.form)(scope.$parent);\r\n                            var field = $parse(scope.form + '.' + scope.field)(scope.$parent);\r\n                            return {\r\n                                'control-focus': scope.focus,\r\n                                'control-success': field.$valid,\r\n                                'control-error': field.$invalid && (form.$submitted || field.$touched),\r\n                                'control-empty': !field.$viewValue\r\n                            };\r\n                        };\r\n                        scope.getMessages = function() {\r\n                            var form = $parse(scope.form)(scope.$parent);\r\n                            var field = $parse(scope.form + '.' + scope.field)(scope.$parent);\r\n                            return (form.$submitted || field.$touched) && field.$error;\r\n                        };\r\n                    },\r\n                    // post: function (scope, element, attributes) { }\r\n                };\r\n            }\r\n            /*\r\n            compile: function(element, attributes) {\r\n                element.removeAttr('my-dir'); \r\n                element.attr('ng-hide', 'true');\r\n                return function(scope) {\r\n                    $compile(element)(scope);\r\n                };\r\n            },\r\n            */\r\n    };\r\n}]);\r\n\r\napp.directive('state', ['$timeout', function($timeout) {\r\n    return {\r\n        restrict: 'EA',\r\n        templateUrl: 'partials/state',\r\n        transclude: true,\r\n        replace: true,\r\n        scope: {\r\n            state: '=',\r\n        },\r\n        link: function(scope, element, attributes, model) {\r\n            scope.stateClass = function() {\r\n                if (scope.state.button === element) {\r\n                    var sclass = {\r\n                        busy: scope.state.isBusy,\r\n                        successing: scope.state.isSuccessing,\r\n                        success: scope.state.isSuccess,\r\n                        errorring: scope.state.isErroring,\r\n                        error: scope.state.isError,\r\n                    };\r\n                    // console.log('stateClass', sclass);\r\n                    return sclass;\r\n                } else {\r\n                    return null;\r\n                }\r\n            };\r\n            scope.stateDisabled = function() {\r\n                var disabled = (scope.state.button && scope.state.button !== element); // || scope.$parent.$eval(attributes.onValidate);\r\n                // console.log('stateDisabled', disabled);\r\n                return disabled;\r\n            };\r\n\r\n            function onClick() {\r\n                $timeout(function() {\r\n                    if (!scope.$parent.$eval(attributes.onValidate)) {\r\n                        // console.log('state.onClick', attributes.onValidate, attributes.onClick);\r\n                        scope.state.button = element;\r\n                        return scope.$parent.$eval(attributes.onClick);\r\n                    } else {\r\n                        scope.$parent.$eval('form.$setSubmitted()');\r\n                    }\r\n                });\r\n            };\r\n\r\n            function addListeners() {\r\n                element.on('touchstart click', onClick);\r\n            };\r\n\r\n            function removeListeners() {\r\n                element.off('touchstart click', onClick);\r\n            };\r\n            scope.$on('$destroy', function() {\r\n                removeListeners();\r\n            });\r\n            addListeners();\r\n        }\r\n    }\r\n}]);\r\n\r\napp.directive('controlRow', ['$http', '$templateCache', '$compile', function($http, $templateCache, $compile) {\r\n    var aid = 0;\r\n\r\n    function _format(string, prepend, expression) {\r\n        string = string || '';\r\n        prepend = prepend || '';\r\n        var splitted = string.split(',');\r\n        if (splitted.length > 1) {\r\n            var formatted = splitted.shift();\r\n            angular.forEach(splitted, function(value, index) {\r\n                if (expression) {\r\n                    formatted = formatted.split('{' + index + '}').join('\\' + ' + prepend + value + ' + \\'');\r\n                } else {\r\n                    formatted = formatted.split('{' + index + '}').join(prepend + value);\r\n                }\r\n            });\r\n            if (expression) {\r\n                return '\\'' + formatted + '\\'';\r\n            } else {\r\n                return formatted;\r\n            }\r\n        } else {\r\n            return prepend + string;\r\n        }\r\n    }\r\n\r\n    function templateFunction(element, attributes) {\r\n        var form = attributes.form || 'Form';\r\n        var title = attributes.title || 'Untitled';\r\n        var placeholder = attributes.placeholder || title;\r\n        var name = title.replace(/[^0-9a-zA-Z]/g, \"\").split(' ').join('') + (++aid);\r\n        var formKey = form + '.' + name;\r\n        var formFocus = ' ng-focus=\"' + formKey + '.hasFocus=true\" ng-blur=\"' + formKey + '.hasFocus=false\"';\r\n        var message = '',\r\n            decoration = '',\r\n            disabled = '';\r\n        var label = (attributes.label ? attributes.label : 'name');\r\n        var key = (attributes.key ? attributes.key : 'id');\r\n        var model = attributes.model;\r\n        var change = (attributes.onChange ? ' ng-change=\"' + attributes.onChange + '\"' : '');\r\n        var focus = (attributes.onFocus ? ' ng-focus=\"' + attributes.onFocus + '\"' : '');\r\n        var blur = (attributes.onBlur ? ' ng-blur=\"' + attributes.onBlur + '\"' : '');\r\n        var inputCols = attributes.cols ? 6 : 9;\r\n        var colInput = 'col-lg-' + inputCols;\r\n        var colLabel = 'col-lg-' + (12 - inputCols);\r\n        if (attributes.cols === '12') {\r\n            colLabel = colInput = 'col-lg-12';\r\n        }\r\n        var required = (attributes.required ? ' required=\"true\"' : '');\r\n        var readonly = (attributes.readonly ? ' readonly' : '');\r\n        var options = (attributes.options ? ' ng-model-options=\"' + attributes.options + '\" ' : '');\r\n        var validate = (attributes.validate ? ' validate-type=\"' + attributes.validate + '\" ' : '');\r\n        var format = (attributes.format ? ' format=\"' + attributes.format + '\" ' : '');\r\n        var precision = (attributes.precision ? ' precision=\"' + attributes.precision + '\" ' : '');\r\n        if (attributes.disabled) {\r\n            disabled = ' disabled';\r\n        }\r\n        if (attributes.ngDisabled) {\r\n            disabled = ' ng-disabled=\"' + attributes.ngDisabled + '\"';\r\n        }\r\n        if (attributes.required) {\r\n            decoration = attributes.readonly || attributes.disabled ? '' : '<sup></sup>';\r\n        }\r\n        message = '<span ng-messages=\"' + (attributes.readonly ? '' : '(' + form + '.$submitted || ' + formKey + '.$touched) && ') + formKey + '.$error\" role=\"alert\">';\r\n        message = message + '<span ng-message=\"required\" class=\"label-error animated flash\">obbligatorio </span>';\r\n        switch (attributes.controlRow) {\r\n            case 'password':\r\n                message = message + '<span ng-message=\"minlength\" class=\"label-error animated flash\">almeno 6 caratteri </span>';\r\n                break;\r\n            case 'email':\r\n                message = message + '<span ng-message=\"email\" class=\"label-error animated flash\">valore non corretto </span>';\r\n                break;\r\n            case 'number':\r\n            case 'range':\r\n                message = message + '<span ng-message=\"positive\" class=\"label-error animated flash\">solo valori positivi </span>';\r\n                message = message + '<span ng-message=\"number\" class=\"label-error animated flash\">solo valori numerici </span>';\r\n                break;\r\n        }\r\n        if (attributes.match !== undefined) {\r\n            message = message + '<span ng-message=\"match\" class=\"label-error animated flash\">non corrispondente </span>';\r\n        }\r\n        message = message + '</span>';\r\n        var validation = ' ng-class=\"{ \\'control-focus\\': ' + formKey + '.hasFocus, \\'control-success\\': ' + formKey + '.$valid, \\'control-error\\': ' + formKey + '.$invalid && (' + form + '.$submitted || ' + formKey + '.$touched), \\'control-empty\\': !' + formKey + '.$viewValue }\"';\r\n        var template = '<div class=\"row\" ' + validation + '><label for=\"' + name + '\" class=\"' + colLabel + ' col-form-label\">' + title + decoration + '</label><div class=\"' + colInput + ' col-' + attributes.controlRow + '\">';\r\n        switch (attributes.controlRow) {\r\n            case 'static':\r\n                var click = (attributes.click ? ' ng-click=\"' + attributes.click + '\"' : '');\r\n                var mouseover = (attributes.mouseover ? ' ng-mouseover=\"' + attributes.mouseover + '\"' : '');\r\n                var mouseout = (attributes.mouseout ? ' ng-mouseover=\"' + attributes.mouseout + '\"' : '');\r\n                var icon = (attributes.icon ? '<i class=\"pull-xs-right ' + attributes.icon + '\"></i>' : '');\r\n                template += '<p class=\"form-control\" ' + click + mouseover + mouseout + '><span ng-bind-html=\"' + model + ' || \\'&nbsp;\\'\"></span>' + icon + '</p>';\r\n                break;\r\n            case 'checkbox':\r\n                template = '<div class=\"' + colInput + '\"' + validation + '><div class=\"col-xs-12\"><label class=\"custom-control custom-checkbox\">';\r\n                template += '   <input type=\"checkbox\" class=\"custom-control-input\" ng-model=\"' + model + '\">';\r\n                template += '   <span class=\"custom-control-indicator\"></span>';\r\n                template += '   <span class=\"custom-control-description\">' + title + '</span>';\r\n                template += '</label>';\r\n                // template += '<input id=\"' + name + '\" name=\"' + name + '\" type=\"checkbox\" ng-model=\"' + model + '\" ' + change + focus + blur + required + ' class=\"toggle toggle-round-flat\">';\r\n                /*\r\n                template = '<div class=\"checkbox\">';\r\n                template += '<span class=\"checkbox-label\">' + title + required +'</span>';\r\n                template += '<span class=\"switch\"><input id=\"' + name + '\" name=\"' + name + '\" type=\"checkbox\" ng-model=\"' + model + '\" ' + change + focus + blur + required + ' class=\"toggle toggle-round-flat\"><label for=\"' + name + '\"></label></span>';\r\n                template += '</div>';\r\n                */\r\n                break;\r\n            case 'yesno':\r\n                template = '<div class=\"row\" ' + validation + '><label class=\"col-lg-6 custom-control custom-checkbox\">' + title + decoration + '</label>';\r\n                template += '<div class=\"' + colLabel + '\"><label class=\"custom-control custom-checkbox\">';\r\n                template += '   <input type=\"checkbox\" class=\"custom-control-input\" ng-model=\"' + model + '\" ng-change=\"' + model + 'No=!' + model + '\">';\r\n                template += '   <span class=\"custom-control-indicator\"></span>';\r\n                template += '   <span class=\"custom-control-description\">S</span>';\r\n                template += '</label></div>';\r\n                template += '<div class=\"' + colLabel + '\"><label class=\"custom-control custom-checkbox\">';\r\n                template += '   <input type=\"checkbox\" class=\"custom-control-input\" ng-model=\"' + model + 'No\" ng-change=\"' + model + '=!' + model + 'No\">';\r\n                template += '   <span class=\"custom-control-indicator\"></span>';\r\n                template += '   <span class=\"custom-control-description\">No</span>';\r\n                template += '</label>';\r\n                // template += '<input id=\"' + name + '\" name=\"' + name + '\" type=\"checkbox\" ng-model=\"' + model + '\" ' + change + focus + blur + required + ' class=\"toggle toggle-round-flat\">';\r\n                /*\r\n                template = '<div class=\"checkbox\">';\r\n                template += '<span class=\"checkbox-label\">' + title + required +'</span>';\r\n                template += '<span class=\"switch\"><input id=\"' + name + '\" name=\"' + name + '\" type=\"checkbox\" ng-model=\"' + model + '\" ' + change + focus + blur + required + ' class=\"toggle toggle-round-flat\"><label for=\"' + name + '\"></label></span>';\r\n                template += '</div>';\r\n                */\r\n                break;\r\n            case 'switch':\r\n                if (attributes.disabled) {\r\n                    disabled = ' disabled=\"true\"';\r\n                }\r\n                if (attributes.ngDisabled) {\r\n                    disabled = ' disabled=\"' + attributes.ngDisabled + '\"';\r\n                }\r\n                template = '<div class=\"row control-switch\" ' + validation + '><label for=\"' + name + '\" class=\"' + colLabel + ' col-form-label\">' + title + decoration + '</label>';\r\n                template += '<div class=\"' + colInput + '\">';\r\n                template += '<switch name=\"' + name + '\" ng-model=\"' + model + '\" ' + change + focus + blur + options + ' on=\"S\" off=\"No\" ' + required + disabled + readonly + formFocus + '></switch>';\r\n                break;\r\n            case 'range':\r\n                validate = ' validate-type=\"number\"';\r\n                var nameHi = name + 'Hi';\r\n                var formKeyHi = form + '.' + nameHi;\r\n                var modelHi = attributes.modelHi;\r\n                var validationHi = ' ng-class=\"{ \\'control-focus\\': ' + formKeyHi + '.hasFocus, \\'control-success\\': ' + formKeyHi + '.$valid, \\'control-error\\': ' + formKeyHi + '.$invalid && (' + form + '.$submitted || ' + formKeyHi + '.$touched), \\'control-empty\\': !' + formKeyHi + '.$viewValue }\"';\r\n                var requiredHi = required;\r\n                if (attributes.requiredHi == 'true') {\r\n                    requiredHi = ' required=\"true\"';\r\n                } else if (attributes.requiredHi == 'false') {\r\n                    requiredHi = '';\r\n                }\r\n                var messageHi = ' ',\r\n                    decorationHi = ' ';\r\n                if (attributes.required && attributes.requiredHi !== 'false') {\r\n                    decorationHi = attributes.readonly || attributes.disabled ? '' : '<sup></sup>';\r\n                }\r\n                messageHi = '<span ng-messages=\"' + (attributes.readonly ? '' : '(' + form + '.$submitted || ' + formKeyHi + '.$touched) && ') + formKeyHi + '.$error\" role=\"alert\">';\r\n                messageHi = messageHi + '<span ng-message=\"required\" class=\"label-error animated flash\">obbligatorio </span>';\r\n                switch (attributes.controlRow) {\r\n                    case 'password':\r\n                        messageHi = messageHi + '<span ng-message=\"minlength\" class=\"label-error animated flash\">almeno 3 caratteri </span>';\r\n                        break;\r\n                    case 'email':\r\n                        messageHi = messageHi + '<span ng-message=\"email\" class=\"label-error animated flash\">valore non corretto </span>';\r\n                        break;\r\n                    case 'number':\r\n                    case 'range':\r\n                        messageHi = messageHi + '<span ng-message=\"positive\" class=\"label-error animated flash\">solo valori positivi </span>';\r\n                        messageHi = messageHi + '<span ng-message=\"number\" class=\"label-error animated flash\">solo valori numerici </span>';\r\n                        break;\r\n                }\r\n                if (attributes.match !== undefined) {\r\n                    messageHi = messageHi + '<span ng-message=\"match\" class=\"label-error animated flash\">non corrispondente </span>';\r\n                }\r\n                messageHi = messageHi + '</span>';\r\n                template = '<div class=\"row\"><label for=\"' + name + '\" class=\"' + colLabel + ' col-form-label\">' + title + '</label><div class=\"' + colInput + ' col-' + attributes.controlRow + '\">';\r\n                template += '<div class=\"form-control-range form-control-range-min\" ' + validation + '>' + decoration + '<input class=\"form-control\" name=\"' + name + '\" ng-model=\"' + model + '\" ' + change + focus + blur + options + ' placeholder=\"' + placeholder + '\" type=\"text\"' + required + disabled + readonly + formFocus + validate + format + precision + '>' + message + '</div>';\r\n                template += '<div class=\"form-control-range form-control-range-max\" ' + validationHi + '>' + decorationHi + '<input class=\"form-control\" name=\"' + nameHi + '\" ng-model=\"' + modelHi + '\" ' + change + focus + blur + options + ' placeholder=\"' + placeholder + '\" type=\"text\"' + requiredHi + disabled + readonly + formFocus + validate + format + precision + '>' + messageHi + '</div>';\r\n                return template + '</div></div>';\r\n                break;\r\n            case 'range-slider':\r\n                var himodel = (attributes.himodel ? ' rz-slider-high=\"' + attributes.himodel + '\" ' : '');\r\n                options = (attributes.options ? ' rz-slider-options=\"' + attributes.options + '\" ' : '');\r\n                template += '<rzslider rz-slider-model=\"' + model + '\" ' + himodel + options + '\"></rzslider>';\r\n                break;\r\n            case 'select':\r\n                var filter = (attributes.min ? ' | filter:gte(\\'' + key + '\\', ' + attributes.min + ')' : '');\r\n                var optionLabel = _format(label, 'item.', true);\r\n                var options = attributes.number ?\r\n                    'item.' + key + ' as ' + optionLabel + ' disable when item.disabled for item in ' + attributes.source + filter :\r\n                    optionLabel + ' disable when item.disabled for item in ' + attributes.source + filter + ' track by item.' + key;\r\n                template += '<select name=\"' + name + '\" class=\"form-control\" ng-model=\"' + model + '\" ' + change + focus + blur + ' ng-options=\"' + options + '\" ' + (attributes.number ? 'convert-to-number' : '') + required + disabled + '><option value=\"\" disabled selected hidden>' + placeholder + '</option></select>';\r\n                break;\r\n            case 'autocomplete':\r\n                var canCreate = (attributes.canCreate ? attributes.canCreate : false);\r\n                var flatten = (attributes.flatten ? attributes.flatten : false);\r\n                var queryable = (attributes.queryable ? attributes.queryable : false);\r\n                var onSelected = (attributes.onSelected ? ' on-selected=\"' + attributes.onSelected + '\"' : '');\r\n                template += '<input name=\"' + name + '\" ng-model=\"' + model + '\" type=\"hidden\" ' + (attributes.required ? 'required' : '') + '>';\r\n                template += '<div control-autocomplete=\"' + attributes.source + '\" model=\"' + model + '\" label=\"' + label + '\"  key=\"' + key + '\" can-create=\"' + canCreate + '\" flatten=\"' + flatten + '\" queryable=\"' + queryable + '\" placeholder=\"' + placeholder + '\" on-focus=\"' + formKey + '.hasFocus=true\" on-blur=\"' + formKey + '.hasFocus=false\"' + onSelected + '></div>';\r\n                break;\r\n            case 'textarea':\r\n                var rows = (attributes.rows ? attributes.rows : '1');\r\n                template += '<textarea name=\"' + name + '\" class=\"form-control\" ng-model=\"' + model + '\" ' + change + focus + blur + options + ' placeholder=\"' + placeholder + '\" ' + required + disabled + ' rows=\"' + rows + '\"' + formFocus + '></textarea>';\r\n                break;\r\n            case 'htmltext':\r\n                var taDisabled = '';\r\n                if (attributes.disabled) {\r\n                    taDisabled = ' ta-disabled=\"true\"';\r\n                }\r\n                if (attributes.ngDisabled) {\r\n                    taDisabled = ' ta-disabled=\"' + attributes.ngDisabled + '\"';\r\n                }\r\n                template += '<div text-angular name=\"' + name + '\" ta-paste=\"doStripHtml($html)\" ng-model=\"' + model + '\" ' + change + focus + blur + options + ' placeholder=\"' + placeholder + '\" ' + required + taDisabled + readonly + formFocus + (attributes.required ? ' ta-min-text=\"1\"' : '') + '></div>';\r\n                break;\r\n            case 'password':\r\n                template += '<div class=\"input-group\"><input name=\"' + name + '\" class=\"form-control\" ng-model=\"' + model + '\" ' + change + focus + blur + options + ' placeholder=\"' + placeholder + '\" type=\"{{form.' + name + ' ? \\'password\\' : \\'text\\'}}\" ng-minlength=\"6\" ' + required + disabled + formFocus + '><span class=\"input-group-addon\" ng-if=\"' + model + '\"><span class=\"icon-eye\" ng-click=\"form.' + name + ' = !form.' + name + '\"></span></span></div>';\r\n                break;\r\n            case 'email':\r\n                template += '<input name=\"' + name + '\" class=\"form-control\" ng-model=\"' + model + '\" ' + change + focus + blur + options + ' placeholder=\"' + placeholder + '\" type=\"email\" ' + required + disabled + formFocus + '>';\r\n                break;\r\n            case 'number-picker':\r\n                validate = ' validate-type=\"anynumber\"';\r\n                /*\r\n                var doSub = model + ' = ' + model + ' -1';\r\n                if (attributes.min) {\r\n                    validate += ' min=\"' + attributes.min + '\"';\r\n                    doSub = model + ' = Math.max(' + attributes.min + ', ' + model + ' -1)';\r\n                }\r\n                var doAdd = model + ' = ' + model + ' +1';\r\n                if (attributes.max) {\r\n                    validate += ' max=\"' + attributes.max + '\"';\r\n                    doAdd = model + ' = Math.min(' + attributes.max + ', ' + model + ' +1)';\r\n                }\r\n                template += '<div class=\"input-group\">';\r\n                template += '   <span class=\"input-group-btn\"><button class=\"btn btn-outline-primary\" type=\"button\" ng-click=\"(' + doSub + ')\">-</button></span>';\r\n                template += '   <input name=\"' + name + '\" class=\"form-control\" ng-model=\"' + model + '\" ' + change + focus + blur + options + ' placeholder=\"' + placeholder + '\" type=\"text\"' + required + disabled + readonly + formFocus + validate + format + precision + '>';\r\n                template += '   <span class=\"input-group-btn\"><button class=\"btn btn-outline-primary\" type=\"button\" ng-click=\"(' + doAdd + ')\">+</button></span>';\r\n                template += '</div>';\r\n                */\r\n                template += '<div number-picker=\"' + model + '\" min=\"' + attributes.min + '\" max=\"' + attributes.max + '\">';\r\n                template += '   <input name=\"' + name + '\" class=\"form-control\" ng-model=\"' + model + '\" ' + change + focus + blur + options + ' placeholder=\"' + placeholder + '\" type=\"text\"' + required + disabled + readonly + formFocus + validate + format + precision + '>';\r\n                template += '</div>';\r\n                break;\r\n            case 'number':\r\n                validate = ' validate-type=\"number\"';\r\n                template += '<input name=\"' + name + '\" class=\"form-control\" ng-model=\"' + model + '\" ' + change + focus + blur + options + ' placeholder=\"' + placeholder + '\" type=\"text\"' + required + disabled + readonly + formFocus + validate + format + precision + '>';\r\n                break;\r\n            case 'anynumber':\r\n                validate = ' validate-type=\"anynumber\"';\r\n                template += '<input name=\"' + name + '\" class=\"form-control\" ng-model=\"' + model + '\" ' + change + focus + blur + options + ' placeholder=\"' + placeholder + '\" type=\"text\"' + required + disabled + readonly + formFocus + validate + format + precision + '>';\r\n                break;\r\n            case 'date':\r\n                validate = ' validate-type=\"date\"';\r\n                format = ' format=\"dd-MM-yyyy\"';\r\n                if (attributes.disabled || attributes.readonly) {\r\n                    template += '<div class=\"input-group\"><input type=\"text\" class=\"form-control\" name=\"' + name + '\" ng-model=\"' + model + '\" placeholder=\"' + placeholder + '\" ' + required + disabled + readonly + formFocus + validate + format + '><span class=\"input-group-addon\"><i class=\"icon-calendar\"></i></span></div>';\r\n                } else {\r\n                    template += '<input type=\"date\" name=\"' + name + '\" class=\"form-control form-control-hidden\" is-open=\"flags.' + name + '\" ng-model=\"' + model + '\" placeholder=\"dd-MM-yyyy\" ' + required + disabled + readonly + formFocus + ' uib-datepicker-popup datepicker-options=\"sources.datepickerOptions\" datepicker-template-url=\"uib/template/datepicker/datepicker.html\" show-button-bar=\"false\" current-text=\"Oggi\" clear-text=\"Rimuovi\" close-text=\"Chiudi\">';\r\n                    template += '<div ng-click=\"(flags.' + name + ' = true)\" class=\"input-group disabled\"><input type=\"text\" class=\"form-control\" name=\"' + name + '\" ng-model=\"' + model + '\" placeholder=\"' + placeholder + '\" ' + required + disabled + readonly + formFocus + validate + format + '><span class=\"input-group-addon\"><i class=\"icon-calendar\"></i></span></div>';\r\n                }\r\n                break;\r\n                /*\r\n        case 'date':\r\n            placeholder = placeholder || 'dd-MM-yyyy';\r\n            template += '<input name=\"' + name + '\" class=\"form-control\" ng-model=\"' + model + '\" ' + change + focus + blur + options + ' placeholder=\"' + placeholder + '\" type=\"date\"' + required + disabled + readonly + formFocus + '>';\r\n            break;\r\n            */\r\n            case 'datetime-local':\r\n                placeholder = placeholder || 'dd-MM-yyyyTHH:mm:ss';\r\n                // placeholder == title ? placeholder = 'dd/MM/yyyyTHH:mm:ss' : null;\r\n                template += '<input name=\"' + name + '\" class=\"form-control\" ng-model=\"' + model + '\" ' + change + focus + blur + options + ' placeholder=\"' + placeholder + '\" type=\"datetime-local\"' + required + disabled + readonly + formFocus + '>';\r\n                break;\r\n            case 'text':\r\n            default:\r\n                template += '<input name=\"' + name + '\" class=\"form-control\" ng-model=\"' + model + '\" ' + change + focus + blur + options + ' placeholder=\"' + placeholder + '\" type=\"text\"' + required + disabled + readonly + formFocus + validate + format + precision + '>';\r\n                break;\r\n        }\r\n        return template + message + '</div></div>';\r\n    }\r\n    return {\r\n        restrict: 'A',\r\n        replace: true,\r\n        compile: function(templateElement, templateAttributes) {\r\n            return function(scope, element, attributes) {\r\n                element.html(templateFunction(templateElement, templateAttributes));\r\n                $compile(element.contents())(scope);\r\n            }\r\n        }\r\n    }\r\n}]);\r\n\r\napp.directive('numberPicker', ['$parse', '$timeout', function($parse, $timeout) {\r\n    return {\r\n        restrict: 'A',\r\n        template: '<div class=\"input-group\">' +\r\n            '   <span class=\"input-group-btn\"><button class=\"btn btn-outline-primary\" type=\"button\">-</button></span>' +\r\n            '   <div ng-transclude></div>' +\r\n            '   <span class=\"input-group-btn\"><button class=\"btn btn-outline-primary\" type=\"button\">+</button></span>' +\r\n            '</div>',\r\n        replace: true,\r\n        transclude: true,\r\n        link: function(scope, element, attributes, model) {\r\n            var node = element[0];\r\n            var nodeRemove = node.querySelectorAll('.input-group-btn > .btn')[0];\r\n            var nodeAdd = node.querySelectorAll('.input-group-btn > .btn')[1];\r\n\r\n            function onRemove(e) {\r\n                var min = $parse(attributes.min)(scope);\r\n                var getter = $parse(attributes.numberPicker);\r\n                var setter = getter.assign;\r\n                $timeout(function() {\r\n                    setter(scope, Math.max(min, getter(scope) - 1));\r\n                });\r\n                // console.log('numberPicker.onRemove', min);\r\n            }\r\n\r\n            function onAdd(e) {\r\n                var max = $parse(attributes.max)(scope);\r\n                var getter = $parse(attributes.numberPicker);\r\n                var setter = getter.assign;\r\n                $timeout(function() {\r\n                    setter(scope, Math.min(max, getter(scope) + 1));\r\n                });\r\n                // console.log('numberPicker.onAdd', max);\r\n            }\r\n\r\n            function addListeners() {\r\n                angular.element(nodeRemove).on('touchstart mousedown', onRemove);\r\n                angular.element(nodeAdd).on('touchstart mousedown', onAdd);\r\n            }\r\n\r\n            function removeListeners() {\r\n                angular.element(nodeRemove).off('touchstart mousedown', onRemove);\r\n                angular.element(nodeAdd).off('touchstart mousedown', onAdd);\r\n            }\r\n            scope.$on('$destroy', function() {\r\n                removeListeners();\r\n            });\r\n            addListeners();\r\n        }\r\n    }\r\n}]);\r\n\r\napp.directive('validateType', ['$filter', function($filter) {\r\n    return {\r\n        require: 'ngModel',\r\n        link: function(scope, element, attributes, model) {\r\n            var validateType = attributes.validateType;\r\n            var format = attributes.format || '';\r\n            var precision = attributes.precision || 2;\r\n            var focus = false;\r\n            switch (validateType) {\r\n                case 'date':\r\n                case 'datetime':\r\n                case 'datetime-local':\r\n                    model.$formatters.push(function(value) {\r\n                        if (value) {\r\n                            return $filter('date')(value, format);\r\n                        } else {\r\n                            return null;\r\n                        }\r\n                    });\r\n                    break;\r\n                case 'number':\r\n                    model.$parsers.unshift(function(value) {\r\n                        var valid = false,\r\n                            type = validateType;\r\n                        if (value !== undefined && value !== \"\") {\r\n                            valid = String(value).indexOf(Number(value).toString()) !== -1; // isFinite(value); // \r\n                            value = Number(value);\r\n                            model.$setValidity('number', valid);\r\n                            if (valid) {\r\n                                model.$setValidity('positive', value >= 0.01);\r\n                                attributes.min !== undefined ? model.$setValidity('range', value >= Number(attributes.min)) : null;\r\n                                attributes.max !== undefined ? model.$setValidity('range', value <= Number(attributes.max)) : null;\r\n                            }\r\n                            /*                             \r\n                            if (valid) {\r\n                                if (value < 0.01) {\r\n                                    valid = false;\r\n                                    type = 'positive';\r\n                                }\r\n                                if (valid && attributes.min !== undefined) {\r\n                                    valid = valid && value >= Number(attributes.min);\r\n                                    if (!valid) {\r\n                                        type = 'range';\r\n                                    }\r\n                                }\r\n                                if (valid && attributes.max !== undefined) {\r\n                                    valid = valid && value <= Number(attributes.max);\r\n                                    if (!valid) {\r\n                                        type = 'range';\r\n                                    }\r\n                                }\r\n                            }\r\n                            */\r\n                            // console.log('validateType.number', type, valid, value);\r\n                        } else {\r\n                            valid = true;\r\n                            value = Number(value);\r\n                            model.$setValidity('number', true);\r\n                            model.$setValidity('positive', true);\r\n                            attributes.min !== undefined ? model.$setValidity('range', true) : null;\r\n                            attributes.max !== undefined ? model.$setValidity('range', true) : null;\r\n                        }\r\n                        return value;\r\n                    });\r\n                    model.$formatters.push(function(value) {\r\n                        if (value) {\r\n                            return $filter('number')(value, precision) + ' ' + format;\r\n                        } else {\r\n                            return null;\r\n                        }\r\n                    });\r\n                    /*\r\n                    model.$render = function () {\r\n                        console.log('model.render', model.$modelValue);\r\n                        element[0].value = model.$modelValue ? $filter('number')(model.$modelValue, precision) + ' ' + format : ' ';\r\n                    };\r\n                    */\r\n                    break;\r\n                case 'anynumber':\r\n                    model.$parsers.unshift(function(value) {\r\n                        var valid = false,\r\n                            type = validateType;\r\n                        if (value !== undefined && value !== \"\") {\r\n                            valid = String(value).indexOf(Number(value).toString()) !== -1; // isFinite(value); // \r\n                            value = Number(value);\r\n                            model.$setValidity('number', valid);\r\n                            if (valid) {\r\n                                attributes.min !== undefined ? model.$setValidity('range', value >= Number(attributes.min)) : null;\r\n                                attributes.max !== undefined ? model.$setValidity('range', value <= Number(attributes.max)) : null;\r\n                            }\r\n                        } else {\r\n                            valid = true;\r\n                            value = Number(value);\r\n                            model.$setValidity('number', true);\r\n                            attributes.min !== undefined ? model.$setValidity('range', true) : null;\r\n                            attributes.max !== undefined ? model.$setValidity('range', true) : null;\r\n                        }\r\n                        return value;\r\n                    });\r\n                    model.$formatters.push(function(value) {\r\n                        if (value || value === 0) {\r\n                            return $filter('number')(value, precision) + ' ' + format;\r\n                        } else {\r\n                            return null;\r\n                        }\r\n                    });\r\n                    break;\r\n            }\r\n\r\n            function onFocus() {\r\n                focus = true;\r\n                if (format) {\r\n                    element[0].value = model.$modelValue || null;\r\n                    if (!model.$modelValue) {\r\n                        model.$setViewValue(null);\r\n                    }\r\n                }\r\n            }\r\n\r\n            function doBlur() {\r\n                if (format && !model.$invalid) {\r\n                    switch (validateType) {\r\n                        case 'date':\r\n                        case 'datetime':\r\n                        case 'datetime-local':\r\n                            element[0].value = model.$modelValue ? $filter('date')(model.$modelValue, format) : ' ';\r\n                            break;\r\n                        default:\r\n                            element[0].value = model.$modelValue ? $filter('number')(model.$modelValue, precision) + ' ' + format : ' ';\r\n                            break;\r\n                    }\r\n                }\r\n            }\r\n\r\n            function onBlur() {\r\n                focus = false;\r\n                doBlur();\r\n            }\r\n\r\n            function addListeners() {\r\n                element.on('focus', onFocus);\r\n                element.on('blur', onBlur);\r\n            }\r\n\r\n            function removeListeners() {\r\n                element.off('focus', onFocus);\r\n                element.off('blur', onBlur);\r\n            }\r\n            scope.$on('$destroy', function() {\r\n                removeListeners();\r\n            });\r\n            addListeners();\r\n        }\r\n    };\r\n}]);\n/* global angular, app, Autolinker */\r\n\n/* global angular, app */\r\n\r\napp.factory('State', ['$timeout', function($timeout) {\r\n    function State() {\r\n        this.isReady = false;\r\n        this.idle();\r\n    }\r\n    State.prototype = {\r\n        idle: function() {\r\n            this.isBusy = false;\r\n            this.isError = false;\r\n            this.isErroring = false;\r\n            this.isSuccess = false;\r\n            this.isSuccessing = false;\r\n            this.button = null;\r\n            this.errors = [];\r\n        },\r\n        enabled: function() {\r\n            return !this.isBusy && !this.isErroring && !this.isSuccessing;\r\n        },\r\n        busy: function() {\r\n            if (!this.isBusy) {\r\n                this.isBusy = true;\r\n                this.isError = false;\r\n                this.isErroring = false;\r\n                this.isSuccess = false;\r\n                this.isSuccessing = false;\r\n                this.errors = [];\r\n                // console.log('State.busy', this);\r\n                return true;\r\n            } else {\r\n                return false;\r\n            }\r\n        },\r\n        success: function() {\r\n            this.isBusy = false;\r\n            this.isError = false;\r\n            this.isErroring = false;\r\n            this.isSuccess = true;\r\n            this.isSuccessing = true;\r\n            this.errors = [];\r\n            $timeout(function() {\r\n                this.isSuccessing = false;\r\n                this.button = null;\r\n            }.bind(this), 1000);\r\n        },\r\n        error: function(error) {\r\n            this.isBusy = false;\r\n            this.isError = true;\r\n            this.isErroring = true;\r\n            this.isSuccess = false;\r\n            this.isSuccessing = false;\r\n            this.errors.push(error);\r\n            $timeout(function() {\r\n                this.isErroring = false;\r\n                this.button = null;\r\n            }.bind(this), 1000);\r\n        },\r\n        ready: function() {\r\n            this.isReady = true;\r\n            this.success();\r\n        },\r\n        errorMessage: function() {\r\n            return this.isError ? this.errors[this.errors.length - 1] : null;\r\n        },\r\n        submitClass: function() {\r\n            return {\r\n                busy: this.isBusy,\r\n                ready: this.isReady,\r\n                successing: this.isSuccessing,\r\n                success: this.isSuccess,\r\n                errorring: this.isErroring,\r\n                error: this.isError,\r\n            };\r\n        },\r\n        submitMessage: function(idleMessage, busyMessage, successMessage, errorMessage) {\r\n            idleMessage = idleMessage || 'Submit';\r\n            if (this.isBusy) {\r\n                return busyMessage || idleMessage;\r\n            } else if (this.isSuccess) {\r\n                return successMessage || idleMessage;\r\n            } else if (this.isError) {\r\n                return errorMessage || idleMessage;\r\n            } else {\r\n                return idleMessage;\r\n            }\r\n        },\r\n    };\r\n    return State;\r\n}]);\n/* global angular, app */\n\napp.service('Router', ['$location', function($location) {\n\n    var service = this;\n    service.redirect = redirect;\n\n    function redirect(path) {\n        $location.$$lastRequestedPath = $location.path();\n        $location.path(path);\n    }\n\n}]);\n\napp.service('FirebaseApi', ['$q', '$location', '$firebaseAuth', '$firebaseObject', '$firebaseArray', 'LocalStorage', function($q, $location, $firebaseAuth, $firebaseObject, $firebaseArray, storage) {\n\n    var firebase = window.firebase || null;\n    if (firebase) {\n        var config = {\n            apiKey: \"AIzaSyCskd8Cgzd_j7JzgEC3mEb4ir1qZFh6auQ\",\n            authDomain: \"starfish-c2b0f.firebaseapp.com\",\n            databaseURL: \"https://starfish-c2b0f.firebaseio.com\",\n            projectId: \"starfish-c2b0f\",\n            storageBucket: \"starfish-c2b0f.appspot.com\",\n            messagingSenderId: \"796739915579\"\n        };\n        firebase.initializeApp(config);\n    } else {\n        throw ('missing firebase.js');\n    }\n\n    var service = this;\n    service.user = undefined;\n    service.presence = undefined;\n    service.items = getUserItems;\n    service.auth = {\n        signin: signin,\n        signup: signup,\n        signout: signout,\n    };\n    service.users = {\n        save: null,\n    };\n    service.current = current;\n    service.isLoggedOrGoTo = isLoggedOrGoTo;\n\n    function connect() {\n        var deferred = $q.defer();\n        if (service.presence) {\n            deferred.resolve(service.presence);\n        } else {\n            var auth = $firebaseAuth();\n            auth.$signInAnonymously({ remember: 'sessionOnly' }).then(function(logged) {\n                var presence = service.presence = {\n                    uid: logged.uid,\n                };\n                deferred.resolve(presence);\n            }).catch(function(error) {\n                console.log('Error', error);\n                deferred.reject(error);\n            });\n        }\n        return deferred.promise;\n    }\n\n    function current() {\n        var deferred = $q.defer();\n        if (service.user) {\n            deferred.resolve(service.user);\n        } else {\n            var token = storage.get('token');\n            if (token) {\n                connect().then(function(p) {\n                    var root = firebase.database().ref();\n                    var usersRef = root.child('users');\n                    usersRef.orderByChild('token').equalTo(token).on('value', function(snap) {\n                        var user = service.user = firstOrDefault(snap);\n                        if (user) {\n                            storage.set('token', user.token);\n                            deferred.resolve(user);\n                        } else {\n                            deferred.reject();\n                        }\n                    });\n                }, function() {\n                    deferred.reject();\n                });\n            } else {\n                deferred.reject();\n            }\n        }\n        return deferred.promise;\n    }\n\n    function signin(model) {\n        console.log('FirebaseApi.signin', model);\n        var deferred = $q.defer();\n        if (service.user) {\n            console.log('signed', service.user);\n            deferred.resolve(service.user);\n        } else {\n            connect().then(function(presence) {\n                var root = firebase.database().ref();\n                var usersRef = root.child('users');\n                usersRef.orderByChild('email').equalTo(model.email).on('value', function(snap) {\n                    var user = service.user = firstOrDefault(snap);\n                    if (user && user.password === model.password) {\n                        storage.set('token', user.token);\n                        deferred.resolve(user);\n                    } else {\n                        deferred.reject({\n                            message: 'not found',\n                        });\n                    }\n                });\n            }, function() {\n                deferred.reject();\n            });\n        }\n        return deferred.promise;\n    }\n\n    function signup(model) {\n        console.log('FirebaseApi.signup', model);\n        var deferred = $q.defer();\n        connect().then(function(p) {\n            console.log('connected', p);\n            var root = firebase.database().ref();\n            var usersRef = root.child('users');\n            var userRef = usersRef.push();\n            model.token = service.presence.uid;\n            storage.set('token', model.token);\n            userRef.set(model);\n            service.user = model;\n            service.updateUser = function() {\n                userRef.set(model);\n            };\n            deferred.resolve(model);\n        }, function() {\n            deferred.reject();\n        });\n        return deferred.promise;\n    }\n\n    function signout() {\n        console.log('FirebaseApi.signout');\n        var deferred = $q.defer();\n        storage.delete('token');\n        service.user = null;\n        deferred.resolve();\n        return deferred.promise;\n    }\n\n    function getUserItems() {\n        return getArray('items', { token: 'token' });\n    }\n\n    function isLoggedOrGoTo(redirect) {\n        var deferred = $q.defer();\n        current().then(function(user) {\n            deferred.resolve(service.user);\n        }, function() {\n            deferred.reject();\n            $location.$$lastRequestedPath = $location.path();\n            $location.path(redirect);\n        });\n        return deferred.promise;\n    }\n\n    // UTILS\n\n    function removeRange(firebaseArray, from, to) {\n        var keys = {};\n        if (to === undefined) {\n            to = firebaseArray.length;\n        }\n        for (var i = from; i < to; ++i) {\n            keys[firebaseArray.$keyAt(i)] = null;\n        }\n        return firebaseArray.$ref().update(keys);\n    }\n\n    function queryBase(collection, query) {\n        var deferred = $q.defer();\n        var root = firebase.database().ref();\n        var ref = root.child(collection);\n        var fields = [];\n        for (var p in query) {\n            fields.push({\n                key: p,\n                value: query[p],\n            });\n        }\n        var field = fields.shift();\n        var items = [];\n        ref.orderByChild(field.key).equalTo(field.value).on('child_added', function(snap) {\n            var item = snap.val();\n            if (item) {\n                deferred.resolve(item);\n            } else {\n                deferred.reject();\n            }\n        });\n        return deferred.promise;\n    }\n\n    function getField(query) {\n        var fields = [];\n        for (var p in query) {\n            fields.push({\n                key: p,\n                value: query[p],\n            });\n        }\n        var field = null;\n        if (fields.length) {\n            field = fields.shift();\n        }\n        return field;\n    }\n\n    function getArray(collection, query, limit) {\n        var deferred = $q.defer();\n        var root = firebase.database().ref();\n        var ref = root.child(collection);\n        var array = null;\n        if (query) {\n            var field = getField(query);\n            if (field) {\n                var queryRef = ref.orderByChild(field.key).equalTo(field.value);\n                if (limit) {\n                    queryRef = queryRef.limitToLast(limit);\n                }\n                array = $firebaseArray(queryRef);\n            }\n        }\n        array = array || $firebaseArray(ref);\n        array.$loaded(function(array) {\n            deferred.resolve(array);\n        }, function(error) {\n            deferred.reject(error);\n        });\n        return deferred.promise;\n    }\n\n    function firstOrDefault(snap) {\n        var item = null;\n        if (snap.numChildren()) {\n            var items = snap.val();\n            var keys = Object.keys(items);\n            item = items[keys[0]];\n        }\n        return item;\n    }\n\n    /*\n\n    this.presences = {\n        getPresences: function () {\n            var deferred = $q.defer();\n            var user = service.user;\n            var root = service.root = firebase.database().ref();\n            var presencesRef = root.child('presences');\n            var userRef = presencesRef.push();\n            var connectedRef = root.child('.info/connected');\n            connectedRef.on('value', function (snap) {\n                if (snap.val()) {\n                    userRef.onDisconnect().remove();\n                    userRef.set(user);\n                    service.updateUser = function () {\n                        userRef.set(user);\n                    };\n                    deferred.resolve();\n                }\n            });\n            presencesRef.on('value', function (snap) {\n                // console.log('# of online users = ', snap.numChildren());\n                var presences = snap.val(),\n                    items = [];\n                for (var key in presences) {\n                    var user = presences[key];\n                    if (user.id !== service.user.id) {\n                        items.push(user);\n                    }\n                }\n                if (items.length) {\n                    service.options.onPresences(items);\n                }\n            });\n            service.presences = $firebaseArray(presencesRef);\n            return deferred.promise;\n        },\n    };\n\n    this.activities = {\n        clearActivities: function () {\n            var min = Number.POSITIVE_INFINITY;\n            angular.forEach(service.presences, function (presence) {\n                min = Math.min(presence.timestamp, min);\n            });\n            var activities = service.activities;\n            var from = 0,\n                to = 0;\n            angular.forEach(activities, function (item, index) {\n                if (item.timestamp < min) {\n                    to = index + 1;\n                }\n            });\n            removeRange(activities, from, to);\n        },\n        addActivities: function (items) {\n            if (items && items.length) {\n                var user = service.user;\n                var root = service.root; // firebase.database().ref();\n                var lastActivity = null;\n                var activitiesRef = root.child('activities');\n                angular.forEach(items, function (item) {\n                    item.userId = user.id;\n                    item.timestamp = Date.now();\n                    lastActivity = item;\n                    var activityRef = activitiesRef.push();\n                    activityRef.set(item);\n                });\n                if (lastActivity) {\n                    user.lastActivity = lastActivity;\n                    service.updateUser();\n                }\n            }\n        },\n        getUniqueActivities: function (items) {\n            items.sort(function (a, b) {\n                return b.timestamp - a.timestamp; // desc\n            });\n            var pool = {};\n            items = items.filter(function (item) {\n                if (!pool[item.id]) {\n                    return (pool[item.id] = true);\n                } else {\n                    return false;\n                }\n            });\n            items.sort(function (a, b) {\n                return a.timestamp - b.timestamp; // asc\n            });\n            return items;\n        },\n        getActivities: function () {\n            var deferred = $q.defer();\n            var root = service.root; // firebase.database().ref();\n            var activitiesRef = root.child('activities');\n            var user = service.user;\n            var lastDate = user.timestamp;\n            activitiesRef.on('value', function (snap) {\n                var activities = snap.val(),\n                    items = [];\n                var max = Number.NEGATIVE_INFINITY;\n                for (var key in activities) {\n                    var activity = activities[key];\n                    max = Math.max(max, activity.timestamp);\n                    if (activity.userId !== service.user.id && activity.timestamp > lastDate) {\n                        items.push(activity);\n                    }\n                }\n                lastDate = Math.max(lastDate, max);\n                items = service.getUniqueActivities(items);\n                if (items.length) {\n                    service.options.onActivities(items);\n                }\n            });\n            var activities = service.activities = $firebaseArray(activitiesRef);\n            activities.$loaded().then(function () {\n                service.clearActivities();\n                deferred.resolve();\n            }).catch(function (error) {\n                deferred.reject(error);\n            });\n            return deferred.promise;\n        },\n    };\n\n    */\n}]);\n\napp.service('WebApi', ['$http', '$q', '$timeout', '$location', function($http, $q, $timeout, $location) {\n\n    var service = this;\n\n    var _get = this.get = function(url, params) {\n        var deferred = $q.defer();\n        $http.get(url, { params: params }).then(function(response) {\n            deferred.resolve(response.data);\n        }, function(response) {\n            onError(deferred, 'get', url, { params: params }, response);\n        });\n        return deferred.promise;\n    };\n    var _post = this.post = function(url, model) {\n        var deferred = $q.defer();\n        if (service.DEBUG) {\n            console.log('Api.DEBUG', url, model);\n            deferred.resolve(model);\n        } else {\n            $http.post(url, model).then(function(response) {\n                deferred.resolve(response.data);\n            }, function(response) {\n                onError(deferred, 'post', url, model, response);\n            });\n        }\n        return deferred.promise;\n    };\n    var _put = this.put = function(url, model) {\n        var deferred = $q.defer();\n        $http.put(url, model).then(function(response) {\n            deferred.resolve(response.data);\n        }, function(response) {\n            onError(deferred, 'put', url, model, response);\n        });\n        return deferred.promise;\n    };\n    var _patch = this.patch = function(url, model) {\n        var deferred = $q.defer();\n        $http.patch(url, model).then(function(response) {\n            deferred.resolve(response.data);\n        }, function(response) {\n            onError(deferred, 'patch', url, model, response);\n        });\n        return deferred.promise;\n    };\n    var _delete = this.delete = function(url) {\n        var deferred = $q.defer();\n        $http.delete(url).then(function(response) {\n            deferred.resolve(response.data);\n        }, function(response) {\n            onError(deferred, 'delete', url, null, response);\n        });\n        return deferred.promise;\n    };\n    var _blob = this.blob = function(url, model) {\n        var deferred = $q.defer();\n        if (service.DEBUG) {\n            console.log('Api.DEBUG', url, model);\n            deferred.resolve(model);\n        } else {\n            $http({\n                url: url,\n                method: \"POST\",\n                data: model,\n                headers: {\n                    'Content-type': 'application/json'\n                },\n                responseType: 'arraybuffer',\n            }).then(function(response) {\n                deferred.resolve(response);\n            }, function(response) {\n                onError(deferred, 'post', url, model, response);\n            });\n        }\n        return deferred.promise;\n    };\n\n    this.auth = {\n        signin: _service.signin,\n        // return _post('/api/auth/login', model);\n        signout: function(userId) {\n            // return _get('/api/auth/logout/' + userId);\n        },\n        current: function() {\n            var deferred = $q.defer();\n            if (_service.user) {\n                deferred.resolve(_service.user);\n            } else {\n                deferred.reject();\n            }\n            return deferred.promise;\n            // return _get('/api/auth/current/');\n        },\n    };\n\n}]);\n\napp.factory('Cookie', ['$q', '$window', function($q, $window) {\n    function Cookie() {}\n    Cookie.TIMEOUT = 5 * 60 * 1000; // five minutes\n    Cookie._set = function(name, value, days) {\n        var expires;\n        if (days) {\n            var date = new Date();\n            date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));\n            expires = '; expires=' + date.toGMTString();\n        } else {\n            expires = '';\n        }\n        $window.document.cookie = name + '=' + value + expires + '; path=/';\n    };\n    Cookie.set = function(name, value, days) {\n        try {\n            var cache = [];\n            var json = JSON.stringify(value, function(key, value) {\n                if (key === 'pool') {\n                    return;\n                }\n                if (typeof value === 'object' && value !== null) {\n                    if (cache.indexOf(value) !== -1) {\n                        // Circular reference found, discard key\n                        return;\n                    }\n                    cache.push(value);\n                }\n                return value;\n            });\n            cache = null;\n            Cookie._set(name, json, days);\n        } catch (e) {\n            console.log('Cookie.set.error serializing', name, value, e);\n        }\n    };\n    Cookie.get = function(name) {\n        var cookieName = name + \"=\";\n        var ca = $window.document.cookie.split(';');\n        for (var i = 0; i < ca.length; i++) {\n            var c = ca[i];\n            while (c.charAt(0) == ' ') {\n                c = c.substring(1, c.length);\n            }\n            if (c.indexOf(cookieName) === 0) {\n                var value = c.substring(cookieName.length, c.length);\n                var model = null;\n                try {\n                    model = JSON.parse(value);\n                } catch (e) {\n                    console.log('Cookie.get.error parsing', key, e);\n                }\n                return model;\n            }\n        }\n        return null;\n    };\n    Cookie.delete = function(name) {\n        Cookie._set(name, \"\", -1);\n    };\n    Cookie.on = function(name) {\n        var deferred = $q.defer();\n        var i, interval = 1000,\n            elapsed = 0,\n            timeout = Cookie.TIMEOUT;\n\n        function checkCookie() {\n            if (elapsed > timeout) {\n                deferred.reject('timeout');\n            } else {\n                var c = Cookie.get(name);\n                if (c) {\n                    deferred.resolve(c);\n                } else {\n                    elapsed += interval;\n                    i = setTimeout(checkCookie, interval);\n                }\n            }\n        }\n        checkCookie();\n        return deferred.promise;\n    };\n    return Cookie;\n}]);\n\napp.factory('LocalStorage', ['$q', '$window', 'Cookie', function($q, $window, Cookie) {\n    function LocalStorage() {}\n\n    function isLocalStorageSupported() {\n        var supported = false;\n        try {\n            supported = 'localStorage' in $window && $window.localStorage !== null;\n            if (supported) {\n                $window.localStorage.setItem('test', '1');\n                $window.localStorage.removeItem('test');\n            } else {\n                supported = false;\n            }\n        } catch (e) {\n            supported = false;\n        }\n        return supported;\n    }\n    LocalStorage.isSupported = isLocalStorageSupported();\n    if (LocalStorage.isSupported) {\n        LocalStorage.set = function(name, value) {\n            try {\n                var cache = [];\n                var json = JSON.stringify(value, function(key, value) {\n                    if (key === 'pool') {\n                        return;\n                    }\n                    if (typeof value === 'object' && value !== null) {\n                        if (cache.indexOf(value) !== -1) {\n                            // Circular reference found, discard key\n                            return;\n                        }\n                        cache.push(value);\n                    }\n                    return value;\n                });\n                cache = null;\n                $window.localStorage.setItem(name, json);\n            } catch (e) {\n                console.log('LocalStorage.set.error serializing', name, value, e);\n            }\n        };\n        LocalStorage.get = function(name) {\n            var value = null;\n            if ($window.localStorage[name] !== undefined) {\n                try {\n                    value = JSON.parse($window.localStorage[name]);\n                } catch (e) {\n                    console.log('LocalStorage.get.error parsing', name, e);\n                }\n            }\n            return value;\n        };\n        LocalStorage.delete = function(name) {\n            $window.localStorage.removeItem(name);\n        };\n        LocalStorage.on = function(name) {\n            var deferred = $q.defer();\n            var i, timeout = Cookie.TIMEOUT;\n\n            function storageEvent(e) {\n                // console.log('LocalStorage.on', name, e);\n                clearTimeout(i);\n                if (e.originalEvent.key == name) {\n                    try {\n                        var value = JSON.parse(e.originalEvent.newValue); // , e.originalEvent.oldValue\n                        deferred.resolve(value);\n                    } catch (error) {\n                        console.log('LocalStorage.on.error parsing', name, error);\n                        deferred.reject('error parsing ' + name);\n                    }\n                }\n            }\n            angular.element($window).on('storage', storageEvent);\n            i = setTimeout(function() {\n                deferred.reject('timeout');\n            }, timeout);\n            return deferred.promise;\n        };\n    } else {\n        console.log('LocalStorage.unsupported switching to cookies');\n        LocalStorage.set = Cookie.set;\n        LocalStorage.get = Cookie.get;\n        LocalStorage.delete = Cookie.delete;\n        LocalStorage.on = Cookie.on;\n    }\n    return LocalStorage;\n}]);\n\napp.factory('SessionStorage', ['$q', '$window', 'Cookie', function($q, $window, Cookie) {\n    function SessionStorage() {}\n\n    function isSessionStorageSupported() {\n        var supported = false;\n        try {\n            supported = 'sessionStorage' in $window && $window.sessionStorage !== undefined;\n            if (supported) {\n                $window.sessionStorage.setItem('test', '1');\n                $window.sessionStorage.removeItem('test');\n            } else {\n                supported = false;\n            }\n        } catch (e) {\n            supported = false;\n        }\n        return supported;\n    }\n    SessionStorage.isSupported = isSessionStorageSupported();\n    if (SessionStorage.isSupported) {\n        SessionStorage.set = function(name, value) {\n            try {\n                var cache = [];\n                var json = JSON.stringify(value, function(key, value) {\n                    if (key === 'pool') {\n                        return;\n                    }\n                    if (typeof value === 'object' && value !== null) {\n                        if (cache.indexOf(value) !== -1) {\n                            // Circular reference found, discard key\n                            return;\n                        }\n                        cache.push(value);\n                    }\n                    return value;\n                });\n                cache = null;\n                $window.sessionStorage.setItem(name, json);\n            } catch (e) {\n                console.log('SessionStorage.set.error serializing', name, value, e);\n            }\n        };\n        SessionStorage.get = function(name) {\n            var value = null;\n            if ($window.sessionStorage[name] !== undefined) {\n                try {\n                    value = JSON.parse($window.sessionStorage[name]);\n                } catch (e) {\n                    console.log('SessionStorage.get.error parsing', name, e);\n                }\n            }\n            return value;\n        };\n        SessionStorage.delete = function(name) {\n            $window.sessionStorage.removeItem(name);\n        };\n        SessionStorage.on = function(name) {\n            var deferred = $q.defer();\n            var i, timeout = Cookie.TIMEOUT;\n\n            function storageEvent(e) {\n                // console.log('SessionStorage.on', name, e);\n                clearTimeout(i);\n                if (e.originalEvent.key === name) {\n                    try {\n                        var value = JSON.parse(e.originalEvent.newValue); // , e.originalEvent.oldValue\n                        deferred.resolve(value);\n                    } catch (error) {\n                        console.log('SessionStorage.on.error parsing', name, error);\n                        deferred.reject('error parsing ' + name);\n                    }\n                }\n            }\n            angular.element($window).on('storage', storageEvent);\n            i = setTimeout(function() {\n                deferred.reject('timeout');\n            }, timeout);\n            return deferred.promise;\n        };\n    } else {\n        console.log('SessionStorage.unsupported switching to cookies');\n        SessionStorage.set = Cookie.set;\n        SessionStorage.get = Cookie.get;\n        SessionStorage.delete = Cookie.delete;\n        SessionStorage.on = Cookie.on;\n    }\n    return SessionStorage;\n}]);"]}