{"version":3,"sources":["docs/js/app.js"],"names":["app","angular","module","config","$routeProvider","$locationProvider","when","title","templateUrl","controller","resolve","user","api","isLoggedOrGoTo","html5Mode","hashPrefix","$httpProvider","defaults","withCredentials","run","$rootScope","$route","$routeParams","$window","$document","$q","$timeout","closeModal","modal","index","forEach","modals","m","i","active","splice","standalone","navigator","$on","current","value","key","replace","RegExp","log","console","info","apply","arguments","addModal","modalType","params","deferred","defer","template","data","this","reject","push","scrollTo","promise","$scope","$location","signout","auth","then","path","State","state","ready","model","email","password","submit","busy","signin","response","success","$$lastRequestedPath","error","shopName","signup","$interval","Hash","Calendar","GanttRow","serializeDate","date","pad","v","s","z","length","Array","join","yyyy","getFullYear","MM","getMonth","dd","getDate","hh","getHours","mm","getMinutes","ss","getSeconds","getRandomDay","Date","setDate","Math","floor","random","setHours","setMinutes","setSeconds","ceil","getTime","mKey","getRandomItem","day","item","id","uid","hours","activityId","row","taskId","prototype","slice","call","activity","name","budgetHours","project","type","deliveryDate","addItem","slots","add","update","updateMonths","updateItem","extend","clearItems","ranges","removeAll","months","days","intervalId","start","stop","cancel","constant","ACTIVITY","CUSTOMER","DEPARTMENT","GROUP","MANAGER","PROJECT","RESOURCE","USER","factory","pool","get","Object","defineProperties","enumerable","writable","has","undefined","getId","hash","set","newItem","p","keys","remove","oldItem","indexOf","addMany","items","removeMany","shift","each","callback","forward","reverse","sort","c","d","a","b","backward","differs","t","updatePool","pools","ArrayFrom","len","today","todayKey","clearMonth","month","tasks","fromDay","getDay","monthDays","weeks","r","$today","getKey","ganttGroups","colors","assignedHours","useBudget","customer","department","manager","resource","color","lastTaskId","canSelect","canEdit","toLowerCase","mergeSlot","slot","insertSlot","min","max","removeSlots","toggleSlots","assign","col","$key","$date","write","erase","toggle","total","copy","task","updateRanges","previous","lastDay","rKey","range","getRange","from","to","firstKey","lastKey","updateRange","previousKey","nextKey","n","canMoveRange","dir","can","first","getOffsetKey","startDate","k","moveRange","addDays","toggleOpened","opened","compress","Utils","where","serialNumber","number","toString","directive","restrict","transclude","header","link","scope","element","attributes","message","$http","$templateCache","$compile","$parse","formatLabel","string","prepend","expression","splitted","split","formatted","uniqueId","control","ngModel","required","form","placeholder","require","compile","pre","label","filter","optionLabel","options","source","field","minLength","maxLength","Number","POSITIVE_INFINITY","focus","getType","visible","getClasses","$parent","control-focus","control-success","$valid","control-error","$invalid","$submitted","$touched","control-empty","$viewValue","getMessages","$error","onClick","$eval","onValidate","button","removeListeners","off","stateClass","isBusy","successing","isSuccessing","isSuccess","errorring","isErroring","isError","stateDisabled","on","_format","templateFunction","aid","formKey","formFocus","decoration","disabled","change","onChange","onFocus","blur","onBlur","inputCols","cols","colInput","colLabel","readonly","validate","format","precision","ngDisabled","controlRow","match","validation","click","mouseover","mouseout","icon","nameHi","formKeyHi","modelHi","validationHi","requiredHi","messageHi","decorationHi","himodel","canCreate","flatten","queryable","onSelected","rows","taDisabled","templateElement","templateAttributes","html","contents","onRemove","e","getter","numberPicker","setter","onAdd","nodeRemove","nodeAdd","node","querySelectorAll","$filter","$modelValue","$setViewValue","doBlur","validateType","$formatters","$parsers","unshift","valid","String","$setValidity","isReady","idle","errors","enabled","bind","errorMessage","submitClass","submitMessage","idleMessage","busyMessage","successMessage","service","$firebaseAuth","$firebaseObject","$firebaseArray","storage","removeRange","firebaseArray","$keyAt","$ref","snap","numChildren","val","firebase","window","apiKey","authDomain","databaseURL","projectId","storageBucket","messagingSenderId","initializeApp","token","connect","database","ref","child","orderByChild","equalTo","redirect","presence","firebaseAuth","$signInAnonymously","remember","logged","catch","root","usersRef","userRef","updateUser","delete","presences","getPresences","presencesRef","onDisconnect","onPresences","activities","clearActivities","timestamp","addActivities","lastActivity","activitiesRef","userId","now","getUniqueActivities","getActivities","lastDate","NEGATIVE_INFINITY","onActivities","$loaded","url","onError","post","DEBUG","put","patch","blob","method","headers","Content-type","responseType","_service","Cookie","TIMEOUT","_set","expires","setTime","toGMTString","document","cookie","cache","json","JSON","stringify","cookieName","ca","charAt","substring","parse","checkCookie","elapsed","timeout","interval","setTimeout","LocalStorage","isSupported","supported","localStorage","setItem","removeItem","storageEvent","clearTimeout","originalEvent","newValue","SessionStorage","sessionStorage"],"mappings":"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","file":"app.min.js","sourcesContent":["/* global angular */\r\n\r\n\"use strict\";\r\n\r\nvar app = angular.module('app', ['ngRoute', 'ngMessages', 'firebase', 'jsonFormatter']);\r\n\r\napp.config(['$routeProvider', '$locationProvider', function($routeProvider, $locationProvider) {\r\n\r\n    $routeProvider.when('/', {\r\n        title: 'Homepage',\r\n        templateUrl: 'partials/home.html',\r\n        controller: 'HomeCtrl',\r\n\r\n    }).when('/signin', {\r\n        title: 'Accedi',\r\n        templateUrl: 'partials/signin.html',\r\n        controller: 'SigninCtrl',\r\n\r\n    }).when('/signup', {\r\n        title: 'Registrazione',\r\n        templateUrl: 'partials/signup.html',\r\n        controller: 'SignupCtrl',\r\n\r\n    }).when('/dashboard', {\r\n        title: 'Dashboard',\r\n        templateUrl: 'partials/dashboard.html',\r\n        controller: 'DashboardCtrl',\r\n        resolve: {\r\n            user: ['FirebaseApi', function(api) {\r\n                return api.isLoggedOrGoTo('/signin');\r\n            }],\r\n        },\r\n\r\n    }).when('/user/:userId', {\r\n        title: 'User',\r\n        templateUrl: 'partials/user.html',\r\n        controller: 'UserCtrl',\r\n        resolve: {\r\n            user: ['FirebaseApi', function(api) {\r\n                return api.isLoggedOrGoTo('/signin');\r\n            }],\r\n        },\r\n\r\n    }).when('/404', {\r\n        title: 'Error 404',\r\n        templateUrl: 'partials/404',\r\n\r\n    });\r\n\r\n    // $routeProvider.otherwise('/'); // stream\r\n\r\n    // HTML5 MODE url writing method (false: #/anchor/use, true: /html5/url/use)\r\n    $locationProvider.html5Mode(false);\r\n    $locationProvider.hashPrefix('');\r\n\r\n}]);\r\n\r\napp.config(['$httpProvider', function($httpProvider) {\r\n    $httpProvider.defaults.withCredentials = true;\r\n}]);\r\n\r\napp.run(['$rootScope', '$route', '$routeParams', '$window', '$document', '$q', '$timeout', function($rootScope, $route, $routeParams, $window, $document, $q, $timeout) {\r\n\r\n    $rootScope.standalone = $window.navigator.standalone;\r\n\r\n    $rootScope.$on('$routeChangeSuccess', function() {\r\n        var title = $route.current.title;\r\n        angular.forEach($routeParams, function(value, key) {\r\n            title = title.replace(new RegExp(':' + key, 'g'), value);\r\n        });\r\n        $document.title = title || '';\r\n    });\r\n\r\n    $rootScope.log = function() {\r\n        if ($window.console && $window.console.info) {\r\n            $window.console.info.apply($window.console, arguments);\r\n        }\r\n    };\r\n\r\n    // MODALS\r\n    $rootScope.modals = [];\r\n\r\n    function closeModal(modal) {\r\n        var index = -1;\r\n        angular.forEach($rootScope.modals, function(m, i) {\r\n            if (m === modal) {\r\n                index = i;\r\n            }\r\n        });\r\n        if (index !== -1) {\r\n            modal.active = false;\r\n            $timeout(function() {\r\n                $rootScope.modals.splice(index, 1);\r\n            }, 500);\r\n        }\r\n    }\r\n\r\n    $rootScope.addModal = function(modalType, title, params) {\r\n        var deferred = $q.defer();\r\n        params = params || null;\r\n        var modal = {\r\n            title: 'Untitled',\r\n            controller: null,\r\n            template: null,\r\n            params: params,\r\n        };\r\n        switch (modalType) {\r\n            case 'messageModal':\r\n                modal = {\r\n                    title: title || 'Messaggio',\r\n                    controller: 'MessageModalCtrl',\r\n                    template: 'partials/modals/message',\r\n                    params: params,\r\n                };\r\n                break;\r\n        }\r\n        modal.deferred = deferred;\r\n        modal.resolve = function(data) {\r\n            closeModal(this);\r\n            modal.deferred.resolve(data, modal);\r\n        };\r\n        modal.reject = function() {\r\n            closeModal(this);\r\n            modal.deferred.reject(modal);\r\n        };\r\n        $rootScope.modals.push(modal);\r\n        angular.forEach($rootScope.modals, function(m, i) {\r\n            m.active = false;\r\n        });\r\n        $timeout(function() {\r\n            modal.active = true;\r\n            $window.scrollTo(0, 0);\r\n        }, 500);\r\n        return deferred.promise;\r\n    };\r\n\r\n}]);\n/* global angular, app */\r\n\n/* global angular, app */\r\n\r\napp.controller('RootCtrl', ['$scope', '$location', 'FirebaseApi', function($scope, $location, api) {\r\n\r\n    $scope.api = api;\r\n\r\n    $scope.signout = function() {\r\n        console.log(api);\r\n        api.auth.signout().then(function() {\r\n            $location.path('/');\r\n        });\r\n    }\r\n\r\n    api.current().then(function(user) {\r\n        console.log(user);\r\n    });\r\n\r\n}]);\r\n\r\napp.controller('HomeCtrl', ['$scope', '$location', '$timeout', 'State', 'FirebaseApi', function($scope, $location, $timeout, State, api) {\r\n\r\n    var state = $scope.state = new State();\r\n\r\n    state.ready();\r\n\r\n}]);\r\n\r\napp.controller('DashboardCtrl', ['$scope', '$location', '$timeout', 'State', 'FirebaseApi', function($scope, $location, $timeout, State, api) {\r\n\r\n    var state = $scope.state = new State();\r\n\r\n    state.ready();\r\n\r\n}]);\r\n\r\napp.controller('SigninCtrl', ['$scope', '$location', '$timeout', 'State', 'FirebaseApi', function($scope, $location, $timeout, State, api) {\r\n\r\n    var state = $scope.state = new State();\r\n\r\n    var model = $scope.model = {\r\n        email: 'stefano.tombari@gmail.com',\r\n        password: 'password',\r\n    };\r\n\r\n    $scope.submit = function() {\r\n        if (state.busy()) {\r\n            api.auth.signin(model).then(function success(response) {\r\n                state.success();\r\n                $timeout(function() {\r\n                    var path = $location.$$lastRequestedPath || '/dashboard';\r\n                    console.log('SigninCtrl', path, response);\r\n                    $location.path(path);\r\n                    $location.$$lastRequestedPath = null;\r\n                }, 1000);\r\n            }, function error(response) {\r\n                console.log('SigninCtrl.error', response);\r\n                state.error(response);\r\n            });\r\n        }\r\n    };\r\n\r\n}]);\r\n\r\napp.controller('SignupCtrl', ['$scope', '$location', '$timeout', 'State', 'FirebaseApi', function($scope, $location, $timeout, State, api) {\r\n\r\n    var state = $scope.state = new State();\r\n\r\n    var model = $scope.model = {\r\n        email: 'stefano.tombari@gmail.com',\r\n        password: 'password',\r\n        shopName: 'Bagni Elsa n3',\r\n    };\r\n\r\n    $scope.submit = function() {\r\n        if (state.busy()) {\r\n            api.auth.signup(model).then(function success(response) {\r\n                state.success();\r\n                $timeout(function() {\r\n                    var path = $location.$$lastRequestedPath || '/dashboard';\r\n                    console.log('SignupCtrl', path, response);\r\n                    $location.path(path);\r\n                    $location.$$lastRequestedPath = null;\r\n                }, 1000);\r\n            }, function error(response) {\r\n                console.log('SignupCtrl.error', response);\r\n                state.error(response);\r\n            });\r\n        }\r\n    };\r\n\r\n}]);\r\n\r\napp.controller('DemoCtrl', ['$scope', '$interval', 'Hash', 'Calendar', 'GanttRow', function($scope, $interval, Hash, Calendar, GanttRow) {\r\n\r\n    var row = $scope.row = new GanttRow({\r\n        activity: {\r\n            id: 1000000 + getRandom(),\r\n            name: 'Activity',\r\n            budgetHours: 10 + Math.floor(Math.random() * 50),\r\n        },\r\n        project: {\r\n            type: Math.floor(Math.random() * 5),\r\n            deliveryDate: new Date(),\r\n        },\r\n    }, []);\r\n\r\n    $scope.addItem = function() {\r\n        var item = getRandomItem();\r\n        row.slots.add(item);\r\n        row.update();\r\n        row.updateMonths();\r\n        $scope.item = item;\r\n        // console.log('addItem', item.id);\r\n        log('addItem', item.id);\r\n    };\r\n    $scope.updateItem = function() {\r\n        if ($scope.item) {\r\n            var id = $scope.item.id;\r\n            item = getRandomItem();\r\n            item = angular.extend($scope.item, item);\r\n            item.id = id;\r\n            row.slots.add(item);\r\n            row.update();\r\n            row.updateMonths();\r\n            $scope.item = item;\r\n            log('updateItem', item.id);\r\n        }\r\n    };\r\n    $scope.clearItems = function() {\r\n        row.ranges.removeAll();\r\n        row.months.removeAll();\r\n        row.days.removeAll();\r\n        row.slots.removeAll();\r\n        row.update();\r\n        row.updateMonths();\r\n        delete $scope.item;\r\n        log('clearItems');\r\n    };\r\n\r\n    var intervalId;\r\n    $scope.start = function() {\r\n        $scope.stop();\r\n        intervalId = $interval($scope.addItem, 1000 / 60);\r\n    };\r\n    $scope.stop = function() {\r\n        if (intervalId) {\r\n            $interval.cancel(intervalId);\r\n        }\r\n    };\r\n\r\n    function serializeDate(date) {\r\n        function pad(v, s, z) {\r\n            v = (v || 0) + '';\r\n            s = (s || 2);\r\n            z = (z || '0');\r\n            return v.length >= s ? v : new Array(s - v.length + 1).join(z) + v;\r\n        }\r\n        var yyyy = date.getFullYear();\r\n        var MM = date.getMonth() + 1; // getMonth() is zero-based\r\n        var dd = date.getDate();\r\n        var hh = date.getHours();\r\n        var mm = date.getMinutes();\r\n        var ss = date.getSeconds();\r\n        return yyyy + '-' + pad(MM) + '-' + pad(dd) + 'T' + pad(hh) + ':' + pad(mm) + ':' + pad(ss);\r\n    }\r\n\r\n    function getRandom() {\r\n        return 1000000 + Math.floor(Math.random() * 100000);\r\n    }\r\n\r\n    function getRandomDay() {\r\n        var oneday = (24 * 60 * 60 * 1000);\r\n        var date = new Date();\r\n        date.setDate(date.getDate() + Math.floor(Math.random() * 60));\r\n        // date.setMonth(date.getMonth() + Math.floor(Math.random() * 2));\r\n        date.setHours(0);\r\n        date.setMinutes(0);\r\n        date.setSeconds(0);\r\n        var yyyy = date.getFullYear();\r\n        var MM = date.getMonth();\r\n        var key = Math.ceil(date.getTime() / oneday);\r\n        var mKey = yyyy * 12 + MM;\r\n        return {\r\n            key: key,\r\n            mKey: mKey,\r\n            date: serializeDate(date)\r\n        };\r\n    }\r\n\r\n    var uid = 1;\r\n\r\n    function getRandomItem() {\r\n        var day = getRandomDay();\r\n        var item = {\r\n            id: uid,\r\n            hours: 1 + Math.floor(Math.random() * 6),\r\n            date: new Date(day.date),\r\n            key: day.key,\r\n            mKey: day.mKey,\r\n            activityId: row.id,\r\n        };\r\n        if (Math.floor(Math.random() * 3) === 0) {\r\n            item.taskId = 10000 + Math.floor(Math.random() * 50);\r\n        }\r\n        uid++;\r\n        return item;\r\n    }\r\n\r\n    function log() {\r\n        $scope.log = Array.prototype.slice.call(arguments);\r\n    }\r\n}]);\r\n\r\napp.constant('ganttGroups', {\r\n    ACTIVITY: 1,\r\n    CUSTOMER: 2,\r\n    DEPARTMENT: 3,\r\n    GROUP: 4,\r\n    MANAGER: 5,\r\n    PROJECT: 6,\r\n    RESOURCE: 7,\r\n    USER: 9,\r\n});\r\n\r\napp.factory('Hash', [function() {\r\n    var pools = {};\r\n\r\n    function Hash(key, pool) {\r\n        key = key || 'id';\r\n        pool = pool ? Hash.get(pool) : {};\r\n        Object.defineProperties(this, {\r\n            key: {\r\n                value: key,\r\n                enumerable: false,\r\n                writable: false\r\n            },\r\n            pool: {\r\n                value: pool,\r\n                enumerable: false,\r\n                writable: false\r\n            },\r\n            length: {\r\n                value: 0,\r\n                enumerable: false,\r\n                writable: true\r\n            }\r\n        });\r\n    }\r\n\r\n    function has(id) {\r\n        return this.pool[id] !== undefined;\r\n    }\r\n\r\n    function getId(id) {\r\n        return this.pool[id];\r\n    }\r\n\r\n    function get(item) {\r\n        var hash = this,\r\n            key = this.key;\r\n        return item ? hash.getId(item[key]) : null;\r\n    }\r\n\r\n    function set(item) {\r\n        var hash = this,\r\n            pool = this.pool,\r\n            key = this.key;\r\n        pool[item[key]] = item;\r\n        hash.push(item);\r\n        return item;\r\n    }\r\n\r\n    function add(newItem) {\r\n        var hash = this;\r\n        var item = hash.get(newItem);\r\n        if (item) {\r\n            for (var i = 0, keys = Object.keys(newItem), p; i < keys.length; i++) {\r\n                p = keys[i];\r\n                item[p] = newItem[p];\r\n            }\r\n        } else {\r\n            item = hash.set(newItem);\r\n        }\r\n        return item;\r\n    }\r\n\r\n    function remove(oldItem) {\r\n        var hash = this,\r\n            pool = this.pool,\r\n            key = this.key;\r\n        var item = hash.get(oldItem);\r\n        if (item) {\r\n            var index = hash.indexOf(item);\r\n            if (index !== -1) {\r\n                hash.splice(index, 1);\r\n            }\r\n            delete pool[item[key]];\r\n        }\r\n        return hash;\r\n    }\r\n\r\n    function addMany(items) {\r\n        var hash = this;\r\n        if (!items) {\r\n            return hash;\r\n        }\r\n        var i = 0;\r\n        while (i < items.length) {\r\n            hash.add(items[i]);\r\n            i++;\r\n        }\r\n        return hash;\r\n    }\r\n\r\n    function removeMany(items) {\r\n        var hash = this;\r\n        if (!items) {\r\n            return hash;\r\n        }\r\n        var i = 0;\r\n        while (i < items.length) {\r\n            hash.remove(items[i]);\r\n            i++;\r\n        }\r\n        return hash;\r\n    }\r\n\r\n    function removeAll() {\r\n        var hash = this,\r\n            key = hash.key,\r\n            pool = hash.pool;\r\n        var i = 0,\r\n            t = hash.length,\r\n            item;\r\n        while (hash.length) {\r\n            item = hash.shift();\r\n            delete pool[item[key]];\r\n            i++;\r\n        }\r\n        return hash;\r\n    }\r\n\r\n    function each(callback) {\r\n        var hash = this;\r\n        if (callback) {\r\n            var i = 0;\r\n            while (i < hash.length) {\r\n                callback(hash[i], i);\r\n                i++;\r\n            }\r\n        }\r\n        return hash;\r\n    }\r\n\r\n    function forward(key, reverse) {\r\n        var hash = this;\r\n        key = (key || this.key);\r\n        hash.sort(function(c, d) {\r\n            var a = reverse ? d : c;\r\n            var b = reverse ? c : d;\r\n            return a[key] - b[key];\r\n        });\r\n        return hash;\r\n    }\r\n\r\n    function backward(key) {\r\n        return this.forward(key, true);\r\n    }\r\n\r\n    function differs(hash) {\r\n        if (hash.key !== this.key || hash.length !== this.length) {\r\n            return true;\r\n        } else {\r\n            var differs = false,\r\n                i = 0,\r\n                t = this.length,\r\n                key = this.key;\r\n            while (differs && i < t) {\r\n                differs = this[i][key] !== hash[i][key];\r\n                i++;\r\n            }\r\n        }\r\n    }\r\n\r\n    function updatePool() {\r\n        var hash = this,\r\n            pool = this.pool,\r\n            key = this.key;\r\n        Object.keys(pool).forEach(function(key) {\r\n            delete pool[key];\r\n        });\r\n        angular.forEach(hash, function(item) {\r\n            pool[item[key]] = item;\r\n        });\r\n    }\r\n    Hash.get = function(pool) {\r\n        return (pools[pool] = pools[pool] || {});\r\n    };\r\n    Hash.prototype = new Array;\r\n    Hash.prototype.has = has;\r\n    Hash.prototype.getId = getId;\r\n    Hash.prototype.get = get;\r\n    Hash.prototype.set = set;\r\n    Hash.prototype.add = add;\r\n    Hash.prototype.remove = remove;\r\n    Hash.prototype.each = each;\r\n    Hash.prototype.addMany = addMany;\r\n    Hash.prototype.removeMany = removeMany;\r\n    Hash.prototype.removeAll = removeAll;\r\n    Hash.prototype.forward = forward;\r\n    Hash.prototype.backward = backward;\r\n    Hash.prototype.differs = differs;\r\n    Hash.prototype.updatePool = updatePool;\r\n    return Hash;\r\n}]);\r\n\r\napp.factory('Calendar', ['Hash', function(Hash) {\r\n    var oneday = (24 * 60 * 60 * 1000);\r\n    var today = new Date();\r\n    today.setHours(0);\r\n    today.setMinutes(0);\r\n    today.setSeconds(0);\r\n    var todayKey = Math.ceil(today.getTime() / oneday);\r\n\r\n    function ArrayFrom(len, callback) {\r\n        var a = [];\r\n        while (a.length < len) {\r\n            a.push(callback(a.length));\r\n        }\r\n        return a;\r\n    }\r\n    var months = new Hash('mKey');\r\n\r\n    function Calendar() {}\r\n    Calendar.getDate = function(day) {\r\n        if (typeof day.date.getMonth === 'function') {\r\n            return day.date;\r\n        } else {\r\n            return new Date(day.date);\r\n        }\r\n    };\r\n    Calendar.clearMonth = function(month) {\r\n        month.days.each(function(day) {\r\n            if (day) {\r\n                day.hours = 0;\r\n                day.tasks = [];\r\n            }\r\n        });\r\n    };\r\n    Calendar.getMonth = function(day) {\r\n        today = new Date();\r\n        today.setHours(0);\r\n        today.setMinutes(0);\r\n        today.setSeconds(0);\r\n        todayKey = Math.ceil(today.getTime() / oneday);\r\n        //\r\n        var date = Calendar.getDate(day);\r\n        var yyyy = date.getFullYear();\r\n        var MM = date.getMonth();\r\n        var key = Math.ceil(date.getTime() / oneday);\r\n        var mKey = yyyy * 12 + MM;\r\n        var month = months.getId(mKey);\r\n        if (!month) {\r\n            var fromDay = new Date(yyyy, MM, 1).getDay();\r\n            var monthDays = new Date(yyyy, MM + 1, 0).getDate();\r\n            var weeks = Math.ceil(monthDays / 7);\r\n            month = {\r\n                date: date,\r\n                mKey: mKey,\r\n                month: MM,\r\n                monthDays: monthDays,\r\n                fromDay: fromDay,\r\n                days: new Hash('key'),\r\n            };\r\n            month.weeks = ArrayFrom(weeks, function(r) {\r\n                var days = ArrayFrom(7, function(c) {\r\n                    var item = null;\r\n                    var d = r * 7 + c - (fromDay - 1);\r\n                    if (d >= 0 && d < monthDays) {\r\n                        var date = new Date(yyyy, MM, d + 1);\r\n                        var key = Math.ceil(date.getTime() / oneday);\r\n                        item = {\r\n                            $today: key === todayKey,\r\n                            c: c,\r\n                            r: r,\r\n                            d: d + 1,\r\n                            date: date,\r\n                            key: key,\r\n                            hours: 0,\r\n                            tasks: [],\r\n                        };\r\n                        item = month.days.add(item);\r\n                    }\r\n                    return item;\r\n                });\r\n                return {\r\n                    r: r,\r\n                    days: days,\r\n                };\r\n            });\r\n            month = months.add(month);\r\n        }\r\n        return month;\r\n    };\r\n    Calendar.getDay = function(days) {\r\n        var date = new Date(today);\r\n        date.setDate(date.getDate() + days);\r\n        return date;\r\n    };\r\n    Calendar.getKey = function(date) {\r\n        return Math.ceil(date.getTime() / oneday);\r\n    };\r\n    return Calendar;\r\n}]);\r\n\r\napp.factory('GanttRow', ['Hash', 'Calendar', 'ganttGroups', function(Hash, Calendar, ganttGroups) {\r\n    var uid = 1;\r\n\r\n    var oneday = (24 * 60 * 60 * 1000);\r\n    var today = new Date();\r\n    today.setHours(0);\r\n    today.setMinutes(0);\r\n    today.setSeconds(0);\r\n    var todayKey = Math.ceil(today.getTime() / oneday);\r\n\r\n    function GanttRow(data, colors) {\r\n        this.type = ganttGroups.ACTIVITY;\r\n        this.assignedHours = 0;\r\n        this.slots = new Hash('id');\r\n        this.days = new Hash('key');\r\n        this.months = new Hash('mKey');\r\n        this.ranges = new Hash('rKey');\r\n        this.tasks = new Hash('id'); // 'taskId'\r\n        // angular.isObject(data) ? angular.extend(this, data) : null;\r\n        if (data) {\r\n            this.id = data.activity.id;\r\n            this.name = data.activity.name;\r\n            this.budgetHours = data.activity.budgetHours;\r\n            this.useBudget = data.project.type !== 2 && data.project.type !== 4;\r\n            this.customer = data.customer;\r\n            this.department = data.department;\r\n            this.manager = data.manager;\r\n            this.project = data.project;\r\n            this.resource = data.resource;\r\n            this.color = colors[this.id % (colors.length || 1)];\r\n        }\r\n        // this.items = new Hash().fill(data.items);\r\n        this.lastTaskId = null;\r\n        this.update();\r\n    }\r\n    GanttRow.prototype = {\r\n        canSelect: function() {\r\n            return this.type === ganttGroups.ACTIVITY && this.budgetHours > 0;\r\n        },\r\n        canEdit: function() {\r\n            return this.canSelect() && this.resource.name.toLowerCase().indexOf('nondefinito') === -1;\r\n        },\r\n        mergeSlot: function(slot) {\r\n            var slots = this.slots;\r\n            if (slot.hours) {\r\n                slots.add(slot);\r\n            } else {\r\n                slots.remove(slot);\r\n            }\r\n        },\r\n        insertSlot: function(key, hours, taskId) {\r\n            var slot = null;\r\n            if (this.useBudget) {\r\n                hours = Math.min(hours, this.budgetHours - this.assignedHours);\r\n            }\r\n            hours = Math.max(0, hours);\r\n            if (hours > 0) {\r\n                var item = {\r\n                    id: 'temp-' + (uid++),\r\n                    key: key,\r\n                    date: new Date(key * oneday),\r\n                    hours: hours,\r\n                    activityId: this.id,\r\n                };\r\n                if (taskId) {\r\n                    item.taskId = taskId;\r\n                    this.lastTaskId = taskId;\r\n                }\r\n                this.slots.add(item);\r\n                slot = this.slots.getId(item.id);\r\n            }\r\n            this.update();\r\n            return slot;\r\n        },\r\n        removeSlots: function(key) {\r\n            var day = this.days.getId(key);\r\n            day.tasks.each(function(item) {\r\n                item.hours = 0;\r\n            });\r\n            var slots = day.tasks.slice();\r\n            this.slots.removeMany(slots);\r\n            this.update();\r\n            return slots;\r\n        },\r\n        toggleSlots: function(key, hours) {\r\n            if (this.days.has(key)) {\r\n                return this.removeSlots(key);\r\n            } else {\r\n                var slot = this.insertSlot(key, hours, this.lastTaskId);\r\n                return [slot];\r\n            }\r\n        },\r\n        // WRITE CANCEL DAY SLOT\r\n        assign: function(col, value) {\r\n            console.log('assign');\r\n            var slots = this.slots,\r\n                key = col.$key;\r\n            var item = {\r\n                // errore\r\n                id: 'temp-' + (uid++),\r\n                key: key,\r\n                date: col.$date,\r\n                hours: value || 0,\r\n                activityId: this.id,\r\n            };\r\n            if (value) {\r\n                slots.add(item);\r\n            } else {\r\n                slots.remove(item);\r\n            }\r\n            this.update();\r\n            return this.days.getId(key);\r\n        },\r\n        write: function(col, value, max) {\r\n            value = Math.min(value, max);\r\n            if (this.useBudget) {\r\n                value = Math.min(value, this.budgetHours - this.assignedHours);\r\n            }\r\n            value = Math.max(0, value);\r\n            if (value && !this.days.has(col.$key) && col.$date >= today) {\r\n                return this.assign(col, value);\r\n            }\r\n        },\r\n        erase: function(col, value, max) {\r\n            if (this.days.has(col.$key) && col.$date >= today) {\r\n                return this.assign(col, null);\r\n            }\r\n        },\r\n        toggle: function(col, value, max) {\r\n            if (this.days.has(col.$key)) {\r\n                return this.erase(col, value, max);\r\n            } else {\r\n                return this.write(col, value, max);\r\n            }\r\n        },\r\n        // WRITE CANCEL DAY SLOT\r\n        update: function() {\r\n            var total = 0;\r\n            var slots = this.slots,\r\n                days = this.days;\r\n            days.removeAll();\r\n            var taskId = null;\r\n            slots.each(function(item) {\r\n                taskId = item.taskId || taskId;\r\n                total += item ? item.hours : 0;\r\n                var day = days.add({\r\n                    key: item.key,\r\n                    date: item.date,\r\n                    hours: 0,\r\n                });\r\n                day.tasks = day.tasks || new Hash('id'); // 'taskId'\r\n                day.tasks.add(angular.copy(item));\r\n                day.tasks.each(function(task) {\r\n                    day.hours += task.hours;\r\n                });\r\n            });\r\n            this.lastTaskId = taskId || this.lastTaskId;\r\n            days.forward(); // sort by key       \r\n            this.assignedHours = total;\r\n            this.updateRanges();\r\n        },\r\n        updateMonths: function() {\r\n            var days = this.days,\r\n                months = this.months;\r\n            months.removeAll();\r\n            var previous;\r\n            days.each(function(item) {\r\n                var month = Calendar.getMonth(item);\r\n                if (month !== previous) {\r\n                    previous = month;\r\n                    Calendar.clearMonth(month);\r\n                }\r\n                months.add(month);\r\n                var day = month.days.getId(item.key);\r\n                if (day) {\r\n                    day.hours = item.hours;\r\n                    day.tasks = item.tasks;\r\n                }\r\n            });\r\n            months.forward(); // sort by key  \r\n        },\r\n        updateRanges: function() {\r\n            var days = this.days,\r\n                ranges = this.ranges;\r\n            ranges.removeAll();\r\n            var rKey = 0,\r\n                lastDay;\r\n            days.each(function(day, i) {\r\n                if (lastDay) {\r\n                    if (day.key - lastDay.key > 1 || day.tasks.differs(lastDay.tasks)) {\r\n                        rKey++;\r\n                    }\r\n                }\r\n                lastDay = day;\r\n                var range = ranges.add({\r\n                    rKey: rKey,\r\n                });\r\n                range.days = range.days || [];\r\n                range.days.push(day.key);\r\n            });\r\n            ranges.forward(); // sort by key   \r\n        },\r\n        getRange: function(col, from, to) {\r\n            var ranges = this.ranges,\r\n                range = null,\r\n                key = col.$key;\r\n            ranges.each(function(item) {\r\n                var index = item.days.indexOf(key);\r\n                if (index !== -1) {\r\n                    item.c = index;\r\n                    item.firstKey = Math.max(from, item.days[0]);\r\n                    item.lastKey = Math.min(to, item.days[item.days.length - 1]);\r\n                    range = item;\r\n                }\r\n            });\r\n            return range;\r\n        },\r\n        updateRange: function(col, from, to) {\r\n            var ranges = this.ranges,\r\n                range = this.getRange(col, from, to);\r\n            if (range) {\r\n                range.previousKey = null;\r\n                range.nextKey = null;\r\n                var r = range.rKey;\r\n                if (r > 0) {\r\n                    var p = ranges[r - 1];\r\n                    range.previousKey = p.days[p.days.length - 1];\r\n                }\r\n                if (r < ranges.length - 1) {\r\n                    var n = ranges[r + 1];\r\n                    range.nextKey = n.days[0];\r\n                }\r\n            }\r\n            return range;\r\n        },\r\n        canMoveRange: function(range, dir) {\r\n            // rifare !!!\r\n            var can = true;\r\n            var row = this;\r\n            var first = range.items[0];\r\n            var last = range.items[range.items.length - 1];\r\n            var key = row.getOffsetKey(first.startDate, dir);\r\n            var i = 0,\r\n                t = range.items.length;\r\n            while (i < t) {\r\n                var k = key + i;\r\n                if (k < todayKey || (row.days.getId(k) && range.items.indexOf(row.days.getId(k)) === -1)) { // sistemare!!\r\n                    can = false;\r\n                    i = t;\r\n                }\r\n                i++;\r\n            }\r\n            return can;\r\n        },\r\n        moveRange: function(range, dir) {\r\n            if (range.items.length) {\r\n                var row = this;\r\n                if (row.canMoveRange(range, dir)) {\r\n                    angular.forEach(range.items, function(item) {\r\n                        row.addDays(item, dir);\r\n                    });\r\n                    row.update();\r\n                }\r\n            }\r\n        },\r\n        addDays: function(item, days) {\r\n            // console.log('GanttRow.addDay', item, days);\r\n            var date = new Date(item.startDate);\r\n            date.setDate(date.getDate() + days);\r\n            item.date = date;\r\n            item.key = Math.ceil(date.getTime() / oneday);\r\n            return item;\r\n        },\r\n        getOffsetKey: function(date, day) {\r\n            date = new Date(date);\r\n            date.setDate(date.getDate() + day);\r\n            var key = Math.ceil(date.getTime() / oneday);\r\n            return key;\r\n        },\r\n        getHours: function(key) {\r\n            var hours = 0;\r\n            var day = this.days.getId(key);\r\n            if (day) {\r\n                day.tasks.each(function(task) {\r\n                    hours += task.hours;\r\n                });\r\n            }\r\n            return hours;\r\n        },\r\n        toggleOpened: function() {\r\n            // console.log('toggleOpened');\r\n            this.opened = !this.opened;\r\n        },\r\n        compress: function(key) {\r\n            if (!this.items.length) {\r\n                return;\r\n            }\r\n            this.items.sort(function(a, b) {\r\n                return a.key - b.key;\r\n            });\r\n            var item = Utils.where(this.items, { key: key });\r\n            item = item || this.items[0];\r\n            var index = this.items.indexOf(item);\r\n            var i = index,\r\n                t = this.items.length;\r\n            key = Math.max(key, todayKey);\r\n            // da rifare\r\n            // collezionare ore totali\r\n            // redistribuire records in base a carico giornaliero\r\n            // spostare su gantt\r\n            while (i < t) {\r\n                item = this.items[i];\r\n                item.key = key + i - index;\r\n                item.date = new Date(item.key * oneday);\r\n                i++;\r\n            }\r\n            this.update();\r\n        },\r\n    };\r\n    GanttRow.serialNumber = function(number, max) {\r\n        return new Array((1 + (max.toString().length) - (number.toString().length))).join('0');\r\n    };\r\n    return GanttRow;\r\n}]);\n/* global angular, app */\r\n\r\napp.directive('header', [function() {\r\n    return {\r\n        restrict: 'E',\r\n        templateUrl: 'partials/header',\r\n        transclude: {\r\n            'header': '?headerItems',\r\n        },\r\n        link: function(scope, element, attributes, model) {}\r\n    };\r\n}]);\r\n\r\napp.directive('controlMessages', [function() {\r\n    return {\r\n        restrict: 'E',\r\n        templateUrl: 'partials/control-messages',\r\n        transclude: {\r\n            'message': '?messageItems',\r\n        },\r\n        link: function(scope, element, attributes, model) {}\r\n    };\r\n}]);\r\n\r\napp.directive('control', ['$http', '$templateCache', '$compile', '$parse', function($http, $templateCache, $compile, $parse) {\r\n    function formatLabel(string, prepend, expression) {\r\n        string = string || '';\r\n        prepend = prepend || '';\r\n        var splitted = string.split(',');\r\n        if (splitted.length > 1) {\r\n            var formatted = splitted.shift();\r\n            angular.forEach(splitted, function(value, index) {\r\n                if (expression) {\r\n                    formatted = formatted.split('{' + index + '}').join('\\' + ' + prepend + value + ' + \\'');\r\n                } else {\r\n                    formatted = formatted.split('{' + index + '}').join(prepend + value);\r\n                }\r\n            });\r\n            if (expression) {\r\n                return '\\'' + formatted + '\\'';\r\n            } else {\r\n                return formatted;\r\n            }\r\n        } else {\r\n            return prepend + string;\r\n        }\r\n    }\r\n    var uniqueId = 0;\r\n    return {\r\n        restrict: 'A',\r\n        templateUrl: function(element, attributes) {\r\n            var template = 'partials/control';\r\n            switch (attributes.control) {\r\n                case 'select':\r\n                    template = 'partials/control-select';\r\n                    break;\r\n            }\r\n            return template;\r\n        },\r\n        scope: {\r\n            ngModel: '=',\r\n            required: '=',\r\n            form: '@',\r\n            title: '@',\r\n            placeholder: '@',\r\n        },\r\n        require: 'ngModel',\r\n        link: function(scope, element, attributes, model) {\r\n\r\n        },\r\n        compile: function(element, attributes) {\r\n                return {\r\n                    pre: function(scope, element, attributes) {\r\n                        if (attributes.control === 'select') {\r\n                            var label = (attributes.label ? attributes.label : 'name');\r\n                            var key = (attributes.key ? attributes.key : 'id');\r\n                            var filter = (attributes.min ? ' | filter:gte(\\'' + key + '\\', ' + attributes.min + ')' : '');\r\n                            var optionLabel = formatLabel(label, 'item.', true);\r\n                            scope.options = attributes.number ?\r\n                                'item.' + key + ' as ' + optionLabel + ' disable when item.disabled for item in ' + attributes.source + filter :\r\n                                optionLabel + ' disable when item.disabled for item in ' + attributes.source + filter + ' track by item.' + key;\r\n                            console.log('control.compile.pre', scope.options);\r\n                        }\r\n                        var type = scope.type = attributes.control;\r\n                        var form = scope.form = scope.form || 'form';\r\n                        var title = scope.title = scope.title || 'untitled';\r\n                        var placeholder = scope.placeholder = scope.placeholder || title;\r\n                        var field = scope.field = title.replace(/[^0-9a-zA-Z]/g, \"\").split(' ').join('') + (++uniqueId);\r\n                        scope.minLength = attributes.min || 0;\r\n                        scope.maxLength = attributes.max || Number.POSITIVE_INFINITY;\r\n                        scope.focus = false;\r\n                        scope.getType = function() {\r\n                            var type = 'text';\r\n                            switch (attributes.control) {\r\n                                case 'password':\r\n                                    // var form = $parse(scope.form)(scope.$parent);\r\n                                    // var field = $parse(scope.form + '.' + scope.field)(scope.$parent);\r\n                                    type = scope.visible ? 'text' : 'password';\r\n                                    break;\r\n                                default:\r\n                                    type = attributes.control;\r\n                            }\r\n                            console.log('control.getType', type);\r\n                            return type;\r\n                        };\r\n                        scope.getClasses = function() {\r\n                            var form = $parse(scope.form)(scope.$parent);\r\n                            var field = $parse(scope.form + '.' + scope.field)(scope.$parent);\r\n                            return {\r\n                                'control-focus': scope.focus,\r\n                                'control-success': field.$valid,\r\n                                'control-error': field.$invalid && (form.$submitted || field.$touched),\r\n                                'control-empty': !field.$viewValue\r\n                            };\r\n                        };\r\n                        scope.getMessages = function() {\r\n                            var form = $parse(scope.form)(scope.$parent);\r\n                            var field = $parse(scope.form + '.' + scope.field)(scope.$parent);\r\n                            return (form.$submitted || field.$touched) && field.$error;\r\n                        };\r\n                    },\r\n                    // post: function (scope, element, attributes) { }\r\n                };\r\n            }\r\n            /*\r\n            compile: function(element, attributes) {\r\n                element.removeAttr('my-dir'); \r\n                element.attr('ng-hide', 'true');\r\n                return function(scope) {\r\n                    $compile(element)(scope);\r\n                };\r\n            },\r\n            */\r\n    };\r\n}]);\r\n\r\napp.directive('state', ['$timeout', function($timeout) {\r\n    return {\r\n        restrict: 'EA',\r\n        templateUrl: 'partials/state',\r\n        transclude: true,\r\n        replace: true,\r\n        scope: {\r\n            state: '=',\r\n        },\r\n        link: function(scope, element, attributes, model) {\r\n            scope.stateClass = function() {\r\n                if (scope.state.button === element) {\r\n                    var sclass = {\r\n                        busy: scope.state.isBusy,\r\n                        successing: scope.state.isSuccessing,\r\n                        success: scope.state.isSuccess,\r\n                        errorring: scope.state.isErroring,\r\n                        error: scope.state.isError,\r\n                    };\r\n                    // console.log('stateClass', sclass);\r\n                    return sclass;\r\n                } else {\r\n                    return null;\r\n                }\r\n            };\r\n            scope.stateDisabled = function() {\r\n                var disabled = (scope.state.button && scope.state.button !== element); // || scope.$parent.$eval(attributes.onValidate);\r\n                // console.log('stateDisabled', disabled);\r\n                return disabled;\r\n            };\r\n\r\n            function onClick() {\r\n                $timeout(function() {\r\n                    if (!scope.$parent.$eval(attributes.onValidate)) {\r\n                        // console.log('state.onClick', attributes.onValidate, attributes.onClick);\r\n                        scope.state.button = element;\r\n                        return scope.$parent.$eval(attributes.onClick);\r\n                    } else {\r\n                        scope.$parent.$eval('form.$setSubmitted()');\r\n                    }\r\n                });\r\n            };\r\n\r\n            function addListeners() {\r\n                element.on('touchstart click', onClick);\r\n            };\r\n\r\n            function removeListeners() {\r\n                element.off('touchstart click', onClick);\r\n            };\r\n            scope.$on('$destroy', function() {\r\n                removeListeners();\r\n            });\r\n            addListeners();\r\n        }\r\n    }\r\n}]);\r\n\r\napp.directive('controlRow', ['$http', '$templateCache', '$compile', function($http, $templateCache, $compile) {\r\n    var aid = 0;\r\n\r\n    function _format(string, prepend, expression) {\r\n        string = string || '';\r\n        prepend = prepend || '';\r\n        var splitted = string.split(',');\r\n        if (splitted.length > 1) {\r\n            var formatted = splitted.shift();\r\n            angular.forEach(splitted, function(value, index) {\r\n                if (expression) {\r\n                    formatted = formatted.split('{' + index + '}').join('\\' + ' + prepend + value + ' + \\'');\r\n                } else {\r\n                    formatted = formatted.split('{' + index + '}').join(prepend + value);\r\n                }\r\n            });\r\n            if (expression) {\r\n                return '\\'' + formatted + '\\'';\r\n            } else {\r\n                return formatted;\r\n            }\r\n        } else {\r\n            return prepend + string;\r\n        }\r\n    }\r\n\r\n    function templateFunction(element, attributes) {\r\n        var form = attributes.form || 'Form';\r\n        var title = attributes.title || 'Untitled';\r\n        var placeholder = attributes.placeholder || title;\r\n        var name = title.replace(/[^0-9a-zA-Z]/g, \"\").split(' ').join('') + (++aid);\r\n        var formKey = form + '.' + name;\r\n        var formFocus = ' ng-focus=\"' + formKey + '.hasFocus=true\" ng-blur=\"' + formKey + '.hasFocus=false\"';\r\n        var message = '',\r\n            decoration = '',\r\n            disabled = '';\r\n        var label = (attributes.label ? attributes.label : 'name');\r\n        var key = (attributes.key ? attributes.key : 'id');\r\n        var model = attributes.model;\r\n        var change = (attributes.onChange ? ' ng-change=\"' + attributes.onChange + '\"' : '');\r\n        var focus = (attributes.onFocus ? ' ng-focus=\"' + attributes.onFocus + '\"' : '');\r\n        var blur = (attributes.onBlur ? ' ng-blur=\"' + attributes.onBlur + '\"' : '');\r\n        var inputCols = attributes.cols ? 6 : 9;\r\n        var colInput = 'col-lg-' + inputCols;\r\n        var colLabel = 'col-lg-' + (12 - inputCols);\r\n        if (attributes.cols === '12') {\r\n            colLabel = colInput = 'col-lg-12';\r\n        }\r\n        var required = (attributes.required ? ' required=\"true\"' : '');\r\n        var readonly = (attributes.readonly ? ' readonly' : '');\r\n        var options = (attributes.options ? ' ng-model-options=\"' + attributes.options + '\" ' : '');\r\n        var validate = (attributes.validate ? ' validate-type=\"' + attributes.validate + '\" ' : '');\r\n        var format = (attributes.format ? ' format=\"' + attributes.format + '\" ' : '');\r\n        var precision = (attributes.precision ? ' precision=\"' + attributes.precision + '\" ' : '');\r\n        if (attributes.disabled) {\r\n            disabled = ' disabled';\r\n        }\r\n        if (attributes.ngDisabled) {\r\n            disabled = ' ng-disabled=\"' + attributes.ngDisabled + '\"';\r\n        }\r\n        if (attributes.required) {\r\n            decoration = attributes.readonly || attributes.disabled ? '' : '<sup></sup>';\r\n        }\r\n        message = '<span ng-messages=\"' + (attributes.readonly ? '' : '(' + form + '.$submitted || ' + formKey + '.$touched) && ') + formKey + '.$error\" role=\"alert\">';\r\n        message = message + '<span ng-message=\"required\" class=\"label-error animated flash\">obbligatorio </span>';\r\n        switch (attributes.controlRow) {\r\n            case 'password':\r\n                message = message + '<span ng-message=\"minlength\" class=\"label-error animated flash\">almeno 6 caratteri </span>';\r\n                break;\r\n            case 'email':\r\n                message = message + '<span ng-message=\"email\" class=\"label-error animated flash\">valore non corretto </span>';\r\n                break;\r\n            case 'number':\r\n            case 'range':\r\n                message = message + '<span ng-message=\"positive\" class=\"label-error animated flash\">solo valori positivi </span>';\r\n                message = message + '<span ng-message=\"number\" class=\"label-error animated flash\">solo valori numerici </span>';\r\n                break;\r\n        }\r\n        if (attributes.match !== undefined) {\r\n            message = message + '<span ng-message=\"match\" class=\"label-error animated flash\">non corrispondente </span>';\r\n        }\r\n        message = message + '</span>';\r\n        var validation = ' ng-class=\"{ \\'control-focus\\': ' + formKey + '.hasFocus, \\'control-success\\': ' + formKey + '.$valid, \\'control-error\\': ' + formKey + '.$invalid && (' + form + '.$submitted || ' + formKey + '.$touched), \\'control-empty\\': !' + formKey + '.$viewValue }\"';\r\n        var template = '<div class=\"row\" ' + validation + '><label for=\"' + name + '\" class=\"' + colLabel + ' col-form-label\">' + title + decoration + '</label><div class=\"' + colInput + ' col-' + attributes.controlRow + '\">';\r\n        switch (attributes.controlRow) {\r\n            case 'static':\r\n                var click = (attributes.click ? ' ng-click=\"' + attributes.click + '\"' : '');\r\n                var mouseover = (attributes.mouseover ? ' ng-mouseover=\"' + attributes.mouseover + '\"' : '');\r\n                var mouseout = (attributes.mouseout ? ' ng-mouseover=\"' + attributes.mouseout + '\"' : '');\r\n                var icon = (attributes.icon ? '<i class=\"pull-xs-right ' + attributes.icon + '\"></i>' : '');\r\n                template += '<p class=\"form-control\" ' + click + mouseover + mouseout + '><span ng-bind-html=\"' + model + ' || \\'&nbsp;\\'\"></span>' + icon + '</p>';\r\n                break;\r\n            case 'checkbox':\r\n                template = '<div class=\"' + colInput + '\"' + validation + '><div class=\"col-xs-12\"><label class=\"custom-control custom-checkbox\">';\r\n                template += '   <input type=\"checkbox\" class=\"custom-control-input\" ng-model=\"' + model + '\">';\r\n                template += '   <span class=\"custom-control-indicator\"></span>';\r\n                template += '   <span class=\"custom-control-description\">' + title + '</span>';\r\n                template += '</label>';\r\n                // template += '<input id=\"' + name + '\" name=\"' + name + '\" type=\"checkbox\" ng-model=\"' + model + '\" ' + change + focus + blur + required + ' class=\"toggle toggle-round-flat\">';\r\n                /*\r\n                template = '<div class=\"checkbox\">';\r\n                template += '<span class=\"checkbox-label\">' + title + required +'</span>';\r\n                template += '<span class=\"switch\"><input id=\"' + name + '\" name=\"' + name + '\" type=\"checkbox\" ng-model=\"' + model + '\" ' + change + focus + blur + required + ' class=\"toggle toggle-round-flat\"><label for=\"' + name + '\"></label></span>';\r\n                template += '</div>';\r\n                */\r\n                break;\r\n            case 'yesno':\r\n                template = '<div class=\"row\" ' + validation + '><label class=\"col-lg-6 custom-control custom-checkbox\">' + title + decoration + '</label>';\r\n                template += '<div class=\"' + colLabel + '\"><label class=\"custom-control custom-checkbox\">';\r\n                template += '   <input type=\"checkbox\" class=\"custom-control-input\" ng-model=\"' + model + '\" ng-change=\"' + model + 'No=!' + model + '\">';\r\n                template += '   <span class=\"custom-control-indicator\"></span>';\r\n                template += '   <span class=\"custom-control-description\">S</span>';\r\n                template += '</label></div>';\r\n                template += '<div class=\"' + colLabel + '\"><label class=\"custom-control custom-checkbox\">';\r\n                template += '   <input type=\"checkbox\" class=\"custom-control-input\" ng-model=\"' + model + 'No\" ng-change=\"' + model + '=!' + model + 'No\">';\r\n                template += '   <span class=\"custom-control-indicator\"></span>';\r\n                template += '   <span class=\"custom-control-description\">No</span>';\r\n                template += '</label>';\r\n                // template += '<input id=\"' + name + '\" name=\"' + name + '\" type=\"checkbox\" ng-model=\"' + model + '\" ' + change + focus + blur + required + ' class=\"toggle toggle-round-flat\">';\r\n                /*\r\n                template = '<div class=\"checkbox\">';\r\n                template += '<span class=\"checkbox-label\">' + title + required +'</span>';\r\n                template += '<span class=\"switch\"><input id=\"' + name + '\" name=\"' + name + '\" type=\"checkbox\" ng-model=\"' + model + '\" ' + change + focus + blur + required + ' class=\"toggle toggle-round-flat\"><label for=\"' + name + '\"></label></span>';\r\n                template += '</div>';\r\n                */\r\n                break;\r\n            case 'switch':\r\n                if (attributes.disabled) {\r\n                    disabled = ' disabled=\"true\"';\r\n                }\r\n                if (attributes.ngDisabled) {\r\n                    disabled = ' disabled=\"' + attributes.ngDisabled + '\"';\r\n                }\r\n                template = '<div class=\"row control-switch\" ' + validation + '><label for=\"' + name + '\" class=\"' + colLabel + ' col-form-label\">' + title + decoration + '</label>';\r\n                template += '<div class=\"' + colInput + '\">';\r\n                template += '<switch name=\"' + name + '\" ng-model=\"' + model + '\" ' + change + focus + blur + options + ' on=\"S\" off=\"No\" ' + required + disabled + readonly + formFocus + '></switch>';\r\n                break;\r\n            case 'range':\r\n                validate = ' validate-type=\"number\"';\r\n                var nameHi = name + 'Hi';\r\n                var formKeyHi = form + '.' + nameHi;\r\n                var modelHi = attributes.modelHi;\r\n                var validationHi = ' ng-class=\"{ \\'control-focus\\': ' + formKeyHi + '.hasFocus, \\'control-success\\': ' + formKeyHi + '.$valid, \\'control-error\\': ' + formKeyHi + '.$invalid && (' + form + '.$submitted || ' + formKeyHi + '.$touched), \\'control-empty\\': !' + formKeyHi + '.$viewValue }\"';\r\n                var requiredHi = required;\r\n                if (attributes.requiredHi == 'true') {\r\n                    requiredHi = ' required=\"true\"';\r\n                } else if (attributes.requiredHi == 'false') {\r\n                    requiredHi = '';\r\n                }\r\n                var messageHi = ' ',\r\n                    decorationHi = ' ';\r\n                if (attributes.required && attributes.requiredHi !== 'false') {\r\n                    decorationHi = attributes.readonly || attributes.disabled ? '' : '<sup></sup>';\r\n                }\r\n                messageHi = '<span ng-messages=\"' + (attributes.readonly ? '' : '(' + form + '.$submitted || ' + formKeyHi + '.$touched) && ') + formKeyHi + '.$error\" role=\"alert\">';\r\n                messageHi = messageHi + '<span ng-message=\"required\" class=\"label-error animated flash\">obbligatorio </span>';\r\n                switch (attributes.controlRow) {\r\n                    case 'password':\r\n                        messageHi = messageHi + '<span ng-message=\"minlength\" class=\"label-error animated flash\">almeno 3 caratteri </span>';\r\n                        break;\r\n                    case 'email':\r\n                        messageHi = messageHi + '<span ng-message=\"email\" class=\"label-error animated flash\">valore non corretto </span>';\r\n                        break;\r\n                    case 'number':\r\n                    case 'range':\r\n                        messageHi = messageHi + '<span ng-message=\"positive\" class=\"label-error animated flash\">solo valori positivi </span>';\r\n                        messageHi = messageHi + '<span ng-message=\"number\" class=\"label-error animated flash\">solo valori numerici </span>';\r\n                        break;\r\n                }\r\n                if (attributes.match !== undefined) {\r\n                    messageHi = messageHi + '<span ng-message=\"match\" class=\"label-error animated flash\">non corrispondente </span>';\r\n                }\r\n                messageHi = messageHi + '</span>';\r\n                template = '<div class=\"row\"><label for=\"' + name + '\" class=\"' + colLabel + ' col-form-label\">' + title + '</label><div class=\"' + colInput + ' col-' + attributes.controlRow + '\">';\r\n                template += '<div class=\"form-control-range form-control-range-min\" ' + validation + '>' + decoration + '<input class=\"form-control\" name=\"' + name + '\" ng-model=\"' + model + '\" ' + change + focus + blur + options + ' placeholder=\"' + placeholder + '\" type=\"text\"' + required + disabled + readonly + formFocus + validate + format + precision + '>' + message + '</div>';\r\n                template += '<div class=\"form-control-range form-control-range-max\" ' + validationHi + '>' + decorationHi + '<input class=\"form-control\" name=\"' + nameHi + '\" ng-model=\"' + modelHi + '\" ' + change + focus + blur + options + ' placeholder=\"' + placeholder + '\" type=\"text\"' + requiredHi + disabled + readonly + formFocus + validate + format + precision + '>' + messageHi + '</div>';\r\n                return template + '</div></div>';\r\n                break;\r\n            case 'range-slider':\r\n                var himodel = (attributes.himodel ? ' rz-slider-high=\"' + attributes.himodel + '\" ' : '');\r\n                options = (attributes.options ? ' rz-slider-options=\"' + attributes.options + '\" ' : '');\r\n                template += '<rzslider rz-slider-model=\"' + model + '\" ' + himodel + options + '\"></rzslider>';\r\n                break;\r\n            case 'select':\r\n                var filter = (attributes.min ? ' | filter:gte(\\'' + key + '\\', ' + attributes.min + ')' : '');\r\n                var optionLabel = _format(label, 'item.', true);\r\n                var options = attributes.number ?\r\n                    'item.' + key + ' as ' + optionLabel + ' disable when item.disabled for item in ' + attributes.source + filter :\r\n                    optionLabel + ' disable when item.disabled for item in ' + attributes.source + filter + ' track by item.' + key;\r\n                template += '<select name=\"' + name + '\" class=\"form-control\" ng-model=\"' + model + '\" ' + change + focus + blur + ' ng-options=\"' + options + '\" ' + (attributes.number ? 'convert-to-number' : '') + required + disabled + '><option value=\"\" disabled selected hidden>' + placeholder + '</option></select>';\r\n                break;\r\n            case 'autocomplete':\r\n                var canCreate = (attributes.canCreate ? attributes.canCreate : false);\r\n                var flatten = (attributes.flatten ? attributes.flatten : false);\r\n                var queryable = (attributes.queryable ? attributes.queryable : false);\r\n                var onSelected = (attributes.onSelected ? ' on-selected=\"' + attributes.onSelected + '\"' : '');\r\n                template += '<input name=\"' + name + '\" ng-model=\"' + model + '\" type=\"hidden\" ' + (attributes.required ? 'required' : '') + '>';\r\n                template += '<div control-autocomplete=\"' + attributes.source + '\" model=\"' + model + '\" label=\"' + label + '\"  key=\"' + key + '\" can-create=\"' + canCreate + '\" flatten=\"' + flatten + '\" queryable=\"' + queryable + '\" placeholder=\"' + placeholder + '\" on-focus=\"' + formKey + '.hasFocus=true\" on-blur=\"' + formKey + '.hasFocus=false\"' + onSelected + '></div>';\r\n                break;\r\n            case 'textarea':\r\n                var rows = (attributes.rows ? attributes.rows : '1');\r\n                template += '<textarea name=\"' + name + '\" class=\"form-control\" ng-model=\"' + model + '\" ' + change + focus + blur + options + ' placeholder=\"' + placeholder + '\" ' + required + disabled + ' rows=\"' + rows + '\"' + formFocus + '></textarea>';\r\n                break;\r\n            case 'htmltext':\r\n                var taDisabled = '';\r\n                if (attributes.disabled) {\r\n                    taDisabled = ' ta-disabled=\"true\"';\r\n                }\r\n                if (attributes.ngDisabled) {\r\n                    taDisabled = ' ta-disabled=\"' + attributes.ngDisabled + '\"';\r\n                }\r\n                template += '<div text-angular name=\"' + name + '\" ta-paste=\"doStripHtml($html)\" ng-model=\"' + model + '\" ' + change + focus + blur + options + ' placeholder=\"' + placeholder + '\" ' + required + taDisabled + readonly + formFocus + (attributes.required ? ' ta-min-text=\"1\"' : '') + '></div>';\r\n                break;\r\n            case 'password':\r\n                template += '<div class=\"input-group\"><input name=\"' + name + '\" class=\"form-control\" ng-model=\"' + model + '\" ' + change + focus + blur + options + ' placeholder=\"' + placeholder + '\" type=\"{{form.' + name + ' ? \\'password\\' : \\'text\\'}}\" ng-minlength=\"6\" ' + required + disabled + formFocus + '><span class=\"input-group-addon\" ng-if=\"' + model + '\"><span class=\"icon-eye\" ng-click=\"form.' + name + ' = !form.' + name + '\"></span></span></div>';\r\n                break;\r\n            case 'email':\r\n                template += '<input name=\"' + name + '\" class=\"form-control\" ng-model=\"' + model + '\" ' + change + focus + blur + options + ' placeholder=\"' + placeholder + '\" type=\"email\" ' + required + disabled + formFocus + '>';\r\n                break;\r\n            case 'number-picker':\r\n                validate = ' validate-type=\"anynumber\"';\r\n                /*\r\n                var doSub = model + ' = ' + model + ' -1';\r\n                if (attributes.min) {\r\n                    validate += ' min=\"' + attributes.min + '\"';\r\n                    doSub = model + ' = Math.max(' + attributes.min + ', ' + model + ' -1)';\r\n                }\r\n                var doAdd = model + ' = ' + model + ' +1';\r\n                if (attributes.max) {\r\n                    validate += ' max=\"' + attributes.max + '\"';\r\n                    doAdd = model + ' = Math.min(' + attributes.max + ', ' + model + ' +1)';\r\n                }\r\n                template += '<div class=\"input-group\">';\r\n                template += '   <span class=\"input-group-btn\"><button class=\"btn btn-outline-primary\" type=\"button\" ng-click=\"(' + doSub + ')\">-</button></span>';\r\n                template += '   <input name=\"' + name + '\" class=\"form-control\" ng-model=\"' + model + '\" ' + change + focus + blur + options + ' placeholder=\"' + placeholder + '\" type=\"text\"' + required + disabled + readonly + formFocus + validate + format + precision + '>';\r\n                template += '   <span class=\"input-group-btn\"><button class=\"btn btn-outline-primary\" type=\"button\" ng-click=\"(' + doAdd + ')\">+</button></span>';\r\n                template += '</div>';\r\n                */\r\n                template += '<div number-picker=\"' + model + '\" min=\"' + attributes.min + '\" max=\"' + attributes.max + '\">';\r\n                template += '   <input name=\"' + name + '\" class=\"form-control\" ng-model=\"' + model + '\" ' + change + focus + blur + options + ' placeholder=\"' + placeholder + '\" type=\"text\"' + required + disabled + readonly + formFocus + validate + format + precision + '>';\r\n                template += '</div>';\r\n                break;\r\n            case 'number':\r\n                validate = ' validate-type=\"number\"';\r\n                template += '<input name=\"' + name + '\" class=\"form-control\" ng-model=\"' + model + '\" ' + change + focus + blur + options + ' placeholder=\"' + placeholder + '\" type=\"text\"' + required + disabled + readonly + formFocus + validate + format + precision + '>';\r\n                break;\r\n            case 'anynumber':\r\n                validate = ' validate-type=\"anynumber\"';\r\n                template += '<input name=\"' + name + '\" class=\"form-control\" ng-model=\"' + model + '\" ' + change + focus + blur + options + ' placeholder=\"' + placeholder + '\" type=\"text\"' + required + disabled + readonly + formFocus + validate + format + precision + '>';\r\n                break;\r\n            case 'date':\r\n                validate = ' validate-type=\"date\"';\r\n                format = ' format=\"dd-MM-yyyy\"';\r\n                if (attributes.disabled || attributes.readonly) {\r\n                    template += '<div class=\"input-group\"><input type=\"text\" class=\"form-control\" name=\"' + name + '\" ng-model=\"' + model + '\" placeholder=\"' + placeholder + '\" ' + required + disabled + readonly + formFocus + validate + format + '><span class=\"input-group-addon\"><i class=\"icon-calendar\"></i></span></div>';\r\n                } else {\r\n                    template += '<input type=\"date\" name=\"' + name + '\" class=\"form-control form-control-hidden\" is-open=\"flags.' + name + '\" ng-model=\"' + model + '\" placeholder=\"dd-MM-yyyy\" ' + required + disabled + readonly + formFocus + ' uib-datepicker-popup datepicker-options=\"sources.datepickerOptions\" datepicker-template-url=\"uib/template/datepicker/datepicker.html\" show-button-bar=\"false\" current-text=\"Oggi\" clear-text=\"Rimuovi\" close-text=\"Chiudi\">';\r\n                    template += '<div ng-click=\"(flags.' + name + ' = true)\" class=\"input-group disabled\"><input type=\"text\" class=\"form-control\" name=\"' + name + '\" ng-model=\"' + model + '\" placeholder=\"' + placeholder + '\" ' + required + disabled + readonly + formFocus + validate + format + '><span class=\"input-group-addon\"><i class=\"icon-calendar\"></i></span></div>';\r\n                }\r\n                break;\r\n                /*\r\n        case 'date':\r\n            placeholder = placeholder || 'dd-MM-yyyy';\r\n            template += '<input name=\"' + name + '\" class=\"form-control\" ng-model=\"' + model + '\" ' + change + focus + blur + options + ' placeholder=\"' + placeholder + '\" type=\"date\"' + required + disabled + readonly + formFocus + '>';\r\n            break;\r\n            */\r\n            case 'datetime-local':\r\n                placeholder = placeholder || 'dd-MM-yyyyTHH:mm:ss';\r\n                // placeholder == title ? placeholder = 'dd/MM/yyyyTHH:mm:ss' : null;\r\n                template += '<input name=\"' + name + '\" class=\"form-control\" ng-model=\"' + model + '\" ' + change + focus + blur + options + ' placeholder=\"' + placeholder + '\" type=\"datetime-local\"' + required + disabled + readonly + formFocus + '>';\r\n                break;\r\n            case 'text':\r\n            default:\r\n                template += '<input name=\"' + name + '\" class=\"form-control\" ng-model=\"' + model + '\" ' + change + focus + blur + options + ' placeholder=\"' + placeholder + '\" type=\"text\"' + required + disabled + readonly + formFocus + validate + format + precision + '>';\r\n                break;\r\n        }\r\n        return template + message + '</div></div>';\r\n    }\r\n    return {\r\n        restrict: 'A',\r\n        replace: true,\r\n        compile: function(templateElement, templateAttributes) {\r\n            return function(scope, element, attributes) {\r\n                element.html(templateFunction(templateElement, templateAttributes));\r\n                $compile(element.contents())(scope);\r\n            }\r\n        }\r\n    }\r\n}]);\r\n\r\napp.directive('numberPicker', ['$parse', '$timeout', function($parse, $timeout) {\r\n    return {\r\n        restrict: 'A',\r\n        template: '<div class=\"input-group\">' +\r\n            '   <span class=\"input-group-btn\"><button class=\"btn btn-outline-primary\" type=\"button\">-</button></span>' +\r\n            '   <div ng-transclude></div>' +\r\n            '   <span class=\"input-group-btn\"><button class=\"btn btn-outline-primary\" type=\"button\">+</button></span>' +\r\n            '</div>',\r\n        replace: true,\r\n        transclude: true,\r\n        link: function(scope, element, attributes, model) {\r\n            var node = element[0];\r\n            var nodeRemove = node.querySelectorAll('.input-group-btn > .btn')[0];\r\n            var nodeAdd = node.querySelectorAll('.input-group-btn > .btn')[1];\r\n\r\n            function onRemove(e) {\r\n                var min = $parse(attributes.min)(scope);\r\n                var getter = $parse(attributes.numberPicker);\r\n                var setter = getter.assign;\r\n                $timeout(function() {\r\n                    setter(scope, Math.max(min, getter(scope) - 1));\r\n                });\r\n                // console.log('numberPicker.onRemove', min);\r\n            }\r\n\r\n            function onAdd(e) {\r\n                var max = $parse(attributes.max)(scope);\r\n                var getter = $parse(attributes.numberPicker);\r\n                var setter = getter.assign;\r\n                $timeout(function() {\r\n                    setter(scope, Math.min(max, getter(scope) + 1));\r\n                });\r\n                // console.log('numberPicker.onAdd', max);\r\n            }\r\n\r\n            function addListeners() {\r\n                angular.element(nodeRemove).on('touchstart mousedown', onRemove);\r\n                angular.element(nodeAdd).on('touchstart mousedown', onAdd);\r\n            }\r\n\r\n            function removeListeners() {\r\n                angular.element(nodeRemove).off('touchstart mousedown', onRemove);\r\n                angular.element(nodeAdd).off('touchstart mousedown', onAdd);\r\n            }\r\n            scope.$on('$destroy', function() {\r\n                removeListeners();\r\n            });\r\n            addListeners();\r\n        }\r\n    }\r\n}]);\r\n\r\napp.directive('validateType', ['$filter', function($filter) {\r\n    return {\r\n        require: 'ngModel',\r\n        link: function(scope, element, attributes, model) {\r\n            var validateType = attributes.validateType;\r\n            var format = attributes.format || '';\r\n            var precision = attributes.precision || 2;\r\n            var focus = false;\r\n            switch (validateType) {\r\n                case 'date':\r\n                case 'datetime':\r\n                case 'datetime-local':\r\n                    model.$formatters.push(function(value) {\r\n                        if (value) {\r\n                            return $filter('date')(value, format);\r\n                        } else {\r\n                            return null;\r\n                        }\r\n                    });\r\n                    break;\r\n                case 'number':\r\n                    model.$parsers.unshift(function(value) {\r\n                        var valid = false,\r\n                            type = validateType;\r\n                        if (value !== undefined && value !== \"\") {\r\n                            valid = String(value).indexOf(Number(value).toString()) !== -1; // isFinite(value); // \r\n                            value = Number(value);\r\n                            model.$setValidity('number', valid);\r\n                            if (valid) {\r\n                                model.$setValidity('positive', value >= 0.01);\r\n                                attributes.min !== undefined ? model.$setValidity('range', value >= Number(attributes.min)) : null;\r\n                                attributes.max !== undefined ? model.$setValidity('range', value <= Number(attributes.max)) : null;\r\n                            }\r\n                            /*                             \r\n                            if (valid) {\r\n                                if (value < 0.01) {\r\n                                    valid = false;\r\n                                    type = 'positive';\r\n                                }\r\n                                if (valid && attributes.min !== undefined) {\r\n                                    valid = valid && value >= Number(attributes.min);\r\n                                    if (!valid) {\r\n                                        type = 'range';\r\n                                    }\r\n                                }\r\n                                if (valid && attributes.max !== undefined) {\r\n                                    valid = valid && value <= Number(attributes.max);\r\n                                    if (!valid) {\r\n                                        type = 'range';\r\n                                    }\r\n                                }\r\n                            }\r\n                            */\r\n                            // console.log('validateType.number', type, valid, value);\r\n                        } else {\r\n                            valid = true;\r\n                            value = Number(value);\r\n                            model.$setValidity('number', true);\r\n                            model.$setValidity('positive', true);\r\n                            attributes.min !== undefined ? model.$setValidity('range', true) : null;\r\n                            attributes.max !== undefined ? model.$setValidity('range', true) : null;\r\n                        }\r\n                        return value;\r\n                    });\r\n                    model.$formatters.push(function(value) {\r\n                        if (value) {\r\n                            return $filter('number')(value, precision) + ' ' + format;\r\n                        } else {\r\n                            return null;\r\n                        }\r\n                    });\r\n                    /*\r\n                    model.$render = function () {\r\n                        console.log('model.render', model.$modelValue);\r\n                        element[0].value = model.$modelValue ? $filter('number')(model.$modelValue, precision) + ' ' + format : ' ';\r\n                    };\r\n                    */\r\n                    break;\r\n                case 'anynumber':\r\n                    model.$parsers.unshift(function(value) {\r\n                        var valid = false,\r\n                            type = validateType;\r\n                        if (value !== undefined && value !== \"\") {\r\n                            valid = String(value).indexOf(Number(value).toString()) !== -1; // isFinite(value); // \r\n                            value = Number(value);\r\n                            model.$setValidity('number', valid);\r\n                            if (valid) {\r\n                                attributes.min !== undefined ? model.$setValidity('range', value >= Number(attributes.min)) : null;\r\n                                attributes.max !== undefined ? model.$setValidity('range', value <= Number(attributes.max)) : null;\r\n                            }\r\n                        } else {\r\n                            valid = true;\r\n                            value = Number(value);\r\n                            model.$setValidity('number', true);\r\n                            attributes.min !== undefined ? model.$setValidity('range', true) : null;\r\n                            attributes.max !== undefined ? model.$setValidity('range', true) : null;\r\n                        }\r\n                        return value;\r\n                    });\r\n                    model.$formatters.push(function(value) {\r\n                        if (value || value === 0) {\r\n                            return $filter('number')(value, precision) + ' ' + format;\r\n                        } else {\r\n                            return null;\r\n                        }\r\n                    });\r\n                    break;\r\n            }\r\n\r\n            function onFocus() {\r\n                focus = true;\r\n                if (format) {\r\n                    element[0].value = model.$modelValue || null;\r\n                    if (!model.$modelValue) {\r\n                        model.$setViewValue(null);\r\n                    }\r\n                }\r\n            }\r\n\r\n            function doBlur() {\r\n                if (format && !model.$invalid) {\r\n                    switch (validateType) {\r\n                        case 'date':\r\n                        case 'datetime':\r\n                        case 'datetime-local':\r\n                            element[0].value = model.$modelValue ? $filter('date')(model.$modelValue, format) : ' ';\r\n                            break;\r\n                        default:\r\n                            element[0].value = model.$modelValue ? $filter('number')(model.$modelValue, precision) + ' ' + format : ' ';\r\n                            break;\r\n                    }\r\n                }\r\n            }\r\n\r\n            function onBlur() {\r\n                focus = false;\r\n                doBlur();\r\n            }\r\n\r\n            function addListeners() {\r\n                element.on('focus', onFocus);\r\n                element.on('blur', onBlur);\r\n            }\r\n\r\n            function removeListeners() {\r\n                element.off('focus', onFocus);\r\n                element.off('blur', onBlur);\r\n            }\r\n            scope.$on('$destroy', function() {\r\n                removeListeners();\r\n            });\r\n            addListeners();\r\n        }\r\n    };\r\n}]);\n/* global angular, app, Autolinker */\r\n\n/* global angular, app */\r\n\r\napp.factory('State', ['$timeout', function($timeout) {\r\n    function State() {\r\n        this.isReady = false;\r\n        this.idle();\r\n    }\r\n    State.prototype = {\r\n        idle: function() {\r\n            this.isBusy = false;\r\n            this.isError = false;\r\n            this.isErroring = false;\r\n            this.isSuccess = false;\r\n            this.isSuccessing = false;\r\n            this.button = null;\r\n            this.errors = [];\r\n        },\r\n        enabled: function() {\r\n            return !this.isBusy && !this.isErroring && !this.isSuccessing;\r\n        },\r\n        busy: function() {\r\n            if (!this.isBusy) {\r\n                this.isBusy = true;\r\n                this.isError = false;\r\n                this.isErroring = false;\r\n                this.isSuccess = false;\r\n                this.isSuccessing = false;\r\n                this.errors = [];\r\n                // console.log('State.busy', this);\r\n                return true;\r\n            } else {\r\n                return false;\r\n            }\r\n        },\r\n        success: function() {\r\n            this.isBusy = false;\r\n            this.isError = false;\r\n            this.isErroring = false;\r\n            this.isSuccess = true;\r\n            this.isSuccessing = true;\r\n            this.errors = [];\r\n            $timeout(function() {\r\n                this.isSuccessing = false;\r\n                this.button = null;\r\n            }.bind(this), 1000);\r\n        },\r\n        error: function(error) {\r\n            this.isBusy = false;\r\n            this.isError = true;\r\n            this.isErroring = true;\r\n            this.isSuccess = false;\r\n            this.isSuccessing = false;\r\n            this.errors.push(error);\r\n            $timeout(function() {\r\n                this.isErroring = false;\r\n                this.button = null;\r\n            }.bind(this), 1000);\r\n        },\r\n        ready: function() {\r\n            this.isReady = true;\r\n            this.success();\r\n        },\r\n        errorMessage: function() {\r\n            return this.isError ? this.errors[this.errors.length - 1] : null;\r\n        },\r\n        submitClass: function() {\r\n            return {\r\n                busy: this.isBusy,\r\n                ready: this.isReady,\r\n                successing: this.isSuccessing,\r\n                success: this.isSuccess,\r\n                errorring: this.isErroring,\r\n                error: this.isError,\r\n            };\r\n        },\r\n        submitMessage: function(idleMessage, busyMessage, successMessage, errorMessage) {\r\n            idleMessage = idleMessage || 'Submit';\r\n            if (this.isBusy) {\r\n                return busyMessage || idleMessage;\r\n            } else if (this.isSuccess) {\r\n                return successMessage || idleMessage;\r\n            } else if (this.isError) {\r\n                return errorMessage || idleMessage;\r\n            } else {\r\n                return idleMessage;\r\n            }\r\n        },\r\n    };\r\n    return State;\r\n}]);\n/* global angular, app */\n\napp.service('FirebaseApi', ['$q', '$location', '$firebaseAuth', '$firebaseObject', '$firebaseArray', 'LocalStorage', function($q, $location, $firebaseAuth, $firebaseObject, $firebaseArray, storage) {\n\n    var service = this;\n\n    var firebase = window.firebase || null;\n    if (firebase) {\n        var config = {\n            apiKey: \"AIzaSyCskd8Cgzd_j7JzgEC3mEb4ir1qZFh6auQ\",\n            authDomain: \"starfish-c2b0f.firebaseapp.com\",\n            databaseURL: \"https://starfish-c2b0f.firebaseio.com\",\n            projectId: \"starfish-c2b0f\",\n            storageBucket: \"starfish-c2b0f.appspot.com\",\n            messagingSenderId: \"796739915579\"\n        };\n        firebase.initializeApp(config);\n    } else {\n        throw ('missing firebase.js');\n    }\n\n    function removeRange(firebaseArray, from, to) {\n        var keys = {};\n        if (to === undefined) {\n            to = firebaseArray.length;\n        }\n        for (var i = from; i < to; ++i) {\n            keys[firebaseArray.$keyAt(i)] = null;\n        }\n        return firebaseArray.$ref().update(keys);\n    }\n\n    function first(snap) {\n        var item = null;\n        if (snap.numChildren() === 1) {\n            var items = snap.val();\n            var keys = Object.keys(items);\n            item = items[keys[0]];\n        }\n        return item;\n    }\n\n    this.current = function() {\n        var deferred = $q.defer();\n        if (service.user) {\n            deferred.resolve(service.user);\n        } else {\n            var token = storage.get('token');\n            if (token) {\n                service.auth.connect().then(function(p) {\n                    var root = firebase.database().ref();\n                    var usersRef = root.child('users');\n                    usersRef.orderByChild('token').equalTo(token).on('value', function(snap) {\n                        var user = service.user = first(snap);\n                        if (user) {\n                            storage.set('token', user.token);\n                            deferred.resolve(user);\n                        } else {\n                            deferred.reject();\n                        }\n                    });\n                }, function() {\n                    deferred.reject();\n                });\n            } else {\n                deferred.reject();\n            }\n        }\n        return deferred.promise;\n    };\n\n    this.isLoggedOrGoTo = function(redirect) {\n        var deferred = $q.defer();\n        service.current().then(function(user) {\n            deferred.resolve(service.user);\n        }, function() {\n            deferred.reject();\n            $location.$$lastRequestedPath = $location.path();\n            $location.path(redirect);\n        });\n        return deferred.promise;\n    };\n\n    this.auth = {\n        connect: function() {\n            var deferred = $q.defer();\n            if (service.presence) {\n                deferred.resolve(service.presence);\n            } else {\n                var firebaseAuth = service.firebaseAuth = $firebaseAuth();\n                firebaseAuth.$signInAnonymously({ remember: 'sessionOnly' }).then(function(logged) {\n                    var presence = service.presence = {\n                        uid: logged.uid,\n                    };\n                    deferred.resolve(presence);\n                }).catch(function(error) {\n                    console.log('Error', error);\n                    deferred.reject(error);\n                });\n            }\n            return deferred.promise;\n        },\n        current: function() {\n            var deferred = $q.defer();\n            if (service.user) {\n                deferred.resolve(service.user);\n            } else {\n                deferred.reject();\n            }\n            return deferred.promise;\n        },\n        signin: function(model) {\n            console.log('FirebaseApi.signin', model);\n            var deferred = $q.defer();\n            if (service.user) {\n                console.log('signed', service.user);\n                deferred.resolve(service.user);\n            } else {\n                service.auth.connect().then(function(presence) {\n                    var root = firebase.database().ref();\n                    var usersRef = root.child('users');\n                    usersRef.orderByChild('email').equalTo(model.email).on('value', function(snap) {\n                        var user = service.user = first(snap);\n                        if (user && user.password === model.password) {\n                            storage.set('token', user.token);\n                            deferred.resolve(user);\n                        } else {\n                            deferred.reject({\n                                message: 'not found',\n                            });\n                        }\n                    });\n                }, function() {\n                    deferred.reject();\n                });\n            }\n            return deferred.promise;\n        },\n        signup: function(model) {\n            console.log('FirebaseApi.signup', model);\n            var deferred = $q.defer();\n            service.auth.connect().then(function(p) {\n                console.log('connected', p);\n                var root = firebase.database().ref();\n                var usersRef = root.child('users');\n                var userRef = usersRef.push();\n                model.token = service.presence.uid;\n                storage.set('token', model.token);\n                userRef.set(model);\n                service.user = model;\n                service.updateUser = function() {\n                    userRef.set(model);\n                };\n                deferred.resolve(model);\n            }, function() {\n                deferred.reject();\n            });\n            return deferred.promise;\n        },\n        signout: function() {\n            console.log('FirebaseApi.signout');\n            var deferred = $q.defer();\n            storage.delete('token');\n            service.user = null;\n            deferred.resolve();\n            return deferred.promise;\n        },\n    };\n\n    this.presences = {\n        getPresences: function() {\n            var deferred = $q.defer();\n            var user = service.user;\n            var root = service.root = firebase.database().ref();\n            var presencesRef = root.child('presences');\n            var userRef = presencesRef.push();\n            var connectedRef = root.child('.info/connected');\n            connectedRef.on('value', function(snap) {\n                if (snap.val()) {\n                    userRef.onDisconnect().remove();\n                    userRef.set(user);\n                    service.updateUser = function() {\n                        userRef.set(user);\n                    };\n                    deferred.resolve();\n                }\n            });\n            presencesRef.on('value', function(snap) {\n                // console.log('# of online users = ', snap.numChildren());\n                var presences = snap.val(),\n                    items = [];\n                for (var key in presences) {\n                    var user = presences[key];\n                    if (user.id !== service.user.id) {\n                        items.push(user);\n                    }\n                }\n                if (items.length) {\n                    service.options.onPresences(items);\n                }\n            });\n            service.presences = $firebaseArray(presencesRef);\n            return deferred.promise;\n        },\n    };\n\n    this.activities = {\n        clearActivities: function() {\n            var min = Number.POSITIVE_INFINITY;\n            angular.forEach(service.presences, function(presence) {\n                min = Math.min(presence.timestamp, min);\n            });\n            var activities = service.activities;\n            var from = 0,\n                to = 0;\n            angular.forEach(activities, function(item, index) {\n                if (item.timestamp < min) {\n                    to = index + 1;\n                }\n            });\n            removeRange(activities, from, to);\n        },\n        addActivities: function(items) {\n            if (items && items.length) {\n                var user = service.user;\n                var root = service.root; // firebase.database().ref();\n                var lastActivity = null;\n                var activitiesRef = root.child('activities');\n                angular.forEach(items, function(item) {\n                    item.userId = user.id;\n                    item.timestamp = Date.now();\n                    lastActivity = item;\n                    var activityRef = activitiesRef.push();\n                    activityRef.set(item);\n                });\n                if (lastActivity) {\n                    user.lastActivity = lastActivity;\n                    service.updateUser();\n                }\n            }\n        },\n        getUniqueActivities: function(items) {\n            items.sort(function(a, b) {\n                return b.timestamp - a.timestamp; // desc\n            });\n            var pool = {};\n            items = items.filter(function(item) {\n                if (!pool[item.id]) {\n                    return (pool[item.id] = true);\n                } else {\n                    return false;\n                }\n            });\n            items.sort(function(a, b) {\n                return a.timestamp - b.timestamp; // asc\n            });\n            return items;\n        },\n        getActivities: function() {\n            var deferred = $q.defer();\n            var root = service.root; // firebase.database().ref();\n            var activitiesRef = root.child('activities');\n            var user = service.user;\n            var lastDate = user.timestamp;\n            activitiesRef.on('value', function(snap) {\n                var activities = snap.val(),\n                    items = [];\n                var max = Number.NEGATIVE_INFINITY;\n                for (var key in activities) {\n                    var activity = activities[key];\n                    max = Math.max(max, activity.timestamp);\n                    if (activity.userId !== service.user.id && activity.timestamp > lastDate) {\n                        items.push(activity);\n                    }\n                }\n                lastDate = Math.max(lastDate, max);\n                items = service.getUniqueActivities(items);\n                if (items.length) {\n                    service.options.onActivities(items);\n                }\n            });\n            var activities = service.activities = $firebaseArray(activitiesRef);\n            activities.$loaded().then(function() {\n                service.clearActivities();\n                deferred.resolve();\n            }).catch(function(error) {\n                deferred.reject(error);\n            });\n            /*\n            var unwatch = activities.$watch(function(event) {\n              console.log(event);\n            });\n            // at some time in the future, we can unregister using\n            // unwatch();\n            */\n            return deferred.promise;\n        },\n    };\n\n}]);\n\napp.service('WebApi', ['$http', '$q', '$timeout', '$location', function($http, $q, $timeout, $location) {\n\n    var service = this;\n\n    var _get = this.get = function(url, params) {\n        var deferred = $q.defer();\n        $http.get(url, { params: params }).then(function(response) {\n            deferred.resolve(response.data);\n        }, function(response) {\n            onError(deferred, 'get', url, { params: params }, response);\n        });\n        return deferred.promise;\n    };\n    var _post = this.post = function(url, model) {\n        var deferred = $q.defer();\n        if (service.DEBUG) {\n            console.log('Api.DEBUG', url, model);\n            deferred.resolve(model);\n        } else {\n            $http.post(url, model).then(function(response) {\n                deferred.resolve(response.data);\n            }, function(response) {\n                onError(deferred, 'post', url, model, response);\n            });\n        }\n        return deferred.promise;\n    };\n    var _put = this.put = function(url, model) {\n        var deferred = $q.defer();\n        $http.put(url, model).then(function(response) {\n            deferred.resolve(response.data);\n        }, function(response) {\n            onError(deferred, 'put', url, model, response);\n        });\n        return deferred.promise;\n    };\n    var _patch = this.patch = function(url, model) {\n        var deferred = $q.defer();\n        $http.patch(url, model).then(function(response) {\n            deferred.resolve(response.data);\n        }, function(response) {\n            onError(deferred, 'patch', url, model, response);\n        });\n        return deferred.promise;\n    };\n    var _delete = this.delete = function(url) {\n        var deferred = $q.defer();\n        $http.delete(url).then(function(response) {\n            deferred.resolve(response.data);\n        }, function(response) {\n            onError(deferred, 'delete', url, null, response);\n        });\n        return deferred.promise;\n    };\n    var _blob = this.blob = function(url, model) {\n        var deferred = $q.defer();\n        if (service.DEBUG) {\n            console.log('Api.DEBUG', url, model);\n            deferred.resolve(model);\n        } else {\n            $http({\n                url: url,\n                method: \"POST\",\n                data: model,\n                headers: {\n                    'Content-type': 'application/json'\n                },\n                responseType: 'arraybuffer',\n            }).then(function(response) {\n                deferred.resolve(response);\n            }, function(response) {\n                onError(deferred, 'post', url, model, response);\n            });\n        }\n        return deferred.promise;\n    };\n\n    this.auth = {\n        signin: _service.signin,\n        // return _post('/api/auth/login', model);\n        signout: function(userId) {\n            // return _get('/api/auth/logout/' + userId);\n        },\n        current: function() {\n            var deferred = $q.defer();\n            if (_service.user) {\n                deferred.resolve(_service.user);\n            } else {\n                deferred.reject();\n            }\n            return deferred.promise;\n            // return _get('/api/auth/current/');\n        },\n    };\n\n}]);\n\napp.factory('Cookie', ['$q', '$window', function($q, $window) {\n    function Cookie() {}\n    Cookie.TIMEOUT = 5 * 60 * 1000; // five minutes\n    Cookie._set = function(name, value, days) {\n        var expires;\n        if (days) {\n            var date = new Date();\n            date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));\n            expires = '; expires=' + date.toGMTString();\n        } else {\n            expires = '';\n        }\n        $window.document.cookie = name + '=' + value + expires + '; path=/';\n    };\n    Cookie.set = function(name, value, days) {\n        try {\n            var cache = [];\n            var json = JSON.stringify(value, function(key, value) {\n                if (key === 'pool') {\n                    return;\n                }\n                if (typeof value === 'object' && value !== null) {\n                    if (cache.indexOf(value) !== -1) {\n                        // Circular reference found, discard key\n                        return;\n                    }\n                    cache.push(value);\n                }\n                return value;\n            });\n            cache = null;\n            Cookie._set(name, json, days);\n        } catch (e) {\n            console.log('Cookie.set.error serializing', name, value, e);\n        }\n    };\n    Cookie.get = function(name) {\n        var cookieName = name + \"=\";\n        var ca = $window.document.cookie.split(';');\n        for (var i = 0; i < ca.length; i++) {\n            var c = ca[i];\n            while (c.charAt(0) == ' ') {\n                c = c.substring(1, c.length);\n            }\n            if (c.indexOf(cookieName) === 0) {\n                var value = c.substring(cookieName.length, c.length);\n                var model = null;\n                try {\n                    model = JSON.parse(value);\n                } catch (e) {\n                    console.log('Cookie.get.error parsing', key, e);\n                }\n                return model;\n            }\n        }\n        return null;\n    };\n    Cookie.delete = function(name) {\n        Cookie._set(name, \"\", -1);\n    };\n    Cookie.on = function(name) {\n        var deferred = $q.defer();\n        var i, interval = 1000,\n            elapsed = 0,\n            timeout = Cookie.TIMEOUT;\n\n        function checkCookie() {\n            if (elapsed > timeout) {\n                deferred.reject('timeout');\n            } else {\n                var c = Cookie.get(name);\n                if (c) {\n                    deferred.resolve(c);\n                } else {\n                    elapsed += interval;\n                    i = setTimeout(checkCookie, interval);\n                }\n            }\n        }\n        checkCookie();\n        return deferred.promise;\n    };\n    return Cookie;\n}]);\n\napp.factory('LocalStorage', ['$q', '$window', 'Cookie', function($q, $window, Cookie) {\n    function LocalStorage() {}\n\n    function isLocalStorageSupported() {\n        var supported = false;\n        try {\n            supported = 'localStorage' in $window && $window.localStorage !== null;\n            if (supported) {\n                $window.localStorage.setItem('test', '1');\n                $window.localStorage.removeItem('test');\n            } else {\n                supported = false;\n            }\n        } catch (e) {\n            supported = false;\n        }\n        return supported;\n    }\n    LocalStorage.isSupported = isLocalStorageSupported();\n    if (LocalStorage.isSupported) {\n        LocalStorage.set = function(name, value) {\n            try {\n                var cache = [];\n                var json = JSON.stringify(value, function(key, value) {\n                    if (key === 'pool') {\n                        return;\n                    }\n                    if (typeof value === 'object' && value !== null) {\n                        if (cache.indexOf(value) !== -1) {\n                            // Circular reference found, discard key\n                            return;\n                        }\n                        cache.push(value);\n                    }\n                    return value;\n                });\n                cache = null;\n                $window.localStorage.setItem(name, json);\n            } catch (e) {\n                console.log('LocalStorage.set.error serializing', name, value, e);\n            }\n        };\n        LocalStorage.get = function(name) {\n            var value = null;\n            if ($window.localStorage[name] !== undefined) {\n                try {\n                    value = JSON.parse($window.localStorage[name]);\n                } catch (e) {\n                    console.log('LocalStorage.get.error parsing', name, e);\n                }\n            }\n            return value;\n        };\n        LocalStorage.delete = function(name) {\n            $window.localStorage.removeItem(name);\n        };\n        LocalStorage.on = function(name) {\n            var deferred = $q.defer();\n            var i, timeout = Cookie.TIMEOUT;\n\n            function storageEvent(e) {\n                // console.log('LocalStorage.on', name, e);\n                clearTimeout(i);\n                if (e.originalEvent.key == name) {\n                    try {\n                        var value = JSON.parse(e.originalEvent.newValue); // , e.originalEvent.oldValue\n                        deferred.resolve(value);\n                    } catch (error) {\n                        console.log('LocalStorage.on.error parsing', name, error);\n                        deferred.reject('error parsing ' + name);\n                    }\n                }\n            }\n            angular.element($window).on('storage', storageEvent);\n            i = setTimeout(function() {\n                deferred.reject('timeout');\n            }, timeout);\n            return deferred.promise;\n        };\n    } else {\n        console.log('LocalStorage.unsupported switching to cookies');\n        LocalStorage.set = Cookie.set;\n        LocalStorage.get = Cookie.get;\n        LocalStorage.delete = Cookie.delete;\n        LocalStorage.on = Cookie.on;\n    }\n    return LocalStorage;\n}]);\n\napp.factory('SessionStorage', ['$q', '$window', 'Cookie', function($q, $window, Cookie) {\n    function SessionStorage() {}\n\n    function isSessionStorageSupported() {\n        var supported = false;\n        try {\n            supported = 'sessionStorage' in $window && $window.sessionStorage !== undefined;\n            if (supported) {\n                $window.sessionStorage.setItem('test', '1');\n                $window.sessionStorage.removeItem('test');\n            } else {\n                supported = false;\n            }\n        } catch (e) {\n            supported = false;\n        }\n        return supported;\n    }\n    SessionStorage.isSupported = isSessionStorageSupported();\n    if (SessionStorage.isSupported) {\n        SessionStorage.set = function(name, value) {\n            try {\n                var cache = [];\n                var json = JSON.stringify(value, function(key, value) {\n                    if (key === 'pool') {\n                        return;\n                    }\n                    if (typeof value === 'object' && value !== null) {\n                        if (cache.indexOf(value) !== -1) {\n                            // Circular reference found, discard key\n                            return;\n                        }\n                        cache.push(value);\n                    }\n                    return value;\n                });\n                cache = null;\n                $window.sessionStorage.setItem(name, json);\n            } catch (e) {\n                console.log('SessionStorage.set.error serializing', name, value, e);\n            }\n        };\n        SessionStorage.get = function(name) {\n            var value = null;\n            if ($window.sessionStorage[name] !== undefined) {\n                try {\n                    value = JSON.parse($window.sessionStorage[name]);\n                } catch (e) {\n                    console.log('SessionStorage.get.error parsing', name, e);\n                }\n            }\n            return value;\n        };\n        SessionStorage.delete = function(name) {\n            $window.sessionStorage.removeItem(name);\n        };\n        SessionStorage.on = function(name) {\n            var deferred = $q.defer();\n            var i, timeout = Cookie.TIMEOUT;\n\n            function storageEvent(e) {\n                // console.log('SessionStorage.on', name, e);\n                clearTimeout(i);\n                if (e.originalEvent.key === name) {\n                    try {\n                        var value = JSON.parse(e.originalEvent.newValue); // , e.originalEvent.oldValue\n                        deferred.resolve(value);\n                    } catch (error) {\n                        console.log('SessionStorage.on.error parsing', name, error);\n                        deferred.reject('error parsing ' + name);\n                    }\n                }\n            }\n            angular.element($window).on('storage', storageEvent);\n            i = setTimeout(function() {\n                deferred.reject('timeout');\n            }, timeout);\n            return deferred.promise;\n        };\n    } else {\n        console.log('SessionStorage.unsupported switching to cookies');\n        SessionStorage.set = Cookie.set;\n        SessionStorage.get = Cookie.get;\n        SessionStorage.delete = Cookie.delete;\n        SessionStorage.on = Cookie.on;\n    }\n    return SessionStorage;\n}]);"]}