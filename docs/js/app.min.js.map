{"version":3,"sources":["docs/js/app.js"],"names":["app","angular","module","config","$routeProvider","$locationProvider","when","title","templateUrl","controller","resolve","user","api","isLoggedOrGoTo","html5Mode","hashPrefix","$httpProvider","defaults","withCredentials","run","$rootScope","$route","$routeParams","$window","$document","$q","$timeout","closeModal","modal","index","forEach","modals","m","i","active","splice","standalone","navigator","$on","current","value","key","replace","RegExp","log","console","info","apply","arguments","addModal","modalType","params","deferred","defer","template","data","this","reject","push","scrollTo","promise","$scope","$location","signout","auth","then","path","State","state","ready","items","model","submit","busy","signin","response","success","$$lastRequestedPath","error","signup","$interval","Hash","Calendar","GanttRow","serializeDate","date","pad","v","s","z","length","Array","join","yyyy","getFullYear","MM","getMonth","dd","getDate","hh","getHours","mm","getMinutes","ss","getSeconds","getRandomDay","Date","setDate","Math","floor","random","setHours","setMinutes","setSeconds","ceil","getTime","mKey","getRandomItem","day","item","id","uid","hours","activityId","row","taskId","prototype","slice","call","activity","name","budgetHours","project","type","deliveryDate","addItem","slots","add","update","updateMonths","updateItem","extend","clearItems","ranges","removeAll","months","days","intervalId","start","stop","cancel","constant","ACTIVITY","CUSTOMER","DEPARTMENT","GROUP","MANAGER","PROJECT","RESOURCE","USER","factory","pool","get","Object","defineProperties","enumerable","writable","has","undefined","getId","hash","set","newItem","p","keys","remove","oldItem","indexOf","addMany","removeMany","shift","each","callback","forward","reverse","sort","c","d","a","b","backward","differs","t","updatePool","pools","ArrayFrom","len","today","todayKey","clearMonth","month","tasks","fromDay","getDay","monthDays","weeks","r","$today","getKey","ganttGroups","colors","assignedHours","useBudget","customer","department","manager","resource","color","lastTaskId","canSelect","canEdit","toLowerCase","mergeSlot","slot","insertSlot","min","max","removeSlots","toggleSlots","assign","col","$key","$date","write","erase","toggle","total","copy","task","updateRanges","previous","lastDay","rKey","range","getRange","from","to","firstKey","lastKey","updateRange","previousKey","nextKey","n","canMoveRange","dir","can","first","getOffsetKey","startDate","k","moveRange","addDays","toggleOpened","opened","compress","Utils","where","serialNumber","number","toString","directive","restrict","transclude","header","link","scope","element","attributes","message","$http","$templateCache","$compile","$parse","formatLabel","string","prepend","expression","splitted","split","formatted","uniqueId","control","ngModel","required","form","placeholder","require","compile","pre","label","filter","optionLabel","options","source","field","minLength","maxLength","Number","POSITIVE_INFINITY","focus","getType","visible","getClasses","$parent","control-focus","control-success","$valid","control-error","$invalid","$submitted","$touched","control-empty","$viewValue","getMessages","$error","onClick","$eval","onValidate","button","removeListeners","off","stateClass","isBusy","successing","isSuccessing","isSuccess","errorring","isErroring","isError","stateDisabled","on","_format","templateFunction","aid","formKey","formFocus","decoration","disabled","change","onChange","onFocus","blur","onBlur","inputCols","cols","colInput","colLabel","readonly","validate","format","precision","ngDisabled","controlRow","match","validation","click","mouseover","mouseout","icon","nameHi","formKeyHi","modelHi","validationHi","requiredHi","messageHi","decorationHi","himodel","canCreate","flatten","queryable","onSelected","rows","taDisabled","templateElement","templateAttributes","html","contents","onRemove","e","getter","numberPicker","setter","onAdd","nodeRemove","nodeAdd","node","querySelectorAll","$filter","$modelValue","$setViewValue","doBlur","validateType","$formatters","$parsers","unshift","valid","String","$setValidity","isReady","idle","errors","enabled","bind","errorMessage","submitClass","submitMessage","idleMessage","busyMessage","successMessage","service","redirect","$firebaseAuth","$firebaseObject","$firebaseArray","storage","connect","presence","$signInAnonymously","remember","logged","catch","token","firebase","database","ref","child","orderByChild","equalTo","snap","firstOrDefault","email","password","root","usersRef","userRef","updateUser","delete","getUserItems","getArray","getField","query","fields","collection","limit","array","queryRef","limitToLast","$loaded","numChildren","val","window","apiKey","authDomain","databaseURL","projectId","storageBucket","messagingSenderId","initializeApp","url","onError","post","DEBUG","put","patch","blob","method","headers","Content-type","responseType","_service","userId","Cookie","TIMEOUT","_set","expires","setTime","toGMTString","document","cookie","cache","json","JSON","stringify","cookieName","ca","charAt","substring","parse","checkCookie","elapsed","timeout","interval","setTimeout","LocalStorage","isSupported","supported","localStorage","setItem","removeItem","storageEvent","clearTimeout","originalEvent","newValue","SessionStorage","sessionStorage"],"mappings":"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","file":"app.min.js","sourcesContent":["/* global angular */\r\n\r\n\"use strict\";\r\n\r\nvar app = angular.module('app', ['ngRoute', 'ngMessages', 'firebase', 'jsonFormatter']);\r\n\r\napp.config(['$routeProvider', '$locationProvider', function($routeProvider, $locationProvider) {\r\n\r\n    $routeProvider.when('/', {\r\n        title: 'Homepage',\r\n        templateUrl: 'partials/home.html',\r\n        controller: 'HomeCtrl',\r\n\r\n    }).when('/signin', {\r\n        title: 'Accedi',\r\n        templateUrl: 'partials/signin.html',\r\n        controller: 'SigninCtrl',\r\n\r\n    }).when('/signup', {\r\n        title: 'Registrazione',\r\n        templateUrl: 'partials/signup.html',\r\n        controller: 'SignupCtrl',\r\n\r\n    }).when('/dashboard', {\r\n        title: 'Dashboard',\r\n        templateUrl: 'partials/dashboard.html',\r\n        controller: 'DashboardCtrl',\r\n        resolve: {\r\n            user: ['FirebaseApi', function(api) {\r\n                return api.isLoggedOrGoTo('/signin');\r\n            }],\r\n        },\r\n\r\n    }).when('/user/:userId', {\r\n        title: 'User',\r\n        templateUrl: 'partials/user.html',\r\n        controller: 'UserCtrl',\r\n        resolve: {\r\n            user: ['FirebaseApi', function(api) {\r\n                return api.isLoggedOrGoTo('/signin');\r\n            }],\r\n        },\r\n\r\n    }).when('/404', {\r\n        title: 'Error 404',\r\n        templateUrl: 'partials/404',\r\n\r\n    });\r\n\r\n    // $routeProvider.otherwise('/'); // stream\r\n\r\n    // HTML5 MODE url writing method (false: #/anchor/use, true: /html5/url/use)\r\n    $locationProvider.html5Mode(false);\r\n    $locationProvider.hashPrefix('');\r\n\r\n}]);\r\n\r\napp.config(['$httpProvider', function($httpProvider) {\r\n    $httpProvider.defaults.withCredentials = true;\r\n}]);\r\n\r\napp.run(['$rootScope', '$route', '$routeParams', '$window', '$document', '$q', '$timeout', function($rootScope, $route, $routeParams, $window, $document, $q, $timeout) {\r\n\r\n    $rootScope.standalone = $window.navigator.standalone;\r\n\r\n    $rootScope.$on('$routeChangeSuccess', function() {\r\n        var title = $route.current.title;\r\n        angular.forEach($routeParams, function(value, key) {\r\n            title = title.replace(new RegExp(':' + key, 'g'), value);\r\n        });\r\n        $document.title = title || '';\r\n    });\r\n\r\n    $rootScope.log = function() {\r\n        if ($window.console && $window.console.info) {\r\n            $window.console.info.apply($window.console, arguments);\r\n        }\r\n    };\r\n\r\n    // MODALS\r\n    $rootScope.modals = [];\r\n\r\n    function closeModal(modal) {\r\n        var index = -1;\r\n        angular.forEach($rootScope.modals, function(m, i) {\r\n            if (m === modal) {\r\n                index = i;\r\n            }\r\n        });\r\n        if (index !== -1) {\r\n            modal.active = false;\r\n            $timeout(function() {\r\n                $rootScope.modals.splice(index, 1);\r\n            }, 500);\r\n        }\r\n    }\r\n\r\n    $rootScope.addModal = function(modalType, title, params) {\r\n        var deferred = $q.defer();\r\n        params = params || null;\r\n        var modal = {\r\n            title: 'Untitled',\r\n            controller: null,\r\n            template: null,\r\n            params: params,\r\n        };\r\n        switch (modalType) {\r\n            case 'messageModal':\r\n                modal = {\r\n                    title: title || 'Messaggio',\r\n                    controller: 'MessageModalCtrl',\r\n                    template: 'partials/modals/message',\r\n                    params: params,\r\n                };\r\n                break;\r\n        }\r\n        modal.deferred = deferred;\r\n        modal.resolve = function(data) {\r\n            closeModal(this);\r\n            modal.deferred.resolve(data, modal);\r\n        };\r\n        modal.reject = function() {\r\n            closeModal(this);\r\n            modal.deferred.reject(modal);\r\n        };\r\n        $rootScope.modals.push(modal);\r\n        angular.forEach($rootScope.modals, function(m, i) {\r\n            m.active = false;\r\n        });\r\n        $timeout(function() {\r\n            modal.active = true;\r\n            $window.scrollTo(0, 0);\r\n        }, 500);\r\n        return deferred.promise;\r\n    };\r\n\r\n}]);\n/* global angular, app */\r\n\n/* global angular, app */\r\n\r\napp.controller('RootCtrl', ['$scope', '$location', 'FirebaseApi', function($scope, $location, api) {\r\n\r\n    $scope.api = api;\r\n\r\n    $scope.signout = function() {\r\n        console.log(api);\r\n        api.auth.signout().then(function() {\r\n            $location.path('/');\r\n        });\r\n    };\r\n\r\n    api.current().then(function(user) {\r\n        console.log(user);\r\n    });\r\n\r\n}]);\r\n\r\napp.controller('HomeCtrl', ['$scope', '$location', '$timeout', 'State', 'FirebaseApi', function($scope, $location, $timeout, State, api) {\r\n\r\n    var state = $scope.state = new State();\r\n\r\n    state.ready();\r\n\r\n}]);\r\n\r\napp.controller('DashboardCtrl', ['$scope', '$location', '$timeout', 'State', 'FirebaseApi', function($scope, $location, $timeout, State, api) {\r\n\r\n    var state = $scope.state = new State();\r\n\r\n    state.ready();\r\n\r\n    api.items().then(function(items){\r\n        console.log('DashboardCtrl.items', items);\r\n        $scope.items = items;\r\n    });\r\n\r\n}]);\r\n\r\napp.controller('SigninCtrl', ['$scope', '$location', '$timeout', 'State', 'FirebaseApi', function($scope, $location, $timeout, State, api) {\r\n    \r\n    var state = $scope.state = new State();\r\n\r\n    var model = $scope.model = {};\r\n\r\n    $scope.submit = function() {\r\n        if (state.busy()) {\r\n            api.auth.signin(model).then(function success(response) {\r\n                state.success();\r\n                // $timeout(function() {\r\n                    var path = $location.$$lastRequestedPath || '/dashboard';\r\n                    console.log('SigninCtrl', path, response);\r\n                    $location.path(path);\r\n                    $location.$$lastRequestedPath = null;\r\n                // }, 1000);\r\n            }, function error(response) {\r\n                console.log('SigninCtrl.error', response);\r\n                state.error(response);\r\n            });\r\n        }\r\n    };\r\n\r\n}]);\r\n\r\napp.controller('SignupCtrl', ['$scope', '$location', '$timeout', 'State', 'FirebaseApi', function($scope, $location, $timeout, State, api) {\r\n\r\n    var state = $scope.state = new State();\r\n\r\n    var model = $scope.model = {};\r\n\r\n    $scope.submit = function() {\r\n        if (state.busy()) {\r\n            api.auth.signup(model).then(function success(response) {\r\n                state.success();\r\n                // $timeout(function() {\r\n                    var path = $location.$$lastRequestedPath || '/dashboard';\r\n                    console.log('SignupCtrl', path, response);\r\n                    $location.path(path);\r\n                    $location.$$lastRequestedPath = null;\r\n                // }, 1000);\r\n            }, function error(response) {\r\n                console.log('SignupCtrl.error', response);\r\n                state.error(response);\r\n            });\r\n        }\r\n    };\r\n\r\n}]);\r\n\r\napp.controller('DemoCtrl', ['$scope', '$interval', 'Hash', 'Calendar', 'GanttRow', function($scope, $interval, Hash, Calendar, GanttRow) {\r\n\r\n    var row = $scope.row = new GanttRow({\r\n        activity: {\r\n            id: 1000000 + getRandom(),\r\n            name: 'Activity',\r\n            budgetHours: 10 + Math.floor(Math.random() * 50),\r\n        },\r\n        project: {\r\n            type: Math.floor(Math.random() * 5),\r\n            deliveryDate: new Date(),\r\n        },\r\n    }, []);\r\n\r\n    $scope.addItem = function() {\r\n        var item = getRandomItem();\r\n        row.slots.add(item);\r\n        row.update();\r\n        row.updateMonths();\r\n        $scope.item = item;\r\n        // console.log('addItem', item.id);\r\n        log('addItem', item.id);\r\n    };\r\n    $scope.updateItem = function() {\r\n        if ($scope.item) {\r\n            var id = $scope.item.id;\r\n            item = getRandomItem();\r\n            item = angular.extend($scope.item, item);\r\n            item.id = id;\r\n            row.slots.add(item);\r\n            row.update();\r\n            row.updateMonths();\r\n            $scope.item = item;\r\n            log('updateItem', item.id);\r\n        }\r\n    };\r\n    $scope.clearItems = function() {\r\n        row.ranges.removeAll();\r\n        row.months.removeAll();\r\n        row.days.removeAll();\r\n        row.slots.removeAll();\r\n        row.update();\r\n        row.updateMonths();\r\n        delete $scope.item;\r\n        log('clearItems');\r\n    };\r\n\r\n    var intervalId;\r\n    $scope.start = function() {\r\n        $scope.stop();\r\n        intervalId = $interval($scope.addItem, 1000 / 60);\r\n    };\r\n    $scope.stop = function() {\r\n        if (intervalId) {\r\n            $interval.cancel(intervalId);\r\n        }\r\n    };\r\n\r\n    function serializeDate(date) {\r\n        function pad(v, s, z) {\r\n            v = (v || 0) + '';\r\n            s = (s || 2);\r\n            z = (z || '0');\r\n            return v.length >= s ? v : new Array(s - v.length + 1).join(z) + v;\r\n        }\r\n        var yyyy = date.getFullYear();\r\n        var MM = date.getMonth() + 1; // getMonth() is zero-based\r\n        var dd = date.getDate();\r\n        var hh = date.getHours();\r\n        var mm = date.getMinutes();\r\n        var ss = date.getSeconds();\r\n        return yyyy + '-' + pad(MM) + '-' + pad(dd) + 'T' + pad(hh) + ':' + pad(mm) + ':' + pad(ss);\r\n    }\r\n\r\n    function getRandom() {\r\n        return 1000000 + Math.floor(Math.random() * 100000);\r\n    }\r\n\r\n    function getRandomDay() {\r\n        var oneday = (24 * 60 * 60 * 1000);\r\n        var date = new Date();\r\n        date.setDate(date.getDate() + Math.floor(Math.random() * 60));\r\n        // date.setMonth(date.getMonth() + Math.floor(Math.random() * 2));\r\n        date.setHours(0);\r\n        date.setMinutes(0);\r\n        date.setSeconds(0);\r\n        var yyyy = date.getFullYear();\r\n        var MM = date.getMonth();\r\n        var key = Math.ceil(date.getTime() / oneday);\r\n        var mKey = yyyy * 12 + MM;\r\n        return {\r\n            key: key,\r\n            mKey: mKey,\r\n            date: serializeDate(date)\r\n        };\r\n    }\r\n\r\n    var uid = 1;\r\n\r\n    function getRandomItem() {\r\n        var day = getRandomDay();\r\n        var item = {\r\n            id: uid,\r\n            hours: 1 + Math.floor(Math.random() * 6),\r\n            date: new Date(day.date),\r\n            key: day.key,\r\n            mKey: day.mKey,\r\n            activityId: row.id,\r\n        };\r\n        if (Math.floor(Math.random() * 3) === 0) {\r\n            item.taskId = 10000 + Math.floor(Math.random() * 50);\r\n        }\r\n        uid++;\r\n        return item;\r\n    }\r\n\r\n    function log() {\r\n        $scope.log = Array.prototype.slice.call(arguments);\r\n    }\r\n}]);\r\n\r\napp.constant('ganttGroups', {\r\n    ACTIVITY: 1,\r\n    CUSTOMER: 2,\r\n    DEPARTMENT: 3,\r\n    GROUP: 4,\r\n    MANAGER: 5,\r\n    PROJECT: 6,\r\n    RESOURCE: 7,\r\n    USER: 9,\r\n});\r\n\r\napp.factory('Hash', [function() {\r\n    var pools = {};\r\n\r\n    function Hash(key, pool) {\r\n        key = key || 'id';\r\n        pool = pool ? Hash.get(pool) : {};\r\n        Object.defineProperties(this, {\r\n            key: {\r\n                value: key,\r\n                enumerable: false,\r\n                writable: false\r\n            },\r\n            pool: {\r\n                value: pool,\r\n                enumerable: false,\r\n                writable: false\r\n            },\r\n            length: {\r\n                value: 0,\r\n                enumerable: false,\r\n                writable: true\r\n            }\r\n        });\r\n    }\r\n\r\n    function has(id) {\r\n        return this.pool[id] !== undefined;\r\n    }\r\n\r\n    function getId(id) {\r\n        return this.pool[id];\r\n    }\r\n\r\n    function get(item) {\r\n        var hash = this,\r\n            key = this.key;\r\n        return item ? hash.getId(item[key]) : null;\r\n    }\r\n\r\n    function set(item) {\r\n        var hash = this,\r\n            pool = this.pool,\r\n            key = this.key;\r\n        pool[item[key]] = item;\r\n        hash.push(item);\r\n        return item;\r\n    }\r\n\r\n    function add(newItem) {\r\n        var hash = this;\r\n        var item = hash.get(newItem);\r\n        if (item) {\r\n            for (var i = 0, keys = Object.keys(newItem), p; i < keys.length; i++) {\r\n                p = keys[i];\r\n                item[p] = newItem[p];\r\n            }\r\n        } else {\r\n            item = hash.set(newItem);\r\n        }\r\n        return item;\r\n    }\r\n\r\n    function remove(oldItem) {\r\n        var hash = this,\r\n            pool = this.pool,\r\n            key = this.key;\r\n        var item = hash.get(oldItem);\r\n        if (item) {\r\n            var index = hash.indexOf(item);\r\n            if (index !== -1) {\r\n                hash.splice(index, 1);\r\n            }\r\n            delete pool[item[key]];\r\n        }\r\n        return hash;\r\n    }\r\n\r\n    function addMany(items) {\r\n        var hash = this;\r\n        if (!items) {\r\n            return hash;\r\n        }\r\n        var i = 0;\r\n        while (i < items.length) {\r\n            hash.add(items[i]);\r\n            i++;\r\n        }\r\n        return hash;\r\n    }\r\n\r\n    function removeMany(items) {\r\n        var hash = this;\r\n        if (!items) {\r\n            return hash;\r\n        }\r\n        var i = 0;\r\n        while (i < items.length) {\r\n            hash.remove(items[i]);\r\n            i++;\r\n        }\r\n        return hash;\r\n    }\r\n\r\n    function removeAll() {\r\n        var hash = this,\r\n            key = hash.key,\r\n            pool = hash.pool;\r\n        var i = 0,\r\n            t = hash.length,\r\n            item;\r\n        while (hash.length) {\r\n            item = hash.shift();\r\n            delete pool[item[key]];\r\n            i++;\r\n        }\r\n        return hash;\r\n    }\r\n\r\n    function each(callback) {\r\n        var hash = this;\r\n        if (callback) {\r\n            var i = 0;\r\n            while (i < hash.length) {\r\n                callback(hash[i], i);\r\n                i++;\r\n            }\r\n        }\r\n        return hash;\r\n    }\r\n\r\n    function forward(key, reverse) {\r\n        var hash = this;\r\n        key = (key || this.key);\r\n        hash.sort(function(c, d) {\r\n            var a = reverse ? d : c;\r\n            var b = reverse ? c : d;\r\n            return a[key] - b[key];\r\n        });\r\n        return hash;\r\n    }\r\n\r\n    function backward(key) {\r\n        return this.forward(key, true);\r\n    }\r\n\r\n    function differs(hash) {\r\n        if (hash.key !== this.key || hash.length !== this.length) {\r\n            return true;\r\n        } else {\r\n            var differs = false,\r\n                i = 0,\r\n                t = this.length,\r\n                key = this.key;\r\n            while (differs && i < t) {\r\n                differs = this[i][key] !== hash[i][key];\r\n                i++;\r\n            }\r\n        }\r\n    }\r\n\r\n    function updatePool() {\r\n        var hash = this,\r\n            pool = this.pool,\r\n            key = this.key;\r\n        Object.keys(pool).forEach(function(key) {\r\n            delete pool[key];\r\n        });\r\n        angular.forEach(hash, function(item) {\r\n            pool[item[key]] = item;\r\n        });\r\n    }\r\n    Hash.get = function(pool) {\r\n        return (pools[pool] = pools[pool] || {});\r\n    };\r\n    Hash.prototype = new Array;\r\n    Hash.prototype.has = has;\r\n    Hash.prototype.getId = getId;\r\n    Hash.prototype.get = get;\r\n    Hash.prototype.set = set;\r\n    Hash.prototype.add = add;\r\n    Hash.prototype.remove = remove;\r\n    Hash.prototype.each = each;\r\n    Hash.prototype.addMany = addMany;\r\n    Hash.prototype.removeMany = removeMany;\r\n    Hash.prototype.removeAll = removeAll;\r\n    Hash.prototype.forward = forward;\r\n    Hash.prototype.backward = backward;\r\n    Hash.prototype.differs = differs;\r\n    Hash.prototype.updatePool = updatePool;\r\n    return Hash;\r\n}]);\r\n\r\napp.factory('Calendar', ['Hash', function(Hash) {\r\n    var oneday = (24 * 60 * 60 * 1000);\r\n    var today = new Date();\r\n    today.setHours(0);\r\n    today.setMinutes(0);\r\n    today.setSeconds(0);\r\n    var todayKey = Math.ceil(today.getTime() / oneday);\r\n\r\n    function ArrayFrom(len, callback) {\r\n        var a = [];\r\n        while (a.length < len) {\r\n            a.push(callback(a.length));\r\n        }\r\n        return a;\r\n    }\r\n    var months = new Hash('mKey');\r\n\r\n    function Calendar() {}\r\n    Calendar.getDate = function(day) {\r\n        if (typeof day.date.getMonth === 'function') {\r\n            return day.date;\r\n        } else {\r\n            return new Date(day.date);\r\n        }\r\n    };\r\n    Calendar.clearMonth = function(month) {\r\n        month.days.each(function(day) {\r\n            if (day) {\r\n                day.hours = 0;\r\n                day.tasks = [];\r\n            }\r\n        });\r\n    };\r\n    Calendar.getMonth = function(day) {\r\n        today = new Date();\r\n        today.setHours(0);\r\n        today.setMinutes(0);\r\n        today.setSeconds(0);\r\n        todayKey = Math.ceil(today.getTime() / oneday);\r\n        //\r\n        var date = Calendar.getDate(day);\r\n        var yyyy = date.getFullYear();\r\n        var MM = date.getMonth();\r\n        var key = Math.ceil(date.getTime() / oneday);\r\n        var mKey = yyyy * 12 + MM;\r\n        var month = months.getId(mKey);\r\n        if (!month) {\r\n            var fromDay = new Date(yyyy, MM, 1).getDay();\r\n            var monthDays = new Date(yyyy, MM + 1, 0).getDate();\r\n            var weeks = Math.ceil(monthDays / 7);\r\n            month = {\r\n                date: date,\r\n                mKey: mKey,\r\n                month: MM,\r\n                monthDays: monthDays,\r\n                fromDay: fromDay,\r\n                days: new Hash('key'),\r\n            };\r\n            month.weeks = ArrayFrom(weeks, function(r) {\r\n                var days = ArrayFrom(7, function(c) {\r\n                    var item = null;\r\n                    var d = r * 7 + c - (fromDay - 1);\r\n                    if (d >= 0 && d < monthDays) {\r\n                        var date = new Date(yyyy, MM, d + 1);\r\n                        var key = Math.ceil(date.getTime() / oneday);\r\n                        item = {\r\n                            $today: key === todayKey,\r\n                            c: c,\r\n                            r: r,\r\n                            d: d + 1,\r\n                            date: date,\r\n                            key: key,\r\n                            hours: 0,\r\n                            tasks: [],\r\n                        };\r\n                        item = month.days.add(item);\r\n                    }\r\n                    return item;\r\n                });\r\n                return {\r\n                    r: r,\r\n                    days: days,\r\n                };\r\n            });\r\n            month = months.add(month);\r\n        }\r\n        return month;\r\n    };\r\n    Calendar.getDay = function(days) {\r\n        var date = new Date(today);\r\n        date.setDate(date.getDate() + days);\r\n        return date;\r\n    };\r\n    Calendar.getKey = function(date) {\r\n        return Math.ceil(date.getTime() / oneday);\r\n    };\r\n    return Calendar;\r\n}]);\r\n\r\napp.factory('GanttRow', ['Hash', 'Calendar', 'ganttGroups', function(Hash, Calendar, ganttGroups) {\r\n    var uid = 1;\r\n\r\n    var oneday = (24 * 60 * 60 * 1000);\r\n    var today = new Date();\r\n    today.setHours(0);\r\n    today.setMinutes(0);\r\n    today.setSeconds(0);\r\n    var todayKey = Math.ceil(today.getTime() / oneday);\r\n\r\n    function GanttRow(data, colors) {\r\n        this.type = ganttGroups.ACTIVITY;\r\n        this.assignedHours = 0;\r\n        this.slots = new Hash('id');\r\n        this.days = new Hash('key');\r\n        this.months = new Hash('mKey');\r\n        this.ranges = new Hash('rKey');\r\n        this.tasks = new Hash('id'); // 'taskId'\r\n        // angular.isObject(data) ? angular.extend(this, data) : null;\r\n        if (data) {\r\n            this.id = data.activity.id;\r\n            this.name = data.activity.name;\r\n            this.budgetHours = data.activity.budgetHours;\r\n            this.useBudget = data.project.type !== 2 && data.project.type !== 4;\r\n            this.customer = data.customer;\r\n            this.department = data.department;\r\n            this.manager = data.manager;\r\n            this.project = data.project;\r\n            this.resource = data.resource;\r\n            this.color = colors[this.id % (colors.length || 1)];\r\n        }\r\n        // this.items = new Hash().fill(data.items);\r\n        this.lastTaskId = null;\r\n        this.update();\r\n    }\r\n    GanttRow.prototype = {\r\n        canSelect: function() {\r\n            return this.type === ganttGroups.ACTIVITY && this.budgetHours > 0;\r\n        },\r\n        canEdit: function() {\r\n            return this.canSelect() && this.resource.name.toLowerCase().indexOf('nondefinito') === -1;\r\n        },\r\n        mergeSlot: function(slot) {\r\n            var slots = this.slots;\r\n            if (slot.hours) {\r\n                slots.add(slot);\r\n            } else {\r\n                slots.remove(slot);\r\n            }\r\n        },\r\n        insertSlot: function(key, hours, taskId) {\r\n            var slot = null;\r\n            if (this.useBudget) {\r\n                hours = Math.min(hours, this.budgetHours - this.assignedHours);\r\n            }\r\n            hours = Math.max(0, hours);\r\n            if (hours > 0) {\r\n                var item = {\r\n                    id: 'temp-' + (uid++),\r\n                    key: key,\r\n                    date: new Date(key * oneday),\r\n                    hours: hours,\r\n                    activityId: this.id,\r\n                };\r\n                if (taskId) {\r\n                    item.taskId = taskId;\r\n                    this.lastTaskId = taskId;\r\n                }\r\n                this.slots.add(item);\r\n                slot = this.slots.getId(item.id);\r\n            }\r\n            this.update();\r\n            return slot;\r\n        },\r\n        removeSlots: function(key) {\r\n            var day = this.days.getId(key);\r\n            day.tasks.each(function(item) {\r\n                item.hours = 0;\r\n            });\r\n            var slots = day.tasks.slice();\r\n            this.slots.removeMany(slots);\r\n            this.update();\r\n            return slots;\r\n        },\r\n        toggleSlots: function(key, hours) {\r\n            if (this.days.has(key)) {\r\n                return this.removeSlots(key);\r\n            } else {\r\n                var slot = this.insertSlot(key, hours, this.lastTaskId);\r\n                return [slot];\r\n            }\r\n        },\r\n        // WRITE CANCEL DAY SLOT\r\n        assign: function(col, value) {\r\n            console.log('assign');\r\n            var slots = this.slots,\r\n                key = col.$key;\r\n            var item = {\r\n                // errore\r\n                id: 'temp-' + (uid++),\r\n                key: key,\r\n                date: col.$date,\r\n                hours: value || 0,\r\n                activityId: this.id,\r\n            };\r\n            if (value) {\r\n                slots.add(item);\r\n            } else {\r\n                slots.remove(item);\r\n            }\r\n            this.update();\r\n            return this.days.getId(key);\r\n        },\r\n        write: function(col, value, max) {\r\n            value = Math.min(value, max);\r\n            if (this.useBudget) {\r\n                value = Math.min(value, this.budgetHours - this.assignedHours);\r\n            }\r\n            value = Math.max(0, value);\r\n            if (value && !this.days.has(col.$key) && col.$date >= today) {\r\n                return this.assign(col, value);\r\n            }\r\n        },\r\n        erase: function(col, value, max) {\r\n            if (this.days.has(col.$key) && col.$date >= today) {\r\n                return this.assign(col, null);\r\n            }\r\n        },\r\n        toggle: function(col, value, max) {\r\n            if (this.days.has(col.$key)) {\r\n                return this.erase(col, value, max);\r\n            } else {\r\n                return this.write(col, value, max);\r\n            }\r\n        },\r\n        // WRITE CANCEL DAY SLOT\r\n        update: function() {\r\n            var total = 0;\r\n            var slots = this.slots,\r\n                days = this.days;\r\n            days.removeAll();\r\n            var taskId = null;\r\n            slots.each(function(item) {\r\n                taskId = item.taskId || taskId;\r\n                total += item ? item.hours : 0;\r\n                var day = days.add({\r\n                    key: item.key,\r\n                    date: item.date,\r\n                    hours: 0,\r\n                });\r\n                day.tasks = day.tasks || new Hash('id'); // 'taskId'\r\n                day.tasks.add(angular.copy(item));\r\n                day.tasks.each(function(task) {\r\n                    day.hours += task.hours;\r\n                });\r\n            });\r\n            this.lastTaskId = taskId || this.lastTaskId;\r\n            days.forward(); // sort by key       \r\n            this.assignedHours = total;\r\n            this.updateRanges();\r\n        },\r\n        updateMonths: function() {\r\n            var days = this.days,\r\n                months = this.months;\r\n            months.removeAll();\r\n            var previous;\r\n            days.each(function(item) {\r\n                var month = Calendar.getMonth(item);\r\n                if (month !== previous) {\r\n                    previous = month;\r\n                    Calendar.clearMonth(month);\r\n                }\r\n                months.add(month);\r\n                var day = month.days.getId(item.key);\r\n                if (day) {\r\n                    day.hours = item.hours;\r\n                    day.tasks = item.tasks;\r\n                }\r\n            });\r\n            months.forward(); // sort by key  \r\n        },\r\n        updateRanges: function() {\r\n            var days = this.days,\r\n                ranges = this.ranges;\r\n            ranges.removeAll();\r\n            var rKey = 0,\r\n                lastDay;\r\n            days.each(function(day, i) {\r\n                if (lastDay) {\r\n                    if (day.key - lastDay.key > 1 || day.tasks.differs(lastDay.tasks)) {\r\n                        rKey++;\r\n                    }\r\n                }\r\n                lastDay = day;\r\n                var range = ranges.add({\r\n                    rKey: rKey,\r\n                });\r\n                range.days = range.days || [];\r\n                range.days.push(day.key);\r\n            });\r\n            ranges.forward(); // sort by key   \r\n        },\r\n        getRange: function(col, from, to) {\r\n            var ranges = this.ranges,\r\n                range = null,\r\n                key = col.$key;\r\n            ranges.each(function(item) {\r\n                var index = item.days.indexOf(key);\r\n                if (index !== -1) {\r\n                    item.c = index;\r\n                    item.firstKey = Math.max(from, item.days[0]);\r\n                    item.lastKey = Math.min(to, item.days[item.days.length - 1]);\r\n                    range = item;\r\n                }\r\n            });\r\n            return range;\r\n        },\r\n        updateRange: function(col, from, to) {\r\n            var ranges = this.ranges,\r\n                range = this.getRange(col, from, to);\r\n            if (range) {\r\n                range.previousKey = null;\r\n                range.nextKey = null;\r\n                var r = range.rKey;\r\n                if (r > 0) {\r\n                    var p = ranges[r - 1];\r\n                    range.previousKey = p.days[p.days.length - 1];\r\n                }\r\n                if (r < ranges.length - 1) {\r\n                    var n = ranges[r + 1];\r\n                    range.nextKey = n.days[0];\r\n                }\r\n            }\r\n            return range;\r\n        },\r\n        canMoveRange: function(range, dir) {\r\n            // rifare !!!\r\n            var can = true;\r\n            var row = this;\r\n            var first = range.items[0];\r\n            var last = range.items[range.items.length - 1];\r\n            var key = row.getOffsetKey(first.startDate, dir);\r\n            var i = 0,\r\n                t = range.items.length;\r\n            while (i < t) {\r\n                var k = key + i;\r\n                if (k < todayKey || (row.days.getId(k) && range.items.indexOf(row.days.getId(k)) === -1)) { // sistemare!!\r\n                    can = false;\r\n                    i = t;\r\n                }\r\n                i++;\r\n            }\r\n            return can;\r\n        },\r\n        moveRange: function(range, dir) {\r\n            if (range.items.length) {\r\n                var row = this;\r\n                if (row.canMoveRange(range, dir)) {\r\n                    angular.forEach(range.items, function(item) {\r\n                        row.addDays(item, dir);\r\n                    });\r\n                    row.update();\r\n                }\r\n            }\r\n        },\r\n        addDays: function(item, days) {\r\n            // console.log('GanttRow.addDay', item, days);\r\n            var date = new Date(item.startDate);\r\n            date.setDate(date.getDate() + days);\r\n            item.date = date;\r\n            item.key = Math.ceil(date.getTime() / oneday);\r\n            return item;\r\n        },\r\n        getOffsetKey: function(date, day) {\r\n            date = new Date(date);\r\n            date.setDate(date.getDate() + day);\r\n            var key = Math.ceil(date.getTime() / oneday);\r\n            return key;\r\n        },\r\n        getHours: function(key) {\r\n            var hours = 0;\r\n            var day = this.days.getId(key);\r\n            if (day) {\r\n                day.tasks.each(function(task) {\r\n                    hours += task.hours;\r\n                });\r\n            }\r\n            return hours;\r\n        },\r\n        toggleOpened: function() {\r\n            // console.log('toggleOpened');\r\n            this.opened = !this.opened;\r\n        },\r\n        compress: function(key) {\r\n            if (!this.items.length) {\r\n                return;\r\n            }\r\n            this.items.sort(function(a, b) {\r\n                return a.key - b.key;\r\n            });\r\n            var item = Utils.where(this.items, { key: key });\r\n            item = item || this.items[0];\r\n            var index = this.items.indexOf(item);\r\n            var i = index,\r\n                t = this.items.length;\r\n            key = Math.max(key, todayKey);\r\n            // da rifare\r\n            // collezionare ore totali\r\n            // redistribuire records in base a carico giornaliero\r\n            // spostare su gantt\r\n            while (i < t) {\r\n                item = this.items[i];\r\n                item.key = key + i - index;\r\n                item.date = new Date(item.key * oneday);\r\n                i++;\r\n            }\r\n            this.update();\r\n        },\r\n    };\r\n    GanttRow.serialNumber = function(number, max) {\r\n        return new Array((1 + (max.toString().length) - (number.toString().length))).join('0');\r\n    };\r\n    return GanttRow;\r\n}]);\n/* global angular, app */\r\n\r\napp.directive('header', [function() {\r\n    return {\r\n        restrict: 'E',\r\n        templateUrl: 'partials/header',\r\n        transclude: {\r\n            'header': '?headerItems',\r\n        },\r\n        link: function(scope, element, attributes, model) {}\r\n    };\r\n}]);\r\n\r\napp.directive('controlMessages', [function() {\r\n    return {\r\n        restrict: 'E',\r\n        templateUrl: 'partials/control-messages',\r\n        transclude: {\r\n            'message': '?messageItems',\r\n        },\r\n        link: function(scope, element, attributes, model) {}\r\n    };\r\n}]);\r\n\r\napp.directive('control', ['$http', '$templateCache', '$compile', '$parse', function($http, $templateCache, $compile, $parse) {\r\n    function formatLabel(string, prepend, expression) {\r\n        string = string || '';\r\n        prepend = prepend || '';\r\n        var splitted = string.split(',');\r\n        if (splitted.length > 1) {\r\n            var formatted = splitted.shift();\r\n            angular.forEach(splitted, function(value, index) {\r\n                if (expression) {\r\n                    formatted = formatted.split('{' + index + '}').join('\\' + ' + prepend + value + ' + \\'');\r\n                } else {\r\n                    formatted = formatted.split('{' + index + '}').join(prepend + value);\r\n                }\r\n            });\r\n            if (expression) {\r\n                return '\\'' + formatted + '\\'';\r\n            } else {\r\n                return formatted;\r\n            }\r\n        } else {\r\n            return prepend + string;\r\n        }\r\n    }\r\n    var uniqueId = 0;\r\n    return {\r\n        restrict: 'A',\r\n        templateUrl: function(element, attributes) {\r\n            var template = 'partials/control';\r\n            switch (attributes.control) {\r\n                case 'select':\r\n                    template = 'partials/control-select';\r\n                    break;\r\n            }\r\n            return template;\r\n        },\r\n        scope: {\r\n            ngModel: '=',\r\n            required: '=',\r\n            form: '@',\r\n            title: '@',\r\n            placeholder: '@',\r\n        },\r\n        require: 'ngModel',\r\n        link: function(scope, element, attributes, model) {\r\n\r\n        },\r\n        compile: function(element, attributes) {\r\n                return {\r\n                    pre: function(scope, element, attributes) {\r\n                        if (attributes.control === 'select') {\r\n                            var label = (attributes.label ? attributes.label : 'name');\r\n                            var key = (attributes.key ? attributes.key : 'id');\r\n                            var filter = (attributes.min ? ' | filter:gte(\\'' + key + '\\', ' + attributes.min + ')' : '');\r\n                            var optionLabel = formatLabel(label, 'item.', true);\r\n                            scope.options = attributes.number ?\r\n                                'item.' + key + ' as ' + optionLabel + ' disable when item.disabled for item in ' + attributes.source + filter :\r\n                                optionLabel + ' disable when item.disabled for item in ' + attributes.source + filter + ' track by item.' + key;\r\n                            console.log('control.compile.pre', scope.options);\r\n                        }\r\n                        var type = scope.type = attributes.control;\r\n                        var form = scope.form = scope.form || 'form';\r\n                        var title = scope.title = scope.title || 'untitled';\r\n                        var placeholder = scope.placeholder = scope.placeholder || title;\r\n                        var field = scope.field = title.replace(/[^0-9a-zA-Z]/g, \"\").split(' ').join('') + (++uniqueId);\r\n                        scope.minLength = attributes.min || 0;\r\n                        scope.maxLength = attributes.max || Number.POSITIVE_INFINITY;\r\n                        scope.focus = false;\r\n                        scope.getType = function() {\r\n                            var type = 'text';\r\n                            switch (attributes.control) {\r\n                                case 'password':\r\n                                    // var form = $parse(scope.form)(scope.$parent);\r\n                                    // var field = $parse(scope.form + '.' + scope.field)(scope.$parent);\r\n                                    type = scope.visible ? 'text' : 'password';\r\n                                    break;\r\n                                default:\r\n                                    type = attributes.control;\r\n                            }\r\n                            console.log('control.getType', type);\r\n                            return type;\r\n                        };\r\n                        scope.getClasses = function() {\r\n                            var form = $parse(scope.form)(scope.$parent);\r\n                            var field = $parse(scope.form + '.' + scope.field)(scope.$parent);\r\n                            return {\r\n                                'control-focus': scope.focus,\r\n                                'control-success': field.$valid,\r\n                                'control-error': field.$invalid && (form.$submitted || field.$touched),\r\n                                'control-empty': !field.$viewValue\r\n                            };\r\n                        };\r\n                        scope.getMessages = function() {\r\n                            var form = $parse(scope.form)(scope.$parent);\r\n                            var field = $parse(scope.form + '.' + scope.field)(scope.$parent);\r\n                            return (form.$submitted || field.$touched) && field.$error;\r\n                        };\r\n                    },\r\n                    // post: function (scope, element, attributes) { }\r\n                };\r\n            }\r\n            /*\r\n            compile: function(element, attributes) {\r\n                element.removeAttr('my-dir'); \r\n                element.attr('ng-hide', 'true');\r\n                return function(scope) {\r\n                    $compile(element)(scope);\r\n                };\r\n            },\r\n            */\r\n    };\r\n}]);\r\n\r\napp.directive('state', ['$timeout', function($timeout) {\r\n    return {\r\n        restrict: 'EA',\r\n        templateUrl: 'partials/state',\r\n        transclude: true,\r\n        replace: true,\r\n        scope: {\r\n            state: '=',\r\n        },\r\n        link: function(scope, element, attributes, model) {\r\n            scope.stateClass = function() {\r\n                if (scope.state.button === element) {\r\n                    var sclass = {\r\n                        busy: scope.state.isBusy,\r\n                        successing: scope.state.isSuccessing,\r\n                        success: scope.state.isSuccess,\r\n                        errorring: scope.state.isErroring,\r\n                        error: scope.state.isError,\r\n                    };\r\n                    // console.log('stateClass', sclass);\r\n                    return sclass;\r\n                } else {\r\n                    return null;\r\n                }\r\n            };\r\n            scope.stateDisabled = function() {\r\n                var disabled = (scope.state.button && scope.state.button !== element); // || scope.$parent.$eval(attributes.onValidate);\r\n                // console.log('stateDisabled', disabled);\r\n                return disabled;\r\n            };\r\n\r\n            function onClick() {\r\n                $timeout(function() {\r\n                    if (!scope.$parent.$eval(attributes.onValidate)) {\r\n                        // console.log('state.onClick', attributes.onValidate, attributes.onClick);\r\n                        scope.state.button = element;\r\n                        return scope.$parent.$eval(attributes.onClick);\r\n                    } else {\r\n                        scope.$parent.$eval('form.$setSubmitted()');\r\n                    }\r\n                });\r\n            };\r\n\r\n            function addListeners() {\r\n                element.on('touchstart click', onClick);\r\n            };\r\n\r\n            function removeListeners() {\r\n                element.off('touchstart click', onClick);\r\n            };\r\n            scope.$on('$destroy', function() {\r\n                removeListeners();\r\n            });\r\n            addListeners();\r\n        }\r\n    }\r\n}]);\r\n\r\napp.directive('controlRow', ['$http', '$templateCache', '$compile', function($http, $templateCache, $compile) {\r\n    var aid = 0;\r\n\r\n    function _format(string, prepend, expression) {\r\n        string = string || '';\r\n        prepend = prepend || '';\r\n        var splitted = string.split(',');\r\n        if (splitted.length > 1) {\r\n            var formatted = splitted.shift();\r\n            angular.forEach(splitted, function(value, index) {\r\n                if (expression) {\r\n                    formatted = formatted.split('{' + index + '}').join('\\' + ' + prepend + value + ' + \\'');\r\n                } else {\r\n                    formatted = formatted.split('{' + index + '}').join(prepend + value);\r\n                }\r\n            });\r\n            if (expression) {\r\n                return '\\'' + formatted + '\\'';\r\n            } else {\r\n                return formatted;\r\n            }\r\n        } else {\r\n            return prepend + string;\r\n        }\r\n    }\r\n\r\n    function templateFunction(element, attributes) {\r\n        var form = attributes.form || 'Form';\r\n        var title = attributes.title || 'Untitled';\r\n        var placeholder = attributes.placeholder || title;\r\n        var name = title.replace(/[^0-9a-zA-Z]/g, \"\").split(' ').join('') + (++aid);\r\n        var formKey = form + '.' + name;\r\n        var formFocus = ' ng-focus=\"' + formKey + '.hasFocus=true\" ng-blur=\"' + formKey + '.hasFocus=false\"';\r\n        var message = '',\r\n            decoration = '',\r\n            disabled = '';\r\n        var label = (attributes.label ? attributes.label : 'name');\r\n        var key = (attributes.key ? attributes.key : 'id');\r\n        var model = attributes.model;\r\n        var change = (attributes.onChange ? ' ng-change=\"' + attributes.onChange + '\"' : '');\r\n        var focus = (attributes.onFocus ? ' ng-focus=\"' + attributes.onFocus + '\"' : '');\r\n        var blur = (attributes.onBlur ? ' ng-blur=\"' + attributes.onBlur + '\"' : '');\r\n        var inputCols = attributes.cols ? 6 : 9;\r\n        var colInput = 'col-lg-' + inputCols;\r\n        var colLabel = 'col-lg-' + (12 - inputCols);\r\n        if (attributes.cols === '12') {\r\n            colLabel = colInput = 'col-lg-12';\r\n        }\r\n        var required = (attributes.required ? ' required=\"true\"' : '');\r\n        var readonly = (attributes.readonly ? ' readonly' : '');\r\n        var options = (attributes.options ? ' ng-model-options=\"' + attributes.options + '\" ' : '');\r\n        var validate = (attributes.validate ? ' validate-type=\"' + attributes.validate + '\" ' : '');\r\n        var format = (attributes.format ? ' format=\"' + attributes.format + '\" ' : '');\r\n        var precision = (attributes.precision ? ' precision=\"' + attributes.precision + '\" ' : '');\r\n        if (attributes.disabled) {\r\n            disabled = ' disabled';\r\n        }\r\n        if (attributes.ngDisabled) {\r\n            disabled = ' ng-disabled=\"' + attributes.ngDisabled + '\"';\r\n        }\r\n        if (attributes.required) {\r\n            decoration = attributes.readonly || attributes.disabled ? '' : '<sup>âœ½</sup>';\r\n        }\r\n        message = '<span ng-messages=\"' + (attributes.readonly ? '' : '(' + form + '.$submitted || ' + formKey + '.$touched) && ') + formKey + '.$error\" role=\"alert\">';\r\n        message = message + '<span ng-message=\"required\" class=\"label-error animated flash\">obbligatorio â¤´</span>';\r\n        switch (attributes.controlRow) {\r\n            case 'password':\r\n                message = message + '<span ng-message=\"minlength\" class=\"label-error animated flash\">almeno 6 caratteri â¤´</span>';\r\n                break;\r\n            case 'email':\r\n                message = message + '<span ng-message=\"email\" class=\"label-error animated flash\">valore non corretto â¤´</span>';\r\n                break;\r\n            case 'number':\r\n            case 'range':\r\n                message = message + '<span ng-message=\"positive\" class=\"label-error animated flash\">solo valori positivi â¤´</span>';\r\n                message = message + '<span ng-message=\"number\" class=\"label-error animated flash\">solo valori numerici â¤´</span>';\r\n                break;\r\n        }\r\n        if (attributes.match !== undefined) {\r\n            message = message + '<span ng-message=\"match\" class=\"label-error animated flash\">non corrispondente â¤´</span>';\r\n        }\r\n        message = message + '</span>';\r\n        var validation = ' ng-class=\"{ \\'control-focus\\': ' + formKey + '.hasFocus, \\'control-success\\': ' + formKey + '.$valid, \\'control-error\\': ' + formKey + '.$invalid && (' + form + '.$submitted || ' + formKey + '.$touched), \\'control-empty\\': !' + formKey + '.$viewValue }\"';\r\n        var template = '<div class=\"row\" ' + validation + '><label for=\"' + name + '\" class=\"' + colLabel + ' col-form-label\">' + title + decoration + '</label><div class=\"' + colInput + ' col-' + attributes.controlRow + '\">';\r\n        switch (attributes.controlRow) {\r\n            case 'static':\r\n                var click = (attributes.click ? ' ng-click=\"' + attributes.click + '\"' : '');\r\n                var mouseover = (attributes.mouseover ? ' ng-mouseover=\"' + attributes.mouseover + '\"' : '');\r\n                var mouseout = (attributes.mouseout ? ' ng-mouseover=\"' + attributes.mouseout + '\"' : '');\r\n                var icon = (attributes.icon ? '<i class=\"pull-xs-right ' + attributes.icon + '\"></i>' : '');\r\n                template += '<p class=\"form-control\" ' + click + mouseover + mouseout + '><span ng-bind-html=\"' + model + ' || \\'&nbsp;\\'\"></span>' + icon + '</p>';\r\n                break;\r\n            case 'checkbox':\r\n                template = '<div class=\"' + colInput + '\"' + validation + '><div class=\"col-xs-12\"><label class=\"custom-control custom-checkbox\">';\r\n                template += '   <input type=\"checkbox\" class=\"custom-control-input\" ng-model=\"' + model + '\">';\r\n                template += '   <span class=\"custom-control-indicator\"></span>';\r\n                template += '   <span class=\"custom-control-description\">' + title + '</span>';\r\n                template += '</label>';\r\n                // template += '<input id=\"' + name + '\" name=\"' + name + '\" type=\"checkbox\" ng-model=\"' + model + '\" ' + change + focus + blur + required + ' class=\"toggle toggle-round-flat\">';\r\n                /*\r\n                template = '<div class=\"checkbox\">';\r\n                template += '<span class=\"checkbox-label\">' + title + required +'</span>';\r\n                template += '<span class=\"switch\"><input id=\"' + name + '\" name=\"' + name + '\" type=\"checkbox\" ng-model=\"' + model + '\" ' + change + focus + blur + required + ' class=\"toggle toggle-round-flat\"><label for=\"' + name + '\"></label></span>';\r\n                template += '</div>';\r\n                */\r\n                break;\r\n            case 'yesno':\r\n                template = '<div class=\"row\" ' + validation + '><label class=\"col-lg-6 custom-control custom-checkbox\">' + title + decoration + '</label>';\r\n                template += '<div class=\"' + colLabel + '\"><label class=\"custom-control custom-checkbox\">';\r\n                template += '   <input type=\"checkbox\" class=\"custom-control-input\" ng-model=\"' + model + '\" ng-change=\"' + model + 'No=!' + model + '\">';\r\n                template += '   <span class=\"custom-control-indicator\"></span>';\r\n                template += '   <span class=\"custom-control-description\">SÃ¬</span>';\r\n                template += '</label></div>';\r\n                template += '<div class=\"' + colLabel + '\"><label class=\"custom-control custom-checkbox\">';\r\n                template += '   <input type=\"checkbox\" class=\"custom-control-input\" ng-model=\"' + model + 'No\" ng-change=\"' + model + '=!' + model + 'No\">';\r\n                template += '   <span class=\"custom-control-indicator\"></span>';\r\n                template += '   <span class=\"custom-control-description\">No</span>';\r\n                template += '</label>';\r\n                // template += '<input id=\"' + name + '\" name=\"' + name + '\" type=\"checkbox\" ng-model=\"' + model + '\" ' + change + focus + blur + required + ' class=\"toggle toggle-round-flat\">';\r\n                /*\r\n                template = '<div class=\"checkbox\">';\r\n                template += '<span class=\"checkbox-label\">' + title + required +'</span>';\r\n                template += '<span class=\"switch\"><input id=\"' + name + '\" name=\"' + name + '\" type=\"checkbox\" ng-model=\"' + model + '\" ' + change + focus + blur + required + ' class=\"toggle toggle-round-flat\"><label for=\"' + name + '\"></label></span>';\r\n                template += '</div>';\r\n                */\r\n                break;\r\n            case 'switch':\r\n                if (attributes.disabled) {\r\n                    disabled = ' disabled=\"true\"';\r\n                }\r\n                if (attributes.ngDisabled) {\r\n                    disabled = ' disabled=\"' + attributes.ngDisabled + '\"';\r\n                }\r\n                template = '<div class=\"row control-switch\" ' + validation + '><label for=\"' + name + '\" class=\"' + colLabel + ' col-form-label\">' + title + decoration + '</label>';\r\n                template += '<div class=\"' + colInput + '\">';\r\n                template += '<switch name=\"' + name + '\" ng-model=\"' + model + '\" ' + change + focus + blur + options + ' on=\"SÃ¬\" off=\"No\" ' + required + disabled + readonly + formFocus + '></switch>';\r\n                break;\r\n            case 'range':\r\n                validate = ' validate-type=\"number\"';\r\n                var nameHi = name + 'Hi';\r\n                var formKeyHi = form + '.' + nameHi;\r\n                var modelHi = attributes.modelHi;\r\n                var validationHi = ' ng-class=\"{ \\'control-focus\\': ' + formKeyHi + '.hasFocus, \\'control-success\\': ' + formKeyHi + '.$valid, \\'control-error\\': ' + formKeyHi + '.$invalid && (' + form + '.$submitted || ' + formKeyHi + '.$touched), \\'control-empty\\': !' + formKeyHi + '.$viewValue }\"';\r\n                var requiredHi = required;\r\n                if (attributes.requiredHi == 'true') {\r\n                    requiredHi = ' required=\"true\"';\r\n                } else if (attributes.requiredHi == 'false') {\r\n                    requiredHi = '';\r\n                }\r\n                var messageHi = ' ',\r\n                    decorationHi = ' ';\r\n                if (attributes.required && attributes.requiredHi !== 'false') {\r\n                    decorationHi = attributes.readonly || attributes.disabled ? '' : '<sup>âœ½</sup>';\r\n                }\r\n                messageHi = '<span ng-messages=\"' + (attributes.readonly ? '' : '(' + form + '.$submitted || ' + formKeyHi + '.$touched) && ') + formKeyHi + '.$error\" role=\"alert\">';\r\n                messageHi = messageHi + '<span ng-message=\"required\" class=\"label-error animated flash\">obbligatorio â¤´</span>';\r\n                switch (attributes.controlRow) {\r\n                    case 'password':\r\n                        messageHi = messageHi + '<span ng-message=\"minlength\" class=\"label-error animated flash\">almeno 3 caratteri â¤´</span>';\r\n                        break;\r\n                    case 'email':\r\n                        messageHi = messageHi + '<span ng-message=\"email\" class=\"label-error animated flash\">valore non corretto â¤´</span>';\r\n                        break;\r\n                    case 'number':\r\n                    case 'range':\r\n                        messageHi = messageHi + '<span ng-message=\"positive\" class=\"label-error animated flash\">solo valori positivi â¤´</span>';\r\n                        messageHi = messageHi + '<span ng-message=\"number\" class=\"label-error animated flash\">solo valori numerici â¤´</span>';\r\n                        break;\r\n                }\r\n                if (attributes.match !== undefined) {\r\n                    messageHi = messageHi + '<span ng-message=\"match\" class=\"label-error animated flash\">non corrispondente â¤´</span>';\r\n                }\r\n                messageHi = messageHi + '</span>';\r\n                template = '<div class=\"row\"><label for=\"' + name + '\" class=\"' + colLabel + ' col-form-label\">' + title + '</label><div class=\"' + colInput + ' col-' + attributes.controlRow + '\">';\r\n                template += '<div class=\"form-control-range form-control-range-min\" ' + validation + '>' + decoration + '<input class=\"form-control\" name=\"' + name + '\" ng-model=\"' + model + '\" ' + change + focus + blur + options + ' placeholder=\"' + placeholder + '\" type=\"text\"' + required + disabled + readonly + formFocus + validate + format + precision + '>' + message + '</div>';\r\n                template += '<div class=\"form-control-range form-control-range-max\" ' + validationHi + '>' + decorationHi + '<input class=\"form-control\" name=\"' + nameHi + '\" ng-model=\"' + modelHi + '\" ' + change + focus + blur + options + ' placeholder=\"' + placeholder + '\" type=\"text\"' + requiredHi + disabled + readonly + formFocus + validate + format + precision + '>' + messageHi + '</div>';\r\n                return template + '</div></div>';\r\n                break;\r\n            case 'range-slider':\r\n                var himodel = (attributes.himodel ? ' rz-slider-high=\"' + attributes.himodel + '\" ' : '');\r\n                options = (attributes.options ? ' rz-slider-options=\"' + attributes.options + '\" ' : '');\r\n                template += '<rzslider rz-slider-model=\"' + model + '\" ' + himodel + options + '\"></rzslider>';\r\n                break;\r\n            case 'select':\r\n                var filter = (attributes.min ? ' | filter:gte(\\'' + key + '\\', ' + attributes.min + ')' : '');\r\n                var optionLabel = _format(label, 'item.', true);\r\n                var options = attributes.number ?\r\n                    'item.' + key + ' as ' + optionLabel + ' disable when item.disabled for item in ' + attributes.source + filter :\r\n                    optionLabel + ' disable when item.disabled for item in ' + attributes.source + filter + ' track by item.' + key;\r\n                template += '<select name=\"' + name + '\" class=\"form-control\" ng-model=\"' + model + '\" ' + change + focus + blur + ' ng-options=\"' + options + '\" ' + (attributes.number ? 'convert-to-number' : '') + required + disabled + '><option value=\"\" disabled selected hidden>' + placeholder + '</option></select>';\r\n                break;\r\n            case 'autocomplete':\r\n                var canCreate = (attributes.canCreate ? attributes.canCreate : false);\r\n                var flatten = (attributes.flatten ? attributes.flatten : false);\r\n                var queryable = (attributes.queryable ? attributes.queryable : false);\r\n                var onSelected = (attributes.onSelected ? ' on-selected=\"' + attributes.onSelected + '\"' : '');\r\n                template += '<input name=\"' + name + '\" ng-model=\"' + model + '\" type=\"hidden\" ' + (attributes.required ? 'required' : '') + '>';\r\n                template += '<div control-autocomplete=\"' + attributes.source + '\" model=\"' + model + '\" label=\"' + label + '\"  key=\"' + key + '\" can-create=\"' + canCreate + '\" flatten=\"' + flatten + '\" queryable=\"' + queryable + '\" placeholder=\"' + placeholder + '\" on-focus=\"' + formKey + '.hasFocus=true\" on-blur=\"' + formKey + '.hasFocus=false\"' + onSelected + '></div>';\r\n                break;\r\n            case 'textarea':\r\n                var rows = (attributes.rows ? attributes.rows : '1');\r\n                template += '<textarea name=\"' + name + '\" class=\"form-control\" ng-model=\"' + model + '\" ' + change + focus + blur + options + ' placeholder=\"' + placeholder + '\" ' + required + disabled + ' rows=\"' + rows + '\"' + formFocus + '></textarea>';\r\n                break;\r\n            case 'htmltext':\r\n                var taDisabled = '';\r\n                if (attributes.disabled) {\r\n                    taDisabled = ' ta-disabled=\"true\"';\r\n                }\r\n                if (attributes.ngDisabled) {\r\n                    taDisabled = ' ta-disabled=\"' + attributes.ngDisabled + '\"';\r\n                }\r\n                template += '<div text-angular name=\"' + name + '\" ta-paste=\"doStripHtml($html)\" ng-model=\"' + model + '\" ' + change + focus + blur + options + ' placeholder=\"' + placeholder + '\" ' + required + taDisabled + readonly + formFocus + (attributes.required ? ' ta-min-text=\"1\"' : '') + '></div>';\r\n                break;\r\n            case 'password':\r\n                template += '<div class=\"input-group\"><input name=\"' + name + '\" class=\"form-control\" ng-model=\"' + model + '\" ' + change + focus + blur + options + ' placeholder=\"' + placeholder + '\" type=\"{{form.' + name + ' ? \\'password\\' : \\'text\\'}}\" ng-minlength=\"6\" ' + required + disabled + formFocus + '><span class=\"input-group-addon\" ng-if=\"' + model + '\"><span class=\"icon-eye\" ng-click=\"form.' + name + ' = !form.' + name + '\"></span></span></div>';\r\n                break;\r\n            case 'email':\r\n                template += '<input name=\"' + name + '\" class=\"form-control\" ng-model=\"' + model + '\" ' + change + focus + blur + options + ' placeholder=\"' + placeholder + '\" type=\"email\" ' + required + disabled + formFocus + '>';\r\n                break;\r\n            case 'number-picker':\r\n                validate = ' validate-type=\"anynumber\"';\r\n                /*\r\n                var doSub = model + ' = ' + model + ' -1';\r\n                if (attributes.min) {\r\n                    validate += ' min=\"' + attributes.min + '\"';\r\n                    doSub = model + ' = Math.max(' + attributes.min + ', ' + model + ' -1)';\r\n                }\r\n                var doAdd = model + ' = ' + model + ' +1';\r\n                if (attributes.max) {\r\n                    validate += ' max=\"' + attributes.max + '\"';\r\n                    doAdd = model + ' = Math.min(' + attributes.max + ', ' + model + ' +1)';\r\n                }\r\n                template += '<div class=\"input-group\">';\r\n                template += '   <span class=\"input-group-btn\"><button class=\"btn btn-outline-primary\" type=\"button\" ng-click=\"(' + doSub + ')\">-</button></span>';\r\n                template += '   <input name=\"' + name + '\" class=\"form-control\" ng-model=\"' + model + '\" ' + change + focus + blur + options + ' placeholder=\"' + placeholder + '\" type=\"text\"' + required + disabled + readonly + formFocus + validate + format + precision + '>';\r\n                template += '   <span class=\"input-group-btn\"><button class=\"btn btn-outline-primary\" type=\"button\" ng-click=\"(' + doAdd + ')\">+</button></span>';\r\n                template += '</div>';\r\n                */\r\n                template += '<div number-picker=\"' + model + '\" min=\"' + attributes.min + '\" max=\"' + attributes.max + '\">';\r\n                template += '   <input name=\"' + name + '\" class=\"form-control\" ng-model=\"' + model + '\" ' + change + focus + blur + options + ' placeholder=\"' + placeholder + '\" type=\"text\"' + required + disabled + readonly + formFocus + validate + format + precision + '>';\r\n                template += '</div>';\r\n                break;\r\n            case 'number':\r\n                validate = ' validate-type=\"number\"';\r\n                template += '<input name=\"' + name + '\" class=\"form-control\" ng-model=\"' + model + '\" ' + change + focus + blur + options + ' placeholder=\"' + placeholder + '\" type=\"text\"' + required + disabled + readonly + formFocus + validate + format + precision + '>';\r\n                break;\r\n            case 'anynumber':\r\n                validate = ' validate-type=\"anynumber\"';\r\n                template += '<input name=\"' + name + '\" class=\"form-control\" ng-model=\"' + model + '\" ' + change + focus + blur + options + ' placeholder=\"' + placeholder + '\" type=\"text\"' + required + disabled + readonly + formFocus + validate + format + precision + '>';\r\n                break;\r\n            case 'date':\r\n                validate = ' validate-type=\"date\"';\r\n                format = ' format=\"dd-MM-yyyy\"';\r\n                if (attributes.disabled || attributes.readonly) {\r\n                    template += '<div class=\"input-group\"><input type=\"text\" class=\"form-control\" name=\"' + name + '\" ng-model=\"' + model + '\" placeholder=\"' + placeholder + '\" ' + required + disabled + readonly + formFocus + validate + format + '><span class=\"input-group-addon\"><i class=\"icon-calendar\"></i></span></div>';\r\n                } else {\r\n                    template += '<input type=\"date\" name=\"' + name + '\" class=\"form-control form-control-hidden\" is-open=\"flags.' + name + '\" ng-model=\"' + model + '\" placeholder=\"dd-MM-yyyy\" ' + required + disabled + readonly + formFocus + ' uib-datepicker-popup datepicker-options=\"sources.datepickerOptions\" datepicker-template-url=\"uib/template/datepicker/datepicker.html\" show-button-bar=\"false\" current-text=\"Oggi\" clear-text=\"Rimuovi\" close-text=\"Chiudi\">';\r\n                    template += '<div ng-click=\"(flags.' + name + ' = true)\" class=\"input-group disabled\"><input type=\"text\" class=\"form-control\" name=\"' + name + '\" ng-model=\"' + model + '\" placeholder=\"' + placeholder + '\" ' + required + disabled + readonly + formFocus + validate + format + '><span class=\"input-group-addon\"><i class=\"icon-calendar\"></i></span></div>';\r\n                }\r\n                break;\r\n                /*\r\n        case 'date':\r\n            placeholder = placeholder || 'dd-MM-yyyy';\r\n            template += '<input name=\"' + name + '\" class=\"form-control\" ng-model=\"' + model + '\" ' + change + focus + blur + options + ' placeholder=\"' + placeholder + '\" type=\"date\"' + required + disabled + readonly + formFocus + '>';\r\n            break;\r\n            */\r\n            case 'datetime-local':\r\n                placeholder = placeholder || 'dd-MM-yyyyTHH:mm:ss';\r\n                // placeholder == title ? placeholder = 'dd/MM/yyyyTHH:mm:ss' : null;\r\n                template += '<input name=\"' + name + '\" class=\"form-control\" ng-model=\"' + model + '\" ' + change + focus + blur + options + ' placeholder=\"' + placeholder + '\" type=\"datetime-local\"' + required + disabled + readonly + formFocus + '>';\r\n                break;\r\n            case 'text':\r\n            default:\r\n                template += '<input name=\"' + name + '\" class=\"form-control\" ng-model=\"' + model + '\" ' + change + focus + blur + options + ' placeholder=\"' + placeholder + '\" type=\"text\"' + required + disabled + readonly + formFocus + validate + format + precision + '>';\r\n                break;\r\n        }\r\n        return template + message + '</div></div>';\r\n    }\r\n    return {\r\n        restrict: 'A',\r\n        replace: true,\r\n        compile: function(templateElement, templateAttributes) {\r\n            return function(scope, element, attributes) {\r\n                element.html(templateFunction(templateElement, templateAttributes));\r\n                $compile(element.contents())(scope);\r\n            }\r\n        }\r\n    }\r\n}]);\r\n\r\napp.directive('numberPicker', ['$parse', '$timeout', function($parse, $timeout) {\r\n    return {\r\n        restrict: 'A',\r\n        template: '<div class=\"input-group\">' +\r\n            '   <span class=\"input-group-btn\"><button class=\"btn btn-outline-primary\" type=\"button\">-</button></span>' +\r\n            '   <div ng-transclude></div>' +\r\n            '   <span class=\"input-group-btn\"><button class=\"btn btn-outline-primary\" type=\"button\">+</button></span>' +\r\n            '</div>',\r\n        replace: true,\r\n        transclude: true,\r\n        link: function(scope, element, attributes, model) {\r\n            var node = element[0];\r\n            var nodeRemove = node.querySelectorAll('.input-group-btn > .btn')[0];\r\n            var nodeAdd = node.querySelectorAll('.input-group-btn > .btn')[1];\r\n\r\n            function onRemove(e) {\r\n                var min = $parse(attributes.min)(scope);\r\n                var getter = $parse(attributes.numberPicker);\r\n                var setter = getter.assign;\r\n                $timeout(function() {\r\n                    setter(scope, Math.max(min, getter(scope) - 1));\r\n                });\r\n                // console.log('numberPicker.onRemove', min);\r\n            }\r\n\r\n            function onAdd(e) {\r\n                var max = $parse(attributes.max)(scope);\r\n                var getter = $parse(attributes.numberPicker);\r\n                var setter = getter.assign;\r\n                $timeout(function() {\r\n                    setter(scope, Math.min(max, getter(scope) + 1));\r\n                });\r\n                // console.log('numberPicker.onAdd', max);\r\n            }\r\n\r\n            function addListeners() {\r\n                angular.element(nodeRemove).on('touchstart mousedown', onRemove);\r\n                angular.element(nodeAdd).on('touchstart mousedown', onAdd);\r\n            }\r\n\r\n            function removeListeners() {\r\n                angular.element(nodeRemove).off('touchstart mousedown', onRemove);\r\n                angular.element(nodeAdd).off('touchstart mousedown', onAdd);\r\n            }\r\n            scope.$on('$destroy', function() {\r\n                removeListeners();\r\n            });\r\n            addListeners();\r\n        }\r\n    }\r\n}]);\r\n\r\napp.directive('validateType', ['$filter', function($filter) {\r\n    return {\r\n        require: 'ngModel',\r\n        link: function(scope, element, attributes, model) {\r\n            var validateType = attributes.validateType;\r\n            var format = attributes.format || '';\r\n            var precision = attributes.precision || 2;\r\n            var focus = false;\r\n            switch (validateType) {\r\n                case 'date':\r\n                case 'datetime':\r\n                case 'datetime-local':\r\n                    model.$formatters.push(function(value) {\r\n                        if (value) {\r\n                            return $filter('date')(value, format);\r\n                        } else {\r\n                            return null;\r\n                        }\r\n                    });\r\n                    break;\r\n                case 'number':\r\n                    model.$parsers.unshift(function(value) {\r\n                        var valid = false,\r\n                            type = validateType;\r\n                        if (value !== undefined && value !== \"\") {\r\n                            valid = String(value).indexOf(Number(value).toString()) !== -1; // isFinite(value); // \r\n                            value = Number(value);\r\n                            model.$setValidity('number', valid);\r\n                            if (valid) {\r\n                                model.$setValidity('positive', value >= 0.01);\r\n                                attributes.min !== undefined ? model.$setValidity('range', value >= Number(attributes.min)) : null;\r\n                                attributes.max !== undefined ? model.$setValidity('range', value <= Number(attributes.max)) : null;\r\n                            }\r\n                            /*                             \r\n                            if (valid) {\r\n                                if (value < 0.01) {\r\n                                    valid = false;\r\n                                    type = 'positive';\r\n                                }\r\n                                if (valid && attributes.min !== undefined) {\r\n                                    valid = valid && value >= Number(attributes.min);\r\n                                    if (!valid) {\r\n                                        type = 'range';\r\n                                    }\r\n                                }\r\n                                if (valid && attributes.max !== undefined) {\r\n                                    valid = valid && value <= Number(attributes.max);\r\n                                    if (!valid) {\r\n                                        type = 'range';\r\n                                    }\r\n                                }\r\n                            }\r\n                            */\r\n                            // console.log('validateType.number', type, valid, value);\r\n                        } else {\r\n                            valid = true;\r\n                            value = Number(value);\r\n                            model.$setValidity('number', true);\r\n                            model.$setValidity('positive', true);\r\n                            attributes.min !== undefined ? model.$setValidity('range', true) : null;\r\n                            attributes.max !== undefined ? model.$setValidity('range', true) : null;\r\n                        }\r\n                        return value;\r\n                    });\r\n                    model.$formatters.push(function(value) {\r\n                        if (value) {\r\n                            return $filter('number')(value, precision) + ' ' + format;\r\n                        } else {\r\n                            return null;\r\n                        }\r\n                    });\r\n                    /*\r\n                    model.$render = function () {\r\n                        console.log('model.render', model.$modelValue);\r\n                        element[0].value = model.$modelValue ? $filter('number')(model.$modelValue, precision) + ' ' + format : ' ';\r\n                    };\r\n                    */\r\n                    break;\r\n                case 'anynumber':\r\n                    model.$parsers.unshift(function(value) {\r\n                        var valid = false,\r\n                            type = validateType;\r\n                        if (value !== undefined && value !== \"\") {\r\n                            valid = String(value).indexOf(Number(value).toString()) !== -1; // isFinite(value); // \r\n                            value = Number(value);\r\n                            model.$setValidity('number', valid);\r\n                            if (valid) {\r\n                                attributes.min !== undefined ? model.$setValidity('range', value >= Number(attributes.min)) : null;\r\n                                attributes.max !== undefined ? model.$setValidity('range', value <= Number(attributes.max)) : null;\r\n                            }\r\n                        } else {\r\n                            valid = true;\r\n                            value = Number(value);\r\n                            model.$setValidity('number', true);\r\n                            attributes.min !== undefined ? model.$setValidity('range', true) : null;\r\n                            attributes.max !== undefined ? model.$setValidity('range', true) : null;\r\n                        }\r\n                        return value;\r\n                    });\r\n                    model.$formatters.push(function(value) {\r\n                        if (value || value === 0) {\r\n                            return $filter('number')(value, precision) + ' ' + format;\r\n                        } else {\r\n                            return null;\r\n                        }\r\n                    });\r\n                    break;\r\n            }\r\n\r\n            function onFocus() {\r\n                focus = true;\r\n                if (format) {\r\n                    element[0].value = model.$modelValue || null;\r\n                    if (!model.$modelValue) {\r\n                        model.$setViewValue(null);\r\n                    }\r\n                }\r\n            }\r\n\r\n            function doBlur() {\r\n                if (format && !model.$invalid) {\r\n                    switch (validateType) {\r\n                        case 'date':\r\n                        case 'datetime':\r\n                        case 'datetime-local':\r\n                            element[0].value = model.$modelValue ? $filter('date')(model.$modelValue, format) : ' ';\r\n                            break;\r\n                        default:\r\n                            element[0].value = model.$modelValue ? $filter('number')(model.$modelValue, precision) + ' ' + format : ' ';\r\n                            break;\r\n                    }\r\n                }\r\n            }\r\n\r\n            function onBlur() {\r\n                focus = false;\r\n                doBlur();\r\n            }\r\n\r\n            function addListeners() {\r\n                element.on('focus', onFocus);\r\n                element.on('blur', onBlur);\r\n            }\r\n\r\n            function removeListeners() {\r\n                element.off('focus', onFocus);\r\n                element.off('blur', onBlur);\r\n            }\r\n            scope.$on('$destroy', function() {\r\n                removeListeners();\r\n            });\r\n            addListeners();\r\n        }\r\n    };\r\n}]);\n/* global angular, app, Autolinker */\r\n\n/* global angular, app */\r\n\r\napp.factory('State', ['$timeout', function($timeout) {\r\n    function State() {\r\n        this.isReady = false;\r\n        this.idle();\r\n    }\r\n    State.prototype = {\r\n        idle: function() {\r\n            this.isBusy = false;\r\n            this.isError = false;\r\n            this.isErroring = false;\r\n            this.isSuccess = false;\r\n            this.isSuccessing = false;\r\n            this.button = null;\r\n            this.errors = [];\r\n        },\r\n        enabled: function() {\r\n            return !this.isBusy && !this.isErroring && !this.isSuccessing;\r\n        },\r\n        busy: function() {\r\n            if (!this.isBusy) {\r\n                this.isBusy = true;\r\n                this.isError = false;\r\n                this.isErroring = false;\r\n                this.isSuccess = false;\r\n                this.isSuccessing = false;\r\n                this.errors = [];\r\n                // console.log('State.busy', this);\r\n                return true;\r\n            } else {\r\n                return false;\r\n            }\r\n        },\r\n        success: function() {\r\n            this.isBusy = false;\r\n            this.isError = false;\r\n            this.isErroring = false;\r\n            this.isSuccess = true;\r\n            this.isSuccessing = true;\r\n            this.errors = [];\r\n            $timeout(function() {\r\n                this.isSuccessing = false;\r\n                this.button = null;\r\n            }.bind(this), 1000);\r\n        },\r\n        error: function(error) {\r\n            this.isBusy = false;\r\n            this.isError = true;\r\n            this.isErroring = true;\r\n            this.isSuccess = false;\r\n            this.isSuccessing = false;\r\n            this.errors.push(error);\r\n            $timeout(function() {\r\n                this.isErroring = false;\r\n                this.button = null;\r\n            }.bind(this), 1000);\r\n        },\r\n        ready: function() {\r\n            this.isReady = true;\r\n            this.success();\r\n        },\r\n        errorMessage: function() {\r\n            return this.isError ? this.errors[this.errors.length - 1] : null;\r\n        },\r\n        submitClass: function() {\r\n            return {\r\n                busy: this.isBusy,\r\n                ready: this.isReady,\r\n                successing: this.isSuccessing,\r\n                success: this.isSuccess,\r\n                errorring: this.isErroring,\r\n                error: this.isError,\r\n            };\r\n        },\r\n        submitMessage: function(idleMessage, busyMessage, successMessage, errorMessage) {\r\n            idleMessage = idleMessage || 'Submit';\r\n            if (this.isBusy) {\r\n                return busyMessage || idleMessage;\r\n            } else if (this.isSuccess) {\r\n                return successMessage || idleMessage;\r\n            } else if (this.isError) {\r\n                return errorMessage || idleMessage;\r\n            } else {\r\n                return idleMessage;\r\n            }\r\n        },\r\n    };\r\n    return State;\r\n}]);\n/* global angular, app */\n\napp.service('Router', ['$location', function ($location) {\n\n    var service = this;\n    service.redirect = redirect;\n\n    function redirect(path) {\n        $location.$$lastRequestedPath = $location.path();\n        $location.path(path);\n    }\n\n}]);\n\napp.service('FirebaseApi', ['$q', '$location', '$firebaseAuth', '$firebaseObject', '$firebaseArray', 'LocalStorage', function ($q, $location, $firebaseAuth, $firebaseObject, $firebaseArray, storage) {\n\n    var firebase = window.firebase || null;\n    if (firebase) {\n        var config = {\n            apiKey: \"AIzaSyCskd8Cgzd_j7JzgEC3mEb4ir1qZFh6auQ\",\n            authDomain: \"starfish-c2b0f.firebaseapp.com\",\n            databaseURL: \"https://starfish-c2b0f.firebaseio.com\",\n            projectId: \"starfish-c2b0f\",\n            storageBucket: \"starfish-c2b0f.appspot.com\",\n            messagingSenderId: \"796739915579\"\n        };\n        firebase.initializeApp(config);\n    } else {\n        throw ('missing firebase.js');\n    }\n\n    var service = this;\n    service.user = undefined;\n    service.presence = undefined;\n    service.items = getUserItems;\n    service.auth = {\n        signin: signin,\n        signup: signup,\n        signout: signout,\n    };\n    service.current = current;\n    service.isLoggedOrGoTo = isLoggedOrGoTo;\n\n    function connect() {\n        var deferred = $q.defer();\n        if (service.presence) {\n            deferred.resolve(service.presence);\n        } else {\n            var auth = $firebaseAuth();\n            auth.$signInAnonymously({ remember: 'sessionOnly' }).then(function (logged) {\n                var presence = service.presence = {\n                    uid: logged.uid,\n                };\n                deferred.resolve(presence);\n            }).catch(function (error) {\n                console.log('Error', error);\n                deferred.reject(error);\n            });\n        }\n        return deferred.promise;\n    } \n    \n    function current() {\n        var deferred = $q.defer();\n        if (service.user) {\n            deferred.resolve(service.user);\n        } else {\n            var token = storage.get('token');\n            if (token) {\n                connect().then(function (p) {\n                    var root = firebase.database().ref();\n                    var usersRef = root.child('users');\n                    usersRef.orderByChild('token').equalTo(token).on('value', function (snap) {\n                        var user = service.user = firstOrDefault(snap);\n                        if (user) {\n                            storage.set('token', user.token);\n                            deferred.resolve(user);\n                        } else {\n                            deferred.reject();\n                        }\n                    });\n                }, function () {\n                    deferred.reject();\n                });\n            } else {\n                deferred.reject();\n            }\n        }\n        return deferred.promise;\n    }\n\n    function signin(model) {\n        console.log('FirebaseApi.signin', model);\n        var deferred = $q.defer();\n        if (service.user) {\n            console.log('signed', service.user);\n            deferred.resolve(service.user);\n        } else {\n            connect().then(function (presence) {\n                var root = firebase.database().ref();\n                var usersRef = root.child('users');\n                usersRef.orderByChild('email').equalTo(model.email).on('value', function (snap) {\n                    var user = service.user = firstOrDefault(snap);\n                    if (user && user.password === model.password) {\n                        storage.set('token', user.token);\n                        deferred.resolve(user);\n                    } else {\n                        deferred.reject({\n                            message: 'not found',\n                        });\n                    }\n                });\n            }, function () {\n                deferred.reject();\n            });\n        }\n        return deferred.promise;\n    }\n\n    function signup(model) {\n        console.log('FirebaseApi.signup', model);\n        var deferred = $q.defer();\n        connect().then(function (p) {\n            console.log('connected', p);\n            var root = firebase.database().ref();\n            var usersRef = root.child('users');\n            var userRef = usersRef.push();\n            model.token = service.presence.uid;\n            storage.set('token', model.token);\n            userRef.set(model);\n            service.user = model;\n            service.updateUser = function () {\n                userRef.set(model);\n            };\n            deferred.resolve(model);\n        }, function () {\n            deferred.reject();\n        });\n        return deferred.promise;\n    }\n\n    function signout() {\n        console.log('FirebaseApi.signout');\n        var deferred = $q.defer();\n        storage.delete('token');\n        service.user = null;\n        deferred.resolve();\n        return deferred.promise;\n    }\n\n    function getUserItems() {\n        return getArray('items', { token: 'token' });\n    }\n\n    function isLoggedOrGoTo(redirect) {\n        var deferred = $q.defer();\n        current().then(function (user) {\n            deferred.resolve(service.user);\n        }, function () {\n            deferred.reject();\n            $location.$$lastRequestedPath = $location.path();\n            $location.path(redirect);\n        });\n        return deferred.promise;\n    }\n\n    // UTILS\n\n    function removeRange(firebaseArray, from, to) {\n        var keys = {};\n        if (to === undefined) {\n            to = firebaseArray.length;\n        }\n        for (var i = from; i < to; ++i) {\n            keys[firebaseArray.$keyAt(i)] = null;\n        }\n        return firebaseArray.$ref().update(keys);\n    }\n\n    function queryBase(collection, query) {\n        var deferred = $q.defer();\n        var root = firebase.database().ref();\n        var ref = root.child(collection);\n        var fields = [];\n        for (var p in query) {\n            fields.push({\n                key: p,\n                value: query[p],\n            });\n        }\n        var field = fields.shift();\n        var items = [];\n        ref.orderByChild(field.key).equalTo(field.value).on('child_added', function (snap) {\n            var item = snap.val();\n            if (item) {\n                deferred.resolve(item);\n            } else {\n                deferred.reject();\n            }\n        });\n        return deferred.promise;\n    }\n\n    function getField(query) {\n        var fields = [];\n        for (var p in query) {\n            fields.push({\n                key: p,\n                value: query[p],\n            });\n        }\n        var field = null;\n        if (fields.length) {\n            field = fields.shift();\n        }\n        return field;\n    }\n\n    function getArray(collection, query, limit) {\n        var deferred = $q.defer();\n        var root = firebase.database().ref();\n        var ref = root.child(collection);\n        var array = null;\n        if (query) {\n            var field = getField(query);\n            if (field) {\n                var queryRef = ref.orderByChild(field.key).equalTo(field.value);\n                if (limit) {\n                    queryRef = queryRef.limitToLast(limit);\n                }\n                array = $firebaseArray(queryRef);\n            }\n        }\n        array = array || $firebaseArray(ref);\n        array.$loaded(function (array) {\n            deferred.resolve(array);\n        }, function (error) {\n            deferred.reject(error);\n        });\n        return deferred.promise;\n    }\n\n    function firstOrDefault(snap) {\n        var item = null;\n        if (snap.numChildren()) {\n            var items = snap.val();\n            var keys = Object.keys(items);\n            item = items[keys[0]];\n        }\n        return item;\n    }\n\n    /*\n\n    this.presences = {\n        getPresences: function () {\n            var deferred = $q.defer();\n            var user = service.user;\n            var root = service.root = firebase.database().ref();\n            var presencesRef = root.child('presences');\n            var userRef = presencesRef.push();\n            var connectedRef = root.child('.info/connected');\n            connectedRef.on('value', function (snap) {\n                if (snap.val()) {\n                    userRef.onDisconnect().remove();\n                    userRef.set(user);\n                    service.updateUser = function () {\n                        userRef.set(user);\n                    };\n                    deferred.resolve();\n                }\n            });\n            presencesRef.on('value', function (snap) {\n                // console.log('# of online users = ', snap.numChildren());\n                var presences = snap.val(),\n                    items = [];\n                for (var key in presences) {\n                    var user = presences[key];\n                    if (user.id !== service.user.id) {\n                        items.push(user);\n                    }\n                }\n                if (items.length) {\n                    service.options.onPresences(items);\n                }\n            });\n            service.presences = $firebaseArray(presencesRef);\n            return deferred.promise;\n        },\n    };\n\n    this.activities = {\n        clearActivities: function () {\n            var min = Number.POSITIVE_INFINITY;\n            angular.forEach(service.presences, function (presence) {\n                min = Math.min(presence.timestamp, min);\n            });\n            var activities = service.activities;\n            var from = 0,\n                to = 0;\n            angular.forEach(activities, function (item, index) {\n                if (item.timestamp < min) {\n                    to = index + 1;\n                }\n            });\n            removeRange(activities, from, to);\n        },\n        addActivities: function (items) {\n            if (items && items.length) {\n                var user = service.user;\n                var root = service.root; // firebase.database().ref();\n                var lastActivity = null;\n                var activitiesRef = root.child('activities');\n                angular.forEach(items, function (item) {\n                    item.userId = user.id;\n                    item.timestamp = Date.now();\n                    lastActivity = item;\n                    var activityRef = activitiesRef.push();\n                    activityRef.set(item);\n                });\n                if (lastActivity) {\n                    user.lastActivity = lastActivity;\n                    service.updateUser();\n                }\n            }\n        },\n        getUniqueActivities: function (items) {\n            items.sort(function (a, b) {\n                return b.timestamp - a.timestamp; // desc\n            });\n            var pool = {};\n            items = items.filter(function (item) {\n                if (!pool[item.id]) {\n                    return (pool[item.id] = true);\n                } else {\n                    return false;\n                }\n            });\n            items.sort(function (a, b) {\n                return a.timestamp - b.timestamp; // asc\n            });\n            return items;\n        },\n        getActivities: function () {\n            var deferred = $q.defer();\n            var root = service.root; // firebase.database().ref();\n            var activitiesRef = root.child('activities');\n            var user = service.user;\n            var lastDate = user.timestamp;\n            activitiesRef.on('value', function (snap) {\n                var activities = snap.val(),\n                    items = [];\n                var max = Number.NEGATIVE_INFINITY;\n                for (var key in activities) {\n                    var activity = activities[key];\n                    max = Math.max(max, activity.timestamp);\n                    if (activity.userId !== service.user.id && activity.timestamp > lastDate) {\n                        items.push(activity);\n                    }\n                }\n                lastDate = Math.max(lastDate, max);\n                items = service.getUniqueActivities(items);\n                if (items.length) {\n                    service.options.onActivities(items);\n                }\n            });\n            var activities = service.activities = $firebaseArray(activitiesRef);\n            activities.$loaded().then(function () {\n                service.clearActivities();\n                deferred.resolve();\n            }).catch(function (error) {\n                deferred.reject(error);\n            });\n            return deferred.promise;\n        },\n    };\n\n    */\n}]);\n\napp.service('WebApi', ['$http', '$q', '$timeout', '$location', function ($http, $q, $timeout, $location) {\n\n    var service = this;\n\n    var _get = this.get = function (url, params) {\n        var deferred = $q.defer();\n        $http.get(url, { params: params }).then(function (response) {\n            deferred.resolve(response.data);\n        }, function (response) {\n            onError(deferred, 'get', url, { params: params }, response);\n        });\n        return deferred.promise;\n    };\n    var _post = this.post = function (url, model) {\n        var deferred = $q.defer();\n        if (service.DEBUG) {\n            console.log('Api.DEBUG', url, model);\n            deferred.resolve(model);\n        } else {\n            $http.post(url, model).then(function (response) {\n                deferred.resolve(response.data);\n            }, function (response) {\n                onError(deferred, 'post', url, model, response);\n            });\n        }\n        return deferred.promise;\n    };\n    var _put = this.put = function (url, model) {\n        var deferred = $q.defer();\n        $http.put(url, model).then(function (response) {\n            deferred.resolve(response.data);\n        }, function (response) {\n            onError(deferred, 'put', url, model, response);\n        });\n        return deferred.promise;\n    };\n    var _patch = this.patch = function (url, model) {\n        var deferred = $q.defer();\n        $http.patch(url, model).then(function (response) {\n            deferred.resolve(response.data);\n        }, function (response) {\n            onError(deferred, 'patch', url, model, response);\n        });\n        return deferred.promise;\n    };\n    var _delete = this.delete = function (url) {\n        var deferred = $q.defer();\n        $http.delete(url).then(function (response) {\n            deferred.resolve(response.data);\n        }, function (response) {\n            onError(deferred, 'delete', url, null, response);\n        });\n        return deferred.promise;\n    };\n    var _blob = this.blob = function (url, model) {\n        var deferred = $q.defer();\n        if (service.DEBUG) {\n            console.log('Api.DEBUG', url, model);\n            deferred.resolve(model);\n        } else {\n            $http({\n                url: url,\n                method: \"POST\",\n                data: model,\n                headers: {\n                    'Content-type': 'application/json'\n                },\n                responseType: 'arraybuffer',\n            }).then(function (response) {\n                deferred.resolve(response);\n            }, function (response) {\n                onError(deferred, 'post', url, model, response);\n            });\n        }\n        return deferred.promise;\n    };\n\n    this.auth = {\n        signin: _service.signin,\n        // return _post('/api/auth/login', model);\n        signout: function (userId) {\n            // return _get('/api/auth/logout/' + userId);\n        },\n        current: function () {\n            var deferred = $q.defer();\n            if (_service.user) {\n                deferred.resolve(_service.user);\n            } else {\n                deferred.reject();\n            }\n            return deferred.promise;\n            // return _get('/api/auth/current/');\n        },\n    };\n\n}]);\n\napp.factory('Cookie', ['$q', '$window', function ($q, $window) {\n    function Cookie() { }\n    Cookie.TIMEOUT = 5 * 60 * 1000; // five minutes\n    Cookie._set = function (name, value, days) {\n        var expires;\n        if (days) {\n            var date = new Date();\n            date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));\n            expires = '; expires=' + date.toGMTString();\n        } else {\n            expires = '';\n        }\n        $window.document.cookie = name + '=' + value + expires + '; path=/';\n    };\n    Cookie.set = function (name, value, days) {\n        try {\n            var cache = [];\n            var json = JSON.stringify(value, function (key, value) {\n                if (key === 'pool') {\n                    return;\n                }\n                if (typeof value === 'object' && value !== null) {\n                    if (cache.indexOf(value) !== -1) {\n                        // Circular reference found, discard key\n                        return;\n                    }\n                    cache.push(value);\n                }\n                return value;\n            });\n            cache = null;\n            Cookie._set(name, json, days);\n        } catch (e) {\n            console.log('Cookie.set.error serializing', name, value, e);\n        }\n    };\n    Cookie.get = function (name) {\n        var cookieName = name + \"=\";\n        var ca = $window.document.cookie.split(';');\n        for (var i = 0; i < ca.length; i++) {\n            var c = ca[i];\n            while (c.charAt(0) == ' ') {\n                c = c.substring(1, c.length);\n            }\n            if (c.indexOf(cookieName) === 0) {\n                var value = c.substring(cookieName.length, c.length);\n                var model = null;\n                try {\n                    model = JSON.parse(value);\n                } catch (e) {\n                    console.log('Cookie.get.error parsing', key, e);\n                }\n                return model;\n            }\n        }\n        return null;\n    };\n    Cookie.delete = function (name) {\n        Cookie._set(name, \"\", -1);\n    };\n    Cookie.on = function (name) {\n        var deferred = $q.defer();\n        var i, interval = 1000,\n            elapsed = 0,\n            timeout = Cookie.TIMEOUT;\n\n        function checkCookie() {\n            if (elapsed > timeout) {\n                deferred.reject('timeout');\n            } else {\n                var c = Cookie.get(name);\n                if (c) {\n                    deferred.resolve(c);\n                } else {\n                    elapsed += interval;\n                    i = setTimeout(checkCookie, interval);\n                }\n            }\n        }\n        checkCookie();\n        return deferred.promise;\n    };\n    return Cookie;\n}]);\n\napp.factory('LocalStorage', ['$q', '$window', 'Cookie', function ($q, $window, Cookie) {\n    function LocalStorage() { }\n\n    function isLocalStorageSupported() {\n        var supported = false;\n        try {\n            supported = 'localStorage' in $window && $window.localStorage !== null;\n            if (supported) {\n                $window.localStorage.setItem('test', '1');\n                $window.localStorage.removeItem('test');\n            } else {\n                supported = false;\n            }\n        } catch (e) {\n            supported = false;\n        }\n        return supported;\n    }\n    LocalStorage.isSupported = isLocalStorageSupported();\n    if (LocalStorage.isSupported) {\n        LocalStorage.set = function (name, value) {\n            try {\n                var cache = [];\n                var json = JSON.stringify(value, function (key, value) {\n                    if (key === 'pool') {\n                        return;\n                    }\n                    if (typeof value === 'object' && value !== null) {\n                        if (cache.indexOf(value) !== -1) {\n                            // Circular reference found, discard key\n                            return;\n                        }\n                        cache.push(value);\n                    }\n                    return value;\n                });\n                cache = null;\n                $window.localStorage.setItem(name, json);\n            } catch (e) {\n                console.log('LocalStorage.set.error serializing', name, value, e);\n            }\n        };\n        LocalStorage.get = function (name) {\n            var value = null;\n            if ($window.localStorage[name] !== undefined) {\n                try {\n                    value = JSON.parse($window.localStorage[name]);\n                } catch (e) {\n                    console.log('LocalStorage.get.error parsing', name, e);\n                }\n            }\n            return value;\n        };\n        LocalStorage.delete = function (name) {\n            $window.localStorage.removeItem(name);\n        };\n        LocalStorage.on = function (name) {\n            var deferred = $q.defer();\n            var i, timeout = Cookie.TIMEOUT;\n\n            function storageEvent(e) {\n                // console.log('LocalStorage.on', name, e);\n                clearTimeout(i);\n                if (e.originalEvent.key == name) {\n                    try {\n                        var value = JSON.parse(e.originalEvent.newValue); // , e.originalEvent.oldValue\n                        deferred.resolve(value);\n                    } catch (error) {\n                        console.log('LocalStorage.on.error parsing', name, error);\n                        deferred.reject('error parsing ' + name);\n                    }\n                }\n            }\n            angular.element($window).on('storage', storageEvent);\n            i = setTimeout(function () {\n                deferred.reject('timeout');\n            }, timeout);\n            return deferred.promise;\n        };\n    } else {\n        console.log('LocalStorage.unsupported switching to cookies');\n        LocalStorage.set = Cookie.set;\n        LocalStorage.get = Cookie.get;\n        LocalStorage.delete = Cookie.delete;\n        LocalStorage.on = Cookie.on;\n    }\n    return LocalStorage;\n}]);\n\napp.factory('SessionStorage', ['$q', '$window', 'Cookie', function ($q, $window, Cookie) {\n    function SessionStorage() { }\n\n    function isSessionStorageSupported() {\n        var supported = false;\n        try {\n            supported = 'sessionStorage' in $window && $window.sessionStorage !== undefined;\n            if (supported) {\n                $window.sessionStorage.setItem('test', '1');\n                $window.sessionStorage.removeItem('test');\n            } else {\n                supported = false;\n            }\n        } catch (e) {\n            supported = false;\n        }\n        return supported;\n    }\n    SessionStorage.isSupported = isSessionStorageSupported();\n    if (SessionStorage.isSupported) {\n        SessionStorage.set = function (name, value) {\n            try {\n                var cache = [];\n                var json = JSON.stringify(value, function (key, value) {\n                    if (key === 'pool') {\n                        return;\n                    }\n                    if (typeof value === 'object' && value !== null) {\n                        if (cache.indexOf(value) !== -1) {\n                            // Circular reference found, discard key\n                            return;\n                        }\n                        cache.push(value);\n                    }\n                    return value;\n                });\n                cache = null;\n                $window.sessionStorage.setItem(name, json);\n            } catch (e) {\n                console.log('SessionStorage.set.error serializing', name, value, e);\n            }\n        };\n        SessionStorage.get = function (name) {\n            var value = null;\n            if ($window.sessionStorage[name] !== undefined) {\n                try {\n                    value = JSON.parse($window.sessionStorage[name]);\n                } catch (e) {\n                    console.log('SessionStorage.get.error parsing', name, e);\n                }\n            }\n            return value;\n        };\n        SessionStorage.delete = function (name) {\n            $window.sessionStorage.removeItem(name);\n        };\n        SessionStorage.on = function (name) {\n            var deferred = $q.defer();\n            var i, timeout = Cookie.TIMEOUT;\n\n            function storageEvent(e) {\n                // console.log('SessionStorage.on', name, e);\n                clearTimeout(i);\n                if (e.originalEvent.key === name) {\n                    try {\n                        var value = JSON.parse(e.originalEvent.newValue); // , e.originalEvent.oldValue\n                        deferred.resolve(value);\n                    } catch (error) {\n                        console.log('SessionStorage.on.error parsing', name, error);\n                        deferred.reject('error parsing ' + name);\n                    }\n                }\n            }\n            angular.element($window).on('storage', storageEvent);\n            i = setTimeout(function () {\n                deferred.reject('timeout');\n            }, timeout);\n            return deferred.promise;\n        };\n    } else {\n        console.log('SessionStorage.unsupported switching to cookies');\n        SessionStorage.set = Cookie.set;\n        SessionStorage.get = Cookie.get;\n        SessionStorage.delete = Cookie.delete;\n        SessionStorage.on = Cookie.on;\n    }\n    return SessionStorage;\n}]);"]}