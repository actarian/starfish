!function(){"use strict";angular.module("app",["ngRoute","ngMessages","ui.bootstrap","mapboxgl-directive","firebase","jsonFormatter"])}(),function(){"use strict";angular.module("app").config(["$httpProvider",function(t){}])}(),function(){"use strict";angular.module("app").config(["$routeProvider","$locationProvider",function(t,e){t.when("/",{title:"Homepage",templateUrl:"partials/home.html",controller:"HomeCtrl"}).when("/profile",{title:"Profile",templateUrl:"partials/profile.html",controller:"ProfileCtrl",resolve:{user:["FirebaseApi",function(t){return t.isLoggedOrGoTo("/signin")}]}}).when("/signin",{title:"Accedi",templateUrl:"partials/signin.html",controller:"SigninCtrl"}).when("/signup",{title:"Registrazione",templateUrl:"partials/signup.html",controller:"SignupCtrl"}).when("/dashboard",{title:"Dashboard",templateUrl:"partials/dashboard.html",controller:"DashboardCtrl",resolve:{user:["FirebaseApi",function(t){return t.isLoggedOrGoTo("/signin")}]}}).when("/user/:userId",{title:"User",templateUrl:"partials/user.html",controller:"UserCtrl",resolve:{user:["FirebaseApi",function(t){return t.isLoggedOrGoTo("/signin")}]}}).when("/404",{title:"Error 404",templateUrl:"partials/404"}),t.otherwise("/"),e.html5Mode(!1),e.hashPrefix("")}])}(),function(){"use strict";angular.module("app").service("FirebaseApi",["$q","$firebaseAuth","$firebaseObject","$firebaseArray","LocalStorage","Router",function(t,e,n,r,o,i){function s(){var n=t.defer();return x.presence?n.resolve(x.presence):e().$signInAnonymously({remember:"sessionOnly"}).then(function(t){var e=x.presence={uid:t.uid};n.resolve(e)}).catch(function(t){console.log("Error",t),n.reject(t)}),n.promise}function a(){var e=t.defer();if(x.user)e.resolve(x.user);else{var n=o.get("token");n?s().then(function(t){d("users",{token:n}).then(function(t){x.user=t,e.resolve(t)},function(t){e.reject(t)})},function(t){e.reject(t)}):e.reject({message:"not logged"})}return e.promise}function c(e){console.log("FirebaseApi.signin",e);var n=t.defer();return x.user?(console.log("signed",x.user),n.resolve(x.user)):s().then(function(t){d("users",{email:e.email}).then(function(t){t.password===e.password?(o.set("token",t.token),x.user=t,n.resolve(t)):n.reject({message:"not found"})},function(t){n.reject(t)})},function(t){n.reject(t)}),n.promise}function u(e){console.log("FirebaseApi.signup",e);var n=t.defer();return s().then(function(t){e.token=t.uid,y("users",e).then(function(t){o.set("token",t.token),x.user=t,n.resolve(t)},function(t){n.reject(t)})},function(t){n.reject(t)}),n.promise}function l(){console.log("FirebaseApi.signout");var e=t.defer();return o.delete("token"),x.user=null,e.resolve(),e.promise}function h(){return v("items",{token:"token"})}function f(e){var n=t.defer();return a().then(function(t){n.resolve(x.user)},function(){n.reject(),i.redirect(e)}),n.promise}function p(e){console.log("userSave",e);var n=t.defer();return e.$save().then(function(t){n.resolve(e)},function(t){console.log("userSave",t),n.reject(t)}),n.promise}function g(t){var e=[];for(var n in t)e.push({key:n,value:t[n]});var r=null;return e.length&&(r=e.shift()),r}function d(e,n,r){var o=t.defer();return v(e,n,r).then(function(t){if(1===t.length){var n=t[0].$id;m(e,n).then(function(t){o.resolve(t)},function(t){o.reject()})}else o.reject()},function(t){o.reject(t)}),o.promise}function m(t,e){var r=b.database().ref(),o=r.child(t).child(e);return n(o).$loaded()}function v(t,e,n){var o=b.database().ref(),i=o.child(t),s=i;if(e){var a=g(e);a&&(s=i.orderByChild(a.key).equalTo(a.value),n&&(s=s.limitToLast(n)))}return r(s).$loaded()}function y(t,e){var r=b.database().ref(),o=r.child(t),i=o.push();return i.set(e),n(i).$loaded()}var b=window.firebase||null;if(!b)throw"missing firebase.js";var w={apiKey:"AIzaSyCskd8Cgzd_j7JzgEC3mEb4ir1qZFh6auQ",authDomain:"starfish-c2b0f.firebaseapp.com",databaseURL:"https://starfish-c2b0f.firebaseio.com",projectId:"starfish-c2b0f",storageBucket:"starfish-c2b0f.appspot.com",messagingSenderId:"796739915579"};b.initializeApp(w);var x=this;x.user=void 0,x.presence=void 0,x.items=h,x.auth={signin:c,signup:u,signout:l},x.users={save:p},x.current=a,x.isLoggedOrGoTo=f}])}(),function(){"use strict";var t=angular.module("app");t.controller("RootCtrl",["$scope","$location","FirebaseApi",function(t,e,n){t.api=n,t.signout=function(){console.log(n),n.auth.signout().then(function(){e.path("/")})},n.current().then(function(e){t.user=e,console.log(e)},function(t){console.log("RootCtrl.error",t)})}]),t.controller("HomeCtrl",["$scope","State","FirebaseApi",function(t,e,n){(t.state=new e).ready()}]),t.controller("ProfileCtrl",["$scope","State","FirebaseApi","user",function(t,e,n,r){var o=t.state=new e,i=t.MODES={BEACH:1,PRICES:2,PLACE:3,OPENING:4,INFO:5},s=(t.mode=i.BEACH,t.model={shopName:r.shopName,address:r.address,number:r.number,postalCode:r.postalCode,locality:r.locality,city:r.city,province:r.province,region:r.region,country:r.country,position:r.position}),a=(t.map={},t.beach=r.beach||{items:[],cols:0,rows:0});t.controls={};t.submit=function(){o.busy()&&(angular.forEach(s,function(t,e){t?r[e]=t:delete r[e]}),r.beach=a,n.users.save(r).then(function(t){console.log("response",t),o.success()},function(t){o.error(t)}))},t.saveItems=function(){t.submit()}}]),t.controller("DashboardCtrl",["$scope","State","FirebaseApi","user",function(t,e,n,r){(t.state=new e).ready(),n.items().then(function(e){console.log("DashboardCtrl.items",e),t.items=e})}]),t.controller("SigninCtrl",["$scope","State","Router","FirebaseApi",function(t,e,n,r){var o=t.state=new e,i=t.model={};t.submit=function(){o.busy()&&r.auth.signin(i).then(function(t){o.success(),n.retry("/dashboard")},function(t){console.log("SigninCtrl.error",t),o.error(t)})}}]),t.controller("SignupCtrl",["$scope","State","Router","FirebaseApi",function(t,e,n,r){var o=t.state=new e,i=t.model={};t.submit=function(){o.busy()&&r.auth.signup(i).then(function(t){o.success(),n.retry("/dashboard")},function(t){console.log("SignupCtrl.error",t),o.error(t)})}}])}(),function(){"use strict";angular.module("app").directive("beach",["$http","$timeout","Painter","Palette","Rect","Events","Hash",function(t,e,n,r,o,i,s){function a(t,o,s,a){function c(t,e){var n=j;M?n.setFill(n.colors.white):n.setFill(n.colors.grey),n.ctx.beginPath(),n.ctx.arc(t,e,6,0,2*Math.PI,!1),n.ctx.fill()}function u(t,e){var n=.4*R.w,r=j;r.ctx.beginPath(),r.ctx.moveTo(t+n*Math.cos(0),e+n*Math.sin(0));for(var o=1;o<=7;o++)r.ctx.lineTo(t+n*Math.cos(2*o*Math.PI/7),e+n*Math.sin(2*o*Math.PI/7));r.ctx.fill()}function l(t,e){var n={x:(t-T.x)/I.w,y:(e-T.y)/I.h};t+=R.w*n.x*.75,e+=R.h*n.y*.75;var r=j;r.setFill(r.colors.greyLight),u(t,e)}function h(t,e){var n=j;n.setFill(n.colors.blue),u(t,e)}function f(){var t=j;t.clear(),z.pattern(t,"bg",0,0,t.rect.w,t.rect.h),angular.forEach(O,function(t){l(t.x*R.w+R.w2,t.y*R.h+R.h2)}),angular.forEach(O,function(t){h(t.x*R.w+R.w2,t.y*R.h+R.h2)}),E&&c(E.x*R.w+R.w2,E.y*R.h+R.h2)}function p(t){O.push({x:t.x,y:t.y})}function g(t){for(var e,n=-1,r=0,o=O.length;r<o;)e=O[r],e.x===t.x&&e.y===t.y&&(n=r,r=o),r++;return n}function d(t){O.splice(t,1)}function m(t){var e=g(t);return-1!==e?d(e):p(t),e}function v(){M=null,angular.forEach(O,function(t){t.x===E.x&&t.y===E.y&&(M=t)}),f()}function y(){var t={},e={},n=0,r=0;angular.forEach(O,function(o){t[o.x]||(t[o.x]=!0,n++),e[o.y]||(e[o.y]=!0,r++)}),P.cols=n,P.rows=r}function b(){e(function(){y()})}function w(t){var e=t.relative,n={x:Math.floor(e.x/R.w),y:Math.floor(e.y/R.h)};$=!0,C=m(n),v(),b()}function x(t){var e=t.relative;if(T={x:e.x,y:e.y},E={x:Math.floor(e.x/R.w),y:Math.floor(e.y/R.h)},$){var n=g(E);-1===C&&-1===n?p(E):C>=0&&-1!==n&&d(n)}v()}function k(t){$&&($=!1,b())}function S(t){var e=o[0].offsetWidth,n=o[0].offsetHeight;I.w=e,I.h=n,f()}var E,M,$,C,T={x:0,y:0},I={w:0,h:0},R={w:40,h:40,w2:20,h2:20},P=t.beach,A=t.controls,O=P.items,j=new n(o[0]),z=new r;z.add("bg",R.w,R.h,function(t,e){t.setFill(t.colors.greyLight),t.ctx.beginPath(),t.ctx.arc(e.center().x,e.center().y,5,0,2*Math.PI,!1),t.ctx.fill()}),A.setCenter=function(){if(P.rows&&P.cols){var t=Math.floor(I.w/R.w),e=Math.floor(I.h/R.h),n=Number.POSITIVE_INFINITY,r=Number.POSITIVE_INFINITY;angular.forEach(O,function(t){n=Math.min(n,t.x),r=Math.min(r,t.y)});var o=Math.max(0,Math.floor((t-P.cols)/2)-1),i=Math.max(0,Math.floor((e-P.rows)/2)-1);angular.forEach(O,function(t){t.x=o+(t.x-n),t.y=i+(t.y-r)})}console.log("setCenter",P.rows,P.cols),f()};var L={down:w,move:x,up:k,resize:S},F=new i(o);F.add(L),t.$on("$destroy",function(){F.remove(L)}),S(),e(function(){f()})}return{restrict:"A",link:a}}])}(),function(){"use strict";var t=angular.module("app");t.directive("mapbox",["$http","$timeout","GoogleMaps",function(t,e,n){function r(t,r,o,i){function s(){w=c();var e=new mapboxgl.Map({container:r[0],style:"mapbox://styles/mapbox/streets-v9",interactive:!0,logoPosition:"bottom-right",center:[w.lng,w.lat],zoom:9});return x=e.getCanvasContainer(),e.on("mousedown",p),t.map.setAddress=function(e){console.log("setAddress",e),angular.extend(t.model,e),t.map.results=null,w=c(e.position),f()},t.map.search=function(){t.map.results=null,u(t.map.address)},e}function a(){var t=document.createElement("div");t.id="point",t.className="marker";var e=new mapboxgl.Marker(t,{offset:[-10,-10]}).setLngLat([w.lng,w.lat]).addTo(v),n=angular.element(t);return n.on("mouseenter",function(t){x.style.cursor="move",S=!0,v.dragPan.disable()}),n.on("mouseleave",function(t){x.style.cursor="",S=!1,v.dragPan.enable()}),e}function c(e,n){return w=t.model.position||{},e&&n?(w.lat=w.lat||0,w.lng=w.lng||0):(w.lat=w.lat||0,w.lng=w.lng||0,0===w.lat&&0===w.lng&&h()),w}function u(r){b.geocode({address:r},function(r,o){e(function(){"OK"===o?t.map.results=n.parse(r):alert("Geocode was not successful for the following reason: "+o)})})}function l(r){b.geocode({location:r},function(r,o){e(function(){"OK"===o?t.map.results=n.parse(r):console.log("Geocoder failed due to: "+o)})})}function h(){navigator.geolocation?navigator.geolocation.getCurrentPosition(function(t){e(function(){w=c(t.coords.latitude,t.coords.longitude),f(),l(w)})},function(t){console.log("error",t)}):console.log("error","Browser doesn't support Geolocation")}function f(){y.setLngLat([w.lng,w.lat]),v.flyTo({center:[parseFloat(w.lng),parseFloat(w.lat)],zoom:15,speed:1.5,curve:1})}function p(){S&&(k=!0,x.style.cursor="grab",v.on("mousemove",g),v.once("mouseup",d))}function g(t){if(k){var e=t.lngLat;x.style.cursor="grabbing",y.setLngLat([e.lng,e.lat])}}function d(t){if(k){l(t.lngLat),x.style.cursor="",k=!1,v.off("mousemove",g)}}function m(){v=s(),y=a()}var v,y,b,w,x,k,S;n.geocoder().then(function(t){b=t,m()})}if(mapboxgl)return mapboxgl.accessToken="pk.eyJ1IjoiYWN0YXJpYW4iLCJhIjoiY2lqNWU3MnBzMDAyZndnbTM1cjMyd2N2MiJ9.CbuEGSvOAfIYggQv854pRQ",{restrict:"E",link:r}}]),t.service("GoogleMaps",["$q","$http",function(t,e){function n(){var e=t.defer();if(a)e.resolve(window.google.maps);else{window.googleMapsInit=function(){e.resolve(window.google.maps),window.googleMapsInit=null};var n=document.createElement("script");n.setAttribute("async",null),n.setAttribute("defer",null),n.setAttribute("src","https://maps.googleapis.com/maps/api/js?key="+s+"&callback=googleMapsInit"),document.body.appendChild(n)}return e.promise}function r(){var e=t.defer();return n().then(function(t){var n=new t.Geocoder;e.resolve(n)},function(t){e.reject(t)}),e.promise}function o(t,e){var n={street:"route",number:"street_number",locality:"locality",postalCode:"postal_code",city:"administrative_area_level_3",province:"administrative_area_level_2",region:"administrative_area_level_1",country:"country"},r=null;return angular.forEach(e.address_components,function(e){angular.forEach(e.types,function(o){o===n[t]&&(r=e.long_name)})}),r}function i(t){var e=null;return t.length&&(e=t.filter(function(t){return"ROOFTOP"===t.geometry.location_type||"RANGE_INTERPOLATED"===t.geometry.location_type||"GEOMETRIC_CENTER"===t.geometry.location_type}).map(function(t){return{name:t.formatted_address,street:o("street",t),number:o("number",t),locality:o("locality",t),postalCode:o("postalCode",t),city:o("city",t),province:o("province",t),region:o("region",t),country:o("country",t),position:{lng:t.geometry.location.lng(),lat:t.geometry.location.lat()}}})),console.log("googleMaps.parse",t,e),e}var s="AIzaSyAYuhIEO-41YT_GdYU6c1N7DyylT_OcMSY",a=!1;this.maps=n,this.geocoder=r,this.parse=i}])}(),function(){"use strict";var t=angular.module("app");t.factory("Rect",[function(){function t(t,e,n,r){this.x=t||0,this.y=e||0,this.w=n||0,this.h=r||0}return t.mult=function(t,e){return t.x*=e,t.y*=e,t.w*=e,t.h*=e,t},t.prototype={mult:function(e){return t.mult(this,e)},offset:function(t,e){return this.x+=t,this.y+=e,this},reduce:function(t){return this.offset(-t)},reduceRect:function(e){return this.offsetRect(t.mult(e,-1))},expandRect:function(t){return this.x-=t.x||0,this.y-=t.y||0,this.w+=t.w||0,this.h+=t.h||0,this},expand:function(t){return this.expandRect({x:t,y:t,w:2*t,h:2*t})},intersect:function(t){var e=this.x,n=this.y,r=this.w,o=this.h;return!(t.x>e+r||t.x+t.w<e||t.y>n+o||t.y+t.h<n)},top:function(){var t=this.x,e=this.y,n=this.w;this.h;return{x:t+n/2,y:e}},right:function(){var t=this.x,e=this.y;return{x:t+this.w,y:e+this.h/2}},bottom:function(){var t=this.x,e=this.y;return{x:t+this.w/2,y:e+this.h}},left:function(){var t=this.x,e=this.y;this.w;return{x:t,y:e+this.h/2}},center:function(){var t=this.x,e=this.y;return{x:t+this.w/2,y:e+this.h/2}},topLeft:function(){var t=this.x,e=this.y;this.w,this.h;return{x:t,y:e}},topRight:function(){var t=this.x,e=this.y,n=this.w;this.h;return{x:t+n,y:e}},bottomRight:function(){var t=this.x,e=this.y;return{x:t+this.w,y:e+this.h}},bottomLeft:function(){var t=this.x,e=this.y;this.w;return{x:t,y:e+this.h}},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setW:function(t){return this.w=t,this},setH:function(t){return this.h=t,this},setPos:function(t,e){return this.x=t,this.y=e,this},setSize:function(t,e){return this.w=t,this.h=e,this},copy:function(t){return this.x=t.x,this.y=t.y,this.w=t.w,this.h=t.h,this},clone:function(){return new t(this.x,this.y,this.w,this.h)},toString:function(){return"{"+this.x+","+this.y+","+this.w+","+this.h+"}"}},t}]),t.factory("Color",[function(){function t(t,e,n,r){if(arguments.length>1)this.r=t||0===t?t:0,this.g=e||0===e?e:0,this.b=n||0===n?n:0,this.a=r||0===r?r:255;else{var o=t||"0xffffff";o=parseInt(o),t.length>8?(this.r=o>>24&255,this.g=o>>16&255,this.b=o>>8&255,this.a=o>>0&255):(this.r=o>>16&255,this.g=o>>8&255,this.b=o>>0&255,this.a=255)}}return t.componentToHex=function(t){var e=t.toString(16);return 1==e.length?"0"+e:e},t.luma=function(t){return t.dot({r:95,g:100,b:60})},t.contrast=function(e){return new t(t.luma(e)>.6?"0x000000":"0xffffff")},t.darker=function(e,n,r){return r=r||0,new t(Math.max(Math.floor(e.r*r),Math.floor(e.r-255*n)),Math.max(Math.floor(e.g*r),Math.floor(e.g-255*n)),Math.max(Math.floor(e.b*r),Math.floor(e.b-255*n)),e.a)},t.lighter=function(e,n,r){return r=r||1,new t(Math.min(e.r+Math.floor((255-e.r)*r),Math.floor(e.r+255*n)),Math.min(e.g+Math.floor((255-e.g)*r),Math.floor(e.g+255*n)),Math.min(e.b+Math.floor((255-e.b)*r),Math.floor(e.b+255*n)),e.a)},t.prototype={toUint:function(){return(this.r<<24)+(this.g<<16)+(this.b<<8)+this.a},toHex:function(){return"#"+t.componentToHex(this.r)+t.componentToHex(this.g)+t.componentToHex(this.b)+t.componentToHex(this.a)},toRgba:function(){return"rgba("+this.r+","+this.g+","+this.b+","+(this.a/255).toFixed(3)+")"},dot:function(t){return this.r/255*(t.r/255)+this.g/255*(t.g/255)+this.b/255*(t.b/255)},alpha:function(t,e,n){return e=e||0,n=n||1,this.a=Math.floor(255*(e+t*(n-e))),this},makeSet:function(){return this.foreground=t.contrast(this),this.border=t.darker(this,.3),this.light=t.lighter(this,.3),this}},t}]),t.factory("Shape",[function(){function t(){}return t.shapeCircle=function(t,e,n,r,o,i){o=o||0,i=i||2*Math.PI,t.ctx.arc(e,n,r,o,i,!1)},t.shapeStar=function(t,e,n,r,o,s){var a,c,u=Math.PI/2*3,l=Math.PI/s,h=t.ctx;for(h.moveTo(e,n-r),i=0;i<s;i++)a=e+Math.cos(u)*r,c=n+Math.sin(u)*r,h.lineTo(a,c),u+=l,a=e+Math.cos(u)*o,c=n+Math.sin(u)*o,h.lineTo(a,c),u+=l;h.lineTo(e,n-r)},t.shapeRoundRect=function(t,e,n){var r=t.ctx,o=e.x,i=e.y,s=e.w,a=e.h;if(void 0===typeof n&&(n=4),"number"==typeof n)n={tl:n,tr:n,br:n,bl:n};else{var c={tl:0,tr:0,br:0,bl:0};for(var u in c)n[u]=n[u]||c[u]}r.moveTo(o+n.tl,i),r.lineTo(o+s-n.tr,i),r.quadraticCurveTo(o+s,i,o+s,i+n.tr),r.lineTo(o+s,i+a-n.br),r.quadraticCurveTo(o+s,i+a,o+s-n.br,i+a),r.lineTo(o+n.bl,i+a),r.quadraticCurveTo(o,i+a,o,i+a-n.bl),r.lineTo(o,i+n.tl),r.quadraticCurveTo(o,i,o+n.tl,i)},t.circle=function(){var e=Array.prototype.slice.call(arguments),n=e[0].ctx;n.beginPath(),t.shapeCircle.apply(this,e),n.closePath()},t.star=function(){var e=Array.prototype.slice.call(arguments),n=e[0].ctx;n.beginPath(),t.shapeStar.apply(this,e),n.closePath()},t.roundRect=function(){var e=Array.prototype.slice.call(arguments),n=e[0].ctx;n.beginPath(),t.shapeRoundRect.apply(this,e),n.closePath()},t}]),t.constant("PainterColors",{black:"0x14191e",white:"0xffffff",blue:"0x03a9f4",red:"0xF21500",lightBlue:"0x79ccf2",lightYellow:"0xfff79a",greyLighter:"0xf8f8f8",greyLight:"0xeeeeee",greyMedium:"0xcccccc",grey:"0x90939b",map:"0x24292e"}),t.factory("Palette",["$q","Painter","Rect",function(t,e,n){function r(){this.painter=(new e).setSize(0,0),this.buffer=(new e).setSize(0,0),this.size={w:0,h:0},this.pool={},this.rows={}}return r.prototype={getRect:function(t,e){var r=this.painter,o=this.size,i=this.rows,s=new n(0,0,t,e),a=i[e]||{x:0,y:o.h};if(o.w=Math.max(o.w,a.x+t),o.h=Math.max(o.h,a.y+e),r.canvas.width||r.canvas.height){if(o.w>r.canvas.width||o.h>r.canvas.height){var c=r.canvas;r.setCanvas(document.createElement("canvas")),r.setSize(o.w,o.h),r.ctx.drawImage(c,0,0)}}else r.setSize(o.w,o.h);return s.x=a.x,s.y=a.y,a.x+=t,i[e]=a,s},add:function(e,n){var r=this;if(angular.isString(n)){var o=t.defer(),i=new Image;return i.onload=function(){r.addShape(e,i.width,i.height,function(t,e){t.ctx.drawImage(i,0,0)}),o.resolve(i)},i.onerror=function(){o.reject("connot load "+n)},i.src=n,o.promise}var s=Array.prototype.slice.call(arguments);return r.addShape.apply(r,s)},addShape:function(t,e,n,r){var o=this.painter,i=this.getRect(e,n);o.ctx.save(),o.ctx.rect(i.x,i.y,i.w,i.h),o.ctx.clip(),o.ctx.translate(i.x,i.y),r.call(o,o,i.clone().setPos(0,0)),o.ctx.restore(),this.pool[t]=i},draw:function(t,e,n,r,o){var i=this.pool[e];i&&t.drawRect(this.painter.canvas,i,{x:n,y:r,w:i.w,h:i.h},o)},tint:function(t,e,n,r,o,i){var s=this.pool[e];if(s){var a=this.painter,c=this.buffer.setSize(s.w,s.h);c.save(),c.setFill(o),c.fillRect(),c.ctx.globalCompositeOperation="destination-atop",c.ctx.drawImage(a.canvas,s.x,s.y,s.w,s.h,0,0,s.w,s.h),c.restore(),console.log(n,r,c.canvas,t.canvas),t.draw(c.canvas,{x:n,y:r},i)}},pattern:function(t,e,n,r,o,i,s){function a(e){var s=t.ctx;s.save(),s.translate(n,r),s.fillStyle=e,s.fillRect(-n,-r,o,i),s.translate(-n,-r),s.restore()}var c=this.pool[e];if(c){var u,l=c.img;if(l&&c.color==s)u=t.ctx.createPattern(l,"repeat"),a(u);else{var h=this.buffer.setSize(c.w,c.h);s?(c.color=s,h.save(),h.setFill(s),h.fillRect(),h.ctx.globalCompositeOperation="destination-atop",h.ctx.drawImage(this.painter.canvas,c.x,c.y,c.w,c.h,0,0,c.w,c.h),h.restore()):h.ctx.drawImage(this.painter.canvas,c.x,c.y,c.w,c.h,0,0,c.w,c.h),l=new Image,l.onload=function(){c.img=l,u=t.ctx.createPattern(l,"repeat"),a(u)},l.src=h.toDataURL()}}}},r}]),t.factory("Painter",["Shape","Rect","Color","PainterColors",function(t,e,n,r){function o(t){t=t||document.createElement("canvas"),this.rect=new e,this.drawingRect=new e,this.setColors(),this.setCanvas(t)}o.colors={},angular.forEach(r,function(t,e){o.colors[e]=new n(t).makeSet()});o.colors;return o.prototype={colors:o.colors,setColors:function(){var t=this.colors;angular.forEach(r,function(e,r){t[r]=new n(e).makeSet()})},setCanvas:function(t){this.canvas=t,this.setSize(t.offsetWidth,t.offsetHeight);var e=t.getContext("2d");return e.lineCap="square",this.ctx=e,this},setSize:function(t,e){return this.canvas.width=t,this.canvas.height=e,this.rect.w=t,this.rect.h=e,this},copy:function(t){return this.ctx.drawImage(t,0,0),this},clear:function(){return this.resize(),this},resize:function(){return this.setSize(this.canvas.offsetWidth,this.canvas.offsetHeight),this},setText:function(t,e,n,r){t=t||"11px monospace",e=e||"center",n=n||"middle",r=r||this.colors.black;var o=this.ctx;return o.font=t,o.textAlign=e,o.textBaseline=n,o.fillStyle=r.toRgba(),this},setFill:function(t){return t=t||this.colors.black,this.ctx.fillStyle=t.toRgba(),this},setStroke:function(t,e){t=t||this.colors.black;var n=this.ctx;return e=e||1,n.strokeStyle=t.toRgba(),n.lineWidth=e,this},fillText:function(t,e,n,r,o){return n&&(r=r||"",o=o||Math.floor(n/8),t.length>o&&(t=t.substr(0,Math.min(t.length,o)).trim()+r)),this.ctx.fillText(t,e.x,e.y),this},fillRect:function(t){t=t||this.rect;var e=this.ctx,n=t.x,r=t.y,o=t.w,i=t.h;return e.fillRect(n,r,o,i),this},strokeRect:function(t){t=t||this.rect;var e=this.ctx,n=t.x,r=t.y,o=t.w,i=t.h;return e.strokeRect(n,r,o,i),this},fill:function(){return this.ctx.fill(),this},stroke:function(){return this.ctx.stroke(),this},begin:function(){return this.ctx.beginPath(),this},close:function(){return this.ctx.closePath(),this},save:function(){return this.ctx.save(),this},restore:function(){return this.ctx.restore(),this},rotate:function(t){this.ctx.rotate(t*Math.PI/180)},translate:function(t){this.ctx.translate(t.x,t.y)},toDataURL:function(){return this.canvas.toDataURL()},draw:function(t,e,n){if(t){e.w=e.w||t.width,e.h=e.h||t.height;var r=this.ctx,o=this.drawingRect,i=o.x=e.x-e.w/2,s=o.y=e.y-e.h/2;o.w=e.w,o.h=e.h;r.save(),r.translate(i,s),n&&n.call(this),r.drawImage(t,0,0),r.restore()}return this},drawRect:function(t,e,n,r){if(t){e.w=e.w||t.width,e.h=e.h||t.height,n.w=n.w||t.width,n.h=n.h||t.height;var o=this.ctx,i=this.drawingRect,s=i.x=n.x-e.w/2,a=i.y=n.y-e.h/2;i.w=n.w,i.h=n.h;o.save(),o.translate(s,a),r&&r.call(this),o.drawImage(t,e.x,e.y,e.w,e.h,0,0,n.w,n.h),o.restore()}return this},flip:function(t){t=t||{x:1,y:-1};var e=this.ctx,n=this.drawingRect;e.translate(-1===t.x?n.w:0,-1===t.y?n.h:0),e.scale(t.x,t.y)}},o}])}(),function(){"use strict";angular.module("app").factory("Events",[function(){function t(t,e){var n=document.documentElement||document.body.parentNode||document.body,r={x:window.pageXOffset||n.scrollLeft,y:window.pageYOffset||n.scrollTop};if("resize"===t.type){var o={w:this.getWidth(),h:this.getHeight()};this.view=o}var s=i(e),a={x:s.offsetLeft,y:s.offsetTop},c=s.getBoundingClientRect(),u=this.getPage(t);if(u){var l={x:u.x-r.x-c.left,y:u.y-r.y-c.top},h={x:u.x-r.x,y:u.y-r.y};this.relative=l,this.absolute=h}"resize"===this.type&&console.log(this.type),this.originalEvent=t,this.element=e,this.node=s,this.offset=a,this.rect=c}function e(){return self.innerWidth?self.innerWidth:document.documentElement&&document.documentElement.clientWidth?document.documentElement.clientWidth:document.body?document.body.clientWidth:void 0}function n(){return self.innerHeight?self.innerHeight:document.documentElement&&document.documentElement.clientHeight?document.documentElement.clientHeight:document.body?document.body.clientHeight:void 0}function r(t){var e=["click","mousedown","mouseup","mousemove","mouseover","mouseout","mouseenter","mouseleave","contextmenu"],n=["touchstart","touchmove","touchend","touchcancel"],r=null;if(-1!==n.indexOf(t.type)){var o=null,i=t.originalEvent?t.originalEvent:t,s=i.touches.length?i.touches:i.changedTouches;s&&s.length&&(o=s[0]),o&&(r={x:o.pageX,y:o.pageY})}else-1!==e.indexOf(t.type)&&(r={x:t.pageX,y:t.pageY});return this.type=t.type,r}function o(e){function n(e){var n=new t(e,l.element);l.listeners.click.apply(this,[n])}function r(e){var n=new t(e,l.element);l.listeners.down.apply(this,[n]),l.removeTouchEvents()}function o(e){var n=new t(e,l.element);l.listeners.move.apply(this,[n])}function i(e){var n=new t(e,l.element);l.listeners.up.apply(this,[n])}function s(e){console.log("onResize",e);var n=new t(e,l.element);l.listeners.resize.apply(this,[n])}function a(e){var n=new t(e,l.element);l.listeners.down.apply(this,[n]),l.removeStandardEvents()}function c(e){var n=new t(e,l.element);l.listeners.move.apply(this,[n])}function u(e){var n=new t(e,l.element);l.listeners.up.apply(this,[n])}this.element=e,this.listeners={},this.standardEvents={click:{key:"click",callback:n},down:{key:"mousedown",callback:r},move:{key:"mousemove",callback:o},up:{key:"mouseup",callback:i},resize:{key:"resize",callback:s}},this.touchEvents={down:{key:"touchstart",callback:a},move:{key:"touchmove",callback:c},up:{key:"touchend",callback:u}};var l=this}function i(t){return t.length?t[0]:t}function s(t){return t.length?t:angular.element(t)}function a(t){var e=this,n=this.standardEvents,r=this.touchEvents,o=s(this.element),i=angular.element(window);return angular.forEach(t,function(t,s){if(e.listeners[s]){var a={};a[s]=e.listeners[s],c(a)}e.listeners[s]=t,n[s]&&("resize"===s?i.on(n[s].key,n[s].callback):o.on(n[s].key,n[s].callback)),r[s]&&o.on(r[s].key,r[s].callback)}),e}function c(t){var e=this,n=this.standardEvents,r=this.touchEvents,o=s(this.element),i=angular.element(window);return angular.forEach(t,function(t,s){n[s]&&("resize"===s?i.off(n[s].key,n[s].callback):o.off(n[s].key,n[s].callback)),r[s]&&o.off(r[s].key,r[s].callback),e.listeners[s]=null}),e}function u(){var t=this,e=t.standardEvents,n=(t.touchEvents,s(t.element));n.off("mousedown",e.down.callback),n.off("mousemove",e.move.callback),n.off("mouseup",e.up.callback)}function l(){var t=this,e=(t.standardEvents,t.touchEvents),n=s(t.element);n.off("touchstart",e.down.callback),n.off("touchmove",e.move.callback),n.off("touchend",e.up.callback)}return t.prototype={getPage:r,getWidth:e,getHeight:n},o.prototype={add:a,remove:c,removeStandardEvents:u,removeTouchEvents:l},o}])}(),function(){"use strict";angular.module("app").directive("ngClick",["Events",function(t){function e(e,n,r,o){function i(t){n.removeClass("animate"),n.offsetWidth,s.style.left=t.relative.x+"px",s.style.top=t.relative.y+"px",setTimeout(function(){n.addClass("animate"),setTimeout(function(){n.removeClass("animate")},1e3)},10)}n.addClass("material");var s=document.createElement("material");n[0].appendChild(s);var a={click:i},c=new t(n).add(a);e.$on("$destroy",function(){c.remove(a)})}return{restrict:"A",priority:0,link:e}}])}(),function(){"use strict";angular.module("app")}(),function(){"use strict";var t=angular.module("app");t.directive("controlMessages",[function(){return{restrict:"E",templateUrl:"partials/control-messages",transclude:{message:"?messageItems"},link:function(t,e,n,r){}}}]),t.directive("control",["$http","$templateCache","$compile","$parse",function(t,e,n,r){function o(t,e,n){t=t||"",e=e||"";var r=t.split(",");if(r.length>1){var o=r.shift();return angular.forEach(r,function(t,r){o=n?o.split("{"+r+"}").join("' + "+e+t+" + '"):o.split("{"+r+"}").join(e+t)}),n?"'"+o+"'":o}return e+t}var i=0;return{restrict:"A",templateUrl:function(t,e){var n="partials/forms/control";switch(e.control){case"select":n="partials/forms/control-select"}return n},scope:{ngModel:"=",required:"=",form:"@",title:"@",placeholder:"@"},require:"ngModel",link:function(t,e,n,r){},compile:function(t,e){return{pre:function(t,e,n){if("select"===n.control){var s=n.label?n.label:"name",a=n.key?n.key:"id",c=n.min?" | filter:gte('"+a+"', "+n.min+")":"",u=o(s,"item.",!0);t.options=n.number?"item."+a+" as "+u+" disable when item.disabled for item in "+n.source+c:u+" disable when item.disabled for item in "+n.source+c+" track by item."+a,console.log("control.compile.pre",t.options)}var l=(t.type=n.control,t.form=t.form||"form",t.title=t.title||"untitled");t.placeholder=t.placeholder||l,t.field=l.replace(/[^0-9a-zA-Z]/g,"").split(" ").join("")+ ++i;t.minLength=n.min||0,t.maxLength=n.max||Number.POSITIVE_INFINITY,t.options=r(n.options)(t)||{},t.focus=!1,t.getType=function(){var e="text";switch(n.control){case"password":e=t.visible?"text":"password";break;default:e=n.control}return e},t.getClasses=function(){var e=r(t.form)(t.$parent),n=r(t.form+"."+t.field)(t.$parent);return{"control-focus":t.focus,"control-success":n.$valid,"control-error":n.$invalid&&(e.$submitted||n.$touched),"control-empty":!n.$viewValue}},t.getMessages=function(){var e=r(t.form)(t.$parent),n=r(t.form+"."+t.field)(t.$parent);return(e.$submitted||n.$touched)&&n.$error}}}}}}]),t.directive("numberPicker",["$parse","$timeout",function(t,e){return{restrict:"A",template:'<div class="input-group">   <span class="input-group-btn"><button class="btn btn-outline-primary" type="button">-</button></span>   <div ng-transclude></div>   <span class="input-group-btn"><button class="btn btn-outline-primary" type="button">+</button></span></div>',replace:!0,transclude:!0,link:function(n,r,o,i){function s(r){var i=t(o.min)(n),s=t(o.numberPicker),a=s.assign;e(function(){a(n,Math.max(i,s(n)-1))})}function a(r){var i=t(o.max)(n),s=t(o.numberPicker),a=s.assign;e(function(){a(n,Math.min(i,s(n)+1))})}function c(){angular.element(l).off("touchstart mousedown",s),angular.element(h).off("touchstart mousedown",a)}var u=r[0],l=u.querySelectorAll(".input-group-btn > .btn")[0],h=u.querySelectorAll(".input-group-btn > .btn")[1];n.$on("$destroy",function(){c()}),function(){angular.element(l).on("touchstart mousedown",s),angular.element(h).on("touchstart mousedown",a)}()}}}])}(),function(){"use strict";angular.module("app").directive("state",["$timeout",function(t){return{restrict:"EA",templateUrl:"partials/state",transclude:!0,replace:!0,scope:{state:"="},link:function(e,n,r,o){function i(){t(function(){if(!e.$parent.$eval(r.onValidate))return e.state.button=n,e.$parent.$eval(r.onClick);e.$parent.$eval("form.$setSubmitted()")})}function s(){n.off("touchstart click",i)}e.stateClass=function(){return e.state.button===n?{busy:e.state.isBusy,successing:e.state.isSuccessing,success:e.state.isSuccess,errorring:e.state.isErroring,error:e.state.isError}:null},e.stateDisabled=function(){return e.state.button&&e.state.button!==n},e.$on("$destroy",function(){s()}),function(){n.on("touchstart click",i)}()}}}])}(),function(){"use strict";angular.module("app").factory("State",["$timeout",function(t){function e(){this.isReady=!1,this.idle()}function n(){this.isBusy=!1,this.isError=!1,this.isErroring=!1,this.isSuccess=!1,this.isSuccessing=!1,this.button=null,this.errors=[]}function r(){return!this.isBusy&&!this.isErroring&&!this.isSuccessing}function o(){return!this.isBusy&&(this.isBusy=!0,this.isError=!1,this.isErroring=!1,this.isSuccess=!1,this.isSuccessing=!1,this.errors=[],!0)}function i(){this.isBusy=!1,this.isError=!1,this.isErroring=!1,this.isSuccess=!0,this.isSuccessing=!0,this.errors=[],t(function(){this.isSuccessing=!1,this.button=null}.bind(this),1e3)}function s(e){this.isBusy=!1,this.isError=!0,this.isErroring=!0,this.isSuccess=!1,this.isSuccessing=!1,this.errors.push(e),t(function(){this.isErroring=!1,this.button=null}.bind(this),1e3)}function a(){this.isReady=!0,this.success()}function c(){return this.isError?this.errors[this.errors.length-1]:null}function u(){return{busy:this.isBusy,ready:this.isReady,successing:this.isSuccessing,success:this.isSuccess,errorring:this.isErroring,error:this.isError}}function l(t,e,n,r){return t=t||"Submit",this.isBusy?e||t:this.isSuccess?n||t:this.isError?r||t:t}return e.prototype={idle:n,busy:o,enabled:r,error:s,ready:a,success:i,errorMessage:c,submitClass:u,submitMessage:l},e}])}(),function(){"use strict";var t=angular.module("app");t.factory("Cookie",["$q","$window",function(t,e){function n(){}return n.TIMEOUT=3e5,n._set=function(t,n,r){var o;if(r){var i=new Date;i.setTime(i.getTime()+24*r*60*60*1e3),o="; expires="+i.toGMTString()}else o="";e.document.cookie=t+"="+n+o+"; path=/"},n.set=function(t,e,r){try{var o=[],i=JSON.stringify(e,function(t,e){if("pool"!==t){if("object"==typeof e&&null!==e){if(-1!==o.indexOf(e))return
;o.push(e)}return e}});o=null,n._set(t,i,r)}catch(n){console.log("Cookie.set.error serializing",t,e,n)}},n.get=function(t){for(var n=t+"=",r=e.document.cookie.split(";"),o=0;o<r.length;o++){for(var i=r[o];" "==i.charAt(0);)i=i.substring(1,i.length);if(0===i.indexOf(n)){var s=i.substring(n.length,i.length),a=null;try{a=JSON.parse(s)}catch(t){console.log("Cookie.get.error parsing",key,t)}return a}}return null},n.delete=function(t){n._set(t,"",-1)},n.on=function(e){function r(){if(a>c)i.reject("timeout");else{var t=n.get(e);t?i.resolve(t):(a+=s,o=setTimeout(r,s))}}var o,i=t.defer(),s=1e3,a=0,c=n.TIMEOUT;return r(),i.promise},n}]),t.factory("LocalStorage",["$q","$window","Cookie",function(t,e,n){function r(){}return r.isSupported=function(){var t=!1;try{t="localStorage"in e&&null!==e.localStorage,t?(e.localStorage.setItem("test","1"),e.localStorage.removeItem("test")):t=!1}catch(e){t=!1}return t}(),r.isSupported?(r.set=function(t,n){try{var r=[],o=JSON.stringify(n,function(t,e){if("pool"!==t){if("object"==typeof e&&null!==e){if(-1!==r.indexOf(e))return;r.push(e)}return e}});r=null,e.localStorage.setItem(t,o)}catch(e){console.log("LocalStorage.set.error serializing",t,n,e)}},r.get=function(t){var n=null;if(void 0!==e.localStorage[t])try{n=JSON.parse(e.localStorage[t])}catch(e){console.log("LocalStorage.get.error parsing",t,e)}return n},r.delete=function(t){e.localStorage.removeItem(t)},r.on=function(r){function o(t){if(clearTimeout(i),t.originalEvent.key==r)try{var e=JSON.parse(t.originalEvent.newValue);s.resolve(e)}catch(t){console.log("LocalStorage.on.error parsing",r,t),s.reject("error parsing "+r)}}var i,s=t.defer(),a=n.TIMEOUT;return angular.element(e).on("storage",o),i=setTimeout(function(){s.reject("timeout")},a),s.promise}):(console.log("LocalStorage.unsupported switching to cookies"),r.set=n.set,r.get=n.get,r.delete=n.delete,r.on=n.on),r}]),t.factory("SessionStorage",["$q","$window","Cookie",function(t,e,n){function r(){}return r.isSupported=function(){var t=!1;try{t="sessionStorage"in e&&void 0!==e.sessionStorage,t?(e.sessionStorage.setItem("test","1"),e.sessionStorage.removeItem("test")):t=!1}catch(e){t=!1}return t}(),r.isSupported?(r.set=function(t,n){try{var r=[],o=JSON.stringify(n,function(t,e){if("pool"!==t){if("object"==typeof e&&null!==e){if(-1!==r.indexOf(e))return;r.push(e)}return e}});r=null,e.sessionStorage.setItem(t,o)}catch(e){console.log("SessionStorage.set.error serializing",t,n,e)}},r.get=function(t){var n=null;if(void 0!==e.sessionStorage[t])try{n=JSON.parse(e.sessionStorage[t])}catch(e){console.log("SessionStorage.get.error parsing",t,e)}return n},r.delete=function(t){e.sessionStorage.removeItem(t)},r.on=function(r){function o(t){if(clearTimeout(i),t.originalEvent.key===r)try{var e=JSON.parse(t.originalEvent.newValue);s.resolve(e)}catch(t){console.log("SessionStorage.on.error parsing",r,t),s.reject("error parsing "+r)}}var i,s=t.defer(),a=n.TIMEOUT;return angular.element(e).on("storage",o),i=setTimeout(function(){s.reject("timeout")},a),s.promise}):(console.log("SessionStorage.unsupported switching to cookies"),r.set=n.set,r.get=n.get,r.delete=n.delete,r.on=n.on),r}])}(),function(){"use strict";angular.module("app").factory("Hash",[function(){function t(e,n){e=e||"id",n=n?t.get(n):{},Object.defineProperties(this,{key:{value:e,enumerable:!1,writable:!1},pool:{value:n,enumerable:!1,writable:!1},length:{value:0,enumerable:!1,writable:!0}})}function e(t){return void 0!==this.pool[t]}function n(t){return this.pool[t]}function r(t){var e=this,n=this.key;return t?e.getId(t[n]):null}function o(t){var e=this;return this.pool[t[this.key]]=t,e.push(t),t}function i(t){var e=this,n=e.get(t);if(n)for(var r,o=0,i=Object.keys(t);o<i.length;o++)r=i[o],n[r]=t[r];else n=e.set(t);return n}function s(t){var e=this,n=this.pool,r=this.key,o=e.get(t);if(o){var i=e.indexOf(o);-1!==i&&e.splice(i,1),delete n[o[r]]}return e}function a(t){var e=this;if(!t)return e;for(var n=0;n<t.length;)e.add(t[n]),n++;return e}function c(t){var e=this;if(!t)return e;for(var n=0;n<t.length;)e.remove(t[n]),n++;return e}function u(){var t,e=this,n=e.key,r=e.pool,o=0;for(e.length;e.length;)t=e.shift(),delete r[t[n]],o++;return e}function l(t){var e=this;if(t)for(var n=0;n<e.length;)t(e[n],n),n++;return e}function h(t,e){var n=this;return t=t||this.key,n.sort(function(n,r){var o=e?r:n,i=e?n:r;return o[t]-i[t]}),n}function f(t){return this.forward(t,!0)}function p(t){if(t.key!==this.key||t.length!==this.length)return!0;for(var e=!1,n=0,r=this.length,o=this.key;e&&n<r;)e=this[n][o]!==t[n][o],n++}function g(){var t=this,e=this.pool,n=this.key;Object.keys(e).forEach(function(t){delete e[t]}),angular.forEach(t,function(t){e[t[n]]=t})}var d={};return t.get=function(t){return d[t]=d[t]||{}},t.prototype=new Array,t.prototype.has=e,t.prototype.getId=n,t.prototype.get=r,t.prototype.set=o,t.prototype.add=i,t.prototype.remove=s,t.prototype.each=l,t.prototype.addMany=a,t.prototype.removeMany=c,t.prototype.removeAll=u,t.prototype.forward=h,t.prototype.backward=f,t.prototype.differs=p,t.prototype.updatePool=g,t}])}(),function(){"use strict";angular.module("app").directive("header",[function(){return{restrict:"E",templateUrl:"partials/header",transclude:{header:"?headerItems"},link:function(t,e,n,r){}}}])}(),function(){"use strict";angular.module("app").service("Router",["$location","$timeout",function(t,e){function n(n,r){function o(){t.$$lastRequestedPath=t.path(),t.path(n)}r?e(function(){o()},r):o()}function r(n,r){function o(){n=t.$$lastRequestedPath||n,t.$$lastRequestedPath=null,t.path(n)}r?e(function(){o()},r):o()}var o=this;o.redirect=n,o.retry=r}])}();