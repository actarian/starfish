!function(){"use strict";angular.module("app",["ngRoute","ngMessages","mapboxgl-directive","firebase","jsonFormatter"])}(),function(){"use strict";angular.module("app").config(["$httpProvider",function(t){}])}(),function(){"use strict";angular.module("app").config(["$routeProvider","$locationProvider",function(t,e){t.when("/",{title:"Homepage",templateUrl:"partials/home.html",controller:"HomeCtrl",resolve:{user:["FirebaseApi",function(t){return t.current()}]}}).when("/profile",{title:"Profile",templateUrl:"partials/profile.html",controller:"ProfileCtrl",resolve:{user:["FirebaseApi",function(t){return t.isLoggedOrGoTo("/signin")}]}}).when("/signin",{title:"Accedi",templateUrl:"partials/signin.html",controller:"SigninCtrl"}).when("/signup",{title:"Registrazione",templateUrl:"partials/signup.html",controller:"SignupCtrl"}).when("/dashboard",{title:"Dashboard",templateUrl:"partials/dashboard.html",controller:"DashboardCtrl",resolve:{user:["FirebaseApi",function(t){return t.isLoggedOrGoTo("/signin")}]}}).when("/user/:userId",{title:"User",templateUrl:"partials/user.html",controller:"UserCtrl",resolve:{user:["FirebaseApi",function(t){return t.isLoggedOrGoTo("/signin")}]}}).when("/404",{title:"Error 404",templateUrl:"partials/404"}),t.otherwise("/"),e.html5Mode(!1),e.hashPrefix("")}])}(),function(){"use strict";var t=angular.module("app");t.controller("RootCtrl",["$scope","$location","FirebaseApi",function(t,e,n){t.api=n,t.signout=function(){console.log(n),n.auth.signout().then(function(){e.path("/")})},n.current().then(function(e){t.user=e,console.log(e)},function(t){console.log("RootCtrl.error",t)})}]),t.controller("HomeCtrl",["$scope","State","FirebaseApi",function(t,e,n){(t.state=new e).ready()}]),t.controller("ProfileCtrl",["$scope","State","FirebaseApi","user",function(t,e,n,r){var o=t.state=new e,i=t.MODES={PLACE:1,BEACH:2,PRICES:3},s=(t.mode=i.BEACH,t.model={shopName:r.shopName,address:r.address,number:r.number,postalCode:r.postalCode,locality:r.locality,city:r.city,province:r.province,region:r.region,country:r.country,position:r.position}),a=(t.map={},t.beach=r.beach||{items:[],cols:0,rows:0});t.controls={};t.submit=function(){o.busy()&&(angular.forEach(s,function(t,e){t&&(r[e]=t)}),r.beach=a,n.users.save(r).then(function(t){console.log("response",t),o.success()},function(t){o.error(t)}))},t.saveItems=function(){t.submit()}}]),t.controller("DashboardCtrl",["$scope","State","FirebaseApi","user",function(t,e,n,r){(t.state=new e).ready(),n.items().then(function(e){console.log("DashboardCtrl.items",e),t.items=e})}]),t.controller("SigninCtrl",["$scope","State","Router","FirebaseApi",function(t,e,n,r){var o=t.state=new e,i=t.model={};t.submit=function(){o.busy()&&r.auth.signin(i).then(function(t){o.success(),n.retry("/dashboard")},function(t){console.log("SigninCtrl.error",t),o.error(t)})}}]),t.controller("SignupCtrl",["$scope","State","Router","FirebaseApi",function(t,e,n,r){var o=t.state=new e,i=t.model={};t.submit=function(){o.busy()&&r.auth.signup(i).then(function(t){o.success(),n.retry("/dashboard")},function(t){console.log("SignupCtrl.error",t),o.error(t)})}}]),t.controller("DemoCtrl",["$scope","$interval","Hash","Calendar","GanttRow",function(t,e,n,r,o){function i(t){function e(t,e,n){return t=(t||0)+"",e=e||2,n=n||"0",t.length>=e?t:new Array(e-t.length+1).join(n)+t}var n=t.getFullYear(),r=t.getMonth()+1,o=t.getDate(),i=t.getHours(),s=t.getMinutes(),a=t.getSeconds();return n+"-"+e(r)+"-"+e(o)+"T"+e(i)+":"+e(s)+":"+e(a)}function s(){var t=new Date;t.setDate(t.getDate()+Math.floor(60*Math.random())),t.setHours(0),t.setMinutes(0),t.setSeconds(0);var e=t.getFullYear(),n=t.getMonth();return{key:Math.ceil(t.getTime()/864e5),mKey:12*e+n,date:i(t)}}function a(){var t=s(),e={id:h,hours:1+Math.floor(6*Math.random()),date:new Date(t.date),key:t.key,mKey:t.mKey,activityId:l.id};return 0===Math.floor(3*Math.random())&&(e.taskId=1e4+Math.floor(50*Math.random())),h++,e}function c(){t.log=Array.prototype.slice.call(arguments)}var l=t.row=new o({activity:{id:1e6+function(){return 1e6+Math.floor(1e5*Math.random())}(),name:"Activity",budgetHours:10+Math.floor(50*Math.random())},project:{type:Math.floor(5*Math.random()),deliveryDate:new Date}},[]);t.addItem=function(){var e=a();l.slots.add(e),l.update(),l.updateMonths(),t.item=e,c("addItem",e.id)},t.updateItem=function(){if(t.item){var e=t.item.id;item=a(),item=angular.extend(t.item,item),item.id=e,l.slots.add(item),l.update(),l.updateMonths(),t.item=item,c("updateItem",item.id)}},t.clearItems=function(){l.ranges.removeAll(),l.months.removeAll(),l.days.removeAll(),l.slots.removeAll(),l.update(),l.updateMonths(),delete t.item,c("clearItems")};var u;t.start=function(){t.stop(),u=e(t.addItem,1e3/60)},t.stop=function(){u&&e.cancel(u)};var h=1}]),t.constant("ganttGroups",{ACTIVITY:1,CUSTOMER:2,DEPARTMENT:3,GROUP:4,MANAGER:5,PROJECT:6,RESOURCE:7,USER:9}),t.factory("Calendar",["Hash",function(t){function e(t,e){for(var n=[];n.length<t;)n.push(e(n.length));return n}function n(){}var r=new Date;r.setHours(0),r.setMinutes(0),r.setSeconds(0);var o=Math.ceil(r.getTime()/864e5),i=new t("mKey");return n.getDate=function(t){return"function"==typeof t.date.getMonth?t.date:new Date(t.date)},n.clearMonth=function(t){t.days.each(function(t){t&&(t.hours=0,t.tasks=[])})},n.getMonth=function(s){r=new Date,r.setHours(0),r.setMinutes(0),r.setSeconds(0),o=Math.ceil(r.getTime()/864e5);var a=n.getDate(s),c=a.getFullYear(),l=a.getMonth(),u=(Math.ceil(a.getTime()/864e5),12*c+l),h=i.getId(u);if(!h){var f=new Date(c,l,1).getDay(),d=new Date(c,l+1,0).getDate(),m=Math.ceil(d/7);h={date:a,mKey:u,month:l,monthDays:d,fromDay:f,days:new t("key")},h.weeks=e(m,function(t){var n=e(7,function(e){var n=null,r=7*t+e-(f-1);if(r>=0&&r<d){var i=new Date(c,l,r+1),s=Math.ceil(i.getTime()/864e5);n={$today:s===o,c:e,r:t,d:r+1,date:i,key:s,hours:0,tasks:[]},n=h.days.add(n)}return n});return{r:t,days:n}}),h=i.add(h)}return h},n.getDay=function(t){var e=new Date(r);return e.setDate(e.getDate()+t),e},n.getKey=function(t){return Math.ceil(t.getTime()/864e5)},n}]),t.factory("GanttRow",["Hash","Calendar","ganttGroups",function(t,e,n){function r(e,r){this.type=n.ACTIVITY,this.assignedHours=0,this.slots=new t("id"),this.days=new t("key"),this.months=new t("mKey"),this.ranges=new t("rKey"),this.tasks=new t("id"),e&&(this.id=e.activity.id,this.name=e.activity.name,this.budgetHours=e.activity.budgetHours,this.useBudget=2!==e.project.type&&4!==e.project.type,this.customer=e.customer,this.department=e.department,this.manager=e.manager,this.project=e.project,this.resource=e.resource,this.color=r[this.id%(r.length||1)]),this.lastTaskId=null,this.update()}var o=1,i=new Date;i.setHours(0),i.setMinutes(0),i.setSeconds(0);var s=Math.ceil(i.getTime()/864e5);return r.prototype={canSelect:function(){return this.type===n.ACTIVITY&&this.budgetHours>0},canEdit:function(){return this.canSelect()&&-1===this.resource.name.toLowerCase().indexOf("nondefinito")},mergeSlot:function(t){var e=this.slots;t.hours?e.add(t):e.remove(t)},insertSlot:function(t,e,n){var r=null;if(this.useBudget&&(e=Math.min(e,this.budgetHours-this.assignedHours)),(e=Math.max(0,e))>0){var i={id:"temp-"+o++,key:t,date:new Date(864e5*t),hours:e,activityId:this.id};n&&(i.taskId=n,this.lastTaskId=n),this.slots.add(i),r=this.slots.getId(i.id)}return this.update(),r},removeSlots:function(t){var e=this.days.getId(t);e.tasks.each(function(t){t.hours=0});var n=e.tasks.slice();return this.slots.removeMany(n),this.update(),n},toggleSlots:function(t,e){return this.days.has(t)?this.removeSlots(t):[this.insertSlot(t,e,this.lastTaskId)]},assign:function(t,e){console.log("assign");var n=this.slots,r=t.$key,i={id:"temp-"+o++,key:r,date:t.$date,hours:e||0,activityId:this.id};return e?n.add(i):n.remove(i),this.update(),this.days.getId(r)},write:function(t,e,n){if(e=Math.min(e,n),this.useBudget&&(e=Math.min(e,this.budgetHours-this.assignedHours)),(e=Math.max(0,e))&&!this.days.has(t.$key)&&t.$date>=i)return this.assign(t,e)},erase:function(t,e,n){if(this.days.has(t.$key)&&t.$date>=i)return this.assign(t,null)},toggle:function(t,e,n){return this.days.has(t.$key)?this.erase(t,e,n):this.write(t,e,n)},update:function(){var e=0,n=this.slots,r=this.days;r.removeAll();var o=null;n.each(function(n){o=n.taskId||o,e+=n?n.hours:0;var i=r.add({key:n.key,date:n.date,hours:0});i.tasks=i.tasks||new t("id"),i.tasks.add(angular.copy(n)),i.tasks.each(function(t){i.hours+=t.hours})}),this.lastTaskId=o||this.lastTaskId,r.forward(),this.assignedHours=e,this.updateRanges()},updateMonths:function(){var t=this.days,n=this.months;n.removeAll();var r;t.each(function(t){var o=e.getMonth(t);o!==r&&(r=o,e.clearMonth(o)),n.add(o);var i=o.days.getId(t.key);i&&(i.hours=t.hours,i.tasks=t.tasks)}),n.forward()},updateRanges:function(){var t=this.days,e=this.ranges;e.removeAll();var n,r=0;t.each(function(t,o){n&&(t.key-n.key>1||t.tasks.differs(n.tasks))&&r++,n=t;var i=e.add({rKey:r});i.days=i.days||[],i.days.push(t.key)}),e.forward()},getRange:function(t,e,n){var r=this.ranges,o=null,i=t.$key;return r.each(function(t){var r=t.days.indexOf(i);-1!==r&&(t.c=r,t.firstKey=Math.max(e,t.days[0]),t.lastKey=Math.min(n,t.days[t.days.length-1]),o=t)}),o},updateRange:function(t,e,n){var r=this.ranges,o=this.getRange(t,e,n);if(o){o.previousKey=null,o.nextKey=null;var i=o.rKey;if(i>0){var s=r[i-1];o.previousKey=s.days[s.days.length-1]}if(i<r.length-1){var a=r[i+1];o.nextKey=a.days[0]}}return o},canMoveRange:function(t,e){for(var n=!0,r=this,o=t.items[0],i=(t.items[t.items.length-1],r.getOffsetKey(o.startDate,e)),a=0,c=t.items.length;a<c;){var l=i+a;(l<s||r.days.getId(l)&&-1===t.items.indexOf(r.days.getId(l)))&&(n=!1,a=c),a++}return n},moveRange:function(t,e){if(t.items.length){var n=this;n.canMoveRange(t,e)&&(angular.forEach(t.items,function(t){n.addDays(t,e)}),n.update())}},addDays:function(t,e){var n=new Date(t.startDate);return n.setDate(n.getDate()+e),t.date=n,t.key=Math.ceil(n.getTime()/864e5),t},getOffsetKey:function(t,e){return t=new Date(t),t.setDate(t.getDate()+e),Math.ceil(t.getTime()/864e5)},getHours:function(t){var e=0,n=this.days.getId(t);return n&&n.tasks.each(function(t){e+=t.hours}),e},toggleOpened:function(){this.opened=!this.opened},compress:function(t){if(this.items.length){this.items.sort(function(t,e){return t.key-e.key});var e=Utils.where(this.items,{key:t});e=e||this.items[0];var n=this.items.indexOf(e),r=n,o=this.items.length;for(t=Math.max(t,s);r<o;)e=this.items[r],e.key=t+r-n,e.date=new Date(864e5*e.key),r++;this.update()}}},r.serialNumber=function(t,e){return new Array(1+e.toString().length-t.toString().length).join("0")},r}])}(),function(){"use strict";var t=angular.module("app");t.directive("header",[function(){return{restrict:"E",templateUrl:"partials/header",transclude:{header:"?headerItems"},link:function(t,e,n,r){}}}]),t.directive("controlMessages",[function(){return{restrict:"E",templateUrl:"partials/control-messages",transclude:{message:"?messageItems"},link:function(t,e,n,r){}}}]),t.directive("control",["$http","$templateCache","$compile","$parse",function(t,e,n,r){function o(t,e,n){t=t||"",e=e||"";var r=t.split(",");if(r.length>1){var o=r.shift();return angular.forEach(r,function(t,r){o=n?o.split("{"+r+"}").join("' + "+e+t+" + '"):o.split("{"+r+"}").join(e+t)}),n?"'"+o+"'":o}return e+t}var i=0;return{restrict:"A",templateUrl:function(t,e){var n="partials/control";switch(e.control){case"select":n="partials/control-select"}return n},scope:{ngModel:"=",required:"=",form:"@",title:"@",placeholder:"@"},require:"ngModel",link:function(t,e,n,r){},compile:function(t,e){return{pre:function(t,e,n){if("select"===n.control){var s=n.label?n.label:"name",a=n.key?n.key:"id",c=n.min?" | filter:gte('"+a+"', "+n.min+")":"",l=o(s,"item.",!0);t.options=n.number?"item."+a+" as "+l+" disable when item.disabled for item in "+n.source+c:l+" disable when item.disabled for item in "+n.source+c+" track by item."+a,console.log("control.compile.pre",t.options)}var u=(t.type=n.control,t.form=t.form||"form",t.title=t.title||"untitled");t.placeholder=t.placeholder||u,t.field=u.replace(/[^0-9a-zA-Z]/g,"").split(" ").join("")+ ++i;t.minLength=n.min||0,t.maxLength=n.max||Number.POSITIVE_INFINITY,t.options=r(n.options)(t)||{},t.focus=!1,t.getType=function(){var e="text";switch(n.control){case"password":e=t.visible?"text":"password";break;default:e=n.control}return e},t.getClasses=function(){var e=r(t.form)(t.$parent),n=r(t.form+"."+t.field)(t.$parent);return{"control-focus":t.focus,"control-success":n.$valid,"control-error":n.$invalid&&(e.$submitted||n.$touched),"control-empty":!n.$viewValue}},t.getMessages=function(){var e=r(t.form)(t.$parent),n=r(t.form+"."+t.field)(t.$parent);return(e.$submitted||n.$touched)&&n.$error}}}}}}]),t.directive("state",["$timeout",function(t){return{restrict:"EA",templateUrl:"partials/state",transclude:!0,replace:!0,scope:{state:"="},link:function(e,n,r,o){function i(){t(function(){if(!e.$parent.$eval(r.onValidate))return e.state.button=n,e.$parent.$eval(r.onClick);e.$parent.$eval("form.$setSubmitted()")})}function s(){n.off("touchstart click",i)}e.stateClass=function(){if(e.state.button===n){return{busy:e.state.isBusy,successing:e.state.isSuccessing,success:e.state.isSuccess,errorring:e.state.isErroring,error:e.state.isError}}return null},e.stateDisabled=function(){return e.state.button&&e.state.button!==n},e.$on("$destroy",function(){s()}),function(){n.on("touchstart click",i)}()}}}]),t.directive("controlRow",["$http","$templateCache","$compile",function(t,e,n){function r(t,e,n){t=t||"",e=e||"";var r=t.split(",");if(r.length>1){var o=r.shift();return angular.forEach(r,function(t,r){o=n?o.split("{"+r+"}").join("' + "+e+t+" + '"):o.split("{"+r+"}").join(e+t)}),n?"'"+o+"'":o}return e+t}function o(t,e){var n=e.form||"Form",o=e.title||"Untitled",s=e.placeholder||o,a=o.replace(/[^0-9a-zA-Z]/g,"").split(" ").join("")+ ++i,c=n+"."+a,l=' ng-focus="'+c+'.hasFocus=true" ng-blur="'+c+'.hasFocus=false"',u="",h="",f="",d=e.label?e.label:"name",m=e.key?e.key:"id",p=e.model,g=e.onChange?' ng-change="'+e.onChange+'"':"",y=e.onFocus?' ng-focus="'+e.onFocus+'"':"",v=e.onBlur?' ng-blur="'+e.onBlur+'"':"",b=e.cols?6:9,x="col-lg-"+b,w="col-lg-"+(12-b);"12"===e.cols&&(w=x="col-lg-12");var k=e.required?' required="true"':"",M=e.readonly?" readonly":"",S=e.options?' ng-model-options="'+e.options+'" ':"",$=e.validate?' validate-type="'+e.validate+'" ':"",I=e.format?' format="'+e.format+'" ':"",T=e.precision?' precision="'+e.precision+'" ':"";switch(e.disabled&&(f=" disabled"),e.ngDisabled&&(f=' ng-disabled="'+e.ngDisabled+'"'),e.required&&(h=e.readonly||e.disabled?"":"<sup>âœ½</sup>"),u='<span ng-messages="'+(e.readonly?"":"("+n+".$submitted || "+c+".$touched) && ")+c+'.$error" role="alert">',u+='<span ng-message="required" class="label-error animated flash">obbligatorio â¤´</span>',e.controlRow){case"password":u+='<span ng-message="minlength" class="label-error animated flash">almeno 6 caratteri â¤´</span>';break;case"email":u+='<span ng-message="email" class="label-error animated flash">valore non corretto â¤´</span>';break;case"number":case"range":u+='<span ng-message="positive" class="label-error animated flash">solo valori positivi â¤´</span>',u+='<span ng-message="number" class="label-error animated flash">solo valori numerici â¤´</span>'}void 0!==e.match&&(u+='<span ng-message="match" class="label-error animated flash">non corrispondente â¤´</span>'),u+="</span>";var C=" ng-class=\"{ 'control-focus': "+c+".hasFocus, 'control-success': "+c+".$valid, 'control-error': "+c+".$invalid && ("+n+".$submitted || "+c+".$touched), 'control-empty': !"+c+'.$viewValue }"',R='<div class="row" '+C+'><label for="'+a+'" class="'+w+' col-form-label">'+o+h+'</label><div class="'+x+" col-"+e.controlRow+'">';switch(e.controlRow){case"static":R+='<p class="form-control" '+(e.click?' ng-click="'+e.click+'"':"")+(e.mouseover?' ng-mouseover="'+e.mouseover+'"':"")+(e.mouseout?' ng-mouseover="'+e.mouseout+'"':"")+'><span ng-bind-html="'+p+" || '&nbsp;'\"></span>"+(e.icon?'<i class="pull-xs-right '+e.icon+'"></i>':"")+"</p>";break;case"checkbox":R='<div class="'+x+'"'+C+'><div class="col-xs-12"><label class="custom-control custom-checkbox">',R+='   <input type="checkbox" class="custom-control-input" ng-model="'+p+'">',R+='   <span class="custom-control-indicator"></span>',R+='   <span class="custom-control-description">'+o+"</span>",R+="</label>";break;case"yesno":R='<div class="row" '+C+'><label class="col-lg-6 custom-control custom-checkbox">'+o+h+"</label>",R+='<div class="'+w+'"><label class="custom-control custom-checkbox">',R+='   <input type="checkbox" class="custom-control-input" ng-model="'+p+'" ng-change="'+p+"No=!"+p+'">',R+='   <span class="custom-control-indicator"></span>',R+='   <span class="custom-control-description">SÃ¬</span>',R+="</label></div>",R+='<div class="'+w+'"><label class="custom-control custom-checkbox">',R+='   <input type="checkbox" class="custom-control-input" ng-model="'+p+'No" ng-change="'+p+"=!"+p+'No">',R+='   <span class="custom-control-indicator"></span>',R+='   <span class="custom-control-description">No</span>',R+="</label>";break;case"switch":e.disabled&&(f=' disabled="true"'),e.ngDisabled&&(f=' disabled="'+e.ngDisabled+'"'),R='<div class="row control-switch" '+C+'><label for="'+a+'" class="'+w+' col-form-label">'+o+h+"</label>",R+='<div class="'+x+'">',R+='<switch name="'+a+'" ng-model="'+p+'" '+g+y+v+S+' on="SÃ¬" off="No" '+k+f+M+l+"></switch>";break;case"range":$=' validate-type="number"';var E=a+"Hi",A=n+"."+E,D=e.modelHi,P=" ng-class=\"{ 'control-focus': "+A+".hasFocus, 'control-success': "+A+".$valid, 'control-error': "+A+".$invalid && ("+n+".$submitted || "+A+".$touched), 'control-empty': !"+A+'.$viewValue }"',O=k;"true"==e.requiredHi?O=' required="true"':"false"==e.requiredHi&&(O="");var j=" ",H=" ";switch(e.required&&"false"!==e.requiredHi&&(H=e.readonly||e.disabled?"":"<sup>âœ½</sup>"),j='<span ng-messages="'+(e.readonly?"":"("+n+".$submitted || "+A+".$touched) && ")+A+'.$error" role="alert">',j+='<span ng-message="required" class="label-error animated flash">obbligatorio â¤´</span>',e.controlRow){case"password":j+='<span ng-message="minlength" class="label-error animated flash">almeno 3 caratteri â¤´</span>';break;case"email":j+='<span ng-message="email" class="label-error animated flash">valore non corretto â¤´</span>';break;case"number":case"range":j+='<span ng-message="positive" class="label-error animated flash">solo valori positivi â¤´</span>',j+='<span ng-message="number" class="label-error animated flash">solo valori numerici â¤´</span>'}return void 0!==e.match&&(j+='<span ng-message="match" class="label-error animated flash">non corrispondente â¤´</span>'),j+="</span>",R='<div class="row"><label for="'+a+'" class="'+w+' col-form-label">'+o+'</label><div class="'+x+" col-"+e.controlRow+'">',R+='<div class="form-control-range form-control-range-min" '+C+">"+h+'<input class="form-control" name="'+a+'" ng-model="'+p+'" '+g+y+v+S+' placeholder="'+s+'" type="text"'+k+f+M+l+$+I+T+">"+u+"</div>",(R+='<div class="form-control-range form-control-range-max" '+P+">"+H+'<input class="form-control" name="'+E+'" ng-model="'+D+'" '+g+y+v+S+' placeholder="'+s+'" type="text"'+O+f+M+l+$+I+T+">"+j+"</div>")+"</div></div>";case"range-slider":var z=e.himodel?' rz-slider-high="'+e.himodel+'" ':"";S=e.options?' rz-slider-options="'+e.options+'" ':"",R+='<rzslider rz-slider-model="'+p+'" '+z+S+'"></rzslider>';break;case"select":var F=e.min?" | filter:gte('"+m+"', "+e.min+")":"",N=r(d,"item.",!0),S=e.number?"item."+m+" as "+N+" disable when item.disabled for item in "+e.source+F:N+" disable when item.disabled for item in "+e.source+F+" track by item."+m;R+='<select name="'+a+'" class="form-control" ng-model="'+p+'" '+g+y+v+' ng-options="'+S+'" '+(e.number?"convert-to-number":"")+k+f+'><option value="" disabled selected hidden>'+s+"</option></select>";break;case"autocomplete":var q=!!e.canCreate&&e.canCreate,V=!!e.flatten&&e.flatten,L=!!e.queryable&&e.queryable,U=e.onSelected?' on-selected="'+e.onSelected+'"':"";R+='<input name="'+a+'" ng-model="'+p+'" type="hidden" '+(e.required?"required":"")+">",R+='<div control-autocomplete="'+e.source+'" model="'+p+'" label="'+d+'"  key="'+m+'" can-create="'+q+'" flatten="'+V+'" queryable="'+L+'" placeholder="'+s+'" on-focus="'+c+'.hasFocus=true" on-blur="'+c+'.hasFocus=false"'+U+"></div>";break;case"textarea":R+='<textarea name="'+a+'" class="form-control" ng-model="'+p+'" '+g+y+v+S+' placeholder="'+s+'" '+k+f+' rows="'+(e.rows?e.rows:"1")+'"'+l+"></textarea>";break;case"htmltext":var _="";e.disabled&&(_=' ta-disabled="true"'),e.ngDisabled&&(_=' ta-disabled="'+e.ngDisabled+'"'),R+='<div text-angular name="'+a+'" ta-paste="doStripHtml($html)" ng-model="'+p+'" '+g+y+v+S+' placeholder="'+s+'" '+k+_+M+l+(e.required?' ta-min-text="1"':"")+"></div>";break;case"password":R+='<div class="input-group"><input name="'+a+'" class="form-control" ng-model="'+p+'" '+g+y+v+S+' placeholder="'+s+'" type="{{form.'+a+" ? 'password' : 'text'}}\" ng-minlength=\"6\" "+k+f+l+'><span class="input-group-addon" ng-if="'+p+'"><span class="icon-eye" ng-click="form.'+a+" = !form."+a+'"></span></span></div>';break;case"email":R+='<input name="'+a+'" class="form-control" ng-model="'+p+'" '+g+y+v+S+' placeholder="'+s+'" type="email" '+k+f+l+">";break;case"number-picker":$=' validate-type="anynumber"',R+='<div number-picker="'+p+'" min="'+e.min+'" max="'+e.max+'">',R+='   <input name="'+a+'" class="form-control" ng-model="'+p+'" '+g+y+v+S+' placeholder="'+s+'" type="text"'+k+f+M+l+$+I+T+">",R+="</div>";break;case"number":$=' validate-type="number"',R+='<input name="'+a+'" class="form-control" ng-model="'+p+'" '+g+y+v+S+' placeholder="'+s+'" type="text"'+k+f+M+l+$+I+T+">";break;case"anynumber":$=' validate-type="anynumber"',R+='<input name="'+a+'" class="form-control" ng-model="'+p+'" '+g+y+v+S+' placeholder="'+s+'" type="text"'+k+f+M+l+$+I+T+">";break;case"date":$=' validate-type="date"',I=' format="dd-MM-yyyy"',e.disabled||e.readonly?R+='<div class="input-group"><input type="text" class="form-control" name="'+a+'" ng-model="'+p+'" placeholder="'+s+'" '+k+f+M+l+$+I+'><span class="input-group-addon"><i class="icon-calendar"></i></span></div>':(R+='<input type="date" name="'+a+'" class="form-control form-control-hidden" is-open="flags.'+a+'" ng-model="'+p+'" placeholder="dd-MM-yyyy" '+k+f+M+l+' uib-datepicker-popup datepicker-options="sources.datepickerOptions" datepicker-template-url="uib/template/datepicker/datepicker.html" show-button-bar="false" current-text="Oggi" clear-text="Rimuovi" close-text="Chiudi">',R+='<div ng-click="(flags.'+a+' = true)" class="input-group disabled"><input type="text" class="form-control" name="'+a+'" ng-model="'+p+'" placeholder="'+s+'" '+k+f+M+l+$+I+'><span class="input-group-addon"><i class="icon-calendar"></i></span></div>');break;case"datetime-local":s=s||"dd-MM-yyyyTHH:mm:ss",R+='<input name="'+a+'" class="form-control" ng-model="'+p+'" '+g+y+v+S+' placeholder="'+s+'" type="datetime-local"'+k+f+M+l+">";break;default:R+='<input name="'+a+'" class="form-control" ng-model="'+p+'" '+g+y+v+S+' placeholder="'+s+'" type="text"'+k+f+M+l+$+I+T+">"}return R+u+"</div></div>"}var i=0;return{restrict:"A",replace:!0,compile:function(t,e){return function(r,i,s){i.html(o(t,e)),n(i.contents())(r)}}}}]),t.directive("numberPicker",["$parse","$timeout",function(t,e){return{restrict:"A",template:'<div class="input-group">   <span class="input-group-btn"><button class="btn btn-outline-primary" type="button">-</button></span>   <div ng-transclude></div>   <span class="input-group-btn"><button class="btn btn-outline-primary" type="button">+</button></span></div>',replace:!0,transclude:!0,link:function(n,r,o,i){function s(r){var i=t(o.min)(n),s=t(o.numberPicker),a=s.assign;e(function(){a(n,Math.max(i,s(n)-1))})}function a(r){var i=t(o.max)(n),s=t(o.numberPicker),a=s.assign;e(function(){a(n,Math.min(i,s(n)+1))})}function c(){angular.element(u).off("touchstart mousedown",s),angular.element(h).off("touchstart mousedown",a)}var l=r[0],u=l.querySelectorAll(".input-group-btn > .btn")[0],h=l.querySelectorAll(".input-group-btn > .btn")[1];n.$on("$destroy",function(){c()}),function(){angular.element(u).on("touchstart mousedown",s),angular.element(h).on("touchstart mousedown",a)}()}}}]),t.directive("validateType",["$filter",function(t){return{require:"ngModel",link:function(e,n,r,o){function i(){f=!0,u&&(n[0].value=o.$modelValue||null,o.$modelValue||o.$setViewValue(null))}function s(){if(u&&!o.$invalid)switch(l){case"date":case"datetime":case"datetime-local":n[0].value=o.$modelValue?t("date")(o.$modelValue,u):" ";break;default:n[0].value=o.$modelValue?t("number")(o.$modelValue,h)+" "+u:" "}}function a(){f=!1,s()}function c(){n.off("focus",i),n.off("blur",a)}var l=r.validateType,u=r.format||"",h=r.precision||2,f=!1;switch(l){case"date":case"datetime":case"datetime-local":o.$formatters.push(function(e){return e?t("date")(e,u):null});break;case"number":o.$parsers.unshift(function(t){var e=!1;return void 0!==t&&""!==t?(e=-1!==String(t).indexOf(Number(t).toString()),t=Number(t),o.$setValidity("number",e),e&&(o.$setValidity("positive",t>=.01),void 0!==r.min&&o.$setValidity("range",t>=Number(r.min)),void 0!==r.max&&o.$setValidity("range",t<=Number(r.max)))):(e=!0,t=Number(t),o.$setValidity("number",!0),o.$setValidity("positive",!0),void 0!==r.min&&o.$setValidity("range",!0),void 0!==r.max&&o.$setValidity("range",!0)),t}),o.$formatters.push(function(e){return e?t("number")(e,h)+" "+u:null});break;case"anynumber":o.$parsers.unshift(function(t){var e=!1;return void 0!==t&&""!==t?(e=-1!==String(t).indexOf(Number(t).toString()),t=Number(t),o.$setValidity("number",e),e&&(void 0!==r.min&&o.$setValidity("range",t>=Number(r.min)),void 0!==r.max&&o.$setValidity("range",t<=Number(r.max)))):(e=!0,t=Number(t),o.$setValidity("number",!0),void 0!==r.min&&o.$setValidity("range",!0),void 0!==r.max&&o.$setValidity("range",!0)),t}),o.$formatters.push(function(e){return e||0===e?t("number")(e,h)+" "+u:null})}e.$on("$destroy",function(){c()}),function(){n.on("focus",i),n.on("blur",a)}()}}}])}(),function(){"use strict";angular.module("app").directive("beach",["$http","$timeout","Painter","Palette","Rect","Hash","UI",function(t,e,n,r,o,i,s){function a(t,o,i,a){function c(t,e){var n=j;I?n.setFill(n.colors.white):n.setFill(n.colors.grey),n.ctx.beginPath(),n.ctx.arc(t,e,6,0,2*Math.PI,!1),n.ctx.fill()}function l(t,e){var n=.4*A.w,r=j;r.ctx.beginPath(),r.ctx.moveTo(t+n*Math.cos(0),e+n*Math.sin(0));for(var o=1;o<=7;o++)r.ctx.lineTo(t+n*Math.cos(2*o*Math.PI/7),e+n*Math.sin(2*o*Math.PI/7));r.ctx.fill()}function u(t,e){var n={x:(t-R.x)/E.w,y:(e-R.y)/E.h};t+=A.w*n.x*.75,e+=A.h*n.y*.75;var r=j;r.setFill(r.colors.greyLight),l(t,e)}function h(t,e){var n=j;n.setFill(n.colors.blue),l(t,e)}function f(){var t=j;t.clear(),H.pattern(t,"bg",0,0,t.rect.w,t.rect.h),angular.forEach(O,function(t){u(t.x*A.w+A.w2,t.y*A.h+A.h2)}),angular.forEach(O,function(t){h(t.x*A.w+A.w2,t.y*A.h+A.h2)}),$&&c($.x*A.w+A.w2,$.y*A.h+A.h2)}function d(t){O.push({x:t.x,y:t.y})}function m(t){for(var e,n=-1,r=0,o=O.length;r<o;)e=O[r],e.x===t.x&&e.y===t.y&&(n=r,r=o),r++;return n}function p(t){O.splice(t,1)}function g(t){var e=m(t);return-1!==e?p(e):d(t),e}function y(){I=null,angular.forEach(O,function(t){t.x===$.x&&t.y===$.y&&(I=t)}),f()}function v(){var t={},e={},n=0,r=0;angular.forEach(O,function(o){t[o.x]||(t[o.x]=!0,n++),e[o.y]||(e[o.y]=!0,r++)}),D.cols=n,D.rows=r}function b(){e(function(){v()})}function x(t){var e=s.getTouch(t),n=s.getRelativeTouch(o,e),r={x:Math.floor(n.x/A.w),y:Math.floor(n.y/A.h)};T=!0,C=g(r),y(),b()}function w(t){var e=s.getTouch(t),n=s.getRelativeTouch(o,e);if(R={x:n.x,y:n.y},$={x:Math.floor(n.x/A.w),y:Math.floor(n.y/A.h)},T){var r=m($);-1===C&&-1===r?d($):C>=0&&-1!==r&&p(r)}y()}function k(t){T&&(T=!1,b())}function M(){var t=o[0].offsetWidth,e=o[0].offsetHeight;E.w=t,E.h=e,f()}function S(){o.off("mousedown",x),o.off("mousemove",w),o.off("mouseup",k),o.off("resize",M)}var $,I,T,C,R={x:0,y:0},E={w:0,h:0},A={w:40,h:40,w2:20,h2:20},D=t.beach,P=t.controls,O=D.items,j=new n(o[0]),H=new r;H.add("bg",A.w,A.h,function(t,e){t.setFill(t.colors.greyLight),t.ctx.beginPath(),t.ctx.arc(e.center().x,e.center().y,5,0,2*Math.PI,!1),t.ctx.fill()}),t.$on("$destroy",function(){S()}),P.setCenter=function(){if(D.rows&&D.cols){var t=Math.floor(E.w/A.w),e=Math.floor(E.h/A.h),n=Number.POSITIVE_INFINITY,r=Number.POSITIVE_INFINITY;angular.forEach(O,function(t){n=Math.min(n,t.x),r=Math.min(r,t.y)});var o=Math.max(0,Math.floor((t-D.cols)/2)-1),i=Math.max(0,Math.floor((e-D.rows)/2)-1);angular.forEach(O,function(t){t.x=o+(t.x-n),t.y=i+(t.y-r)})}console.log("setCenter",D.rows,D.cols),f()},M(),function(){o.on("mousedown",x),o.on("mousemove",w),o.on("mouseup",k),o.on("resize",M)}(),e(function(){f()})}return{restrict:"A",link:a}}])}(),function(){"use strict";angular.module("app").directive("mapbox",["$http","$timeout",function(t,e){function n(t,n,i,s){function a(e){e.length&&(console.log("handleResults",e),t.map.results=e.map(function(t){return{name:t.formatted_address,address:h("address",t),number:h("number",t),locality:h("locality",t),postalCode:h("postalCode",t),city:h("city",t),province:h("province",t),region:h("region",t),country:h("country",t),position:{lng:t.geometry.location.lng(),lat:t.geometry.location.lat()}}}))}function c(t){r.geocode({address:t},function(t,n){e(function(){"OK"===n?a(t):alert("Geocode was not successful for the following reason: "+n)})})}function l(t){r.geocode({location:t},function(t,n){e(function(){"OK"===n?a(t):console.log("Geocoder failed due to: "+n)})})}function u(){k.setLngLat([p.lng,p.lat]),b.flyTo({center:[parseFloat(p.lng),parseFloat(p.lat)],zoom:15,speed:1.5,curve:1})}function h(t,e){var n={address:"route",number:"street_number",locality:"locality",postalCode:"postal_code",city:"administrative_area_level_3",province:"administrative_area_level_2",region:"administrative_area_level_1",country:"country"},r=null;return angular.forEach(e.address_components,function(e){angular.forEach(e.types,function(o){o===n[t]&&(r=e.long_name)})}),r}function f(){y&&(g=!0,x.style.cursor="grab",b.on("mousemove",d),b.once("mouseup",m))}function d(t){if(g){var e=t.lngLat;x.style.cursor="grabbing",k.setLngLat([e.lng,e.lat])}}function m(t){g&&(l(t.lngLat),x.style.cursor="",g=!1,b.off("mousemove",d))}var p=t.model.position||{};p.lat=p.lat||0,p.lng=p.lng||0;var g,y,v=n[0],b=new mapboxgl.Map({container:v,style:"mapbox://styles/mapbox/streets-v9",interactive:!0,logoPosition:"bottom-right",center:[p.lng,p.lat],zoom:9}),x=b.getCanvasContainer(),w=document.createElement("div");w.id="point",w.className="marker";var k=new mapboxgl.Marker(w,{offset:[-10,-10]}).setLngLat([p.lng,p.lat]).addTo(b);if(angular.element(w).on("mouseenter",function(t){x.style.cursor="move",y=!0,b.dragPan.disable()}),angular.element(w).on("mouseleave",function(t){x.style.cursor="",y=!1,b.dragPan.enable()}),window.googleMapInit=function(){r=new google.maps.Geocoder,console.log("googleMapInit")},!r){var M=document.createElement("script");M.setAttribute("async",null),M.setAttribute("defer",null),M.setAttribute("src","https://maps.googleapis.com/maps/api/js?key="+o+"&callback=googleMapInit"),document.body.appendChild(M)}t.$watch("map.address",function(e){e&&(t.map.results=null,t.map.setAddress=function(e){console.log("setAddress",e),angular.extend(t.model,e),t.map.results=null,u()},c(e))}),b.on("mousedown",f),p.lng,p.lat}if(mapboxgl){mapboxgl.accessToken="pk.eyJ1IjoiYWN0YXJpYW4iLCJhIjoiY2lqNWU3MnBzMDAyZndnbTM1cjMyd2N2MiJ9.CbuEGSvOAfIYggQv854pRQ";var r,o="AIzaSyAYuhIEO-41YT_GdYU6c1N7DyylT_OcMSY";return{restrict:"E",link:n}}}])}(),function(){"use strict";angular.module("app").directive("ngClick",["UI",function(t){function e(e,n,r,o){function i(e){var r=t.getTouch(e),o=t.getRelativeTouch(n,r);n.removeClass("animate"),n.offsetWidth,l.style.left=o.x+"px",l.style.top=o.y+"px",setTimeout(function(){
n.addClass("animate"),setTimeout(function(){n.removeClass("animate")},1e3)},1)}function s(t){n.off("mousedown",a),i(t)}function a(t){n.off("touchstart",s),i(t)}function c(){n.off("touchstart",s),n.off("mousedown",a)}n.addClass("material");var l=document.createElement("material");n[0].appendChild(l),e.$on("$destroy",function(){c()}),function(){n.on("touchstart",s),n.on("mousedown",a)}()}return{restrict:"A",priority:0,link:e}}])}(),function(){"use strict";angular.module("app")}(),function(){"use strict";angular.module("app").factory("State",["$timeout",function(t){function e(){this.isReady=!1,this.idle()}function n(){this.isBusy=!1,this.isError=!1,this.isErroring=!1,this.isSuccess=!1,this.isSuccessing=!1,this.button=null,this.errors=[]}function r(){return!this.isBusy&&!this.isErroring&&!this.isSuccessing}function o(){return!this.isBusy&&(this.isBusy=!0,this.isError=!1,this.isErroring=!1,this.isSuccess=!1,this.isSuccessing=!1,this.errors=[],!0)}function i(){this.isBusy=!1,this.isError=!1,this.isErroring=!1,this.isSuccess=!0,this.isSuccessing=!0,this.errors=[],t(function(){this.isSuccessing=!1,this.button=null}.bind(this),1e3)}function s(e){this.isBusy=!1,this.isError=!0,this.isErroring=!0,this.isSuccess=!1,this.isSuccessing=!1,this.errors.push(e),t(function(){this.isErroring=!1,this.button=null}.bind(this),1e3)}function a(){this.isReady=!0,this.success()}function c(){return this.isError?this.errors[this.errors.length-1]:null}function l(){return{busy:this.isBusy,ready:this.isReady,successing:this.isSuccessing,success:this.isSuccess,errorring:this.isErroring,error:this.isError}}function u(t,e,n,r){return t=t||"Submit",this.isBusy?e||t:this.isSuccess?n||t:this.isError?r||t:t}return e.prototype={idle:n,busy:o,enabled:r,error:s,ready:a,success:i,errorMessage:c,submitClass:l,submitMessage:u},e}])}(),function(){"use strict";angular.module("app").factory("Hash",[function(){function t(e,n){e=e||"id",n=n?t.get(n):{},Object.defineProperties(this,{key:{value:e,enumerable:!1,writable:!1},pool:{value:n,enumerable:!1,writable:!1},length:{value:0,enumerable:!1,writable:!0}})}function e(t){return void 0!==this.pool[t]}function n(t){return this.pool[t]}function r(t){var e=this,n=this.key;return t?e.getId(t[n]):null}function o(t){var e=this;return this.pool[t[this.key]]=t,e.push(t),t}function i(t){var e=this,n=e.get(t);if(n)for(var r,o=0,i=Object.keys(t);o<i.length;o++)r=i[o],n[r]=t[r];else n=e.set(t);return n}function s(t){var e=this,n=this.pool,r=this.key,o=e.get(t);if(o){var i=e.indexOf(o);-1!==i&&e.splice(i,1),delete n[o[r]]}return e}function a(t){var e=this;if(!t)return e;for(var n=0;n<t.length;)e.add(t[n]),n++;return e}function c(t){var e=this;if(!t)return e;for(var n=0;n<t.length;)e.remove(t[n]),n++;return e}function l(){var t,e=this,n=e.key,r=e.pool,o=0;for(e.length;e.length;)t=e.shift(),delete r[t[n]],o++;return e}function u(t){var e=this;if(t)for(var n=0;n<e.length;)t(e[n],n),n++;return e}function h(t,e){var n=this;return t=t||this.key,n.sort(function(n,r){var o=e?r:n,i=e?n:r;return o[t]-i[t]}),n}function f(t){return this.forward(t,!0)}function d(t){if(t.key!==this.key||t.length!==this.length)return!0;for(var e=!1,n=0,r=this.length,o=this.key;e&&n<r;)e=this[n][o]!==t[n][o],n++}function m(){var t=this,e=this.pool,n=this.key;Object.keys(e).forEach(function(t){delete e[t]}),angular.forEach(t,function(t){e[t[n]]=t})}var p={};return t.get=function(t){return p[t]=p[t]||{}},t.prototype=new Array,t.prototype.has=e,t.prototype.getId=n,t.prototype.get=r,t.prototype.set=o,t.prototype.add=i,t.prototype.remove=s,t.prototype.each=u,t.prototype.addMany=a,t.prototype.removeMany=c,t.prototype.removeAll=l,t.prototype.forward=h,t.prototype.backward=f,t.prototype.differs=d,t.prototype.updatePool=m,t}])}(),function(){"use strict";var t=angular.module("app");t.factory("Rect",[function(){function t(t,e,n,r){this.x=t||0,this.y=e||0,this.w=n||0,this.h=r||0}return t.mult=function(t,e){return t.x*=e,t.y*=e,t.w*=e,t.h*=e,t},t.prototype={mult:function(e){return t.mult(this,e)},offset:function(t,e){return this.x+=t,this.y+=e,this},reduce:function(t){return this.offset(-t)},reduceRect:function(e){return this.offsetRect(t.mult(e,-1))},expandRect:function(t){return this.x-=t.x||0,this.y-=t.y||0,this.w+=t.w||0,this.h+=t.h||0,this},expand:function(t){return this.expandRect({x:t,y:t,w:2*t,h:2*t})},intersect:function(t){var e=this.x,n=this.y,r=this.w,o=this.h;return!(t.x>e+r||t.x+t.w<e||t.y>n+o||t.y+t.h<n)},top:function(){var t=this.x,e=this.y,n=this.w;this.h;return{x:t+n/2,y:e}},right:function(){var t=this.x,e=this.y;return{x:t+this.w,y:e+this.h/2}},bottom:function(){var t=this.x,e=this.y;return{x:t+this.w/2,y:e+this.h}},left:function(){var t=this.x,e=this.y;this.w;return{x:t,y:e+this.h/2}},center:function(){var t=this.x,e=this.y;return{x:t+this.w/2,y:e+this.h/2}},topLeft:function(){var t=this.x,e=this.y;this.w,this.h;return{x:t,y:e}},topRight:function(){var t=this.x,e=this.y,n=this.w;this.h;return{x:t+n,y:e}},bottomRight:function(){var t=this.x,e=this.y;return{x:t+this.w,y:e+this.h}},bottomLeft:function(){var t=this.x,e=this.y;this.w;return{x:t,y:e+this.h}},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setW:function(t){return this.w=t,this},setH:function(t){return this.h=t,this},setPos:function(t,e){return this.x=t,this.y=e,this},setSize:function(t,e){return this.w=t,this.h=e,this},copy:function(t){return this.x=t.x,this.y=t.y,this.w=t.w,this.h=t.h,this},clone:function(){return new t(this.x,this.y,this.w,this.h)},toString:function(){return"{"+this.x+","+this.y+","+this.w+","+this.h+"}"}},t}]),t.factory("Color",[function(){function t(t,e,n,r){if(arguments.length>1)this.r=t||0===t?t:0,this.g=e||0===e?e:0,this.b=n||0===n?n:0,this.a=r||0===r?r:255;else{var o=t||"0xffffff";o=parseInt(o),t.length>8?(this.r=o>>24&255,this.g=o>>16&255,this.b=o>>8&255,this.a=o>>0&255):(this.r=o>>16&255,this.g=o>>8&255,this.b=o>>0&255,this.a=255)}}return t.componentToHex=function(t){var e=t.toString(16);return 1==e.length?"0"+e:e},t.luma=function(t){return t.dot({r:95,g:100,b:60})},t.contrast=function(e){return new t(t.luma(e)>.6?"0x000000":"0xffffff")},t.darker=function(e,n,r){return r=r||0,new t(Math.max(Math.floor(e.r*r),Math.floor(e.r-255*n)),Math.max(Math.floor(e.g*r),Math.floor(e.g-255*n)),Math.max(Math.floor(e.b*r),Math.floor(e.b-255*n)),e.a)},t.lighter=function(e,n,r){return r=r||1,new t(Math.min(e.r+Math.floor((255-e.r)*r),Math.floor(e.r+255*n)),Math.min(e.g+Math.floor((255-e.g)*r),Math.floor(e.g+255*n)),Math.min(e.b+Math.floor((255-e.b)*r),Math.floor(e.b+255*n)),e.a)},t.prototype={toUint:function(){return(this.r<<24)+(this.g<<16)+(this.b<<8)+this.a},toHex:function(){return"#"+t.componentToHex(this.r)+t.componentToHex(this.g)+t.componentToHex(this.b)+t.componentToHex(this.a)},toRgba:function(){return"rgba("+this.r+","+this.g+","+this.b+","+(this.a/255).toFixed(3)+")"},dot:function(t){return this.r/255*(t.r/255)+this.g/255*(t.g/255)+this.b/255*(t.b/255)},alpha:function(t,e,n){return e=e||0,n=n||1,this.a=Math.floor(255*(e+t*(n-e))),this},makeSet:function(){return this.foreground=t.contrast(this),this.border=t.darker(this,.3),this.light=t.lighter(this,.3),this}},t}]),t.factory("Shape",[function(){function t(){}return t.shapeCircle=function(t,e,n,r,o,i){o=o||0,i=i||2*Math.PI,t.ctx.arc(e,n,r,o,i,!1)},t.shapeStar=function(t,e,n,r,o,s){var a,c,l=Math.PI/2*3,u=Math.PI/s,h=t.ctx;for(h.moveTo(e,n-r),i=0;i<s;i++)a=e+Math.cos(l)*r,c=n+Math.sin(l)*r,h.lineTo(a,c),l+=u,a=e+Math.cos(l)*o,c=n+Math.sin(l)*o,h.lineTo(a,c),l+=u;h.lineTo(e,n-r)},t.shapeRoundRect=function(t,e,n){var r=t.ctx,o=e.x,i=e.y,s=e.w,a=e.h;if(void 0===typeof n&&(n=4),"number"==typeof n)n={tl:n,tr:n,br:n,bl:n};else{var c={tl:0,tr:0,br:0,bl:0};for(var t in c)n[t]=n[t]||c[t]}r.moveTo(o+n.tl,i),r.lineTo(o+s-n.tr,i),r.quadraticCurveTo(o+s,i,o+s,i+n.tr),r.lineTo(o+s,i+a-n.br),r.quadraticCurveTo(o+s,i+a,o+s-n.br,i+a),r.lineTo(o+n.bl,i+a),r.quadraticCurveTo(o,i+a,o,i+a-n.bl),r.lineTo(o,i+n.tl),r.quadraticCurveTo(o,i,o+n.tl,i)},t.circle=function(){var e=Array.prototype.slice.call(arguments),n=e[0].ctx;n.beginPath(),t.shapeCircle.apply(this,e),n.closePath()},t.star=function(){var e=Array.prototype.slice.call(arguments),n=e[0].ctx;n.beginPath(),t.shapeStar.apply(this,e),n.closePath()},t.roundRect=function(){var e=Array.prototype.slice.call(arguments),n=e[0].ctx;n.beginPath(),t.shapeRoundRect.apply(this,e),n.closePath()},t}]),t.constant("PainterColors",{black:"0x14191e",white:"0xffffff",blue:"0x03a9f4",red:"0xF21500",lightBlue:"0x79ccf2",lightYellow:"0xfff79a",greyLighter:"0xf8f8f8",greyLight:"0xeeeeee",greyMedium:"0xcccccc",grey:"0x90939b",map:"0x24292e"}),t.factory("Palette",["$q","Painter","Rect",function(t,e,n){function r(){this.painter=(new e).setSize(0,0),this.buffer=(new e).setSize(0,0),this.size={w:0,h:0},this.pool={},this.rows={}}return r.prototype={getRect:function(t,e){var r=this.painter,o=this.size,i=this.rows,s=new n(0,0,t,e),a=i[e]||{x:0,y:o.h};if(o.w=Math.max(o.w,a.x+t),o.h=Math.max(o.h,a.y+e),r.canvas.width||r.canvas.height){if(o.w>r.canvas.width||o.h>r.canvas.height){var c=r.canvas;r.setCanvas(document.createElement("canvas")),r.setSize(o.w,o.h),r.ctx.drawImage(c,0,0)}}else r.setSize(o.w,o.h);return s.x=a.x,s.y=a.y,a.x+=t,i[e]=a,s},add:function(e,n){var r=this;if(angular.isString(n)){var o=t.defer(),i=new Image;return i.onload=function(){r.addShape(e,i.width,i.height,function(t,e){t.ctx.drawImage(i,0,0)}),o.resolve(i)},i.onerror=function(){o.reject("connot load "+n)},i.src=n,o.promise}var s=Array.prototype.slice.call(arguments);return r.addShape.apply(r,s)},addShape:function(t,e,n,r){var o=this.painter,i=this.getRect(e,n);o.ctx.save(),o.ctx.rect(i.x,i.y,i.w,i.h),o.ctx.clip(),o.ctx.translate(i.x,i.y),r.call(o,o,i.clone().setPos(0,0)),o.ctx.restore(),this.pool[t]=i},draw:function(t,e,n,r,o){var i=this.pool[e];i&&t.drawRect(this.painter.canvas,i,{x:n,y:r,w:i.w,h:i.h},o)},tint:function(t,e,n,r,o,i){var s=this.pool[e];if(s){var a=this.painter,c=this.buffer.setSize(s.w,s.h);c.save(),c.setFill(o),c.fillRect(),c.ctx.globalCompositeOperation="destination-atop",c.ctx.drawImage(a.canvas,s.x,s.y,s.w,s.h,0,0,s.w,s.h),c.restore(),console.log(n,r,c.canvas,t.canvas),t.draw(c.canvas,{x:n,y:r},i)}},pattern:function(t,e,n,r,o,i,s){function a(e){var s=t.ctx;s.save(),s.translate(n,r),s.fillStyle=e,s.fillRect(-n,-r,o,i),s.translate(-n,-r),s.restore()}var c=this.pool[e];if(c){var l,u=c.img;if(u&&c.color==s)l=t.ctx.createPattern(u,"repeat"),a(l);else{var h=this.buffer.setSize(c.w,c.h);s?(c.color=s,h.save(),h.setFill(s),h.fillRect(),h.ctx.globalCompositeOperation="destination-atop",h.ctx.drawImage(this.painter.canvas,c.x,c.y,c.w,c.h,0,0,c.w,c.h),h.restore()):h.ctx.drawImage(this.painter.canvas,c.x,c.y,c.w,c.h,0,0,c.w,c.h);var u=new Image;u.onload=function(){c.img=u,l=t.ctx.createPattern(u,"repeat"),a(l)},u.src=h.toDataURL()}}}},r}]),t.factory("Painter",["Shape","Rect","Color","PainterColors",function(t,e,n,r){function o(t){t=t||document.createElement("canvas"),this.rect=new e,this.drawingRect=new e,this.setColors(),this.setCanvas(t)}o.colors={},angular.forEach(r,function(t,e){o.colors[e]=new n(t).makeSet()});o.colors;return o.prototype={colors:o.colors,setColors:function(){var t=this.colors;angular.forEach(r,function(e,r){t[r]=new n(e).makeSet()})},setCanvas:function(t){this.canvas=t,this.setSize(t.offsetWidth,t.offsetHeight);var e=t.getContext("2d");return e.lineCap="square",this.ctx=e,this},setSize:function(t,e){return this.canvas.width=t,this.canvas.height=e,this.rect.w=t,this.rect.h=e,this},copy:function(t){return this.ctx.drawImage(t,0,0),this},clear:function(){return this.resize(),this},resize:function(){return this.setSize(this.canvas.offsetWidth,this.canvas.offsetHeight),this},setText:function(t,e,n,r){t=t||"11px monospace",e=e||"center",n=n||"middle",r=r||this.colors.black;var o=this.ctx;return o.font=t,o.textAlign=e,o.textBaseline=n,o.fillStyle=r.toRgba(),this},setFill:function(t){return t=t||this.colors.black,this.ctx.fillStyle=t.toRgba(),this},setStroke:function(t,e){t=t||this.colors.black;var n=this.ctx;return e=e||1,n.strokeStyle=t.toRgba(),n.lineWidth=e,this},fillText:function(t,e,n,r,o){return n&&(r=r||"",o=o||Math.floor(n/8),t.length>o&&(t=t.substr(0,Math.min(t.length,o)).trim()+r)),this.ctx.fillText(t,e.x,e.y),this},fillRect:function(t){t=t||this.rect;var e=this.ctx,n=t.x,r=t.y,o=t.w,i=t.h;return e.fillRect(n,r,o,i),this},strokeRect:function(t){t=t||this.rect;var e=this.ctx,n=t.x,r=t.y,o=t.w,i=t.h;return e.strokeRect(n,r,o,i),this},fill:function(){return this.ctx.fill(),this},stroke:function(){return this.ctx.stroke(),this},begin:function(){return this.ctx.beginPath(),this},close:function(){return this.ctx.closePath(),this},save:function(){return this.ctx.save(),this},restore:function(){return this.ctx.restore(),this},rotate:function(t){this.ctx.rotate(t*Math.PI/180)},translate:function(t){this.ctx.translate(t.x,t.y)},toDataURL:function(){return this.canvas.toDataURL()},draw:function(t,e,n){if(t){e.w=e.w||t.width,e.h=e.h||t.height;var r=this.ctx,o=this.drawingRect,i=o.x=e.x-e.w/2,s=o.y=e.y-e.h/2;o.w=e.w,o.h=e.h;r.save(),r.translate(i,s),n&&n.call(this),r.drawImage(t,0,0),r.restore()}return this},drawRect:function(t,e,n,r){if(t){e.w=e.w||t.width,e.h=e.h||t.height,n.w=n.w||t.width,n.h=n.h||t.height;var o=this.ctx,i=this.drawingRect,s=i.x=n.x-e.w/2,a=i.y=n.y-e.h/2;i.w=n.w,i.h=n.h;o.save(),o.translate(s,a),r&&r.call(this),o.drawImage(t,e.x,e.y,e.w,e.h,0,0,n.w,n.h),o.restore()}return this},flip:function(t){t=t||{x:1,y:-1};var e=this.ctx,n=this.drawingRect;e.translate(-1===t.x?n.w:0,-1===t.y?n.h:0),e.scale(t.x,t.y)}},o}])}(),function(){"use strict";angular.module("app").service("Router",["$location","$timeout",function(t,e){function n(n,r){function o(){t.$$lastRequestedPath=t.path(),t.path(n)}r?e(function(){o()},r):o()}function r(n,r){function o(){n=t.$$lastRequestedPath||n,t.$$lastRequestedPath=null,t.path(n)}r?e(function(){o()},r):o()}var o=this;o.redirect=n,o.retry=r}])}(),function(){"use strict";var t=angular.module("app");t.factory("Cookie",["$q","$window",function(t,e){function n(){}return n.TIMEOUT=3e5,n._set=function(t,n,r){var o;if(r){var i=new Date;i.setTime(i.getTime()+24*r*60*60*1e3),o="; expires="+i.toGMTString()}else o="";e.document.cookie=t+"="+n+o+"; path=/"},n.set=function(t,e,r){try{var o=[],i=JSON.stringify(e,function(t,e){if("pool"!==t){if("object"==typeof e&&null!==e){if(-1!==o.indexOf(e))return;o.push(e)}return e}});o=null,n._set(t,i,r)}catch(n){console.log("Cookie.set.error serializing",t,e,n)}},n.get=function(t){for(var n=t+"=",r=e.document.cookie.split(";"),o=0;o<r.length;o++){for(var i=r[o];" "==i.charAt(0);)i=i.substring(1,i.length);if(0===i.indexOf(n)){var s=i.substring(n.length,i.length),a=null;try{a=JSON.parse(s)}catch(t){console.log("Cookie.get.error parsing",key,t)}return a}}return null},n.delete=function(t){n._set(t,"",-1)},n.on=function(e){function r(){if(a>c)i.reject("timeout");else{var t=n.get(e);t?i.resolve(t):(a+=s,o=setTimeout(r,s))}}var o,i=t.defer(),s=1e3,a=0,c=n.TIMEOUT;return r(),i.promise},n}]),t.factory("LocalStorage",["$q","$window","Cookie",function(t,e,n){function r(){}return r.isSupported=function(){var t=!1;try{t="localStorage"in e&&null!==e.localStorage,t?(e.localStorage.setItem("test","1"),e.localStorage.removeItem("test")):t=!1}catch(e){t=!1}return t}(),r.isSupported?(r.set=function(t,n){try{var r=[],o=JSON.stringify(n,function(t,e){if("pool"!==t){if("object"==typeof e&&null!==e){if(-1!==r.indexOf(e))return;r.push(e)}return e}});r=null,e.localStorage.setItem(t,o)}catch(e){console.log("LocalStorage.set.error serializing",t,n,e)}},r.get=function(t){var n=null;if(void 0!==e.localStorage[t])try{n=JSON.parse(e.localStorage[t])}catch(e){console.log("LocalStorage.get.error parsing",t,e)}return n},r.delete=function(t){e.localStorage.removeItem(t)},r.on=function(r){function o(t){if(clearTimeout(i),t.originalEvent.key==r)try{var e=JSON.parse(t.originalEvent.newValue);s.resolve(e)}catch(t){console.log("LocalStorage.on.error parsing",r,t),s.reject("error parsing "+r)}}var i,s=t.defer(),a=n.TIMEOUT;return angular.element(e).on("storage",o),i=setTimeout(function(){s.reject("timeout")},a),s.promise}):(console.log("LocalStorage.unsupported switching to cookies"),r.set=n.set,r.get=n.get,r.delete=n.delete,r.on=n.on),r}]),t.factory("SessionStorage",["$q","$window","Cookie",function(t,e,n){function r(){}return r.isSupported=function(){var t=!1;try{t="sessionStorage"in e&&void 0!==e.sessionStorage,t?(e.sessionStorage.setItem("test","1"),e.sessionStorage.removeItem("test")):t=!1}catch(e){t=!1}return t}(),r.isSupported?(r.set=function(t,n){try{var r=[],o=JSON.stringify(n,function(t,e){if("pool"!==t){if("object"==typeof e&&null!==e){if(-1!==r.indexOf(e))return;r.push(e)}return e}});r=null,e.sessionStorage.setItem(t,o)}catch(e){console.log("SessionStorage.set.error serializing",t,n,e)}},r.get=function(t){var n=null;if(void 0!==e.sessionStorage[t])try{n=JSON.parse(e.sessionStorage[t])}catch(e){console.log("SessionStorage.get.error parsing",t,e)}return n},r.delete=function(t){e.sessionStorage.removeItem(t)},r.on=function(r){function o(t){if(clearTimeout(i),t.originalEvent.key===r)try{var e=JSON.parse(t.originalEvent.newValue);s.resolve(e)}catch(t){console.log("SessionStorage.on.error parsing",r,t),s.reject("error parsing "+r)}}var i,s=t.defer(),a=n.TIMEOUT;return angular.element(e).on("storage",o),i=setTimeout(function(){s.reject("timeout")},a),s.promise}):(console.log("SessionStorage.unsupported switching to cookies"),r.set=n.set,r.get=n.get,r.delete=n.delete,r.on=n.on),r}])}(),function(){"use strict";angular.module("app").service("FirebaseApi",["$q","$firebaseAuth","$firebaseObject","$firebaseArray","LocalStorage","Router",function(t,e,n,r,o,i){function s(){var n=t.defer();return w.presence?n.resolve(w.presence):e().$signInAnonymously({remember:"sessionOnly"}).then(function(t){var e=w.presence={uid:t.uid};n.resolve(e)}).catch(function(t){console.log("Error",t),n.reject(t)}),n.promise}function a(){var e=t.defer();if(w.user)e.resolve(w.user);else{var n=o.get("token");n?s().then(function(t){p("users",{token:n}).then(function(t){var t=w.user=t;e.resolve(t)},function(t){e.reject(t)})},function(t){e.reject(t)}):e.reject({message:"not logged"})}return e.promise}function c(e){console.log("FirebaseApi.signin",e);var n=t.defer();return w.user?(console.log("signed",w.user),n.resolve(w.user)):s().then(function(t){p("users",{email:e.email}).then(function(t){t.password===e.password?(o.set("token",t.token),w.user=t,n.resolve(t)):n.reject({message:"not found"})},function(t){n.reject(t)})},function(t){n.reject(t)}),n.promise}function l(e){console.log("FirebaseApi.signup",e);var n=t.defer();return s().then(function(t){e.token=t.uid,v("users",e).then(function(t){o.set("token",t.token),w.user=t,n.resolve(t)},function(t){n.reject(t)})},function(t){n.reject(t)}),n.promise}function u(){console.log("FirebaseApi.signout");var e=t.defer();return o.delete("token"),w.user=null,e.resolve(),e.promise}function h(){return y("items",{token:"token"})}function f(e){var n=t.defer();return a().then(function(t){n.resolve(w.user)},function(){n.reject(),i.redirect(e)}),n.promise}function d(e){console.log("userSave",e);var n=t.defer();return e.$save().then(function(t){n.resolve(e)},function(t){console.log("userSave",t),n.reject(t)}),n.promise}function m(t){var e=[];for(var n in t)e.push({key:n,value:t[n]});var r=null;return e.length&&(r=e.shift()),r}function p(e,n,r){var o=t.defer();return y(e,n,r).then(function(t){if(1===t.length){var n=t[0].$id;g(e,n).then(function(t){o.resolve(t)},function(t){o.reject()})}else o.reject()},function(t){o.reject(t)}),o.promise}function g(t,e){var r=b.database().ref(),o=r.child(t).child(e);return n(o).$loaded()}function y(t,e,n){var o=b.database().ref(),i=o.child(t),s=i;if(e){var a=m(e);a&&(s=i.orderByChild(a.key).equalTo(a.value),n&&(s=s.limitToLast(n)))}return r(s).$loaded()}function v(t,e){var r=b.database().ref(),o=r.child(t),i=o.push();return i.set(e),n(i).$loaded()}var b=window.firebase||null;if(!b)throw"missing firebase.js";var x={apiKey:"AIzaSyCskd8Cgzd_j7JzgEC3mEb4ir1qZFh6auQ",authDomain:"starfish-c2b0f.firebaseapp.com",databaseURL:"https://starfish-c2b0f.firebaseio.com",projectId:"starfish-c2b0f",storageBucket:"starfish-c2b0f.appspot.com",messagingSenderId:"796739915579"};b.initializeApp(x);var w=this;w.user=void 0,w.presence=void 0,w.items=h,w.auth={signin:c,signup:l,signout:u},w.users={save:d},w.current=a,w.isLoggedOrGoTo=f}])}(),function(){"use strict";var e=angular.module("app");e.factory("Vector",function(){function t(t,e){this.x=t||0,this.y=e||0}return t.make=function(e,n){return new t(n.x-e.x,n.y-e.y)},t.size=function(t){return Math.sqrt(t.x*t.x+t.y*t.y)},t.normalize=function(e){var n=t.size(e);return e.x/=n,e.y/=n,e},t.incidence=function(t,e){return Math.atan2(e.y,e.x)-Math.atan2(t.y,t.x)},t.distance=function(t,e){return Math.sqrt((t.x-e.x)*(t.x-e.x)+(t.y-e.y)*(t.y-e.y))},t.cross=function(t,e){return t.x*e.y-t.y*e.x},t.difference=function(e,n){return new t(e.x-n.x,e.y-n.y)},t.power=function(t,e){return(Math.abs(e.x-t.x)+Math.abs(e.y-t.y))/2},t.prototype={size:function(){return t.size(this)},normalize:function(){return t.normalize(this)},incidence:function(e){return t.incidence(this,e)},cross:function(e){return t.cross(this,e)},distance:function(e){return t.distance(this,e)},difference:function(e){return t.difference(this,e)},power:function(){return(Math.abs(this.x)+Math.abs(this.y))/2},towards:function(t,e){return e=e||.125,this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this},add:function(t){return this.x+=t.x,this.y+=t.y,this},friction:function(t){return this.x*=t,this.y*=t,this},copy:function(e){return new t(this.x,this.y)},toString:function(){return"{"+this.x+","+this.y+"}"}},t}),e.service("UI",["Vector",function(e){function n(n,r){var o=new e;if("touchstart"===n.type||"touchmove"===n.type||"touchend"===n.type||"touchcancel"===n.type){var i=null,s=n.originalEvent?n.originalEvent:n,a=s.touches.length?s.touches:s.changedTouches;a&&a.length&&(i=a[0]),i&&(o.x=i.pageX,o.y=i.pageY)}else"click"!==n.type&&"mousedown"!==n.type&&"mouseup"!==n.type&&"mousemove"!==n.type&&"mouseover"!==n.type&&"mouseout"!==n.type&&"mouseenter"!==n.type&&"mouseleave"!==n.type&&"contextmenu"!==n.type||(o.x=n.pageX,o.y=n.pageY);return r&&(o.s=e.difference(t,r)),o.type=n.type,o}function r(t,n){t=angular.element(t)[0];var r=t.getBoundingClientRect(),o=new e(r.left,r.top);return e.difference(n,o)}function o(t,e){var n,r;if(["matches","webkitMatchesSelector","mozMatchesSelector","msMatchesSelector","oMatchesSelector"].some(function(t){return"function"==typeof document.body[t]&&(n=t,!0)}),t[n](e))return t;for(;null!==t;){if(null!==(r=t.parentElement)&&r[n](e))return r;t=r}return null}function i(t,e){var n;if(t===e)return t;for(;null!==t;){if(null!==(n=t.parentElement)&&n===e)return n;t=n}return null}var s=this;return s.getTouch=n,s.getRelativeTouch=r,s.getClosest=o,s.getClosestElement=i,s}])}();