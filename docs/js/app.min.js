!function(){"use strict";angular.module("app",["ngRoute","ngMessages","ui.bootstrap","mapboxgl-directive","firebase","jsonFormatter"])}(),function(){"use strict";angular.module("app").config(["$httpProvider",function(e){}])}(),function(){"use strict";angular.module("app").config(["$routeProvider","$locationProvider",function(e,t){e.when("/",{title:"Homepage",templateUrl:"partials/home.html",controller:"HomeCtrl"}).when("/profile",{title:"Profile",templateUrl:"partials/profile.html",controller:"ProfileCtrl",resolve:{user:["FirebaseApi",function(e){return e.isLoggedOrGoTo("/signin")}]}}).when("/signin",{title:"Accedi",templateUrl:"partials/signin.html",controller:"SigninCtrl"}).when("/signup",{title:"Registrazione",templateUrl:"partials/signup.html",controller:"SignupCtrl"}).when("/dashboard",{title:"Dashboard",templateUrl:"partials/dashboard.html",controller:"DashboardCtrl",resolve:{user:["FirebaseApi",function(e){return e.isLoggedOrGoTo("/signin")}]}}).when("/user/:userId",{title:"User",templateUrl:"partials/user.html",controller:"UserCtrl",resolve:{user:["FirebaseApi",function(e){return e.isLoggedOrGoTo("/signin")}]}}).when("/404",{title:"Error 404",templateUrl:"partials/404"}),e.otherwise("/"),t.html5Mode(!1),t.hashPrefix("")}])}(),function(){"use strict";var e=angular.module("app");e.service("FirebaseApi",["$q","FirebaseService","LocalStorage","Router",function(e,t,n,r){function o(){var r=e.defer();if(d.user)r.resolve(d.user);else{var o=n.get("token");o?t.getSingle("users",{token:o}).then(function(e){d.user=e,r.resolve(e)},function(e){r.reject(t.error(e))}):r.reject(t.error("not logged"))}return r.promise}function i(r){console.log("FirebaseApi.userSignin",r);var o=e.defer();return d.user?(console.log("signed",d.user),o.resolve(d.user)):t.getSingle("users",{email:r.email}).then(function(e){r.password===e.password?(n.set("token",e.token),d.user=e,o.resolve(e)):o.reject(getEttot("not found"))},function(e){o.reject(t.error(e))}),o.promise}function s(r){console.log("FirebaseApi.userSignup",r);var o=e.defer();return t.getSingle("users",{email:r.email}).then(function(e){o.reject(t.error("indirizzo email già in uso."))},function(e){r.token=t.presence.uid,addObject("users",r).then(function(e){n.set("token",e.token),d.user=e,o.resolve(e)},function(e){o.reject(t.error(e))})}),o.promise}function a(){console.log("FirebaseApi.signout");var t=e.defer();return n.delete("token"),d.user=null,t.resolve(),t.promise}function c(){return t.getArray("users")}function u(e){return t.getSingle("users",{id:e})}function l(n){var r=e.defer();return t.saveObject(n).then(function(e){r.resolve(n)},function(e){console.log("userSave",e),r.reject(t.error(e))}),r.promise}function f(){return getArray("items",{token:"token"})}function h(){return t.getArray("users")}function p(n){var i=e.defer();return o().then(function(e){i.resolve(d.user)},function(e){i.reject(t.error(e)),r.redirect(n)}),i.promise}var d=this;d.user=void 0,d.isLoggedOrGoTo=p,d.auth={current:o,signin:i,signup:s,signout:a},d.users={index:c,detail:u,save:l},d.items=f,d.facilities=h}]),e.service("FirebaseService",["$q","$firebaseAuth","$firebaseObject","$firebaseArray",function(e,t,n,r){function o(){return(new Date).getTime()+Math.floor(9999*Math.random())}function i(){var n=e.defer();if(g.presence)n.resolve(g.presence);else{t().$signInAnonymously({remember:"sessionOnly"}).then(function(e){var t=g.presence={uid:e.uid};n.resolve(t)}).catch(function(e){n.reject(h(e))})}return n.promise}function s(e){var t=[];for(var n in e)t.push({key:n,value:e[n]});var r=null;return t.length&&(r=t.shift()),r}function a(t,n,r){var o=e.defer();return i().then(function(e){u(t,n,r).then(function(e){if(1===e.length){var n=e[0].$id;c(t,n).then(function(e){o.resolve(e)},function(e){o.reject(h(e))})}else o.reject(h("record duplicati"))},function(e){o.reject(h(e))})},function(e){o.reject(h(e))}),o.promise}function c(t,r){var o=e.defer();return i().then(function(e){var i=p.database().ref(),s=i.child(t).child(r);n(s).$loaded().then(function(e){o.resolve(e)},function(e){o.reject(h(e))})},function(e){o.reject(h(e))}),o.promise}function u(t,n,o){var a=e.defer();return i().then(function(e){var i=p.database().ref(),c=i.child(t),u=c;if(n){var l=s(n);l&&(u=c.orderByChild(l.key).equalTo(l.value),o&&(u=u.limitToLast(o)))}r(u).$loaded().then(function(e){a.resolve(e)},function(e){a.reject(h(e))})},function(e){a.reject(h(e))}),a.promise}function l(t,r){var s=e.defer();return i().then(function(e){var i=p.database().ref(),a=i.child(t),c=a.push();r.id=o(),c.set(r),n(c).$loaded().then(function(e){s.resolve(e)},function(e){s.reject(h(e))})},function(e){s.reject(h(e))}),s.promise}function f(e){return e.$save()}function h(e){var t=400,n="Errore";return angular.isString(e)?n=e:e&&e.message&&(t=e.status,n=e.message),{status:t,message:n}}var p=window.firebase||null;if(!p)throw"missing firebase.js";var d={apiKey:"AIzaSyCskd8Cgzd_j7JzgEC3mEb4ir1qZFh6auQ",authDomain:"starfish-c2b0f.firebaseapp.com",databaseURL:"https://starfish-c2b0f.firebaseio.com",projectId:"starfish-c2b0f",storageBucket:"starfish-c2b0f.appspot.com",messagingSenderId:"796739915579"};p.initializeApp(d);var g=this;g.presence=void 0,g.getSingle=a,g.getObject=c,g.getArray=u,g.addObject=l,g.saveObject=f,g.error=h}]),e.service("_____FirebaseApi",["$q","$firebaseAuth","$firebaseObject","$firebaseArray","LocalStorage","Router",function(e,t,n,r,o,i){function s(e){var t=400,n="Errore";return angular.isString(e)?n=e:e&&e.message&&(t=e.status,n=e.message),{status:t,message:n}}function a(){return(new Date).getTime()+Math.floor(9999*Math.random())}function c(){var n=e.defer();if(E.presence)n.resolve(E.presence);else{t().$signInAnonymously({remember:"sessionOnly"}).then(function(e){var t=E.presence={uid:e.uid};n.resolve(t)}).catch(function(e){console.log("Error",e),n.reject(s(e))})}return n.promise}function u(){var t=e.defer();if(E.user)t.resolve(E.user);else{var n=o.get("token");n?c().then(function(e){y("users",{token:n}).then(function(e){E.user=e,t.resolve(e)},function(e){t.reject(s(e))})},function(e){t.reject(s(e))}):t.reject(s("not logged"))}return t.promise}function l(t){console.log("FirebaseApi.signin",t);var n=e.defer();return E.user?(console.log("signed",E.user),n.resolve(E.user)):c().then(function(e){y("users",{email:t.email}).then(function(e){e.password===t.password?(o.set("token",e.token),E.user=e,n.resolve(e)):n.reject(getEttot("not found"))},function(e){n.reject(s(e))})},function(e){n.reject(s(e))}),n.promise}function f(t){console.log("FirebaseApi.signup",t);var n=e.defer();return c().then(function(e){y("users",{email:t.email}).then(function(e){n.reject(s("indirizzo email già in uso."))},function(r){t.token=e.uid,t.id=a(),w("users",t).then(function(e){o.set("token",e.token),E.user=e,n.resolve(e)},function(e){n.reject(s(e))})})},function(e){n.reject(s(e))}),n.promise}function h(){console.log("FirebaseApi.signout");var t=e.defer();return o.delete("token"),E.user=null,t.resolve(),t.promise}function p(){return x("users")}function d(){return x("items",{token:"token"})}function g(t){var n=e.defer();return u().then(function(e){n.resolve(E.user)},function(e){n.reject(s(e)),i.redirect(t)}),n.promise}function m(t){console.log("userSave",t);var n=e.defer();return t.$save().then(function(e){n.resolve(t)},function(e){console.log("userSave",e),n.reject(s(e))}),n.promise}function v(e){var t=[];for(var n in e)t.push({key:n,value:e[n]});var r=null;return t.length&&(r=t.shift()),r}function y(t,n,r){var o=e.defer();x(t,n,r).then(function(e){if(1===e.length){var n=e[0].$id;b(t,n).then(function(e){o.resolve(e)},function(e){o.reject(s(e))})}else o.reject(s("record duplicati"))},function(e){o.reject(s(e))});return o.promise}function b(e,t){var r=S.database().ref(),o=r.child(e).child(t);return n(o).$loaded()}function x(e,t,n){var o=S.database().ref(),i=o.child(e),s=i;if(t){var a=v(t);a&&(s=i.orderByChild(a.key).equalTo(a.value),n&&(s=s.limitToLast(n)))}return r(s).$loaded()}function w(e,t){var r=S.database().ref(),o=r.child(e),i=o.push();return i.set(t),n(i).$loaded()}var S=window.firebase||null;if(!S)throw"missing firebase.js";var k={apiKey:"AIzaSyCskd8Cgzd_j7JzgEC3mEb4ir1qZFh6auQ",authDomain:"starfish-c2b0f.firebaseapp.com",databaseURL:"https://starfish-c2b0f.firebaseio.com",projectId:"starfish-c2b0f",storageBucket:"starfish-c2b0f.appspot.com",messagingSenderId:"796739915579"};S.initializeApp(k);var E=this;E.user=void 0,E.presence=void 0,E.items=d,E.facilities=p,E.auth={signin:l,signup:f,signout:h},E.users={save:m},E.current=u,E.isLoggedOrGoTo=g}])}(),function(){"use strict";var e=angular.module("app");e.controller("RootCtrl",["$scope","$location","FirebaseApi",function(e,t,n){e.api=n,e.signout=function(){console.log(n),n.auth.signout().then(function(){t.path("/")})},n.auth.current().then(function(t){e.user=t,console.log(t)},function(e){console.log("RootCtrl.error",e)})}]),e.controller("HomeCtrl",["$scope","State","FirebaseApi",function(e,t,n){var r=e.state=new t;e.map={};n.facilities().then(function(t){e.map.items=t,r.ready()},function(e){r.error(e)}),r.ready()}]),e.controller("ProfileCtrl",["$scope","State","FirebaseApi","user",function(e,t,n,r){var o=e.state=new t,i=e.MODES={BEACH:1,PRICES:2,PLACE:3,OPENING:4,INFO:5},s=(e.mode=i.BEACH,e.model={shopName:r.shopName,address:r.address,number:r.number,postalCode:r.postalCode,locality:r.locality,city:r.city,province:r.province,region:r.region,country:r.country,position:r.position}),a=(e.map={},e.beach=r.beach||{items:[],cols:0,rows:0});e.controls={};e.submit=function(e){o.busy(e)&&(angular.forEach(s,function(e,t){e?r[t]=e:delete r[t]}),r.beach=a,n.users.save(r).then(function(e){console.log("response",e),o.success()},function(e){o.error(e)}))},e.saveItems=function(t){e.submit(t)}}]),e.controller("DashboardCtrl",["$scope","State","FirebaseApi","user",function(e,t,n,r){(e.state=new t).ready(),n.items().then(function(t){console.log("DashboardCtrl.items",t),e.items=t})}]),e.controller("SigninCtrl",["$scope","State","Router","FirebaseApi",function(e,t,n,r){var o=e.state=new t,i=e.model={};e.submit=function(e){o.busy(e)&&r.auth.signin(i).then(function(e){o.success(),n.retry("/dashboard")},function(e){console.log("SigninCtrl.error",e),o.error(e)})}}]),e.controller("SignupCtrl",["$scope","State","Router","FirebaseApi",function(e,t,n,r){var o=e.state=new t,i=e.model={};e.submit=function(e){o.busy(e)&&r.auth.signup(i).then(function(e){o.success(),n.retry("/dashboard")},function(e){console.log("SignupCtrl.error",e),o.error(e)})}}])}(),function(){"use strict";angular.module("app").directive("beach",["$http","$timeout","Painter","Palette","Rect","Events","Hash",function(e,t,n,r,o,i,s){function a(e,o,s,a){function c(e,t){var n=L;$?n.setFill(n.colors.white):n.setFill(n.colors.grey),n.ctx.beginPath(),n.ctx.arc(e,t,6,0,2*Math.PI,!1),n.ctx.fill()}function u(e,t){var n=.4*C.w,r=L;r.ctx.beginPath(),r.ctx.moveTo(e+n*Math.cos(0),t+n*Math.sin(0));for(var o=1;o<=7;o++)r.ctx.lineTo(e+n*Math.cos(2*o*Math.PI/7),t+n*Math.sin(2*o*Math.PI/7));r.ctx.fill()}function l(e,t){var n={x:(e-T.x)/A.w,y:(t-T.y)/A.h};e+=C.w*n.x*.75,t+=C.h*n.y*.75;var r=L;r.setFill(r.colors.greyLight),u(e,t)}function f(e,t){var n=L;n.setFill(n.colors.blue),u(e,t)}function h(){var e=L;e.clear(),O.pattern(e,"bg",0,0,e.rect.w,e.rect.h),angular.forEach(P,function(e){l(e.x*C.w+C.w2,e.y*C.h+C.h2)}),angular.forEach(P,function(e){f(e.x*C.w+C.w2,e.y*C.h+C.h2)}),E&&c(E.x*C.w+C.w2,E.y*C.h+C.h2)}function p(e){P.push({x:e.x,y:e.y})}function d(e){for(var t,n=-1,r=0,o=P.length;r<o;)t=P[r],t.x===e.x&&t.y===e.y&&(n=r,r=o),r++;return n}function g(e){P.splice(e,1)}function m(e){var t=d(e);return-1!==t?g(t):p(e),t}function v(){$=null,angular.forEach(P,function(e){e.x===E.x&&e.y===E.y&&($=e)}),h()}function y(){var e={},t={},n=0,r=0;angular.forEach(P,function(o){e[o.x]||(e[o.x]=!0,n++),t[o.y]||(t[o.y]=!0,r++)}),j.cols=n,j.rows=r}function b(){t(function(){y()})}function x(e){var t=e.relative,n={x:Math.floor(t.x/C.w),y:Math.floor(t.y/C.h)};I=!0,M=m(n),v(),b()}function w(e){var t=e.relative;if(T={x:t.x,y:t.y},E={x:Math.floor(t.x/C.w),y:Math.floor(t.y/C.h)},I){var n=d(E);-1===M&&-1===n?p(E):M>=0&&-1!==n&&g(n)}v()}function S(e){I&&(I=!1,b())}function k(e){var t=o[0].offsetWidth,n=o[0].offsetHeight;A.w=t,A.h=n,h()}var E,$,I,M,T={x:0,y:0},A={w:0,h:0},C={w:40,h:40,w2:20,h2:20},j=e.beach,R=e.controls,P=j.items,L=new n(o[0]),O=new r;O.add("bg",C.w,C.h,function(e,t){e.setFill(e.colors.greyLight),e.ctx.beginPath(),e.ctx.arc(t.center().x,t.center().y,5,0,2*Math.PI,!1),e.ctx.fill()}),R.setCenter=function(){if(j.rows&&j.cols){var e=Math.floor(A.w/C.w),t=Math.floor(A.h/C.h),n=Number.POSITIVE_INFINITY,r=Number.POSITIVE_INFINITY;angular.forEach(P,function(e){n=Math.min(n,e.x),r=Math.min(r,e.y)});var o=Math.max(0,Math.floor((e-j.cols)/2)-1),i=Math.max(0,Math.floor((t-j.rows)/2)-1);angular.forEach(P,function(e){e.x=o+(e.x-n),e.y=i+(e.y-r)})}console.log("setCenter",j.rows,j.cols),h()};var N={down:x,move:w,up:S,resize:k},z=new i(o);z.add(N),e.$on("$destroy",function(){z.remove(N)}),k(),t(function(){h()})}return{restrict:"A",link:a}}])}(),function(){"use strict";var e=angular.module("app");e.directive("mapbox",["$http","$timeout","GoogleMaps",function(e,t,n){function r(e,r,o,i){function s(){x=c();var t=new mapboxgl.Map({container:r[0],style:"mapbox://styles/mapbox/streets-v9",interactive:!0,logoPosition:"bottom-right",center:[x.lng,x.lat],zoom:9});return w=t.getCanvasContainer(),t.on("mousedown",p),e.map.setAddress=function(t){console.log("setAddress",t),angular.extend(e.model,t),e.map.results=null,x=c(t.position.lat,t.position.lng),h()},e.map.search=function(){return console.log("address",e.map.address),e.map.results=null,u(e.map.address),!0},e.map.styles={RIVA:1,SATELLITE:2},e.map.style=e.map.styles.RIVA,e.map.styleToggle=function(){e.map.style===e.map.styles.RIVA?(e.map.style=e.map.styles.SATELLITE,t.setStyle("mapbox://styles/mapbox/satellite-v9")):(e.map.style=e.map.styles.RIVA,t.setStyle("mapbox://styles/mapbox/streets-v9"))},e.map.setStyle=function(n){e.map.style=n,e.map.style===e.map.styles.RIVA?t.setStyle("mapbox://styles/mapbox/streets-v9"):t.setStyle("mapbox://styles/mapbox/satellite-v9")},t}function a(){var e=document.createElement("div");e.id="point",e.className="marker";var t=new mapboxgl.Marker(e,{offset:[-10,-10]}).setLngLat([x.lng,x.lat]).addTo(v),n=angular.element(e);return n.on("mouseenter",function(e){w.style.cursor="move",k=!0,v.dragPan.disable()}),n.on("mouseleave",function(e){w.style.cursor="",k=!1,v.dragPan.enable()}),t}function c(t,n){var r=e.model.position||{};return t&&n?(r.lat=t,r.lng=n):(r.lat=r.lat||0,r.lng=r.lng||0,0===r.lat&&0===r.lng&&f()),console.log("setPosition",t,n),r}function u(r){b.geocode({address:r},function(r,o){t(function(){"OK"===o?e.map.results=n.parse(r):alert("Geocode was not successful for the following reason: "+o)})})}function l(r){console.log("reverseGeocode",r),b.geocode({location:r},function(r,o){t(function(){"OK"===o?e.map.results=n.parse(r):console.log("Geocoder failed due to: "+o)})})}function f(){navigator.geolocation?navigator.geolocation.getCurrentPosition(function(e){t(function(){x=c(e.coords.latitude,e.coords.longitude),h(),l(x)})},function(e){console.log("error",e)}):console.log("error","Browser doesn't support Geolocation")}function h(){y.setLngLat([x.lng,x.lat]),v.flyTo({center:[parseFloat(x.lng),parseFloat(x.lat)],zoom:15,speed:1.5,curve:1})}function p(){k&&(S=!0,w.style.cursor="grab",v.on("mousemove",d),v.once("mouseup",g))}function d(e){if(S){var t=e.lngLat;w.style.cursor="grabbing",y.setLngLat([t.lng,t.lat])}}function g(e){if(S){var n=e.lngLat;t(function(){x=c(n.lat,n.lng),l(n)}),w.style.cursor="",S=!1,v.off("mousemove",d)}}function m(){v=s(),y=a()}var v,y,b,x,w,S,k;n.geocoder().then(function(e){b=e,m()})}if(mapboxgl)return mapboxgl.accessToken="pk.eyJ1IjoiYWN0YXJpYW4iLCJhIjoiY2lqNWU3MnBzMDAyZndnbTM1cjMyd2N2MiJ9.CbuEGSvOAfIYggQv854pRQ",{restrict:"E",link:r}}]),e.directive("mapboxViewer",["$http","$timeout","GoogleMaps",function(e,t,n){function r(e,r,o,i){function s(){var t=new mapboxgl.Map({container:r[0],style:"mapbox://styles/mapbox/streets-v9",interactive:!0,logoPosition:"bottom-right",center:[m.lng,m.lat],zoom:6});return y=t.getCanvasContainer(),e.map.setAddress=function(t){console.log("setAddress",t),e.map.results=null,u(t.position)},e.map.search=function(){return console.log("address",e.map.address),e.map.results=null,c(e.map.address),!0},e.map.styles={RIVA:1,SATELLITE:2},e.map.style=e.map.styles.RIVA,e.map.styleToggle=function(){e.map.style===e.map.styles.RIVA?(e.map.style=e.map.styles.SATELLITE,t.setStyle("mapbox://styles/mapbox/satellite-v9")):(e.map.style=e.map.styles.RIVA,t.setStyle("mapbox://styles/mapbox/streets-v9"))},e.map.setStyle=function(n){e.map.style=n,e.map.style===e.map.styles.RIVA?t.setStyle("mapbox://styles/mapbox/streets-v9"):t.setStyle("mapbox://styles/mapbox/satellite-v9")},t}function a(e){var t=document.createElement("div");t.id="point",t.className="marker";var n=new mapboxgl.Marker(t,{offset:[-10,-10]}).setLngLat([e.position.lng,e.position.lat]).addTo(h);return angular.element(t).on("click",function(e){console.log("click",this)}),n}function c(r){g.geocode({address:r},function(r,o){t(function(){"OK"===o?e.map.results=n.parse(r):alert("Geocode was not successful for the following reason: "+o)})})}function u(e){h.flyTo({center:[parseFloat(e.lng),parseFloat(e.lat)],zoom:15,speed:1.5,curve:1})}function l(e){h.fitBounds(e,{speed:1.5,curve:1,padding:30,linear:!1,maxZoom:8})}function f(){h=s(),e.$watch("map.items",function(e){if(console.log(e),angular.forEach(p,function(e){h.removeLayer(e)}),p=[],e){var t=Number.POSITIVE_INFINITY,n=Number.NEGATIVE_INFINITY,r=Number.POSITIVE_INFINITY,o=Number.NEGATIVE_INFINITY;angular.forEach(e,function(e){d=a(e),p.push(d),t=Math.min(t,e.position.lat),n=Math.max(n,e.position.lat),r=Math.min(r,e.position.lng),o=Math.max(o,e.position.lng),v=new mapboxgl.LngLatBounds(new mapboxgl.LngLat(r,t),new mapboxgl.LngLat(o,n))}),l(v)}})}var h,p,d,g,m,v,y;m={lng:13.5998744,lat:41.3412555},n.geocoder().then(function(e){g=e,f()})}if(mapboxgl)return mapboxgl.accessToken="pk.eyJ1IjoiYWN0YXJpYW4iLCJhIjoiY2lqNWU3MnBzMDAyZndnbTM1cjMyd2N2MiJ9.CbuEGSvOAfIYggQv854pRQ",{restrict:"A",link:r}}]),e.service("GoogleMaps",["$q","$http",function(e,t){function n(){var t=e.defer();if(a)t.resolve(window.google.maps);else{window.googleMapsInit=function(){t.resolve(window.google.maps),window.googleMapsInit=null,a=!0};var n=document.createElement("script");n.setAttribute("async",null),n.setAttribute("defer",null),n.setAttribute("src","https://maps.googleapis.com/maps/api/js?key="+s+"&callback=googleMapsInit"),document.body.appendChild(n)}return t.promise}function r(){var t=e.defer();return n().then(function(e){var n=new e.Geocoder;t.resolve(n)},function(e){t.reject(e)}),t.promise}function o(e,t){var n={street:"route",number:"street_number",locality:"locality",postalCode:"postal_code",city:"administrative_area_level_3",province:"administrative_area_level_2",region:"administrative_area_level_1",country:"country"},r=null;return angular.forEach(t.address_components,function(t){angular.forEach(t.types,function(o){o===n[e]&&(r=t.long_name)})}),r}function i(e){var t=null;return e.length&&(t=e.filter(function(e){return!0}).map(function(e){return{name:e.formatted_address,street:o("street",e),number:o("number",e),locality:o("locality",e),postalCode:o("postalCode",e),city:o("city",e),province:o("province",e),region:o("region",e),country:o("country",e),position:{lng:e.geometry.location.lng(),lat:e.geometry.location.lat()}}})),console.log("googleMaps.parse",e,t),t}var s="AIzaSyAYuhIEO-41YT_GdYU6c1N7DyylT_OcMSY",a=!1;this.maps=n,this.geocoder=r,this.parse=i}])}(),function(){"use strict";var e=angular.module("app");e.factory("Rect",[function(){function e(e,t,n,r){this.x=e||0,this.y=t||0,this.w=n||0,this.h=r||0}return e.mult=function(e,t){return e.x*=t,e.y*=t,e.w*=t,e.h*=t,e},e.prototype={mult:function(t){return e.mult(this,t)},offset:function(e,t){return this.x+=e,this.y+=t,this},reduce:function(e){return this.offset(-e)},reduceRect:function(t){return this.offsetRect(e.mult(t,-1))},expandRect:function(e){return this.x-=e.x||0,this.y-=e.y||0,this.w+=e.w||0,this.h+=e.h||0,this},expand:function(e){return this.expandRect({x:e,y:e,w:2*e,h:2*e})},intersect:function(e){var t=this.x,n=this.y,r=this.w,o=this.h;return!(e.x>t+r||e.x+e.w<t||e.y>n+o||e.y+e.h<n)},top:function(){var e=this.x,t=this.y,n=this.w;this.h;return{x:e+n/2,y:t}},right:function(){var e=this.x,t=this.y;return{x:e+this.w,y:t+this.h/2}},bottom:function(){var e=this.x,t=this.y;return{x:e+this.w/2,y:t+this.h}},left:function(){var e=this.x,t=this.y;this.w;return{x:e,y:t+this.h/2}},center:function(){var e=this.x,t=this.y;return{x:e+this.w/2,y:t+this.h/2}},topLeft:function(){var e=this.x,t=this.y;this.w,this.h;return{x:e,y:t}},topRight:function(){var e=this.x,t=this.y,n=this.w;this.h;return{x:e+n,y:t}},bottomRight:function(){var e=this.x,t=this.y;return{x:e+this.w,y:t+this.h}},bottomLeft:function(){var e=this.x,t=this.y;this.w;return{x:e,y:t+this.h}},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setW:function(e){return this.w=e,this},setH:function(e){return this.h=e,this},setPos:function(e,t){return this.x=e,this.y=t,this},setSize:function(e,t){return this.w=e,this.h=t,this},copy:function(e){return this.x=e.x,this.y=e.y,this.w=e.w,this.h=e.h,this},clone:function(){return new e(this.x,this.y,this.w,this.h)},toString:function(){return"{"+this.x+","+this.y+","+this.w+","+this.h+"}"}},e}]),e.factory("Color",[function(){function e(e,t,n,r){if(arguments.length>1)this.r=e||0===e?e:0,this.g=t||0===t?t:0,this.b=n||0===n?n:0,this.a=r||0===r?r:255;else{var o=e||"0xffffff";o=parseInt(o),e.length>8?(this.r=o>>24&255,this.g=o>>16&255,this.b=o>>8&255,this.a=o>>0&255):(this.r=o>>16&255,this.g=o>>8&255,this.b=o>>0&255,this.a=255)}}return e.componentToHex=function(e){var t=e.toString(16);return 1==t.length?"0"+t:t},e.luma=function(e){return e.dot({r:95,g:100,b:60})},e.contrast=function(t){return new e(e.luma(t)>.6?"0x000000":"0xffffff")},e.darker=function(t,n,r){return r=r||0,new e(Math.max(Math.floor(t.r*r),Math.floor(t.r-255*n)),Math.max(Math.floor(t.g*r),Math.floor(t.g-255*n)),Math.max(Math.floor(t.b*r),Math.floor(t.b-255*n)),t.a)},e.lighter=function(t,n,r){return r=r||1,new e(Math.min(t.r+Math.floor((255-t.r)*r),Math.floor(t.r+255*n)),Math.min(t.g+Math.floor((255-t.g)*r),Math.floor(t.g+255*n)),Math.min(t.b+Math.floor((255-t.b)*r),Math.floor(t.b+255*n)),t.a)},e.prototype={toUint:function(){return(this.r<<24)+(this.g<<16)+(this.b<<8)+this.a},toHex:function(){return"#"+e.componentToHex(this.r)+e.componentToHex(this.g)+e.componentToHex(this.b)+e.componentToHex(this.a)},toRgba:function(){return"rgba("+this.r+","+this.g+","+this.b+","+(this.a/255).toFixed(3)+")"},dot:function(e){return this.r/255*(e.r/255)+this.g/255*(e.g/255)+this.b/255*(e.b/255)},alpha:function(e,t,n){return t=t||0,n=n||1,this.a=Math.floor(255*(t+e*(n-t))),this},makeSet:function(){return this.foreground=e.contrast(this),this.border=e.darker(this,.3),this.light=e.lighter(this,.3),this}},e}]),e.factory("Shape",[function(){function e(){}return e.shapeCircle=function(e,t,n,r,o,i){o=o||0,i=i||2*Math.PI,e.ctx.arc(t,n,r,o,i,!1)},e.shapeStar=function(e,t,n,r,o,s){var a,c,u=Math.PI/2*3,l=Math.PI/s,f=e.ctx;for(f.moveTo(t,n-r),i=0;i<s;i++)a=t+Math.cos(u)*r,c=n+Math.sin(u)*r,f.lineTo(a,c),u+=l,a=t+Math.cos(u)*o,c=n+Math.sin(u)*o,f.lineTo(a,c),u+=l;f.lineTo(t,n-r)},e.shapeRoundRect=function(e,t,n){var r=e.ctx,o=t.x,i=t.y,s=t.w,a=t.h;if(void 0===typeof n&&(n=4),"number"==typeof n)n={tl:n,tr:n,br:n,bl:n};else{var c={tl:0,tr:0,br:0,bl:0};for(var u in c)n[u]=n[u]||c[u]}r.moveTo(o+n.tl,i),r.lineTo(o+s-n.tr,i),r.quadraticCurveTo(o+s,i,o+s,i+n.tr),r.lineTo(o+s,i+a-n.br),r.quadraticCurveTo(o+s,i+a,o+s-n.br,i+a),r.lineTo(o+n.bl,i+a),r.quadraticCurveTo(o,i+a,o,i+a-n.bl),r.lineTo(o,i+n.tl),r.quadraticCurveTo(o,i,o+n.tl,i)},e.circle=function(){var t=Array.prototype.slice.call(arguments),n=t[0].ctx;n.beginPath(),e.shapeCircle.apply(this,t),n.closePath()},e.star=function(){var t=Array.prototype.slice.call(arguments),n=t[0].ctx;n.beginPath(),e.shapeStar.apply(this,t),n.closePath()},e.roundRect=function(){var t=Array.prototype.slice.call(arguments),n=t[0].ctx;n.beginPath(),e.shapeRoundRect.apply(this,t),n.closePath()},e}]),e.constant("PainterColors",{black:"0x14191e",white:"0xffffff",blue:"0x0023FF",red:"0xF21500",lightBlue:"0x79ccf2",lightYellow:"0xfff79a",greyLighter:"0xf8f8f8",greyLight:"0xeeeeee",greyMedium:"0xcccccc",grey:"0x90939b",map:"0x24292e"}),e.factory("Palette",["$q","Painter","Rect",function(e,t,n){function r(){this.painter=(new t).setSize(0,0),this.buffer=(new t).setSize(0,0),this.size={w:0,h:0},this.pool={},this.rows={}}return r.prototype={getRect:function(e,t){var r=this.painter,o=this.size,i=this.rows,s=new n(0,0,e,t),a=i[t]||{x:0,y:o.h};if(o.w=Math.max(o.w,a.x+e),o.h=Math.max(o.h,a.y+t),r.canvas.width||r.canvas.height){if(o.w>r.canvas.width||o.h>r.canvas.height){var c=r.canvas;r.setCanvas(document.createElement("canvas")),r.setSize(o.w,o.h),r.ctx.drawImage(c,0,0)}}else r.setSize(o.w,o.h);return s.x=a.x,s.y=a.y,a.x+=e,i[t]=a,s},add:function(t,n){var r=this;if(angular.isString(n)){var o=e.defer(),i=new Image;return i.onload=function(){r.addShape(t,i.width,i.height,function(e,t){e.ctx.drawImage(i,0,0)}),o.resolve(i)},i.onerror=function(){o.reject("connot load "+n)},i.src=n,o.promise}var s=Array.prototype.slice.call(arguments);return r.addShape.apply(r,s)},addShape:function(e,t,n,r){var o=this.painter,i=this.getRect(t,n);o.ctx.save(),o.ctx.rect(i.x,i.y,i.w,i.h),o.ctx.clip(),o.ctx.translate(i.x,i.y),r.call(o,o,i.clone().setPos(0,0)),o.ctx.restore(),this.pool[e]=i},draw:function(e,t,n,r,o){var i=this.pool[t];i&&e.drawRect(this.painter.canvas,i,{x:n,y:r,w:i.w,h:i.h},o)},tint:function(e,t,n,r,o,i){var s=this.pool[t];if(s){var a=this.painter,c=this.buffer.setSize(s.w,s.h);c.save(),c.setFill(o),c.fillRect(),c.ctx.globalCompositeOperation="destination-atop",c.ctx.drawImage(a.canvas,s.x,s.y,s.w,s.h,0,0,s.w,s.h),c.restore(),console.log(n,r,c.canvas,e.canvas),e.draw(c.canvas,{x:n,y:r},i)}},pattern:function(e,t,n,r,o,i,s){function a(t){var s=e.ctx;s.save(),s.translate(n,r),s.fillStyle=t,s.fillRect(-n,-r,o,i),s.translate(-n,-r),s.restore()}var c=this.pool[t];if(c){var u,l=c.img;if(l&&c.color==s)u=e.ctx.createPattern(l,"repeat"),a(u);else{var f=this.buffer.setSize(c.w,c.h);s?(c.color=s,f.save(),f.setFill(s),f.fillRect(),f.ctx.globalCompositeOperation="destination-atop",f.ctx.drawImage(this.painter.canvas,c.x,c.y,c.w,c.h,0,0,c.w,c.h),f.restore()):f.ctx.drawImage(this.painter.canvas,c.x,c.y,c.w,c.h,0,0,c.w,c.h),l=new Image,l.onload=function(){c.img=l,u=e.ctx.createPattern(l,"repeat"),a(u)},l.src=f.toDataURL()}}}},r}]),e.factory("Painter",["Shape","Rect","Color","PainterColors",function(e,t,n,r){function o(e){e=e||document.createElement("canvas"),this.rect=new t,this.drawingRect=new t,this.setColors(),this.setCanvas(e)}o.colors={},angular.forEach(r,function(e,t){o.colors[t]=new n(e).makeSet()});o.colors;return o.prototype={colors:o.colors,setColors:function(){var e=this.colors;angular.forEach(r,function(t,r){e[r]=new n(t).makeSet()})},setCanvas:function(e){this.canvas=e,this.setSize(e.offsetWidth,e.offsetHeight);var t=e.getContext("2d");return t.lineCap="square",this.ctx=t,this},setSize:function(e,t){return this.canvas.width=e,this.canvas.height=t,this.rect.w=e,this.rect.h=t,this},copy:function(e){return this.ctx.drawImage(e,0,0),this},clear:function(){return this.resize(),this},resize:function(){return this.setSize(this.canvas.offsetWidth,this.canvas.offsetHeight),this},setText:function(e,t,n,r){e=e||"11px monospace",t=t||"center",n=n||"middle",r=r||this.colors.black;var o=this.ctx;return o.font=e,o.textAlign=t,o.textBaseline=n,o.fillStyle=r.toRgba(),this},setFill:function(e){return e=e||this.colors.black,this.ctx.fillStyle=e.toRgba(),this},setStroke:function(e,t){e=e||this.colors.black;var n=this.ctx;return t=t||1,n.strokeStyle=e.toRgba(),n.lineWidth=t,this},fillText:function(e,t,n,r,o){return n&&(r=r||"",o=o||Math.floor(n/8),e.length>o&&(e=e.substr(0,Math.min(e.length,o)).trim()+r)),this.ctx.fillText(e,t.x,t.y),this},fillRect:function(e){e=e||this.rect;var t=this.ctx,n=e.x,r=e.y,o=e.w,i=e.h;return t.fillRect(n,r,o,i),this},strokeRect:function(e){e=e||this.rect;var t=this.ctx,n=e.x,r=e.y,o=e.w,i=e.h;return t.strokeRect(n,r,o,i),this},fill:function(){return this.ctx.fill(),this},stroke:function(){return this.ctx.stroke(),this},begin:function(){return this.ctx.beginPath(),this},close:function(){return this.ctx.closePath(),this},save:function(){return this.ctx.save(),this},restore:function(){return this.ctx.restore(),this},rotate:function(e){this.ctx.rotate(e*Math.PI/180)},translate:function(e){this.ctx.translate(e.x,e.y)},toDataURL:function(){return this.canvas.toDataURL()},draw:function(e,t,n){if(e){t.w=t.w||e.width,t.h=t.h||e.height;var r=this.ctx,o=this.drawingRect,i=o.x=t.x-t.w/2,s=o.y=t.y-t.h/2;o.w=t.w,o.h=t.h;r.save(),r.translate(i,s),n&&n.call(this),r.drawImage(e,0,0),r.restore()}return this},drawRect:function(e,t,n,r){if(e){t.w=t.w||e.width,t.h=t.h||e.height,n.w=n.w||e.width,n.h=n.h||e.height;var o=this.ctx,i=this.drawingRect,s=i.x=n.x-t.w/2,a=i.y=n.y-t.h/2;i.w=n.w,i.h=n.h;o.save(),o.translate(s,a),r&&r.call(this),o.drawImage(e,t.x,t.y,t.w,t.h,0,0,n.w,n.h),o.restore()}return this},flip:function(e){e=e||{x:1,y:-1};var t=this.ctx,n=this.drawingRect;t.translate(-1===e.x?n.w:0,-1===e.y?n.h:0),t.scale(e.x,e.y)}},o}])}(),function(){"use strict";angular.module("app").factory("Events",[function(){function e(e,t){var n=document.documentElement||document.body.parentNode||document.body,r={x:window.pageXOffset||n.scrollLeft,y:window.pageYOffset||n.scrollTop};if("resize"===e.type){var o={w:this.getWidth(),h:this.getHeight()};this.view=o}var s=i(t),a={x:s.offsetLeft,y:s.offsetTop},c=s.getBoundingClientRect(),u=this.getPage(e);if(u){var l={x:u.x-r.x-c.left,y:u.y-r.y-c.top},f={x:u.x-r.x,y:u.y-r.y};this.relative=l,this.absolute=f}"resize"===this.type&&console.log(this.type),this.originalEvent=e,this.element=t,this.node=s,this.offset=a,this.rect=c}function t(){return self.innerWidth?self.innerWidth:document.documentElement&&document.documentElement.clientWidth?document.documentElement.clientWidth:document.body?document.body.clientWidth:void 0}function n(){return self.innerHeight?self.innerHeight:document.documentElement&&document.documentElement.clientHeight?document.documentElement.clientHeight:document.body?document.body.clientHeight:void 0}function r(e){var t=["click","mousedown","mouseup","mousemove","mouseover","mouseout","mouseenter","mouseleave","contextmenu"],n=["touchstart","touchmove","touchend","touchcancel"],r=null;if(-1!==n.indexOf(e.type)){var o=null,i=e.originalEvent?e.originalEvent:e,s=i.touches.length?i.touches:i.changedTouches;s&&s.length&&(o=s[0]),o&&(r={x:o.pageX,y:o.pageY})}else-1!==t.indexOf(e.type)&&(r={x:e.pageX,y:e.pageY});return this.type=e.type,r}function o(t){function n(t){var n=new e(t,l.element);l.listeners.click.apply(this,[n])}function r(t){var n=new e(t,l.element);l.listeners.down.apply(this,[n]),l.removeTouchEvents()}function o(t){var n=new e(t,l.element);l.listeners.move.apply(this,[n])}function i(t){var n=new e(t,l.element);l.listeners.up.apply(this,[n])}function s(t){console.log("onResize",t);var n=new e(t,l.element);l.listeners.resize.apply(this,[n])}function a(t){var n=new e(t,l.element);l.listeners.down.apply(this,[n]),l.removeStandardEvents()}function c(t){var n=new e(t,l.element);l.listeners.move.apply(this,[n])}function u(t){var n=new e(t,l.element);l.listeners.up.apply(this,[n])}this.element=t,this.listeners={},this.standardEvents={click:{key:"click",callback:n},down:{key:"mousedown",callback:r},move:{key:"mousemove",callback:o},up:{key:"mouseup",callback:i},resize:{key:"resize",callback:s}},this.touchEvents={down:{key:"touchstart",callback:a},move:{key:"touchmove",callback:c},up:{key:"touchend",callback:u}}
;var l=this}function i(e){return e.length?e[0]:e}function s(e){return e.length?e:angular.element(e)}function a(e){var t=this,n=this.standardEvents,r=this.touchEvents,o=s(this.element),i=angular.element(window);return angular.forEach(e,function(e,s){if(t.listeners[s]){var a={};a[s]=t.listeners[s],c(a)}t.listeners[s]=e,n[s]&&("resize"===s?i.on(n[s].key,n[s].callback):o.on(n[s].key,n[s].callback)),r[s]&&o.on(r[s].key,r[s].callback)}),t}function c(e){var t=this,n=this.standardEvents,r=this.touchEvents,o=s(this.element),i=angular.element(window);return angular.forEach(e,function(e,s){n[s]&&("resize"===s?i.off(n[s].key,n[s].callback):o.off(n[s].key,n[s].callback)),r[s]&&o.off(r[s].key,r[s].callback),t.listeners[s]=null}),t}function u(){var e=this,t=e.standardEvents,n=(e.touchEvents,s(e.element));n.off("mousedown",t.down.callback),n.off("mousemove",t.move.callback),n.off("mouseup",t.up.callback)}function l(){var e=this,t=(e.standardEvents,e.touchEvents),n=s(e.element);n.off("touchstart",t.down.callback),n.off("touchmove",t.move.callback),n.off("touchend",t.up.callback)}return e.prototype={getPage:r,getWidth:t,getHeight:n},o.prototype={add:a,remove:c,removeStandardEvents:u,removeTouchEvents:l},o}])}(),function(){"use strict";angular.module("app").directive("ngClick",["Events",function(e){function t(t,n,r,o){function i(e){n.removeClass("animate"),n.offsetWidth,s.style.left=e.relative.x+"px",s.style.top=e.relative.y+"px",setTimeout(function(){n.addClass("animate"),setTimeout(function(){n.removeClass("animate")},1e3)},10)}n.addClass("material");var s=document.createElement("material");n[0].appendChild(s);var a={click:i},c=new e(n).add(a);t.$on("$destroy",function(){c.remove(a)})}return{restrict:"A",priority:0,link:t}}])}(),function(){"use strict";angular.module("app")}(),function(){"use strict";var e=angular.module("app");e.directive("controlMessages",[function(){return{restrict:"E",templateUrl:"partials/control-messages",transclude:{message:"?messageItems"},link:function(e,t,n,r){}}}]),e.directive("control",["$http","$templateCache","$compile","$parse",function(e,t,n,r){function o(e,t,n){e=e||"",t=t||"";var r=e.split(",");if(r.length>1){var o=r.shift();return angular.forEach(r,function(e,r){o=n?o.split("{"+r+"}").join("' + "+t+e+" + '"):o.split("{"+r+"}").join(t+e)}),n?"'"+o+"'":o}return t+e}var i=0;return{restrict:"A",templateUrl:function(e,t){var n="partials/forms/control";switch(t.control){case"select":n="partials/forms/control-select"}return n},scope:{ngModel:"=",required:"=",form:"@",title:"@",placeholder:"@"},require:"ngModel",compile:function(e,t){return{pre:function(e,t,n){if("select"===n.control){var s=n.label?n.label:"name",a=n.key?n.key:"id",c=n.min?" | filter:gte('"+a+"', "+n.min+")":"",u=o(s,"item.",!0);e.options=n.number?"item."+a+" as "+u+" disable when item.disabled for item in "+n.source+c:u+" disable when item.disabled for item in "+n.source+c+" track by item."+a,console.log("control.compile.pre",e.options)}var l=(e.type=n.control,e.form=e.form||"form",e.title=e.title||"untitled");e.placeholder=e.placeholder||l,e.field=l.replace(/[^0-9a-zA-Z]/g,"").split(" ").join("")+ ++i;e.validate=n.validate||n.control,e.format=n.format||null,e.precision=n.precision||null,e.validate=n.validate||n.control,e.minLength=n.min||0,e.maxLength=n.max||Number.POSITIVE_INFINITY,e.options=r(n.options)(e)||{},e.focus=!1,e.visible=!1,e.getType=function(){var t="text";switch(n.control){case"password":t=e.visible?"text":"password";break;default:t=n.control}return t},e.getClasses=function(){var t=r(e.form)(e.$parent),n=r(e.form+"."+e.field)(e.$parent);return{"control-focus":e.focus,"control-success":n.$valid,"control-error":n.$invalid&&(t.$submitted||n.$touched),"control-empty":!n.$viewValue}},e.getMessages=function(){var t=r(e.form)(e.$parent),n=r(e.form+"."+e.field)(e.$parent);return(t.$submitted||n.$touched)&&n.$error}}}}}}]),e.directive("numberPicker",["$parse","$timeout",function(e,t){return{restrict:"A",template:'<div class="input-group">   <span class="input-group-btn"><button class="btn btn-outline-primary" type="button">-</button></span>   <div ng-transclude></div>   <span class="input-group-btn"><button class="btn btn-outline-primary" type="button">+</button></span></div>',replace:!0,transclude:!0,link:function(n,r,o,i){function s(r){var i=e(o.min)(n),s=e(o.numberPicker),a=s.assign;t(function(){a(n,Math.max(i,s(n)-1))})}function a(r){var i=e(o.max)(n),s=e(o.numberPicker),a=s.assign;t(function(){a(n,Math.min(i,s(n)+1))})}function c(){angular.element(l).off("touchstart mousedown",s),angular.element(f).off("touchstart mousedown",a)}var u=r[0],l=u.querySelectorAll(".input-group-btn > .btn")[0],f=u.querySelectorAll(".input-group-btn > .btn")[1];n.$on("$destroy",function(){c()}),function(){angular.element(l).on("touchstart mousedown",s),angular.element(f).on("touchstart mousedown",a)}()}}}])}(),function(){"use strict";angular.module("app").directive("validate",["$filter",function(e){return{require:"ngModel",link:function(t,n,r,o){function i(){h=!0,l&&(n[0].value=o.$modelValue||null,o.$modelValue||o.$setViewValue(null))}function s(){if(l&&!o.$invalid)switch(u){case"date":case"datetime":case"datetime-local":n[0].value=o.$modelValue?e("date")(o.$modelValue,l):" ";break;default:n[0].value=o.$modelValue?e("number")(o.$modelValue,f)+" "+l:" "}}function a(){h=!1,s()}function c(){n.off("focus",i),n.off("blur",a)}var u=r.validate,l=r.format||"",f=r.precision||2,h=!1;switch(u){case"date":case"datetime":case"datetime-local":o.$formatters.push(function(t){return t?e("date")(t,l):null});break;case"number":o.$parsers.unshift(function(e){var t=!1;return void 0!==e&&""!==e?(t=-1!==String(e).indexOf(Number(e).toString()),e=Number(e),o.$setValidity("number",t),t&&(o.$setValidity("positive",e>=.01),void 0!==r.min&&o.$setValidity("range",e>=Number(r.min)),void 0!==r.max&&o.$setValidity("range",e<=Number(r.max)))):(t=!0,e=Number(e),o.$setValidity("number",!0),o.$setValidity("positive",!0),void 0!==r.min&&o.$setValidity("range",!0),void 0!==r.max&&o.$setValidity("range",!0)),e}),o.$formatters.push(function(t){return t?e("number")(t,f)+" "+l:null});break;case"anynumber":o.$parsers.unshift(function(e){var t=!1;return void 0!==e&&""!==e?(t=-1!==String(e).indexOf(Number(e).toString()),e=Number(e),o.$setValidity("number",t),t&&(void 0!==r.min&&o.$setValidity("range",e>=Number(r.min)),void 0!==r.max&&o.$setValidity("range",e<=Number(r.max)))):(t=!0,e=Number(e),o.$setValidity("number",!0),void 0!==r.min&&o.$setValidity("range",!0),void 0!==r.max&&o.$setValidity("range",!0)),e}),o.$formatters.push(function(t){return t||0===t?e("number")(t,f)+" "+l:null})}t.$on("$destroy",function(){c()}),function(){n.on("focus",i),n.on("blur",a)}()}}}])}(),function(){"use strict";angular.module("app").factory("State",["$timeout",function(e){function t(){this.isReady=!1,this.idle()}function n(){this.isBusy=!1,this.isError=!1,this.isErroring=!1,this.isSuccess=!1,this.isSuccessing=!1,this.button=null,this.errors=[]}function r(){return!this.isBusy&&!this.isErroring&&!this.isSuccessing}function o(e){return!this.isBusy&&(this.isBusy=!0,this.isError=!1,this.isErroring=!1,this.isSuccess=!1,this.isSuccessing=!1,this.errors=[],this.key=e,!0)}function i(){this.isBusy=!1,this.isError=!1,this.isErroring=!1,this.isSuccess=!0,this.isSuccessing=!0,this.errors=[],e(function(){this.isSuccessing=!1,this.key=null}.bind(this),p)}function s(t){this.isBusy=!1,this.isError=!0,this.isErroring=!0,this.isSuccess=!1,this.isSuccessing=!1,this.errors.push(t),e(function(){this.isErroring=!1,this.key=null}.bind(this),p)}function a(){this.isReady=!0,this.success()}function c(){return this.isError?this.errors[this.errors.length-1]:null}function u(){return{busy:this.isBusy,ready:this.isReady,successing:this.isSuccessing,success:this.isSuccess,errorring:this.isErroring,error:this.isError}}function l(e,t){var n={ready:"submit",busy:"sending",error:"error",success:"success"};t&&angular.extend(n,t);var r=n.ready;return this.key===e&&(this.isBusy?r=n.busy:this.isSuccess?r=n.success:this.isError&&(r=n.error)),r}function f(e,t){var n=this,r=null;return this.key===e&&(r={ready:n.isReady,busy:n.isBusy,successing:n.isSuccessing,success:n.isSuccess,errorring:n.isErroring,error:n.isError},t&&angular.forEach(t,function(e,t){r[e]=r[t]})),r}function h(e){return this.key&&this.key!==e}var p=2e3;return t.prototype={idle:n,busy:o,enabled:r,error:s,ready:a,success:i,errorMessage:c,submitClass:u,labels:l,classes:f,disabled:h},t}])}(),function(){"use strict";var e=angular.module("app");e.factory("Cookie",["$q","$window",function(e,t){function n(){}return n.TIMEOUT=3e5,n._set=function(e,n,r){var o;if(r){var i=new Date;i.setTime(i.getTime()+24*r*60*60*1e3),o="; expires="+i.toGMTString()}else o="";t.document.cookie=e+"="+n+o+"; path=/"},n.set=function(e,t,r){try{var o=[],i=JSON.stringify(t,function(e,t){if("pool"!==e){if("object"==typeof t&&null!==t){if(-1!==o.indexOf(t))return;o.push(t)}return t}});o=null,n._set(e,i,r)}catch(n){console.log("Cookie.set.error serializing",e,t,n)}},n.get=function(e){for(var n=e+"=",r=t.document.cookie.split(";"),o=0;o<r.length;o++){for(var i=r[o];" "==i.charAt(0);)i=i.substring(1,i.length);if(0===i.indexOf(n)){var s=i.substring(n.length,i.length),a=null;try{a=JSON.parse(s)}catch(e){console.log("Cookie.get.error parsing",key,e)}return a}}return null},n.delete=function(e){n._set(e,"",-1)},n.on=function(t){function r(){if(a>c)i.reject("timeout");else{var e=n.get(t);e?i.resolve(e):(a+=s,o=setTimeout(r,s))}}var o,i=e.defer(),s=1e3,a=0,c=n.TIMEOUT;return r(),i.promise},n}]),e.factory("LocalStorage",["$q","$window","Cookie",function(e,t,n){function r(){}return r.isSupported=function(){var e=!1;try{e="localStorage"in t&&null!==t.localStorage,e?(t.localStorage.setItem("test","1"),t.localStorage.removeItem("test")):e=!1}catch(t){e=!1}return e}(),r.isSupported?(r.set=function(e,n){try{var r=[],o=JSON.stringify(n,function(e,t){if("pool"!==e){if("object"==typeof t&&null!==t){if(-1!==r.indexOf(t))return;r.push(t)}return t}});r=null,t.localStorage.setItem(e,o)}catch(t){console.log("LocalStorage.set.error serializing",e,n,t)}},r.get=function(e){var n=null;if(void 0!==t.localStorage[e])try{n=JSON.parse(t.localStorage[e])}catch(t){console.log("LocalStorage.get.error parsing",e,t)}return n},r.delete=function(e){t.localStorage.removeItem(e)},r.on=function(r){function o(e){if(clearTimeout(i),e.originalEvent.key==r)try{var t=JSON.parse(e.originalEvent.newValue);s.resolve(t)}catch(e){console.log("LocalStorage.on.error parsing",r,e),s.reject("error parsing "+r)}}var i,s=e.defer(),a=n.TIMEOUT;return angular.element(t).on("storage",o),i=setTimeout(function(){s.reject("timeout")},a),s.promise}):(console.log("LocalStorage.unsupported switching to cookies"),r.set=n.set,r.get=n.get,r.delete=n.delete,r.on=n.on),r}]),e.factory("SessionStorage",["$q","$window","Cookie",function(e,t,n){function r(){}return r.isSupported=function(){var e=!1;try{e="sessionStorage"in t&&void 0!==t.sessionStorage,e?(t.sessionStorage.setItem("test","1"),t.sessionStorage.removeItem("test")):e=!1}catch(t){e=!1}return e}(),r.isSupported?(r.set=function(e,n){try{var r=[],o=JSON.stringify(n,function(e,t){if("pool"!==e){if("object"==typeof t&&null!==t){if(-1!==r.indexOf(t))return;r.push(t)}return t}});r=null,t.sessionStorage.setItem(e,o)}catch(t){console.log("SessionStorage.set.error serializing",e,n,t)}},r.get=function(e){var n=null;if(void 0!==t.sessionStorage[e])try{n=JSON.parse(t.sessionStorage[e])}catch(t){console.log("SessionStorage.get.error parsing",e,t)}return n},r.delete=function(e){t.sessionStorage.removeItem(e)},r.on=function(r){function o(e){if(clearTimeout(i),e.originalEvent.key===r)try{var t=JSON.parse(e.originalEvent.newValue);s.resolve(t)}catch(e){console.log("SessionStorage.on.error parsing",r,e),s.reject("error parsing "+r)}}var i,s=e.defer(),a=n.TIMEOUT;return angular.element(t).on("storage",o),i=setTimeout(function(){s.reject("timeout")},a),s.promise}):(console.log("SessionStorage.unsupported switching to cookies"),r.set=n.set,r.get=n.get,r.delete=n.delete,r.on=n.on),r}])}(),function(){"use strict";angular.module("app").factory("Hash",[function(){function e(t,n){t=t||"id",n=n?e.get(n):{},Object.defineProperties(this,{key:{value:t,enumerable:!1,writable:!1},pool:{value:n,enumerable:!1,writable:!1},length:{value:0,enumerable:!1,writable:!0}})}function t(e){return void 0!==this.pool[e]}function n(e){return this.pool[e]}function r(e){var t=this,n=this.key;return e?t.getId(e[n]):null}function o(e){var t=this;return this.pool[e[this.key]]=e,t.push(e),e}function i(e){var t=this,n=t.get(e);if(n)for(var r,o=0,i=Object.keys(e);o<i.length;o++)r=i[o],n[r]=e[r];else n=t.set(e);return n}function s(e){var t=this,n=this.pool,r=this.key,o=t.get(e);if(o){var i=t.indexOf(o);-1!==i&&t.splice(i,1),delete n[o[r]]}return t}function a(e){var t=this;if(!e)return t;for(var n=0;n<e.length;)t.add(e[n]),n++;return t}function c(e){var t=this;if(!e)return t;for(var n=0;n<e.length;)t.remove(e[n]),n++;return t}function u(){var e,t=this,n=t.key,r=t.pool,o=0;for(t.length;t.length;)e=t.shift(),delete r[e[n]],o++;return t}function l(e){var t=this;if(e)for(var n=0;n<t.length;)e(t[n],n),n++;return t}function f(e,t){var n=this;return e=e||this.key,n.sort(function(n,r){var o=t?r:n,i=t?n:r;return o[e]-i[e]}),n}function h(e){return this.forward(e,!0)}function p(e){if(e.key!==this.key||e.length!==this.length)return!0;for(var t=!1,n=0,r=this.length,o=this.key;t&&n<r;)t=this[n][o]!==e[n][o],n++}function d(){var e=this,t=this.pool,n=this.key;Object.keys(t).forEach(function(e){delete t[e]}),angular.forEach(e,function(e){t[e[n]]=e})}var g={};return e.get=function(e){return g[e]=g[e]||{}},e.prototype=new Array,e.prototype.has=t,e.prototype.getId=n,e.prototype.get=r,e.prototype.set=o,e.prototype.add=i,e.prototype.remove=s,e.prototype.each=l,e.prototype.addMany=a,e.prototype.removeMany=c,e.prototype.removeAll=u,e.prototype.forward=f,e.prototype.backward=h,e.prototype.differs=p,e.prototype.updatePool=d,e}])}(),function(){"use strict";angular.module("app").directive("header",[function(){return{restrict:"E",templateUrl:"partials/header",transclude:{header:"?headerItems"},link:function(e,t,n,r){}}}])}(),function(){"use strict";angular.module("app").service("Router",["$location","$timeout",function(e,t){function n(n,r){function o(){e.$$lastRequestedPath=e.path(),e.path(n)}r?t(function(){o()},r):o()}function r(n,r){function o(){n=e.$$lastRequestedPath||n,e.$$lastRequestedPath=null,e.path(n)}r?t(function(){o()},r):o()}var o=this;o.redirect=n,o.retry=r}])}();