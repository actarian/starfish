!function(){"use strict";angular.module("app",["ngRoute","ngMessages","ui.bootstrap","mapboxgl-directive","firebase","jsonFormatter"])}(),function(){"use strict";angular.module("app").config(["$httpProvider",function(t){}])}(),function(){"use strict";angular.module("app").config(["$routeProvider","$locationProvider",function(t,e){t.when("/",{title:"Homepage",templateUrl:"partials/home.html",controller:"HomeCtrl"}).when("/profile",{title:"Profile",templateUrl:"partials/profile.html",controller:"ProfileCtrl",resolve:{user:["FirebaseApi",function(t){return t.auth.redirect("/signin")}]}}).when("/spiaggia/:facilityId",{title:"Spiaggia",templateUrl:"partials/beach.html",controller:"BeachCtrl"}).when("/signin",{title:"Accedi",templateUrl:"partials/signin.html",controller:"SigninCtrl"}).when("/signup",{title:"Registrazione",templateUrl:"partials/signup.html",controller:"SignupCtrl"}).when("/dashboard",{title:"Dashboard",templateUrl:"partials/dashboard.html",controller:"DashboardCtrl",resolve:{user:["FirebaseApi",function(t){return t.auth.redirect("/signin")}]}}).when("/user/:userId",{title:"User",templateUrl:"partials/user.html",controller:"UserCtrl",resolve:{user:["FirebaseApi",function(t){return t.auth.redirect("/signin")}]}}).when("/404",{title:"Error 404",templateUrl:"partials/404"}),t.otherwise("/"),e.html5Mode(!1),e.hashPrefix("")}])}(),function(){"use strict";var t=angular.module("app");t.service("FirebaseApi",["$q","FirebaseService","LocalStorage","Router",function(t,e,n,r){function o(n,r){var o=t.defer();return r.$save?e.saveObject(r).then(function(t){o.resolve(r)},function(t){o.reject(e.error(t))}):e.addObject(n,r).then(function(t){o.resolve(t)},function(t){o.reject(e.error(t))}),o.promise}var i=this;i.user=void 0,i.auth={redirect:function(n){var o=t.defer();return i.auth.current().then(function(t){o.resolve(i.user)},function(t){o.reject(e.error(t)),r.redirect(n)}),o.promise},current:function(){var r=t.defer();if(i.user)r.resolve(i.user);else{var o=n.get("token");o?e.getSingle("users",{token:o}).then(function(t){i.user=t,r.resolve(t)},function(t){r.reject(e.error(t))}):r.reject(e.error("not logged"))}return r.promise},signin:function(r){console.log("FirebaseApi.userSignin",r);var o=t.defer();return i.user?(console.log("signed",i.user),o.resolve(i.user)):e.getSingle("users",{email:r.email}).then(function(t){r.password===t.password?(n.set("token",t.token),i.user=t,o.resolve(t)):o.reject(getEttot("not found"))},function(t){o.reject(e.error(t))}),o.promise},signup:function(r){console.log("api.userSignup",r);var o=t.defer();return e.getSingle("users",{email:r.email}).then(function(t){o.reject(e.error("indirizzo email gi√† in uso."))},function(t){r.token=e.presence.uid,e.addObject("users",r).then(function(t){n.set("token",t.token),i.user=t,o.resolve(t)},function(t){o.reject(e.error(t))})}),o.promise},signout:function(){console.log("api.signout");var e=t.defer();return n.delete("token"),i.user=null,e.resolve(),e.promise}},i.users={get:function(){return e.getArray("users")},detail:function(t){return e.getSingle("users",{id:t})},save:function(t){return o("users",t)}},i.facilities={get:function(){return e.getArray("facilities")},user:function(t){return e.getSingle("facilities",{userId:t})},detail:function(t){return e.getSingle("facilities",{id:t})},save:function(t){return o("facilities",t)}},i.facilityItems={get:function(){return e.getArray("facilityItems")},user:function(t){return e.getArray("facilityItems",{facilityId:t})},detail:function(t){return e.getSingle("facilityItems",{id:t})},save:function(t){return o("facilityItems",t)}}}]),t.service("FirebaseService",["$q","$firebaseAuth","$firebaseObject","$firebaseArray",function(t,e,n,r){function o(){return(new Date).getTime()+Math.floor(999*Math.random())}function i(){var n=t.defer();if(g.presence)n.resolve(g.presence);else{e().$signInAnonymously({remember:"sessionOnly"}).then(function(t){var e=g.presence={uid:t.uid};n.resolve(e)}).catch(function(t){n.reject(p(t))})}return n.promise}function s(t){var e=[];for(var n in t)e.push({key:n,value:t[n]});var r=null;return e.length&&(r=e.shift()),r}function a(e,n,r){var o=t.defer();return i().then(function(t){l(e,n,r).then(function(t){if(1===t.length){var n=t[0].$id;c(e,n).then(function(t){o.resolve(t)},function(t){o.reject(p(t))})}else o.reject(p("record duplicati"))},function(t){o.reject(p(t))})},function(t){o.reject(p(t))}),o.promise}function c(e,r){var o=t.defer();return i().then(function(t){var i=d.database().ref(),s=i.child(e).child(r);n(s).$loaded().then(function(t){o.resolve(t)},function(t){o.reject(p(t))})},function(t){o.reject(p(t))}),o.promise}function l(e,n,o){var a=t.defer();return i().then(function(t){var i=d.database().ref(),c=i.child(e),l=c;if(n){var u=s(n);u&&(l=c.orderByChild(u.key).equalTo(u.value),o&&(l=l.limitToLast(o)))}r(l).$loaded().then(function(t){a.resolve(t)},function(t){a.reject(p(t))})},function(t){a.reject(p(t))}),a.promise}function u(e,r){var s=t.defer();return i().then(function(t){var i=d.database().ref(),a=i.child(e),c=a.push();r.id=o(),c.set(r),n(c).$loaded().then(function(t){s.resolve(t)},function(t){s.reject(p(t))})},function(t){s.reject(p(t))}),s.promise}function f(e,n){var s=t.defer();return i().then(function(t){var i=d.database().ref(),a=i.child(e),c=o();angular.forEach(n,function(t){t.id=t.id||++c,a.push().set(t)}),r(a).$loaded().then(function(t){s.resolve(t)},function(t){s.reject(p(t))})},function(t){s.reject(p(t))}),s.promise}function h(t){return void 0===t.length&&(t.id=t.id||o()),t.$save()}function p(t){var e=400,n="Errore";return angular.isString(t)?n=t:t&&t.message&&(e=t.status,n=t.message),{status:e,message:n}}var d=window.firebase||null;if(!d)throw"missing firebase.js";var m={apiKey:"AIzaSyCskd8Cgzd_j7JzgEC3mEb4ir1qZFh6auQ",authDomain:"starfish-c2b0f.firebaseapp.com",databaseURL:"https://starfish-c2b0f.firebaseio.com",projectId:"starfish-c2b0f",storageBucket:"starfish-c2b0f.appspot.com",messagingSenderId:"796739915579"};d.initializeApp(m);var g=this;g.presence=void 0,g.getSingle=a,g.getObject=c,g.getArray=l,g.addObject=u,g.addArray=f,g.saveObject=h,g.error=p}])}(),function(){"use strict";var t=angular.module("app");t.controller("RootCtrl",["$scope","$location","FirebaseApi",function(t,e,n){t.api=n,t.signout=function(){console.log(n),n.auth.signout().then(function(){e.path("/")})},n.auth.current().then(function(e){t.user=e,console.log(e)},function(t){console.log("RootCtrl.error",t)})}]),t.controller("HomeCtrl",["$scope","State","FirebaseApi",function(t,e,n){var r=t.state=new e;t.map={};n.facilities.get().then(function(e){t.map.items=e,r.ready()},function(t){r.error(t)}),r.ready()}]),t.controller("ProfileCtrl",["$scope","State","FirebaseApi","user",function(t,e,n,r){var o=t.state=new e,i=t.MODES={BEACH:1,PRICES:2,PLACE:3,OPENING:4,INFO:5},s=(t.mode=i.BEACH,t.model={shopName:r.shopName,cols:0,rows:0,items:[]});t.map={},t.controls={};t.saveFacility=function(t){if(o.busy(t)){var e={};s.$save?e=s:(angular.forEach(s,function(t,n){t?e[n]=t:delete e[n]}),e.userId=r.id),n.facilities.save(e).then(function(t){console.log("response",t),o.success()},function(t){o.error(t)})}},t.saveItems=function(e){t.saveFacility(e)},n.facilities.user(r.id).then(function(e){console.log("user.facilities",e),e&&(s=t.model=e)})}]),t.controller("BeachCtrl",["$scope","$routeParams","State","FirebaseApi",function(t,e,n,r){var o=(t.state=new n,t.model={}),i=(t.map={},t.controls={},t.facilityId=parseInt(e.facilityId));r.facilities.detail(i).then(function(e){o=t.model=e})}]),t.controller("DashboardCtrl",["$scope","State","FirebaseApi","user",function(t,e,n,r){(t.state=new e).ready()}]),t.controller("SigninCtrl",["$scope","State","Router","FirebaseApi",function(t,e,n,r){var o=t.state=new e,i=t.model={};t.submit=function(t){o.busy(t)&&r.auth.signin(i).then(function(t){o.success(),n.path("/dashboard")},function(t){console.log("SigninCtrl.error",t),o.error(t)})}}]),t.controller("SignupCtrl",["$scope","State","Router","FirebaseApi",function(t,e,n,r){var o=t.state=new e,i=t.model={};t.submit=function(t){o.busy(t)&&r.auth.signup(i).then(function(t){o.success(),n.apply("/dashboard")},function(t){console.log("SignupCtrl.error",t),o.error(t)})}}])}(),function(){"use strict";angular.module("app").directive("beach",["$http","$timeout","Painter","Palette","Rect","Events","Hash",function(t,e,n,r,o,i,s){function a(t,o,s,a){function c(t,e){var n=R;E?n.setFill(n.colors.white):n.setFill(n.colors.grey),n.ctx.beginPath(),n.ctx.arc(t,e,6,0,2*Math.PI,!1),n.ctx.fill()}function l(t,e){var n=.4*A.w,r=R;r.ctx.beginPath(),r.ctx.moveTo(t+n*Math.cos(0),e+n*Math.sin(0));for(var o=1;o<=7;o++)r.ctx.lineTo(t+n*Math.cos(2*o*Math.PI/7),e+n*Math.sin(2*o*Math.PI/7));r.ctx.fill()}function u(t,e){var n={x:(t-T.x)/C.w,y:(e-T.y)/C.h};t+=A.w*n.x*.75,e+=A.h*n.y*.75;var r=R;r.setFill(r.colors.greyLight),l(t,e)}function f(t,e){var n=R;n.setFill(n.colors.blue),l(t,e)}function h(){var t=R;t.clear(),P.pattern(t,"bg",0,0,t.rect.w,t.rect.h),angular.forEach(O,function(t){u(t.x*A.w+A.w2,t.y*A.h+A.h2)}),angular.forEach(O,function(t){f(t.x*A.w+A.w2,t.y*A.h+A.h2)}),I&&c(I.x*A.w+A.w2,I.y*A.h+A.h2)}function p(t){O.push({x:t.x,y:t.y})}function d(t){for(var e,n=-1,r=0,o=O.length;r<o;)e=O[r],e.x===t.x&&e.y===t.y&&(n=r,r=o),r++;return n}function m(t){O.splice(t,1)}function g(t){var e=d(t);return-1!==e?m(e):p(t),e}function v(){E=null,angular.forEach(O,function(t){t.x===I.x&&t.y===I.y&&(E=t)}),h()}function y(){var t={},e={},n=0,r=0;angular.forEach(O,function(o){t[o.x]||(t[o.x]=!0,n++),e[o.y]||(e[o.y]=!0,r++)}),N.cols=n,N.rows=r}function b(){e(function(){y()})}function x(t){var e=t.relative,n={x:Math.floor(e.x/A.w),y:Math.floor(e.y/A.h)};$=!0,M=g(n),v(),b()}function w(t){var e=t.relative;if(T={x:e.x,y:e.y},I={x:Math.floor(e.x/A.w),y:Math.floor(e.y/A.h)},$){var n=d(I);-1===M&&-1===n?p(I):M>=0&&-1!==n&&m(n)}v()}function S(t){$&&($=!1,b())}function k(t){var e=o[0].offsetWidth,n=o[0].offsetHeight;C.w=e,C.h=n,h()}var I,E,$,M,T={x:0,y:0},C={w:0,h:0},A={w:40,h:40,w2:20,h2:20},R=new n(o[0]),P=new r,j=t.controls,N=t.model,O=N.items;P.add("bg",A.w,A.h,function(t,e){t.setFill(t.colors.greyLight),t.ctx.beginPath(),t.ctx.arc(e.center().x,e.center().y,5,0,2*Math.PI,!1),t.ctx.fill()}),j.setCenter=function(){if(N.rows&&N.cols){var t=Math.floor(C.w/A.w),e=Math.floor(C.h/A.h),n=Number.POSITIVE_INFINITY,r=Number.POSITIVE_INFINITY;angular.forEach(O,function(t){n=Math.min(n,t.x),r=Math.min(r,t.y)});var o=Math.max(0,Math.floor((t-N.cols)/2)-1),i=Math.max(0,Math.floor((e-N.rows)/2)-1);angular.forEach(O,function(t){t.x=o+(t.x-n),t.y=i+(t.y-r)})}console.log("setCenter",N.rows,N.cols),h()};var L={down:x,move:w,up:S,resize:k},V=new i(o);V.add(L),t.$on("$destroy",function(){V.remove(L)}),k(),t.$watch("model",function(t){N=t,O=N.items,e(function(){h()})})}return{restrict:"A",link:a}}])}(),function(){"use strict";var t=angular.module("app");t.directive("mapbox",["$http","$timeout","GoogleMaps",function(t,e,n){function r(t,r,o,i){function s(){x=c();var e=new mapboxgl.Map({container:r[0],style:"mapbox://styles/mapbox/streets-v9",interactive:!0,logoPosition:"bottom-right",center:[x.lng,x.lat],zoom:9});return w=e.getCanvasContainer(),e.on("mousedown",p),t.map.setAddress=function(e){console.log("setAddress",e),angular.extend(t.model,e),t.map.results=null,x=c(e.position.lat,e.position.lng),h()},t.map.search=function(){return console.log("address",t.map.address),t.map.results=null,l(t.map.address),!0},t.map.styles={RIVA:1,SATELLITE:2},t.map.style=t.map.styles.RIVA,t.map.styleToggle=function(){t.map.style===t.map.styles.RIVA?(t.map.style=t.map.styles.SATELLITE,e.setStyle("mapbox://styles/mapbox/satellite-v9")):(t.map.style=t.map.styles.RIVA,e.setStyle("mapbox://styles/mapbox/streets-v9"))},t.map.setStyle=function(n){t.map.style=n,t.map.style===t.map.styles.RIVA?e.setStyle("mapbox://styles/mapbox/streets-v9"):e.setStyle("mapbox://styles/mapbox/satellite-v9")},e}function a(){var t=document.createElement("div");t.id="point",t.className="marker";var e=new mapboxgl.Marker(t,{offset:[-10,-10]}).setLngLat([x.lng,x.lat]).addTo(v),n=angular.element(t);return n.on("mouseenter",function(t){w.style.cursor="move",k=!0,v.dragPan.disable()}),n.on("mouseleave",function(t){w.style.cursor="",k=!1,v.dragPan.enable()}),e}function c(e,n){var r=t.model.position||{};return e&&n?(r.lat=e,r.lng=n):(r.lat=r.lat||0,r.lng=r.lng||0,0===r.lat&&0===r.lng&&f()),console.log("setPosition",e,n),r}function l(r){b.geocode({address:r},function(r,o){e(function(){"OK"===o?t.map.results=n.parse(r):alert("Geocode was not successful for the following reason: "+o)})})}function u(r){console.log("reverseGeocode",r),b.geocode({location:r},function(r,o){e(function(){"OK"===o?t.map.results=n.parse(r):console.log("Geocoder failed due to: "+o)})})}function f(){navigator.geolocation?navigator.geolocation.getCurrentPosition(function(t){e(function(){x=c(t.coords.latitude,t.coords.longitude),h(),u(x)})},function(t){console.log("error",t)}):console.log("error","Browser doesn't support Geolocation")}function h(){y.setLngLat([x.lng,x.lat]),v.flyTo({center:[parseFloat(x.lng),parseFloat(x.lat)],zoom:15,speed:1.5,curve:1})}function p(){k&&(S=!0,w.style.cursor="grab",v.on("mousemove",d),v.once("mouseup",m))}function d(t){if(S){var e=t.lngLat;w.style.cursor="grabbing",y.setLngLat([e.lng,e.lat])}}function m(t){if(S){var n=t.lngLat;e(function(){x=c(n.lat,n.lng)}),w.style.cursor="",S=!1,v.off("mousemove",d)}}function g(){v=s(),y=a()}var v,y,b,x,w,S,k;n.geocoder().then(function(t){b=t,g()})}if(mapboxgl)return mapboxgl.accessToken="pk.eyJ1IjoiYWN0YXJpYW4iLCJhIjoiY2lqNWU3MnBzMDAyZndnbTM1cjMyd2N2MiJ9.CbuEGSvOAfIYggQv854pRQ",{restrict:"E",link:r}}]),t.directive("mapboxViewer",["$http","$timeout","GoogleMaps","Router",function(t,e,n,r){function o(t,o,i,s){function a(){var e=new mapboxgl.Map({container:o[0],style:"mapbox://styles/mapbox/streets-v9",interactive:!0,logoPosition:"bottom-right",center:[v.lng,v.lat],zoom:6});return b=e.getCanvasContainer(),t.map.setAddress=function(e){console.log("setAddress",e),t.map.results=null,u(e.position)},t.map.search=function(){return console.log("address",t.map.address),t.map.results=null,l(t.map.address),!0},t.map.styles={RIVA:1,SATELLITE:2},t.map.style=t.map.styles.RIVA,t.map.styleToggle=function(){t.map.style===t.map.styles.RIVA?(t.map.style=t.map.styles.SATELLITE,e.setStyle("mapbox://styles/mapbox/satellite-v9")):(t.map.style=t.map.styles.RIVA,e.setStyle("mapbox://styles/mapbox/streets-v9"))},t.map.setStyle=function(n){t.map.style=n,t.map.style===t.map.styles.RIVA?e.setStyle("mapbox://styles/mapbox/streets-v9"):e.setStyle("mapbox://styles/mapbox/satellite-v9")},e}function c(t){var e=document.createElement("div");e.id="point",e.className="marker";var n=new mapboxgl.Marker(e,{offset:[-10,-10]}).setLngLat([t.position.lng,t.position.lat]).addTo(p);return angular.element(e).on("click",function(e){console.log("click",t),r.apply("/spiaggia/"+t.id)}),n}function l(r){g.geocode({address:r},function(r,o){e(function(){"OK"===o?t.map.results=n.parse(r):alert("Geocode was not successful for the following reason: "+o)})})}function u(t){p.flyTo({center:[parseFloat(t.lng),parseFloat(t.lat)],zoom:15,speed:1.5,curve:1})}function f(t){p.fitBounds(t,{speed:1.5,curve:1,padding:30,linear:!1,maxZoom:8})}function h(){p=a(),t.$watch("map.items",function(t){if(console.log(t),angular.forEach(d,function(t){p.removeLayer(t)}),d=[],t){var e=Number.POSITIVE_INFINITY,n=Number.NEGATIVE_INFINITY,r=Number.POSITIVE_INFINITY,o=Number.NEGATIVE_INFINITY;angular.forEach(t,function(t){m=c(t),d.push(m),e=Math.min(e,t.position.lat),n=Math.max(n,t.position.lat),r=Math.min(r,t.position.lng),o=Math.max(o,t.position.lng),y=new mapboxgl.LngLatBounds(new mapboxgl.LngLat(r,e),new mapboxgl.LngLat(o,n))}),f(y)}})}var p,d,m,g,v,y,b;v={lng:13.5998744,lat:41.3412555},n.geocoder().then(function(t){g=t,h()})}if(mapboxgl)return mapboxgl.accessToken="pk.eyJ1IjoiYWN0YXJpYW4iLCJhIjoiY2lqNWU3MnBzMDAyZndnbTM1cjMyd2N2MiJ9.CbuEGSvOAfIYggQv854pRQ",{restrict:"A",link:o}}]),t.service("GoogleMaps",["$q","$http",function(t,e){function n(){var e=t.defer();if(a)e.resolve(window.google.maps);else{window.googleMapsInit=function(){e.resolve(window.google.maps),window.googleMapsInit=null,a=!0};var n=document.createElement("script");n.setAttribute("async",null),n.setAttribute("defer",null),n.setAttribute("src","https://maps.googleapis.com/maps/api/js?key="+s+"&callback=googleMapsInit"),document.body.appendChild(n)}return e.promise}function r(){var e=t.defer();return n().then(function(t){var n=new t.Geocoder;e.resolve(n)},function(t){e.reject(t)}),e.promise}function o(t,e){var n={street:"route",number:"street_number",locality:"locality",postalCode:"postal_code",city:"administrative_area_level_3",province:"administrative_area_level_2",region:"administrative_area_level_1",country:"country"},r=null;return angular.forEach(e.address_components,function(e){angular.forEach(e.types,function(o){o===n[t]&&(r=e.long_name)})}),r}function i(t){var e=null;return t.length&&(e=t.filter(function(t){return!0}).map(function(t){return{name:t.formatted_address,street:o("street",t),number:o("number",t),locality:o("locality",t),postalCode:o("postalCode",t),city:o("city",t),province:o("province",t),region:o("region",t),country:o("country",t),position:{lng:t.geometry.location.lng(),lat:t.geometry.location.lat()}}})),console.log("googleMaps.parse",t,e),e}var s="AIzaSyAYuhIEO-41YT_GdYU6c1N7DyylT_OcMSY",a=!1;this.maps=n,this.geocoder=r,this.parse=i}])}(),function(){"use strict";var t=angular.module("app");t.factory("Rect",[function(){function t(t,e,n,r){this.x=t||0,this.y=e||0,this.w=n||0,this.h=r||0}return t.mult=function(t,e){return t.x*=e,t.y*=e,t.w*=e,t.h*=e,t},t.prototype={mult:function(e){return t.mult(this,e)},offset:function(t,e){return this.x+=t,this.y+=e,this},reduce:function(t){return this.offset(-t)},reduceRect:function(e){return this.offsetRect(t.mult(e,-1))},expandRect:function(t){return this.x-=t.x||0,this.y-=t.y||0,this.w+=t.w||0,this.h+=t.h||0,this},expand:function(t){return this.expandRect({x:t,y:t,w:2*t,h:2*t})},intersect:function(t){var e=this.x,n=this.y,r=this.w,o=this.h;return!(t.x>e+r||t.x+t.w<e||t.y>n+o||t.y+t.h<n)},top:function(){var t=this.x,e=this.y,n=this.w;this.h;return{x:t+n/2,y:e}},right:function(){var t=this.x,e=this.y;return{x:t+this.w,y:e+this.h/2}},bottom:function(){var t=this.x,e=this.y;return{x:t+this.w/2,y:e+this.h}},left:function(){var t=this.x,e=this.y;this.w;return{x:t,y:e+this.h/2}},center:function(){var t=this.x,e=this.y;return{x:t+this.w/2,y:e+this.h/2}},topLeft:function(){var t=this.x,e=this.y;this.w,this.h;return{x:t,y:e}},topRight:function(){var t=this.x,e=this.y,n=this.w;this.h;return{x:t+n,y:e}},bottomRight:function(){var t=this.x,e=this.y;return{x:t+this.w,y:e+this.h}},bottomLeft:function(){var t=this.x,e=this.y;this.w;return{x:t,y:e+this.h}},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setW:function(t){return this.w=t,this},setH:function(t){return this.h=t,this},setPos:function(t,e){return this.x=t,this.y=e,this},setSize:function(t,e){return this.w=t,this.h=e,this},copy:function(t){return this.x=t.x,this.y=t.y,this.w=t.w,this.h=t.h,this},clone:function(){return new t(this.x,this.y,this.w,this.h)},toString:function(){return"{"+this.x+","+this.y+","+this.w+","+this.h+"}"}},t}]),t.factory("Color",[function(){function t(t,e,n,r){if(arguments.length>1)this.r=t||0===t?t:0,this.g=e||0===e?e:0,this.b=n||0===n?n:0,this.a=r||0===r?r:255;else{var o=t||"0xffffff";o=parseInt(o),t.length>8?(this.r=o>>24&255,this.g=o>>16&255,this.b=o>>8&255,this.a=o>>0&255):(this.r=o>>16&255,this.g=o>>8&255,this.b=o>>0&255,this.a=255)}}return t.componentToHex=function(t){var e=t.toString(16);return 1==e.length?"0"+e:e},t.luma=function(t){return t.dot({r:95,g:100,b:60})},t.contrast=function(e){return new t(t.luma(e)>.6?"0x000000":"0xffffff")},t.darker=function(e,n,r){return r=r||0,new t(Math.max(Math.floor(e.r*r),Math.floor(e.r-255*n)),Math.max(Math.floor(e.g*r),Math.floor(e.g-255*n)),Math.max(Math.floor(e.b*r),Math.floor(e.b-255*n)),e.a)},t.lighter=function(e,n,r){return r=r||1,new t(Math.min(e.r+Math.floor((255-e.r)*r),Math.floor(e.r+255*n)),Math.min(e.g+Math.floor((255-e.g)*r),Math.floor(e.g+255*n)),Math.min(e.b+Math.floor((255-e.b)*r),Math.floor(e.b+255*n)),e.a)},t.prototype={toUint:function(){return(this.r<<24)+(this.g<<16)+(this.b<<8)+this.a},toHex:function(){return"#"+t.componentToHex(this.r)+t.componentToHex(this.g)+t.componentToHex(this.b)+t.componentToHex(this.a)},toRgba:function(){return"rgba("+this.r+","+this.g+","+this.b+","+(this.a/255).toFixed(3)+")"},dot:function(t){return this.r/255*(t.r/255)+this.g/255*(t.g/255)+this.b/255*(t.b/255)},alpha:function(t,e,n){return e=e||0,n=n||1,this.a=Math.floor(255*(e+t*(n-e))),this},makeSet:function(){return this.foreground=t.contrast(this),this.border=t.darker(this,.3),this.light=t.lighter(this,.3),this}},t}]),t.factory("Shape",[function(){function t(){}return t.shapeCircle=function(t,e,n,r,o,i){o=o||0,i=i||2*Math.PI,t.ctx.arc(e,n,r,o,i,!1)},t.shapeStar=function(t,e,n,r,o,s){var a,c,l=Math.PI/2*3,u=Math.PI/s,f=t.ctx;for(f.moveTo(e,n-r),i=0;i<s;i++)a=e+Math.cos(l)*r,c=n+Math.sin(l)*r,f.lineTo(a,c),l+=u,a=e+Math.cos(l)*o,c=n+Math.sin(l)*o,f.lineTo(a,c),l+=u;f.lineTo(e,n-r)},t.shapeRoundRect=function(t,e,n){var r=t.ctx,o=e.x,i=e.y,s=e.w,a=e.h;if(void 0===typeof n&&(n=4),"number"==typeof n)n={tl:n,tr:n,br:n,bl:n};else{var c={tl:0,tr:0,br:0,bl:0};for(var l in c)n[l]=n[l]||c[l]}r.moveTo(o+n.tl,i),r.lineTo(o+s-n.tr,i),r.quadraticCurveTo(o+s,i,o+s,i+n.tr),r.lineTo(o+s,i+a-n.br),r.quadraticCurveTo(o+s,i+a,o+s-n.br,i+a),r.lineTo(o+n.bl,i+a),r.quadraticCurveTo(o,i+a,o,i+a-n.bl),r.lineTo(o,i+n.tl),r.quadraticCurveTo(o,i,o+n.tl,i)},t.circle=function(){var e=Array.prototype.slice.call(arguments),n=e[0].ctx;n.beginPath(),t.shapeCircle.apply(this,e),n.closePath()},t.star=function(){var e=Array.prototype.slice.call(arguments),n=e[0].ctx;n.beginPath(),t.shapeStar.apply(this,e),n.closePath()},t.roundRect=function(){var e=Array.prototype.slice.call(arguments),n=e[0].ctx;n.beginPath(),t.shapeRoundRect.apply(this,e),n.closePath()},t}]),t.constant("PainterColors",{black:"0x14191e",white:"0xffffff",blue:"0x0023FF",red:"0xF21500",lightBlue:"0x79ccf2",lightYellow:"0xfff79a",greyLighter:"0xf8f8f8",greyLight:"0xeeeeee",greyMedium:"0xcccccc",grey:"0x90939b",map:"0x24292e"}),t.factory("Palette",["$q","Painter","Rect",function(t,e,n){function r(){this.painter=(new e).setSize(0,0),this.buffer=(new e).setSize(0,0),this.size={w:0,h:0},this.pool={},this.rows={}}return r.prototype={getRect:function(t,e){var r=this.painter,o=this.size,i=this.rows,s=new n(0,0,t,e),a=i[e]||{x:0,y:o.h};if(o.w=Math.max(o.w,a.x+t),o.h=Math.max(o.h,a.y+e),r.canvas.width||r.canvas.height){if(o.w>r.canvas.width||o.h>r.canvas.height){var c=r.canvas;r.setCanvas(document.createElement("canvas")),r.setSize(o.w,o.h),r.ctx.drawImage(c,0,0)}}else r.setSize(o.w,o.h);return s.x=a.x,s.y=a.y,a.x+=t,i[e]=a,s},add:function(e,n){var r=this;if(angular.isString(n)){var o=t.defer(),i=new Image;return i.onload=function(){r.addShape(e,i.width,i.height,function(t,e){t.ctx.drawImage(i,0,0)}),o.resolve(i)},i.onerror=function(){o.reject("connot load "+n)},i.src=n,o.promise}var s=Array.prototype.slice.call(arguments);return r.addShape.apply(r,s)},addShape:function(t,e,n,r){var o=this.painter,i=this.getRect(e,n);o.ctx.save(),o.ctx.rect(i.x,i.y,i.w,i.h),o.ctx.clip(),o.ctx.translate(i.x,i.y),r.call(o,o,i.clone().setPos(0,0)),o.ctx.restore(),this.pool[t]=i},draw:function(t,e,n,r,o){var i=this.pool[e];i&&t.drawRect(this.painter.canvas,i,{x:n,y:r,w:i.w,h:i.h},o)},tint:function(t,e,n,r,o,i){var s=this.pool[e];if(s){var a=this.painter,c=this.buffer.setSize(s.w,s.h);c.save(),c.setFill(o),c.fillRect(),c.ctx.globalCompositeOperation="destination-atop",c.ctx.drawImage(a.canvas,s.x,s.y,s.w,s.h,0,0,s.w,s.h),c.restore(),console.log(n,r,c.canvas,t.canvas),t.draw(c.canvas,{x:n,y:r},i)}},pattern:function(t,e,n,r,o,i,s){function a(e){var s=t.ctx;s.save(),s.translate(n,r),s.fillStyle=e,s.fillRect(-n,-r,o,i),s.translate(-n,-r),s.restore()}var c=this.pool[e];if(c){var l,u=c.img;if(u&&c.color==s)l=t.ctx.createPattern(u,"repeat"),a(l);else{var f=this.buffer.setSize(c.w,c.h);s?(c.color=s,f.save(),f.setFill(s),f.fillRect(),f.ctx.globalCompositeOperation="destination-atop",f.ctx.drawImage(this.painter.canvas,c.x,c.y,c.w,c.h,0,0,c.w,c.h),f.restore()):f.ctx.drawImage(this.painter.canvas,c.x,c.y,c.w,c.h,0,0,c.w,c.h),u=new Image,u.onload=function(){c.img=u,l=t.ctx.createPattern(u,"repeat"),a(l)},u.src=f.toDataURL()}}}},r}]),t.factory("Painter",["Shape","Rect","Color","PainterColors",function(t,e,n,r){function o(t){t=t||document.createElement("canvas"),this.rect=new e,this.drawingRect=new e,this.setColors(),this.setCanvas(t)}o.colors={},angular.forEach(r,function(t,e){o.colors[e]=new n(t).makeSet()});o.colors;return o.prototype={colors:o.colors,setColors:function(){var t=this.colors;angular.forEach(r,function(e,r){t[r]=new n(e).makeSet()})},setCanvas:function(t){this.canvas=t,this.setSize(t.offsetWidth,t.offsetHeight);var e=t.getContext("2d");return e.lineCap="square",this.ctx=e,this},setSize:function(t,e){return this.canvas.width=t,this.canvas.height=e,this.rect.w=t,this.rect.h=e,this},copy:function(t){return this.ctx.drawImage(t,0,0),this},clear:function(){return this.resize(),this},resize:function(){return this.setSize(this.canvas.offsetWidth,this.canvas.offsetHeight),this},setText:function(t,e,n,r){t=t||"11px monospace",e=e||"center",n=n||"middle",r=r||this.colors.black;var o=this.ctx;return o.font=t,o.textAlign=e,o.textBaseline=n,o.fillStyle=r.toRgba(),this},setFill:function(t){return t=t||this.colors.black,this.ctx.fillStyle=t.toRgba(),this},setStroke:function(t,e){t=t||this.colors.black;var n=this.ctx;return e=e||1,n.strokeStyle=t.toRgba(),n.lineWidth=e,this},fillText:function(t,e,n,r,o){return n&&(r=r||"",o=o||Math.floor(n/8),t.length>o&&(t=t.substr(0,Math.min(t.length,o)).trim()+r)),this.ctx.fillText(t,e.x,e.y),this},fillRect:function(t){t=t||this.rect;var e=this.ctx,n=t.x,r=t.y,o=t.w,i=t.h;return e.fillRect(n,r,o,i),this},strokeRect:function(t){t=t||this.rect;var e=this.ctx,n=t.x,r=t.y,o=t.w,i=t.h;return e.strokeRect(n,r,o,i),this},fill:function(){return this.ctx.fill(),this},stroke:function(){return this.ctx.stroke(),this},begin:function(){return this.ctx.beginPath(),this},close:function(){return this.ctx.closePath(),this},save:function(){return this.ctx.save(),this},restore:function(){return this.ctx.restore(),this},rotate:function(t){this.ctx.rotate(t*Math.PI/180)},translate:function(t){this.ctx.translate(t.x,t.y)},toDataURL:function(){return this.canvas.toDataURL()},draw:function(t,e,n){if(t){e.w=e.w||t.width,e.h=e.h||t.height;var r=this.ctx,o=this.drawingRect,i=o.x=e.x-e.w/2,s=o.y=e.y-e.h/2;o.w=e.w,o.h=e.h;r.save(),r.translate(i,s),n&&n.call(this),r.drawImage(t,0,0),r.restore()}return this},drawRect:function(t,e,n,r){if(t){e.w=e.w||t.width,e.h=e.h||t.height,n.w=n.w||t.width,n.h=n.h||t.height;var o=this.ctx,i=this.drawingRect,s=i.x=n.x-e.w/2,a=i.y=n.y-e.h/2;i.w=n.w,i.h=n.h;o.save(),o.translate(s,a),r&&r.call(this),o.drawImage(t,e.x,e.y,e.w,e.h,0,0,n.w,n.h),o.restore()}return this},flip:function(t){t=t||{x:1,y:-1};var e=this.ctx,n=this.drawingRect;e.translate(-1===t.x?n.w:0,-1===t.y?n.h:0),e.scale(t.x,t.y)}},o}])}(),function(){"use strict";angular.module("app").factory("Events",[function(){function t(t,e){var n=document.documentElement||document.body.parentNode||document.body,r={x:window.pageXOffset||n.scrollLeft,y:window.pageYOffset||n.scrollTop};if("resize"===t.type){var o={w:this.getWidth(),h:this.getHeight()};this.view=o}var s=i(e),a={x:s.offsetLeft,y:s.offsetTop},c=s.getBoundingClientRect(),l=this.getPage(t);if(l){var u={x:l.x-r.x-c.left,y:l.y-r.y-c.top},f={x:l.x-r.x,y:l.y-r.y};this.relative=u,this.absolute=f}"resize"===this.type&&console.log(this.type),this.originalEvent=t,this.element=e,this.node=s,this.offset=a,this.rect=c}function e(){return self.innerWidth?self.innerWidth:document.documentElement&&document.documentElement.clientWidth?document.documentElement.clientWidth:document.body?document.body.clientWidth:void 0}function n(){return self.innerHeight?self.innerHeight:document.documentElement&&document.documentElement.clientHeight?document.documentElement.clientHeight:document.body?document.body.clientHeight:void 0}function r(t){var e=["click","mousedown","mouseup","mousemove","mouseover","mouseout","mouseenter","mouseleave","contextmenu"],n=["touchstart","touchmove","touchend","touchcancel"],r=null;if(-1!==n.indexOf(t.type)){var o=null,i=t.originalEvent?t.originalEvent:t,s=i.touches.length?i.touches:i.changedTouches;s&&s.length&&(o=s[0]),o&&(r={x:o.pageX,y:o.pageY})}else-1!==e.indexOf(t.type)&&(r={x:t.pageX,y:t.pageY});return this.type=t.type,r}function o(e){function n(e){var n=new t(e,u.element);u.listeners.click.apply(this,[n])}function r(e){var n=new t(e,u.element);u.listeners.down.apply(this,[n]),u.removeTouchEvents()}function o(e){var n=new t(e,u.element);u.listeners.move.apply(this,[n])}function i(e){var n=new t(e,u.element);u.listeners.up.apply(this,[n])}function s(e){console.log("onResize",e);var n=new t(e,u.element);u.listeners.resize.apply(this,[n])}function a(e){var n=new t(e,u.element);u.listeners.down.apply(this,[n]),u.removeStandardEvents()}function c(e){var n=new t(e,u.element);u.listeners.move.apply(this,[n])}function l(e){var n=new t(e,u.element);u.listeners.up.apply(this,[n])}this.element=e,this.listeners={},this.standardEvents={click:{key:"click",callback:n},down:{key:"mousedown",callback:r},move:{key:"mousemove",callback:o},up:{key:"mouseup",callback:i},resize:{key:"resize",callback:s}},this.touchEvents={down:{key:"touchstart",callback:a},move:{key:"touchmove",callback:c},up:{key:"touchend",callback:l}};var u=this}function i(t){return t.length?t[0]:t}function s(t){return t.length?t:angular.element(t)}function a(t){var e=this,n=this.standardEvents,r=this.touchEvents,o=s(this.element),i=angular.element(window);return angular.forEach(t,function(t,s){if(e.listeners[s]){var a={};a[s]=e.listeners[s],c(a)}e.listeners[s]=t,n[s]&&("resize"===s?i.on(n[s].key,n[s].callback):o.on(n[s].key,n[s].callback)),r[s]&&o.on(r[s].key,r[s].callback)}),e}function c(t){var e=this,n=this.standardEvents,r=this.touchEvents,o=s(this.element),i=angular.element(window);return angular.forEach(t,function(t,s){n[s]&&("resize"===s?i.off(n[s].key,n[s].callback):o.off(n[s].key,n[s].callback)),r[s]&&o.off(r[s].key,r[s].callback),e.listeners[s]=null}),e}function l(){var t=this,e=t.standardEvents,n=(t.touchEvents,s(t.element));n.off("mousedown",e.down.callback),n.off("mousemove",e.move.callback),n.off("mouseup",e.up.callback)}function u(){var t=this,e=(t.standardEvents,t.touchEvents),n=s(t.element);n.off("touchstart",e.down.callback),n.off("touchmove",e.move.callback),n.off("touchend",e.up.callback)}return t.prototype={getPage:r,getWidth:e,getHeight:n},o.prototype={add:a,remove:c,removeStandardEvents:l,removeTouchEvents:u},o}])}(),function(){"use strict";angular.module("app").directive("ngClick",["Events",function(t){function e(e,n,r,o){function i(t){n.removeClass("animate"),n.offsetWidth,s.style.left=t.relative.x+"px",s.style.top=t.relative.y+"px",setTimeout(function(){n.addClass("animate"),setTimeout(function(){n.removeClass("animate")},1e3)},10)}n.addClass("material");var s=document.createElement("material");n[0].appendChild(s);var a={click:i},c=new t(n).add(a);e.$on("$destroy",function(){c.remove(a)})}return{restrict:"A",priority:0,link:e}}])}(),function(){"use strict";angular.module("app")}(),function(){"use strict";var t=angular.module("app");t.directive("controlMessages",[function(){return{restrict:"E",templateUrl:"partials/control-messages",transclude:{message:"?messageItems"},link:function(t,e,n,r){}}}]),t.directive("control",["$http","$templateCache","$compile","$parse",function(t,e,n,r){function o(t,e,n){t=t||"",e=e||"";var r=t.split(",");if(r.length>1){var o=r.shift();return angular.forEach(r,function(t,r){
o=n?o.split("{"+r+"}").join("' + "+e+t+" + '"):o.split("{"+r+"}").join(e+t)}),n?"'"+o+"'":o}return e+t}var i=0;return{restrict:"A",templateUrl:function(t,e){var n="partials/forms/control";switch(e.control){case"select":n="partials/forms/control-select"}return n},scope:{ngModel:"=",required:"=",form:"@",title:"@",placeholder:"@"},require:"ngModel",compile:function(t,e){return{pre:function(t,e,n){if("select"===n.control){var s=n.label?n.label:"name",a=n.key?n.key:"id",c=n.min?" | filter:gte('"+a+"', "+n.min+")":"",l=o(s,"item.",!0);t.options=n.number?"item."+a+" as "+l+" disable when item.disabled for item in "+n.source+c:l+" disable when item.disabled for item in "+n.source+c+" track by item."+a,console.log("control.compile.pre",t.options)}var u=(t.type=n.control,t.form=t.form||"form",t.title=t.title||"untitled");t.placeholder=t.placeholder||u,t.field=u.replace(/[^0-9a-zA-Z]/g,"").split(" ").join("")+ ++i;t.validate=n.validate||n.control,t.format=n.format||null,t.precision=n.precision||null,t.validate=n.validate||n.control,t.minLength=n.min||0,t.maxLength=n.max||Number.POSITIVE_INFINITY,t.options=r(n.options)(t)||{},t.focus=!1,t.visible=!1,t.getType=function(){var e="text";switch(n.control){case"password":e=t.visible?"text":"password";break;default:e=n.control}return e},t.getClasses=function(){var e=r(t.form)(t.$parent),n=r(t.form+"."+t.field)(t.$parent);return{"control-focus":t.focus,"control-success":n.$valid,"control-error":n.$invalid&&(e.$submitted||n.$touched),"control-empty":!n.$viewValue}},t.getMessages=function(){var e=r(t.form)(t.$parent),n=r(t.form+"."+t.field)(t.$parent);return(e.$submitted||n.$touched)&&n.$error}}}}}}]),t.directive("numberPicker",["$parse","$timeout",function(t,e){return{restrict:"A",template:'<div class="input-group">   <span class="input-group-btn"><button class="btn btn-outline-primary" type="button">-</button></span>   <div ng-transclude></div>   <span class="input-group-btn"><button class="btn btn-outline-primary" type="button">+</button></span></div>',replace:!0,transclude:!0,link:function(n,r,o,i){function s(r){var i=t(o.min)(n),s=t(o.numberPicker),a=s.assign;e(function(){a(n,Math.max(i,s(n)-1))})}function a(r){var i=t(o.max)(n),s=t(o.numberPicker),a=s.assign;e(function(){a(n,Math.min(i,s(n)+1))})}function c(){angular.element(u).off("touchstart mousedown",s),angular.element(f).off("touchstart mousedown",a)}var l=r[0],u=l.querySelectorAll(".input-group-btn > .btn")[0],f=l.querySelectorAll(".input-group-btn > .btn")[1];n.$on("$destroy",function(){c()}),function(){angular.element(u).on("touchstart mousedown",s),angular.element(f).on("touchstart mousedown",a)}()}}}])}(),function(){"use strict";angular.module("app").directive("validate",["$filter",function(t){return{require:"ngModel",link:function(e,n,r,o){function i(){h=!0,u&&(n[0].value=o.$modelValue||null,o.$modelValue||o.$setViewValue(null))}function s(){if(u&&!o.$invalid)switch(l){case"date":case"datetime":case"datetime-local":n[0].value=o.$modelValue?t("date")(o.$modelValue,u):" ";break;default:n[0].value=o.$modelValue?t("number")(o.$modelValue,f)+" "+u:" "}}function a(){h=!1,s()}function c(){n.off("focus",i),n.off("blur",a)}var l=r.validate,u=r.format||"",f=r.precision||2,h=!1;switch(l){case"date":case"datetime":case"datetime-local":o.$formatters.push(function(e){return e?t("date")(e,u):null});break;case"number":o.$parsers.unshift(function(t){var e=!1;return void 0!==t&&""!==t?(e=-1!==String(t).indexOf(Number(t).toString()),t=Number(t),o.$setValidity("number",e),e&&(o.$setValidity("positive",t>=.01),void 0!==r.min&&o.$setValidity("range",t>=Number(r.min)),void 0!==r.max&&o.$setValidity("range",t<=Number(r.max)))):(e=!0,t=Number(t),o.$setValidity("number",!0),o.$setValidity("positive",!0),void 0!==r.min&&o.$setValidity("range",!0),void 0!==r.max&&o.$setValidity("range",!0)),t}),o.$formatters.push(function(e){return e?t("number")(e,f)+" "+u:null});break;case"anynumber":o.$parsers.unshift(function(t){var e=!1;return void 0!==t&&""!==t?(e=-1!==String(t).indexOf(Number(t).toString()),t=Number(t),o.$setValidity("number",e),e&&(void 0!==r.min&&o.$setValidity("range",t>=Number(r.min)),void 0!==r.max&&o.$setValidity("range",t<=Number(r.max)))):(e=!0,t=Number(t),o.$setValidity("number",!0),void 0!==r.min&&o.$setValidity("range",!0),void 0!==r.max&&o.$setValidity("range",!0)),t}),o.$formatters.push(function(e){return e||0===e?t("number")(e,f)+" "+u:null})}e.$on("$destroy",function(){c()}),function(){n.on("focus",i),n.on("blur",a)}()}}}])}(),function(){"use strict";angular.module("app").factory("State",["$timeout",function(t){function e(){this.isReady=!1,this.idle()}function n(){this.isBusy=!1,this.isError=!1,this.isErroring=!1,this.isSuccess=!1,this.isSuccessing=!1,this.button=null,this.errors=[]}function r(){return!this.isBusy&&!this.isErroring&&!this.isSuccessing}function o(t){return!this.isBusy&&(this.isBusy=!0,this.isError=!1,this.isErroring=!1,this.isSuccess=!1,this.isSuccessing=!1,this.errors=[],this.key=t,!0)}function i(){this.isBusy=!1,this.isError=!1,this.isErroring=!1,this.isSuccess=!0,this.isSuccessing=!0,this.errors=[],t(function(){this.isSuccessing=!1,this.key=null}.bind(this),p)}function s(e){this.isBusy=!1,this.isError=!0,this.isErroring=!0,this.isSuccess=!1,this.isSuccessing=!1,this.errors.push(e),t(function(){this.isErroring=!1,this.key=null}.bind(this),p)}function a(){this.isReady=!0,this.success()}function c(){return this.isError?this.errors[this.errors.length-1]:null}function l(){return{busy:this.isBusy,ready:this.isReady,successing:this.isSuccessing,success:this.isSuccess,errorring:this.isErroring,error:this.isError}}function u(t,e){var n={ready:"submit",busy:"sending",error:"error",success:"success"};e&&angular.extend(n,e);var r=n.ready;return this.key===t&&(this.isBusy?r=n.busy:this.isSuccess?r=n.success:this.isError&&(r=n.error)),r}function f(t,e){var n=this,r=null;return this.key===t&&(r={ready:n.isReady,busy:n.isBusy,successing:n.isSuccessing,success:n.isSuccess,errorring:n.isErroring,error:n.isError},e&&angular.forEach(e,function(t,e){r[t]=r[e]})),r}function h(t){return this.key&&this.key!==t}var p=2e3;return e.prototype={idle:n,busy:o,enabled:r,error:s,ready:a,success:i,errorMessage:c,submitClass:l,labels:u,classes:f,disabled:h},e}])}(),function(){"use strict";var t=angular.module("app");t.factory("Cookie",["$q","$window",function(t,e){function n(){}return n.TIMEOUT=3e5,n._set=function(t,n,r){var o;if(r){var i=new Date;i.setTime(i.getTime()+24*r*60*60*1e3),o="; expires="+i.toGMTString()}else o="";e.document.cookie=t+"="+n+o+"; path=/"},n.set=function(t,e,r){try{var o=[],i=JSON.stringify(e,function(t,e){if("pool"!==t){if("object"==typeof e&&null!==e){if(-1!==o.indexOf(e))return;o.push(e)}return e}});o=null,n._set(t,i,r)}catch(n){console.log("Cookie.set.error serializing",t,e,n)}},n.get=function(t){for(var n=t+"=",r=e.document.cookie.split(";"),o=0;o<r.length;o++){for(var i=r[o];" "==i.charAt(0);)i=i.substring(1,i.length);if(0===i.indexOf(n)){var s=i.substring(n.length,i.length),a=null;try{a=JSON.parse(s)}catch(t){console.log("Cookie.get.error parsing",key,t)}return a}}return null},n.delete=function(t){n._set(t,"",-1)},n.on=function(e){function r(){if(a>c)i.reject("timeout");else{var t=n.get(e);t?i.resolve(t):(a+=s,o=setTimeout(r,s))}}var o,i=t.defer(),s=1e3,a=0,c=n.TIMEOUT;return r(),i.promise},n}]),t.factory("LocalStorage",["$q","$window","Cookie",function(t,e,n){function r(){}return r.isSupported=function(){var t=!1;try{t="localStorage"in e&&null!==e.localStorage,t?(e.localStorage.setItem("test","1"),e.localStorage.removeItem("test")):t=!1}catch(e){t=!1}return t}(),r.isSupported?(r.set=function(t,n){try{var r=[],o=JSON.stringify(n,function(t,e){if("pool"!==t){if("object"==typeof e&&null!==e){if(-1!==r.indexOf(e))return;r.push(e)}return e}});r=null,e.localStorage.setItem(t,o)}catch(e){console.log("LocalStorage.set.error serializing",t,n,e)}},r.get=function(t){var n=null;if(void 0!==e.localStorage[t])try{n=JSON.parse(e.localStorage[t])}catch(e){console.log("LocalStorage.get.error parsing",t,e)}return n},r.delete=function(t){e.localStorage.removeItem(t)},r.on=function(r){function o(t){if(clearTimeout(i),t.originalEvent.key==r)try{var e=JSON.parse(t.originalEvent.newValue);s.resolve(e)}catch(t){console.log("LocalStorage.on.error parsing",r,t),s.reject("error parsing "+r)}}var i,s=t.defer(),a=n.TIMEOUT;return angular.element(e).on("storage",o),i=setTimeout(function(){s.reject("timeout")},a),s.promise}):(console.log("LocalStorage.unsupported switching to cookies"),r.set=n.set,r.get=n.get,r.delete=n.delete,r.on=n.on),r}]),t.factory("SessionStorage",["$q","$window","Cookie",function(t,e,n){function r(){}return r.isSupported=function(){var t=!1;try{t="sessionStorage"in e&&void 0!==e.sessionStorage,t?(e.sessionStorage.setItem("test","1"),e.sessionStorage.removeItem("test")):t=!1}catch(e){t=!1}return t}(),r.isSupported?(r.set=function(t,n){try{var r=[],o=JSON.stringify(n,function(t,e){if("pool"!==t){if("object"==typeof e&&null!==e){if(-1!==r.indexOf(e))return;r.push(e)}return e}});r=null,e.sessionStorage.setItem(t,o)}catch(e){console.log("SessionStorage.set.error serializing",t,n,e)}},r.get=function(t){var n=null;if(void 0!==e.sessionStorage[t])try{n=JSON.parse(e.sessionStorage[t])}catch(e){console.log("SessionStorage.get.error parsing",t,e)}return n},r.delete=function(t){e.sessionStorage.removeItem(t)},r.on=function(r){function o(t){if(clearTimeout(i),t.originalEvent.key===r)try{var e=JSON.parse(t.originalEvent.newValue);s.resolve(e)}catch(t){console.log("SessionStorage.on.error parsing",r,t),s.reject("error parsing "+r)}}var i,s=t.defer(),a=n.TIMEOUT;return angular.element(e).on("storage",o),i=setTimeout(function(){s.reject("timeout")},a),s.promise}):(console.log("SessionStorage.unsupported switching to cookies"),r.set=n.set,r.get=n.get,r.delete=n.delete,r.on=n.on),r}])}(),function(){"use strict";angular.module("app").factory("Hash",[function(){function t(e,n){e=e||"id",n=n?t.get(n):{},Object.defineProperties(this,{key:{value:e,enumerable:!1,writable:!1},pool:{value:n,enumerable:!1,writable:!1},length:{value:0,enumerable:!1,writable:!0}})}function e(t){return void 0!==this.pool[t]}function n(t){return this.pool[t]}function r(t){var e=this,n=this.key;return t?e.getId(t[n]):null}function o(t){var e=this;return this.pool[t[this.key]]=t,e.push(t),t}function i(t){var e=this,n=e.get(t);if(n)for(var r,o=0,i=Object.keys(t);o<i.length;o++)r=i[o],n[r]=t[r];else n=e.set(t);return n}function s(t){var e=this,n=this.pool,r=this.key,o=e.get(t);if(o){var i=e.indexOf(o);-1!==i&&e.splice(i,1),delete n[o[r]]}return e}function a(t){var e=this;if(!t)return e;for(var n=0;n<t.length;)e.add(t[n]),n++;return e}function c(t){var e=this;if(!t)return e;for(var n=0;n<t.length;)e.remove(t[n]),n++;return e}function l(){var t,e=this,n=e.key,r=e.pool,o=0;for(e.length;e.length;)t=e.shift(),delete r[t[n]],o++;return e}function u(t){var e=this;if(t)for(var n=0;n<e.length;)t(e[n],n),n++;return e}function f(t,e){var n=this;return t=t||this.key,n.sort(function(n,r){var o=e?r:n,i=e?n:r;return o[t]-i[t]}),n}function h(t){return this.forward(t,!0)}function p(t){if(t.key!==this.key||t.length!==this.length)return!0;for(var e=!1,n=0,r=this.length,o=this.key;e&&n<r;)e=this[n][o]!==t[n][o],n++}function d(){var t=this,e=this.pool,n=this.key;Object.keys(e).forEach(function(t){delete e[t]}),angular.forEach(t,function(t){e[t[n]]=t})}var m={};return t.get=function(t){return m[t]=m[t]||{}},t.prototype=new Array,t.prototype.has=e,t.prototype.getId=n,t.prototype.get=r,t.prototype.set=o,t.prototype.add=i,t.prototype.remove=s,t.prototype.each=u,t.prototype.addMany=a,t.prototype.removeMany=c,t.prototype.removeAll=l,t.prototype.forward=f,t.prototype.backward=h,t.prototype.differs=p,t.prototype.updatePool=d,t}])}(),function(){"use strict";angular.module("app").directive("header",[function(){return{restrict:"E",templateUrl:"partials/header",transclude:{header:"?headerItems"},link:function(t,e,n,r){}}}])}(),function(){"use strict";angular.module("app").service("Router",["$location","$timeout",function(t,e){function n(n,r){function o(){t.$$lastRequestedPath=t.path(),t.path(n)}r?e(function(){o()},r):o()}function r(n,r){function o(){n=t.$$lastRequestedPath||n,t.$$lastRequestedPath=null,t.path(n)}r?e(function(){o()},r):o()}function o(n,r){function o(){t.path(n)}r?e(function(){o()},r):e(function(){o()})}var i=this;i.redirect=n,i.path=r,i.apply=o}])}();