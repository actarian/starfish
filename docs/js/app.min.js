!function(){"use strict";angular.module("app",["ngRoute","ngMessages","mapboxgl-directive","firebase","jsonFormatter"])}(),function(){"use strict";angular.module("app").config(["$httpProvider",function(e){e.defaults.withCredentials=!0}])}(),function(){"use strict";angular.module("app").config(["$routeProvider","$locationProvider",function(e,t){e.when("/",{title:"Homepage",templateUrl:"partials/home.html",controller:"HomeCtrl"}).when("/profile",{title:"Profile",templateUrl:"partials/profile.html",controller:"ProfileCtrl",resolve:{user:["FirebaseApi",function(e){return e.isLoggedOrGoTo("/signin")}]}}).when("/signin",{title:"Accedi",templateUrl:"partials/signin.html",controller:"SigninCtrl"}).when("/signup",{title:"Registrazione",templateUrl:"partials/signup.html",controller:"SignupCtrl"}).when("/dashboard",{title:"Dashboard",templateUrl:"partials/dashboard.html",controller:"DashboardCtrl",resolve:{user:["FirebaseApi",function(e){return e.isLoggedOrGoTo("/signin")}]}}).when("/user/:userId",{title:"User",templateUrl:"partials/user.html",controller:"UserCtrl",resolve:{user:["FirebaseApi",function(e){return e.isLoggedOrGoTo("/signin")}]}}).when("/404",{title:"Error 404",templateUrl:"partials/404"}),t.html5Mode(!1),t.hashPrefix("")}])}(),function(){"use strict";var e=angular.module("app");e.controller("RootCtrl",["$scope","$location","FirebaseApi",function(e,t,n){e.api=n,e.signout=function(){console.log(n),n.auth.signout().then(function(){t.path("/")})},n.current().then(function(e){console.log(e)})}]),e.controller("HomeCtrl",["$scope","State","FirebaseApi",function(e,t,n){(e.state=new t).ready()}]),e.controller("ProfileCtrl",["$scope","State","FirebaseApi",function(e,t,n){var r=e.state=new t,o=e.model={};n.current().then(function(e){angular.extend(o,e),r.ready()});var s={navigation:{enabled:!0,options:{}},scale:{enabled:!0,options:{}},attribution:{enabled:!1,options:{}},geolocate:{enabled:!0,options:{}},geocoder:{enabled:!0,options:{}},directions:{enabled:!1,options:{}},draw:{enabled:!1,options:{}}};e.glControls=s,e.submit=function(){r.busy()&&n.users.save(o).then(function(e){r.success()},function(e){r.error(e)})}}]),e.controller("DashboardCtrl",["$scope","State","FirebaseApi",function(e,t,n){(e.state=new t).ready(),n.items().then(function(t){console.log("DashboardCtrl.items",t),e.items=t})}]),e.controller("SigninCtrl",["$scope","State","Router","FirebaseApi",function(e,t,n,r){var o=e.state=new t,s=e.model={};e.submit=function(){o.busy()&&r.auth.signin(s).then(function(e){o.success(),n.retry("/dashboard")},function(e){console.log("SigninCtrl.error",e),o.error(e)})}}]),e.controller("SignupCtrl",["$scope","State","Router","FirebaseApi",function(e,t,n,r){var o=e.state=new t,s=e.model={};e.submit=function(){o.busy()&&r.auth.signup(s).then(function(e){o.success(),n.retry("/dashboard")},function(e){console.log("SignupCtrl.error",e),o.error(e)})}}]),e.controller("DemoCtrl",["$scope","$interval","Hash","Calendar","GanttRow",function(e,t,n,r,o){function s(e){function t(e,t,n){return e=(e||0)+"",t=t||2,n=n||"0",e.length>=t?e:new Array(t-e.length+1).join(n)+e}var n=e.getFullYear(),r=e.getMonth()+1,o=e.getDate(),s=e.getHours(),i=e.getMinutes(),a=e.getSeconds();return n+"-"+t(r)+"-"+t(o)+"T"+t(s)+":"+t(i)+":"+t(a)}function i(){var e=new Date;e.setDate(e.getDate()+Math.floor(60*Math.random())),e.setHours(0),e.setMinutes(0),e.setSeconds(0);var t=e.getFullYear(),n=e.getMonth();return{key:Math.ceil(e.getTime()/864e5),mKey:12*t+n,date:s(e)}}function a(){var e=i(),t={id:d,hours:1+Math.floor(6*Math.random()),date:new Date(e.date),key:e.key,mKey:e.mKey,activityId:u.id};return 0===Math.floor(3*Math.random())&&(t.taskId=1e4+Math.floor(50*Math.random())),d++,t}function l(){e.log=Array.prototype.slice.call(arguments)}var u=e.row=new o({activity:{id:1e6+function(){return 1e6+Math.floor(1e5*Math.random())}(),name:"Activity",budgetHours:10+Math.floor(50*Math.random())},project:{type:Math.floor(5*Math.random()),deliveryDate:new Date}},[]);e.addItem=function(){var t=a();u.slots.add(t),u.update(),u.updateMonths(),e.item=t,l("addItem",t.id)},e.updateItem=function(){if(e.item){var t=e.item.id;item=a(),item=angular.extend(e.item,item),item.id=t,u.slots.add(item),u.update(),u.updateMonths(),e.item=item,l("updateItem",item.id)}},e.clearItems=function(){u.ranges.removeAll(),u.months.removeAll(),u.days.removeAll(),u.slots.removeAll(),u.update(),u.updateMonths(),delete e.item,l("clearItems")};var c;e.start=function(){e.stop(),c=t(e.addItem,1e3/60)},e.stop=function(){c&&t.cancel(c)};var d=1}]),e.constant("ganttGroups",{ACTIVITY:1,CUSTOMER:2,DEPARTMENT:3,GROUP:4,MANAGER:5,PROJECT:6,RESOURCE:7,USER:9}),e.factory("Calendar",["Hash",function(e){function t(e,t){for(var n=[];n.length<e;)n.push(t(n.length));return n}function n(){}var r=new Date;r.setHours(0),r.setMinutes(0),r.setSeconds(0);var o=Math.ceil(r.getTime()/864e5),s=new e("mKey");return n.getDate=function(e){return"function"==typeof e.date.getMonth?e.date:new Date(e.date)},n.clearMonth=function(e){e.days.each(function(e){e&&(e.hours=0,e.tasks=[])})},n.getMonth=function(i){r=new Date,r.setHours(0),r.setMinutes(0),r.setSeconds(0),o=Math.ceil(r.getTime()/864e5);var a=n.getDate(i),l=a.getFullYear(),u=a.getMonth(),c=(Math.ceil(a.getTime()/864e5),12*l+u),d=s.getId(c);if(!d){var f=new Date(l,u,1).getDay(),h=new Date(l,u+1,0).getDate(),m=Math.ceil(h/7);d={date:a,mKey:c,month:u,monthDays:h,fromDay:f,days:new e("key")},d.weeks=t(m,function(e){var n=t(7,function(t){var n=null,r=7*e+t-(f-1);if(r>=0&&r<h){var s=new Date(l,u,r+1),i=Math.ceil(s.getTime()/864e5);n={$today:i===o,c:t,r:e,d:r+1,date:s,key:i,hours:0,tasks:[]},n=d.days.add(n)}return n});return{r:e,days:n}}),d=s.add(d)}return d},n.getDay=function(e){var t=new Date(r);return t.setDate(t.getDate()+e),t},n.getKey=function(e){return Math.ceil(e.getTime()/864e5)},n}]),e.factory("GanttRow",["Hash","Calendar","ganttGroups",function(e,t,n){function r(t,r){this.type=n.ACTIVITY,this.assignedHours=0,this.slots=new e("id"),this.days=new e("key"),this.months=new e("mKey"),this.ranges=new e("rKey"),this.tasks=new e("id"),t&&(this.id=t.activity.id,this.name=t.activity.name,this.budgetHours=t.activity.budgetHours,this.useBudget=2!==t.project.type&&4!==t.project.type,this.customer=t.customer,this.department=t.department,this.manager=t.manager,this.project=t.project,this.resource=t.resource,this.color=r[this.id%(r.length||1)]),this.lastTaskId=null,this.update()}var o=1,s=new Date;s.setHours(0),s.setMinutes(0),s.setSeconds(0);var i=Math.ceil(s.getTime()/864e5);return r.prototype={canSelect:function(){return this.type===n.ACTIVITY&&this.budgetHours>0},canEdit:function(){return this.canSelect()&&-1===this.resource.name.toLowerCase().indexOf("nondefinito")},mergeSlot:function(e){var t=this.slots;e.hours?t.add(e):t.remove(e)},insertSlot:function(e,t,n){var r=null;if(this.useBudget&&(t=Math.min(t,this.budgetHours-this.assignedHours)),(t=Math.max(0,t))>0){var s={id:"temp-"+o++,key:e,date:new Date(864e5*e),hours:t,activityId:this.id};n&&(s.taskId=n,this.lastTaskId=n),this.slots.add(s),r=this.slots.getId(s.id)}return this.update(),r},removeSlots:function(e){var t=this.days.getId(e);t.tasks.each(function(e){e.hours=0});var n=t.tasks.slice();return this.slots.removeMany(n),this.update(),n},toggleSlots:function(e,t){return this.days.has(e)?this.removeSlots(e):[this.insertSlot(e,t,this.lastTaskId)]},assign:function(e,t){console.log("assign");var n=this.slots,r=e.$key,s={id:"temp-"+o++,key:r,date:e.$date,hours:t||0,activityId:this.id};return t?n.add(s):n.remove(s),this.update(),this.days.getId(r)},write:function(e,t,n){if(t=Math.min(t,n),this.useBudget&&(t=Math.min(t,this.budgetHours-this.assignedHours)),(t=Math.max(0,t))&&!this.days.has(e.$key)&&e.$date>=s)return this.assign(e,t)},erase:function(e,t,n){if(this.days.has(e.$key)&&e.$date>=s)return this.assign(e,null)},toggle:function(e,t,n){return this.days.has(e.$key)?this.erase(e,t,n):this.write(e,t,n)},update:function(){var t=0,n=this.slots,r=this.days;r.removeAll();var o=null;n.each(function(n){o=n.taskId||o,t+=n?n.hours:0;var s=r.add({key:n.key,date:n.date,hours:0});s.tasks=s.tasks||new e("id"),s.tasks.add(angular.copy(n)),s.tasks.each(function(e){s.hours+=e.hours})}),this.lastTaskId=o||this.lastTaskId,r.forward(),this.assignedHours=t,this.updateRanges()},updateMonths:function(){var e=this.days,n=this.months;n.removeAll();var r;e.each(function(e){var o=t.getMonth(e);o!==r&&(r=o,t.clearMonth(o)),n.add(o);var s=o.days.getId(e.key);s&&(s.hours=e.hours,s.tasks=e.tasks)}),n.forward()},updateRanges:function(){var e=this.days,t=this.ranges;t.removeAll();var n,r=0;e.each(function(e,o){n&&(e.key-n.key>1||e.tasks.differs(n.tasks))&&r++,n=e;var s=t.add({rKey:r});s.days=s.days||[],s.days.push(e.key)}),t.forward()},getRange:function(e,t,n){var r=this.ranges,o=null,s=e.$key;return r.each(function(e){var r=e.days.indexOf(s);-1!==r&&(e.c=r,e.firstKey=Math.max(t,e.days[0]),e.lastKey=Math.min(n,e.days[e.days.length-1]),o=e)}),o},updateRange:function(e,t,n){var r=this.ranges,o=this.getRange(e,t,n);if(o){o.previousKey=null,o.nextKey=null;var s=o.rKey;if(s>0){var i=r[s-1];o.previousKey=i.days[i.days.length-1]}if(s<r.length-1){var a=r[s+1];o.nextKey=a.days[0]}}return o},canMoveRange:function(e,t){for(var n=!0,r=this,o=e.items[0],s=(e.items[e.items.length-1],r.getOffsetKey(o.startDate,t)),a=0,l=e.items.length;a<l;){var u=s+a;(u<i||r.days.getId(u)&&-1===e.items.indexOf(r.days.getId(u)))&&(n=!1,a=l),a++}return n},moveRange:function(e,t){if(e.items.length){var n=this;n.canMoveRange(e,t)&&(angular.forEach(e.items,function(e){n.addDays(e,t)}),n.update())}},addDays:function(e,t){var n=new Date(e.startDate);return n.setDate(n.getDate()+t),e.date=n,e.key=Math.ceil(n.getTime()/864e5),e},getOffsetKey:function(e,t){return e=new Date(e),e.setDate(e.getDate()+t),Math.ceil(e.getTime()/864e5)},getHours:function(e){var t=0,n=this.days.getId(e);return n&&n.tasks.each(function(e){t+=e.hours}),t},toggleOpened:function(){this.opened=!this.opened},compress:function(e){if(this.items.length){this.items.sort(function(e,t){return e.key-t.key});var t=Utils.where(this.items,{key:e});t=t||this.items[0];var n=this.items.indexOf(t),r=n,o=this.items.length;for(e=Math.max(e,i);r<o;)t=this.items[r],t.key=e+r-n,t.date=new Date(864e5*t.key),r++;this.update()}}},r.serialNumber=function(e,t){return new Array(1+t.toString().length-e.toString().length).join("0")},r}])}(),function(){"use strict";var e=angular.module("app");e.directive("header",[function(){return{restrict:"E",templateUrl:"partials/header",transclude:{header:"?headerItems"},link:function(e,t,n,r){}}}]),e.directive("controlMessages",[function(){return{restrict:"E",templateUrl:"partials/control-messages",transclude:{message:"?messageItems"},link:function(e,t,n,r){}}}]),e.directive("control",["$http","$templateCache","$compile","$parse",function(e,t,n,r){function o(e,t,n){e=e||"",t=t||"";var r=e.split(",");if(r.length>1){var o=r.shift();return angular.forEach(r,function(e,r){o=n?o.split("{"+r+"}").join("' + "+t+e+" + '"):o.split("{"+r+"}").join(t+e)}),n?"'"+o+"'":o}return t+e}var s=0;return{restrict:"A",templateUrl:function(e,t){var n="partials/control";switch(t.control){case"select":n="partials/control-select"}return n},scope:{ngModel:"=",required:"=",form:"@",title:"@",placeholder:"@"},require:"ngModel",link:function(e,t,n,r){},compile:function(e,t){return{pre:function(e,t,n){if("select"===n.control){var i=n.label?n.label:"name",a=n.key?n.key:"id",l=n.min?" | filter:gte('"+a+"', "+n.min+")":"",u=o(i,"item.",!0);e.options=n.number?"item."+a+" as "+u+" disable when item.disabled for item in "+n.source+l:u+" disable when item.disabled for item in "+n.source+l+" track by item."+a,console.log("control.compile.pre",e.options)}var c=(e.type=n.control,e.form=e.form||"form",e.title=e.title||"untitled");e.placeholder=e.placeholder||c,e.field=c.replace(/[^0-9a-zA-Z]/g,"").split(" ").join("")+ ++s;e.minLength=n.min||0,e.maxLength=n.max||Number.POSITIVE_INFINITY,e.focus=!1,e.getType=function(){var t="text";switch(n.control){case"password":t=e.visible?"text":"password";break;default:t=n.control}return t},e.getClasses=function(){var t=r(e.form)(e.$parent),n=r(e.form+"."+e.field)(e.$parent);return{"control-focus":e.focus,"control-success":n.$valid,"control-error":n.$invalid&&(t.$submitted||n.$touched),"control-empty":!n.$viewValue}},e.getMessages=function(){var t=r(e.form)(e.$parent),n=r(e.form+"."+e.field)(e.$parent);return(t.$submitted||n.$touched)&&n.$error}}}}}}]),e.directive("state",["$timeout",function(e){return{restrict:"EA",templateUrl:"partials/state",transclude:!0,replace:!0,scope:{state:"="},link:function(t,n,r,o){function s(){e(function(){if(!t.$parent.$eval(r.onValidate))return t.state.button=n,t.$parent.$eval(r.onClick);t.$parent.$eval("form.$setSubmitted()")})}function i(){n.off("touchstart click",s)}t.stateClass=function(){if(t.state.button===n){return{busy:t.state.isBusy,successing:t.state.isSuccessing,success:t.state.isSuccess,errorring:t.state.isErroring,error:t.state.isError}}return null},t.stateDisabled=function(){return t.state.button&&t.state.button!==n},t.$on("$destroy",function(){i()}),function(){n.on("touchstart click",s)}()}}}]),e.directive("controlRow",["$http","$templateCache","$compile",function(e,t,n){function r(e,t,n){e=e||"",t=t||"";var r=e.split(",");if(r.length>1){var o=r.shift();return angular.forEach(r,function(e,r){o=n?o.split("{"+r+"}").join("' + "+t+e+" + '"):o.split("{"+r+"}").join(t+e)}),n?"'"+o+"'":o}return t+e}function o(e,t){var n=t.form||"Form",o=t.title||"Untitled",i=t.placeholder||o,a=o.replace(/[^0-9a-zA-Z]/g,"").split(" ").join("")+ ++s,l=n+"."+a,u=' ng-focus="'+l+'.hasFocus=true" ng-blur="'+l+'.hasFocus=false"',c="",d="",f="",h=t.label?t.label:"name",m=t.key?t.key:"id",p=t.model,g=t.onChange?' ng-change="'+t.onChange+'"':"",v=t.onFocus?' ng-focus="'+t.onFocus+'"':"",y=t.onBlur?' ng-blur="'+t.onBlur+'"':"",b=t.cols?6:9,k="col-lg-"+b,w="col-lg-"+(12-b);"12"===t.cols&&(w=k="col-lg-12");var $=t.required?' required="true"':"",S=t.readonly?" readonly":"",x=t.options?' ng-model-options="'+t.options+'" ':"",M=t.validate?' validate-type="'+t.validate+'" ':"",T=t.format?' format="'+t.format+'" ':"",C=t.precision?' precision="'+t.precision+'" ':"";switch(t.disabled&&(f=" disabled"),t.ngDisabled&&(f=' ng-disabled="'+t.ngDisabled+'"'),t.required&&(d=t.readonly||t.disabled?"":"<sup>âœ½</sup>"),c='<span ng-messages="'+(t.readonly?"":"("+n+".$submitted || "+l+".$touched) && ")+l+'.$error" role="alert">',c+='<span ng-message="required" class="label-error animated flash">obbligatorio â¤´</span>',t.controlRow){case"password":c+='<span ng-message="minlength" class="label-error animated flash">almeno 6 caratteri â¤´</span>';break;case"email":c+='<span ng-message="email" class="label-error animated flash">valore non corretto â¤´</span>';break;case"number":case"range":c+='<span ng-message="positive" class="label-error animated flash">solo valori positivi â¤´</span>',c+='<span ng-message="number" class="label-error animated flash">solo valori numerici â¤´</span>'}void 0!==t.match&&(c+='<span ng-message="match" class="label-error animated flash">non corrispondente â¤´</span>'),c+="</span>";var I=" ng-class=\"{ 'control-focus': "+l+".hasFocus, 'control-success': "+l+".$valid, 'control-error': "+l+".$invalid && ("+n+".$submitted || "+l+".$touched), 'control-empty': !"+l+'.$viewValue }"',E='<div class="row" '+I+'><label for="'+a+'" class="'+w+' col-form-label">'+o+d+'</label><div class="'+k+" col-"+t.controlRow+'">';switch(t.controlRow){case"static":E+='<p class="form-control" '+(t.click?' ng-click="'+t.click+'"':"")+(t.mouseover?' ng-mouseover="'+t.mouseover+'"':"")+(t.mouseout?' ng-mouseover="'+t.mouseout+'"':"")+'><span ng-bind-html="'+p+" || '&nbsp;'\"></span>"+(t.icon?'<i class="pull-xs-right '+t.icon+'"></i>':"")+"</p>";break;case"checkbox":E='<div class="'+k+'"'+I+'><div class="col-xs-12"><label class="custom-control custom-checkbox">',E+='   <input type="checkbox" class="custom-control-input" ng-model="'+p+'">',E+='   <span class="custom-control-indicator"></span>',E+='   <span class="custom-control-description">'+o+"</span>",E+="</label>";break;case"yesno":E='<div class="row" '+I+'><label class="col-lg-6 custom-control custom-checkbox">'+o+d+"</label>",E+='<div class="'+w+'"><label class="custom-control custom-checkbox">',E+='   <input type="checkbox" class="custom-control-input" ng-model="'+p+'" ng-change="'+p+"No=!"+p+'">',E+='   <span class="custom-control-indicator"></span>',E+='   <span class="custom-control-description">SÃ¬</span>',E+="</label></div>",E+='<div class="'+w+'"><label class="custom-control custom-checkbox">',E+='   <input type="checkbox" class="custom-control-input" ng-model="'+p+'No" ng-change="'+p+"=!"+p+'No">',E+='   <span class="custom-control-indicator"></span>',E+='   <span class="custom-control-description">No</span>',E+="</label>";break;case"switch":t.disabled&&(f=' disabled="true"'),t.ngDisabled&&(f=' disabled="'+t.ngDisabled+'"'),E='<div class="row control-switch" '+I+'><label for="'+a+'" class="'+w+' col-form-label">'+o+d+"</label>",E+='<div class="'+k+'">',E+='<switch name="'+a+'" ng-model="'+p+'" '+g+v+y+x+' on="SÃ¬" off="No" '+$+f+S+u+"></switch>";break;case"range":M=' validate-type="number"';var D=a+"Hi",A=n+"."+D,O=t.modelHi,R=" ng-class=\"{ 'control-focus': "+A+".hasFocus, 'control-success': "+A+".$valid, 'control-error': "+A+".$invalid && ("+n+".$submitted || "+A+".$touched), 'control-empty': !"+A+'.$viewValue }"',j=$;"true"==t.requiredHi?j=' required="true"':"false"==t.requiredHi&&(j="");var q=" ",V=" ";switch(t.required&&"false"!==t.requiredHi&&(V=t.readonly||t.disabled?"":"<sup>âœ½</sup>"),q='<span ng-messages="'+(t.readonly?"":"("+n+".$submitted || "+A+".$touched) && ")+A+'.$error" role="alert">',q+='<span ng-message="required" class="label-error animated flash">obbligatorio â¤´</span>',t.controlRow){case"password":q+='<span ng-message="minlength" class="label-error animated flash">almeno 3 caratteri â¤´</span>';break;case"email":q+='<span ng-message="email" class="label-error animated flash">valore non corretto â¤´</span>';break;case"number":case"range":q+='<span ng-message="positive" class="label-error animated flash">solo valori positivi â¤´</span>',q+='<span ng-message="number" class="label-error animated flash">solo valori numerici â¤´</span>'}return void 0!==t.match&&(q+='<span ng-message="match" class="label-error animated flash">non corrispondente â¤´</span>'),q+="</span>",E='<div class="row"><label for="'+a+'" class="'+w+' col-form-label">'+o+'</label><div class="'+k+" col-"+t.controlRow+'">',E+='<div class="form-control-range form-control-range-min" '+I+">"+d+'<input class="form-control" name="'+a+'" ng-model="'+p+'" '+g+v+y+x+' placeholder="'+i+'" type="text"'+$+f+S+u+M+T+C+">"+c+"</div>",(E+='<div class="form-control-range form-control-range-max" '+R+">"+V+'<input class="form-control" name="'+D+'" ng-model="'+O+'" '+g+v+y+x+' placeholder="'+i+'" type="text"'+j+f+S+u+M+T+C+">"+q+"</div>")+"</div></div>";case"range-slider":var H=t.himodel?' rz-slider-high="'+t.himodel+'" ':"";x=t.options?' rz-slider-options="'+t.options+'" ':"",E+='<rzslider rz-slider-model="'+p+'" '+H+x+'"></rzslider>';break;case"select":var N=t.min?" | filter:gte('"+m+"', "+t.min+")":"",F=r(h,"item.",!0),x=t.number?"item."+m+" as "+F+" disable when item.disabled for item in "+t.source+N:F+" disable when item.disabled for item in "+t.source+N+" track by item."+m;E+='<select name="'+a+'" class="form-control" ng-model="'+p+'" '+g+v+y+' ng-options="'+x+'" '+(t.number?"convert-to-number":"")+$+f+'><option value="" disabled selected hidden>'+i+"</option></select>";break;case"autocomplete":var U=!!t.canCreate&&t.canCreate,z=!!t.flatten&&t.flatten,B=!!t.queryable&&t.queryable,K=t.onSelected?' on-selected="'+t.onSelected+'"':"";E+='<input name="'+a+'" ng-model="'+p+'" type="hidden" '+(t.required?"required":"")+">",E+='<div control-autocomplete="'+t.source+'" model="'+p+'" label="'+h+'"  key="'+m+'" can-create="'+U+'" flatten="'+z+'" queryable="'+B+'" placeholder="'+i+'" on-focus="'+l+'.hasFocus=true" on-blur="'+l+'.hasFocus=false"'+K+"></div>";break;case"textarea":E+='<textarea name="'+a+'" class="form-control" ng-model="'+p+'" '+g+v+y+x+' placeholder="'+i+'" '+$+f+' rows="'+(t.rows?t.rows:"1")+'"'+u+"></textarea>";break;case"htmltext":var P="";t.disabled&&(P=' ta-disabled="true"'),t.ngDisabled&&(P=' ta-disabled="'+t.ngDisabled+'"'),E+='<div text-angular name="'+a+'" ta-paste="doStripHtml($html)" ng-model="'+p+'" '+g+v+y+x+' placeholder="'+i+'" '+$+P+S+u+(t.required?' ta-min-text="1"':"")+"></div>";break;case"password":E+='<div class="input-group"><input name="'+a+'" class="form-control" ng-model="'+p+'" '+g+v+y+x+' placeholder="'+i+'" type="{{form.'+a+" ? 'password' : 'text'}}\" ng-minlength=\"6\" "+$+f+u+'><span class="input-group-addon" ng-if="'+p+'"><span class="icon-eye" ng-click="form.'+a+" = !form."+a+'"></span></span></div>';break;case"email":E+='<input name="'+a+'" class="form-control" ng-model="'+p+'" '+g+v+y+x+' placeholder="'+i+'" type="email" '+$+f+u+">";break;case"number-picker":M=' validate-type="anynumber"',E+='<div number-picker="'+p+'" min="'+t.min+'" max="'+t.max+'">',E+='   <input name="'+a+'" class="form-control" ng-model="'+p+'" '+g+v+y+x+' placeholder="'+i+'" type="text"'+$+f+S+u+M+T+C+">",E+="</div>";break;case"number":M=' validate-type="number"',E+='<input name="'+a+'" class="form-control" ng-model="'+p+'" '+g+v+y+x+' placeholder="'+i+'" type="text"'+$+f+S+u+M+T+C+">";break;case"anynumber":M=' validate-type="anynumber"',E+='<input name="'+a+'" class="form-control" ng-model="'+p+'" '+g+v+y+x+' placeholder="'+i+'" type="text"'+$+f+S+u+M+T+C+">";break;case"date":M=' validate-type="date"',T=' format="dd-MM-yyyy"',t.disabled||t.readonly?E+='<div class="input-group"><input type="text" class="form-control" name="'+a+'" ng-model="'+p+'" placeholder="'+i+'" '+$+f+S+u+M+T+'><span class="input-group-addon"><i class="icon-calendar"></i></span></div>':(E+='<input type="date" name="'+a+'" class="form-control form-control-hidden" is-open="flags.'+a+'" ng-model="'+p+'" placeholder="dd-MM-yyyy" '+$+f+S+u+' uib-datepicker-popup datepicker-options="sources.datepickerOptions" datepicker-template-url="uib/template/datepicker/datepicker.html" show-button-bar="false" current-text="Oggi" clear-text="Rimuovi" close-text="Chiudi">',E+='<div ng-click="(flags.'+a+' = true)" class="input-group disabled"><input type="text" class="form-control" name="'+a+'" ng-model="'+p+'" placeholder="'+i+'" '+$+f+S+u+M+T+'><span class="input-group-addon"><i class="icon-calendar"></i></span></div>');break;case"datetime-local":i=i||"dd-MM-yyyyTHH:mm:ss",E+='<input name="'+a+'" class="form-control" ng-model="'+p+'" '+g+v+y+x+' placeholder="'+i+'" type="datetime-local"'+$+f+S+u+">";break;default:E+='<input name="'+a+'" class="form-control" ng-model="'+p+'" '+g+v+y+x+' placeholder="'+i+'" type="text"'+$+f+S+u+M+T+C+">"}return E+c+"</div></div>"}var s=0;return{restrict:"A",replace:!0,compile:function(e,t){return function(r,s,i){s.html(o(e,t)),n(s.contents())(r)}}}}]),e.directive("numberPicker",["$parse","$timeout",function(e,t){return{restrict:"A",template:'<div class="input-group">   <span class="input-group-btn"><button class="btn btn-outline-primary" type="button">-</button></span>   <div ng-transclude></div>   <span class="input-group-btn"><button class="btn btn-outline-primary" type="button">+</button></span></div>',replace:!0,transclude:!0,link:function(n,r,o,s){function i(r){var s=e(o.min)(n),i=e(o.numberPicker),a=i.assign;t(function(){a(n,Math.max(s,i(n)-1))})}function a(r){var s=e(o.max)(n),i=e(o.numberPicker),a=i.assign;t(function(){a(n,Math.min(s,i(n)+1))})}function l(){angular.element(c).off("touchstart mousedown",i),angular.element(d).off("touchstart mousedown",a)}var u=r[0],c=u.querySelectorAll(".input-group-btn > .btn")[0],d=u.querySelectorAll(".input-group-btn > .btn")[1];n.$on("$destroy",function(){l()}),function(){angular.element(c).on("touchstart mousedown",i),angular.element(d).on("touchstart mousedown",a)}()}}}]),e.directive("validateType",["$filter",function(e){return{require:"ngModel",link:function(t,n,r,o){function s(){f=!0,c&&(n[0].value=o.$modelValue||null,o.$modelValue||o.$setViewValue(null))}function i(){if(c&&!o.$invalid)switch(u){case"date":case"datetime":case"datetime-local":n[0].value=o.$modelValue?e("date")(o.$modelValue,c):" ";break;default:n[0].value=o.$modelValue?e("number")(o.$modelValue,d)+" "+c:" "}}function a(){f=!1,i()}function l(){n.off("focus",s),n.off("blur",a)}var u=r.validateType,c=r.format||"",d=r.precision||2,f=!1;switch(u){case"date":case"datetime":case"datetime-local":o.$formatters.push(function(t){return t?e("date")(t,c):null});break;case"number":o.$parsers.unshift(function(e){var t=!1;return void 0!==e&&""!==e?(t=-1!==String(e).indexOf(Number(e).toString()),e=Number(e),o.$setValidity("number",t),t&&(o.$setValidity("positive",e>=.01),void 0!==r.min&&o.$setValidity("range",e>=Number(r.min)),void 0!==r.max&&o.$setValidity("range",e<=Number(r.max)))):(t=!0,e=Number(e),o.$setValidity("number",!0),o.$setValidity("positive",!0),void 0!==r.min&&o.$setValidity("range",!0),void 0!==r.max&&o.$setValidity("range",!0)),e}),o.$formatters.push(function(t){return t?e("number")(t,d)+" "+c:null});break;case"anynumber":o.$parsers.unshift(function(e){var t=!1;return void 0!==e&&""!==e?(t=-1!==String(e).indexOf(Number(e).toString()),e=Number(e),o.$setValidity("number",t),t&&(void 0!==r.min&&o.$setValidity("range",e>=Number(r.min)),void 0!==r.max&&o.$setValidity("range",e<=Number(r.max)))):(t=!0,e=Number(e),o.$setValidity("number",!0),void 0!==r.min&&o.$setValidity("range",!0),void 0!==r.max&&o.$setValidity("range",!0)),e}),o.$formatters.push(function(t){return t||0===t?e("number")(t,d)+" "+c:null})}t.$on("$destroy",function(){l()}),function(){n.on("focus",s),n.on("blur",a)}()}}}])}(),function(){"use strict";angular.module("app").directive("ngClick",["UI",function(e){function t(t,n,r,o){function s(t){var r=e.getTouch(t),o=e.getRelativeTouch(n,r);n.removeClass("animate"),n.offsetWidth,u.style.left=o.x+"px",u.style.top=o.y+"px",setTimeout(function(){n.addClass("animate"),setTimeout(function(){n.removeClass("animate")},1e3)},1)}function i(e){n.off("mousedown",a),s(e)}function a(e){n.off("touchstart",i),s(e)}function l(){n.off("touchstart",i),n.off("mousedown",a)}n.addClass("material");var u=document.createElement("material");n[0].appendChild(u),t.$on("$destroy",function(){l()}),function(){n.on("touchstart",i),n.on("mousedown",a)}()}return{restrict:"A",priority:0,link:t}}])}(),function(){"use strict";angular.module("app")}(),function(){"use strict";angular.module("app").factory("State",["$timeout",function(e){function t(){this.isReady=!1,this.idle()}function n(){this.isBusy=!1,this.isError=!1,this.isErroring=!1,this.isSuccess=!1,this.isSuccessing=!1,this.button=null,this.errors=[]}function r(){return!this.isBusy&&!this.isErroring&&!this.isSuccessing}function o(){return!this.isBusy&&(this.isBusy=!0,this.isError=!1,this.isErroring=!1,this.isSuccess=!1,this.isSuccessing=!1,this.errors=[],!0)}function s(){this.isBusy=!1,this.isError=!1,this.isErroring=!1,this.isSuccess=!0,this.isSuccessing=!0,this.errors=[],e(function(){this.isSuccessing=!1,this.button=null}.bind(this),1e3)}function i(t){this.isBusy=!1,this.isError=!0,this.isErroring=!0,this.isSuccess=!1,this.isSuccessing=!1,this.errors.push(t),e(function(){this.isErroring=!1,this.button=null}.bind(this),1e3)}function a(){this.isReady=!0,this.success()}function l(){return this.isError?this.errors[this.errors.length-1]:null}function u(){return{busy:this.isBusy,ready:this.isReady,successing:this.isSuccessing,success:this.isSuccess,errorring:this.isErroring,error:this.isError}}function c(e,t,n,r){return e=e||"Submit",this.isBusy?t||e:this.isSuccess?n||e:this.isError?r||e:e}return t.prototype={idle:n,busy:o,enabled:r,error:i,ready:a,success:s,errorMessage:l,submitClass:u,submitMessage:c},t}])}(),function(){"use strict";angular.module("app").factory("Hash",[function(){function e(t,n){t=t||"id",n=n?e.get(n):{},Object.defineProperties(this,{key:{value:t,enumerable:!1,writable:!1},pool:{value:n,enumerable:!1,writable:!1},length:{value:0,enumerable:!1,writable:!0}})}function t(e){return void 0!==this.pool[e]}function n(e){return this.pool[e]}function r(e){var t=this,n=this.key;return e?t.getId(e[n]):null}function o(e){var t=this;return this.pool[e[this.key]]=e,t.push(e),e}function s(e){var t=this,n=t.get(e);if(n)for(var r,o=0,s=Object.keys(e);o<s.length;o++)r=s[o],n[r]=e[r];else n=t.set(e);return n}function i(e){var t=this,n=this.pool,r=this.key,o=t.get(e);if(o){var s=t.indexOf(o);-1!==s&&t.splice(s,1),delete n[o[r]]}return t}function a(e){var t=this;if(!e)return t;for(var n=0;n<e.length;)t.add(e[n]),n++;return t}function l(e){var t=this;if(!e)return t;for(var n=0;n<e.length;)t.remove(e[n]),n++;return t}function u(){var e,t=this,n=t.key,r=t.pool,o=0;for(t.length;t.length;)e=t.shift(),delete r[e[n]],o++;return t}function c(e){var t=this;if(e)for(var n=0;n<t.length;)e(t[n],n),n++;return t}function d(e,t){var n=this;return e=e||this.key,n.sort(function(n,r){var o=t?r:n,s=t?n:r;return o[e]-s[e]}),n}function f(e){return this.forward(e,!0)}function h(e){if(e.key!==this.key||e.length!==this.length)return!0;for(var t=!1,n=0,r=this.length,o=this.key;t&&n<r;)t=this[n][o]!==e[n][o],n++}function m(){var e=this,t=this.pool,n=this.key;Object.keys(t).forEach(function(e){delete t[e]}),angular.forEach(e,function(e){t[e[n]]=e})}var p={};return e.get=function(e){return p[e]=p[e]||{}},e.prototype=new Array,e.prototype.has=t,e.prototype.getId=n,e.prototype.get=r,e.prototype.set=o,e.prototype.add=s,e.prototype.remove=i,e.prototype.each=c,e.prototype.addMany=a,e.prototype.removeMany=l,e.prototype.removeAll=u,e.prototype.forward=d,e.prototype.backward=f,e.prototype.differs=h,e.prototype.updatePool=m,e}])}(),function(){"use strict";angular.module("app").service("Router",["$location","$timeout",function(e,t){function n(n,r){function o(){e.$$lastRequestedPath=e.path(),e.path(n)}r?t(function(){o()},r):o()}function r(n,r){function o(){n=e.$$lastRequestedPath||n,e.$$lastRequestedPath=null,e.path(n)}r?t(function(){o()},r):o()}var o=this;o.redirect=n,o.retry=r}])}(),function(){"use strict";var e=angular.module("app");e.factory("Cookie",["$q","$window",function(e,t){function n(){}return n.TIMEOUT=3e5,n._set=function(e,n,r){var o;if(r){var s=new Date;s.setTime(s.getTime()+24*r*60*60*1e3),o="; expires="+s.toGMTString()}else o="";t.document.cookie=e+"="+n+o+"; path=/"},n.set=function(e,t,r){try{var o=[],s=JSON.stringify(t,function(e,t){if("pool"!==e){if("object"==typeof t&&null!==t){if(-1!==o.indexOf(t))return;o.push(t)}return t}});o=null,n._set(e,s,r)}catch(n){console.log("Cookie.set.error serializing",e,t,n)}},n.get=function(e){for(var n=e+"=",r=t.document.cookie.split(";"),o=0;o<r.length;o++){for(var s=r[o];" "==s.charAt(0);)s=s.substring(1,s.length);if(0===s.indexOf(n)){var i=s.substring(n.length,s.length),a=null;try{a=JSON.parse(i)}catch(e){console.log("Cookie.get.error parsing",key,e)}return a}}return null},n.delete=function(e){n._set(e,"",-1)},n.on=function(t){function r(){if(a>l)s.reject("timeout");else{var e=n.get(t);e?s.resolve(e):(a+=i,o=setTimeout(r,i))}}var o,s=e.defer(),i=1e3,a=0,l=n.TIMEOUT;return r(),s.promise},n}]),e.factory("LocalStorage",["$q","$window","Cookie",function(e,t,n){function r(){}return r.isSupported=function(){var e=!1;try{e="localStorage"in t&&null!==t.localStorage,e?(t.localStorage.setItem("test","1"),t.localStorage.removeItem("test")):e=!1}catch(t){e=!1}return e}(),r.isSupported?(r.set=function(e,n){try{var r=[],o=JSON.stringify(n,function(e,t){if("pool"!==e){if("object"==typeof t&&null!==t){if(-1!==r.indexOf(t))return;r.push(t)}return t}});r=null,t.localStorage.setItem(e,o)}catch(t){console.log("LocalStorage.set.error serializing",e,n,t)}},r.get=function(e){var n=null;if(void 0!==t.localStorage[e])try{n=JSON.parse(t.localStorage[e])
}catch(t){console.log("LocalStorage.get.error parsing",e,t)}return n},r.delete=function(e){t.localStorage.removeItem(e)},r.on=function(r){function o(e){if(clearTimeout(s),e.originalEvent.key==r)try{var t=JSON.parse(e.originalEvent.newValue);i.resolve(t)}catch(e){console.log("LocalStorage.on.error parsing",r,e),i.reject("error parsing "+r)}}var s,i=e.defer(),a=n.TIMEOUT;return angular.element(t).on("storage",o),s=setTimeout(function(){i.reject("timeout")},a),i.promise}):(console.log("LocalStorage.unsupported switching to cookies"),r.set=n.set,r.get=n.get,r.delete=n.delete,r.on=n.on),r}]),e.factory("SessionStorage",["$q","$window","Cookie",function(e,t,n){function r(){}return r.isSupported=function(){var e=!1;try{e="sessionStorage"in t&&void 0!==t.sessionStorage,e?(t.sessionStorage.setItem("test","1"),t.sessionStorage.removeItem("test")):e=!1}catch(t){e=!1}return e}(),r.isSupported?(r.set=function(e,n){try{var r=[],o=JSON.stringify(n,function(e,t){if("pool"!==e){if("object"==typeof t&&null!==t){if(-1!==r.indexOf(t))return;r.push(t)}return t}});r=null,t.sessionStorage.setItem(e,o)}catch(t){console.log("SessionStorage.set.error serializing",e,n,t)}},r.get=function(e){var n=null;if(void 0!==t.sessionStorage[e])try{n=JSON.parse(t.sessionStorage[e])}catch(t){console.log("SessionStorage.get.error parsing",e,t)}return n},r.delete=function(e){t.sessionStorage.removeItem(e)},r.on=function(r){function o(e){if(clearTimeout(s),e.originalEvent.key===r)try{var t=JSON.parse(e.originalEvent.newValue);i.resolve(t)}catch(e){console.log("SessionStorage.on.error parsing",r,e),i.reject("error parsing "+r)}}var s,i=e.defer(),a=n.TIMEOUT;return angular.element(t).on("storage",o),s=setTimeout(function(){i.reject("timeout")},a),i.promise}):(console.log("SessionStorage.unsupported switching to cookies"),r.set=n.set,r.get=n.get,r.delete=n.delete,r.on=n.on),r}])}(),function(){"use strict";angular.module("app").service("FirebaseApi",["$q","$firebaseAuth","$firebaseObject","$firebaseArray","LocalStorage","Router",function(e,t,n,r,o,s){function i(){var n=e.defer();return y.presence?n.resolve(y.presence):t().$signInAnonymously({remember:"sessionOnly"}).then(function(e){var t=y.presence={uid:e.uid};n.resolve(t)}).catch(function(e){console.log("Error",e),n.reject(e)}),n.promise}function a(){var t=e.defer();if(y.user)t.resolve(y.user);else{var n=o.get("token");n?i().then(function(e){g.database().ref().child("users").orderByChild("token").equalTo(n).on("value",function(e){var n=y.user=p(e);n?(o.set("token",n.token),t.resolve(n)):t.reject()})},function(){t.reject()}):t.reject()}return t.promise}function l(t){console.log("FirebaseApi.signin",t);var n=e.defer();return y.user?(console.log("signed",y.user),n.resolve(y.user)):i().then(function(e){g.database().ref().child("users").orderByChild("email").equalTo(t.email).on("value",function(e){var r=y.user=p(e);r&&r.password===t.password?(o.set("token",r.token),n.resolve(r)):n.reject({message:"not found"})})},function(){n.reject()}),n.promise}function u(t){console.log("FirebaseApi.signup",t);var n=e.defer();return i().then(function(e){console.log("connected",e);var r=g.database().ref(),s=r.child("users"),i=s.push();t.token=y.presence.uid,o.set("token",t.token),i.set(t),y.user=t,y.updateUser=function(){i.set(t)},n.resolve(t)},function(){n.reject()}),n.promise}function c(){console.log("FirebaseApi.signout");var t=e.defer();return o.delete("token"),y.user=null,t.resolve(),t.promise}function d(){return m("items",{token:"token"})}function f(t){var n=e.defer();return a().then(function(e){n.resolve(y.user)},function(){n.reject(),s.redirect(t)}),n.promise}function h(e){var t=[];for(var n in e)t.push({key:n,value:e[n]});var r=null;return t.length&&(r=t.shift()),r}function m(t,n,o){var s=e.defer(),i=g.database().ref(),a=i.child(t),l=null;if(n){var u=h(n);if(u){var c=a.orderByChild(u.key).equalTo(u.value);o&&(c=c.limitToLast(o)),l=r(c)}}return l=l||r(a),l.$loaded(function(e){s.resolve(e)},function(e){s.reject(e)}),s.promise}function p(e){var t=null;if(e.numChildren()){var n=e.val();t=n[Object.keys(n)[0]]}return t}var g=window.firebase||null;if(!g)throw"missing firebase.js";var v={apiKey:"AIzaSyCskd8Cgzd_j7JzgEC3mEb4ir1qZFh6auQ",authDomain:"starfish-c2b0f.firebaseapp.com",databaseURL:"https://starfish-c2b0f.firebaseio.com",projectId:"starfish-c2b0f",storageBucket:"starfish-c2b0f.appspot.com",messagingSenderId:"796739915579"};g.initializeApp(v);var y=this;y.user=void 0,y.presence=void 0,y.items=d,y.auth={signin:l,signup:u,signout:c},y.users={save:null},y.current=a,y.isLoggedOrGoTo=f}])}(),function(){"use strict";var e=angular.module("app");e.factory("Vector",function(){function e(e,t){this.x=e||0,this.y=t||0}return e.make=function(t,n){return new e(n.x-t.x,n.y-t.y)},e.size=function(e){return Math.sqrt(e.x*e.x+e.y*e.y)},e.normalize=function(t){var n=e.size(t);return t.x/=n,t.y/=n,t},e.incidence=function(e,t){return Math.atan2(t.y,t.x)-Math.atan2(e.y,e.x)},e.distance=function(e,t){return Math.sqrt((e.x-t.x)*(e.x-t.x)+(e.y-t.y)*(e.y-t.y))},e.cross=function(e,t){return e.x*t.y-e.y*t.x},e.difference=function(t,n){return new e(t.x-n.x,t.y-n.y)},e.power=function(e,t){return(Math.abs(t.x-e.x)+Math.abs(t.y-e.y))/2},e.prototype={size:function(){return e.size(this)},normalize:function(){return e.normalize(this)},incidence:function(t){return e.incidence(this,t)},cross:function(t){return e.cross(this,t)},distance:function(t){return e.distance(this,t)},difference:function(t){return e.difference(this,t)},power:function(){return(Math.abs(this.x)+Math.abs(this.y))/2},towards:function(e,t){return t=t||.125,this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this},add:function(e){return this.x+=e.x,this.y+=e.y,this},friction:function(e){return this.x*=e,this.y*=e,this},copy:function(t){return new e(this.x,this.y)},toString:function(){return"{"+this.x+","+this.y+"}"}},e}),e.service("UI",["Vector",function(e){function n(n,r){var o=new e;if("touchstart"===n.type||"touchmove"===n.type||"touchend"===n.type||"touchcancel"===n.type){var s=null,i=n.originalEvent?n.originalEvent:n,a=i.touches.length?i.touches:i.changedTouches;a&&a.length&&(s=a[0]),s&&(o.x=s.pageX,o.y=s.pageY)}else"click"!==n.type&&"mousedown"!==n.type&&"mouseup"!==n.type&&"mousemove"!==n.type&&"mouseover"!==n.type&&"mouseout"!==n.type&&"mouseenter"!==n.type&&"mouseleave"!==n.type&&"contextmenu"!==n.type||(o.x=n.pageX,o.y=n.pageY);return r&&(o.s=e.difference(t,r)),o.type=n.type,o}function r(t,n){t=angular.element(t)[0];var r=t.getBoundingClientRect(),o=new e(r.left,r.top);return e.difference(n,o)}function o(e,t){var n,r;if(["matches","webkitMatchesSelector","mozMatchesSelector","msMatchesSelector","oMatchesSelector"].some(function(e){return"function"==typeof document.body[e]&&(n=e,!0)}),e[n](t))return e;for(;null!==e;){if(null!==(r=e.parentElement)&&r[n](t))return r;e=r}return null}function s(e,t){var n;if(e===t)return e;for(;null!==e;){if(null!==(n=e.parentElement)&&n===t)return n;e=n}return null}var i=this;return i.getTouch=n,i.getRelativeTouch=r,i.getClosest=o,i.getClosestElement=s,i}])}();