!function(){"use strict";angular.module("app",["ngRoute","ngMessages","ui.bootstrap","mapboxgl-directive","firebase","jsonFormatter"])}(),function(){"use strict";angular.module("app").config(["$httpProvider",function(t){}])}(),function(){"use strict";angular.module("app").config(["$routeProvider","$locationProvider",function(t,e){t.when("/",{title:"Homepage",templateUrl:"partials/home.html",controller:"HomeCtrl"}).when("/profile",{title:"Profile",templateUrl:"partials/profile.html",controller:"ProfileCtrl",resolve:{user:["FirebaseApi",function(t){return t.isLoggedOrGoTo("/signin")}]}}).when("/signin",{title:"Accedi",templateUrl:"partials/signin.html",controller:"SigninCtrl"}).when("/signup",{title:"Registrazione",templateUrl:"partials/signup.html",controller:"SignupCtrl"}).when("/dashboard",{title:"Dashboard",templateUrl:"partials/dashboard.html",controller:"DashboardCtrl",resolve:{user:["FirebaseApi",function(t){return t.isLoggedOrGoTo("/signin")}]}}).when("/user/:userId",{title:"User",templateUrl:"partials/user.html",controller:"UserCtrl",resolve:{user:["FirebaseApi",function(t){return t.isLoggedOrGoTo("/signin")}]}}).when("/404",{title:"Error 404",templateUrl:"partials/404"}),t.otherwise("/"),e.html5Mode(!1),e.hashPrefix("")}])}(),function(){"use strict";angular.module("app").service("FirebaseApi",["$q","$firebaseAuth","$firebaseObject","$firebaseArray","LocalStorage","Router",function(t,e,n,o,r,i){function s(){var n=t.defer();return S.presence?n.resolve(S.presence):e().$signInAnonymously({remember:"sessionOnly"}).then(function(t){var e=S.presence={uid:t.uid};n.resolve(e)}).catch(function(t){console.log("Error",t),n.reject(t)}),n.promise}function a(){var e=t.defer();if(S.user)e.resolve(S.user);else{var n=r.get("token");n?s().then(function(t){g("users",{token:n}).then(function(t){S.user=t,e.resolve(t)},function(t){e.reject(t)})},function(t){e.reject(t)}):e.reject({message:"not logged"})}return e.promise}function c(e){console.log("FirebaseApi.signin",e);var n=t.defer();return S.user?(console.log("signed",S.user),n.resolve(S.user)):s().then(function(t){g("users",{email:e.email}).then(function(t){t.password===e.password?(r.set("token",t.token),S.user=t,n.resolve(t)):n.reject({message:"not found"})},function(t){n.reject(t)})},function(t){n.reject(t)}),n.promise}function l(e){console.log("FirebaseApi.signup",e);var n=t.defer();return s().then(function(t){e.token=t.uid,b("users",e).then(function(t){r.set("token",t.token),S.user=t,n.resolve(t)},function(t){n.reject(t)})},function(t){n.reject(t)}),n.promise}function u(){console.log("FirebaseApi.signout");var e=t.defer();return r.delete("token"),S.user=null,e.resolve(),e.promise}function h(){return y("users")}function f(){return y("items",{token:"token"})}function p(e){var n=t.defer();return a().then(function(t){n.resolve(S.user)},function(){n.reject(),i.redirect(e)}),n.promise}function m(e){console.log("userSave",e);var n=t.defer();return e.$save().then(function(t){n.resolve(e)},function(t){console.log("userSave",t),n.reject(t)}),n.promise}function d(t){var e=[];for(var n in t)e.push({key:n,value:t[n]});var o=null;return e.length&&(o=e.shift()),o}function g(e,n,o){var r=t.defer();return y(e,n,o).then(function(t){if(1===t.length){var n=t[0].$id;v(e,n).then(function(t){r.resolve(t)},function(t){r.reject()})}else r.reject()},function(t){r.reject(t)}),r.promise}function v(t,e){var o=x.database().ref(),r=o.child(t).child(e);return n(r).$loaded()}function y(t,e,n){var r=x.database().ref(),i=r.child(t),s=i;if(e){var a=d(e);a&&(s=i.orderByChild(a.key).equalTo(a.value),n&&(s=s.limitToLast(n)))}return o(s).$loaded()}function b(t,e){var o=x.database().ref(),r=o.child(t),i=r.push();return i.set(e),n(i).$loaded()}var x=window.firebase||null;if(!x)throw"missing firebase.js";var w={apiKey:"AIzaSyCskd8Cgzd_j7JzgEC3mEb4ir1qZFh6auQ",authDomain:"starfish-c2b0f.firebaseapp.com",databaseURL:"https://starfish-c2b0f.firebaseio.com",projectId:"starfish-c2b0f",storageBucket:"starfish-c2b0f.appspot.com",messagingSenderId:"796739915579"};x.initializeApp(w);var S=this;S.user=void 0,S.presence=void 0,S.items=f,S.facilities=h,S.auth={signin:c,signup:l,signout:u},S.users={save:m},S.current=a,S.isLoggedOrGoTo=p}])}(),function(){"use strict";var t=angular.module("app");t.controller("RootCtrl",["$scope","$location","FirebaseApi",function(t,e,n){t.api=n,t.signout=function(){console.log(n),n.auth.signout().then(function(){e.path("/")})},n.current().then(function(e){t.user=e,console.log(e)},function(t){console.log("RootCtrl.error",t)})}]),t.controller("HomeCtrl",["$scope","State","FirebaseApi",function(t,e,n){var o=t.state=new e;t.map={};n.facilities().then(function(e){t.map.items=e,o.ready()},function(t){o.error(t)}),o.ready()}]),t.controller("ProfileCtrl",["$scope","State","FirebaseApi","user",function(t,e,n,o){var r=t.state=new e,i=t.MODES={BEACH:1,PRICES:2,PLACE:3,OPENING:4,INFO:5},s=(t.mode=i.BEACH,t.model={shopName:o.shopName,address:o.address,number:o.number,postalCode:o.postalCode,locality:o.locality,city:o.city,province:o.province,region:o.region,country:o.country,position:o.position}),a=(t.map={},t.beach=o.beach||{items:[],cols:0,rows:0});t.controls={};t.submit=function(t){r.busy(t)&&(angular.forEach(s,function(t,e){t?o[e]=t:delete o[e]}),o.beach=a,n.users.save(o).then(function(t){console.log("response",t),r.success()},function(t){r.error(t)}))},t.saveItems=function(e){t.submit(e)}}]),t.controller("DashboardCtrl",["$scope","State","FirebaseApi","user",function(t,e,n,o){(t.state=new e).ready(),n.items().then(function(e){console.log("DashboardCtrl.items",e),t.items=e})}]),t.controller("SigninCtrl",["$scope","State","Router","FirebaseApi",function(t,e,n,o){var r=t.state=new e,i=t.model={};t.submit=function(t){r.busy(t)&&o.auth.signin(i).then(function(t){r.success(),n.retry("/dashboard")},function(t){console.log("SigninCtrl.error",t),r.error(t)})}}]),t.controller("SignupCtrl",["$scope","State","Router","FirebaseApi",function(t,e,n,o){var r=t.state=new e,i=t.model={};t.submit=function(t){r.busy(t)&&o.auth.signup(i).then(function(t){r.success(),n.retry("/dashboard")},function(t){console.log("SignupCtrl.error",t),r.error(t)})}}])}(),function(){"use strict";angular.module("app").directive("beach",["$http","$timeout","Painter","Palette","Rect","Events","Hash",function(t,e,n,o,r,i,s){function a(t,r,s,a){function c(t,e){var n=L;I?n.setFill(n.colors.white):n.setFill(n.colors.grey),n.ctx.beginPath(),n.ctx.arc(t,e,6,0,2*Math.PI,!1),n.ctx.fill()}function l(t,e){var n=.4*R.w,o=L;o.ctx.beginPath(),o.ctx.moveTo(t+n*Math.cos(0),e+n*Math.sin(0));for(var r=1;r<=7;r++)o.ctx.lineTo(t+n*Math.cos(2*r*Math.PI/7),e+n*Math.sin(2*r*Math.PI/7));o.ctx.fill()}function u(t,e){var n={x:(t-T.x)/C.w,y:(e-T.y)/C.h};t+=R.w*n.x*.75,e+=R.h*n.y*.75;var o=L;o.setFill(o.colors.greyLight),l(t,e)}function h(t,e){var n=L;n.setFill(n.colors.blue),l(t,e)}function f(){var t=L;t.clear(),O.pattern(t,"bg",0,0,t.rect.w,t.rect.h),angular.forEach(N,function(t){u(t.x*R.w+R.w2,t.y*R.h+R.h2)}),angular.forEach(N,function(t){h(t.x*R.w+R.w2,t.y*R.h+R.h2)}),E&&c(E.x*R.w+R.w2,E.y*R.h+R.h2)}function p(t){N.push({x:t.x,y:t.y})}function m(t){for(var e,n=-1,o=0,r=N.length;o<r;)e=N[o],e.x===t.x&&e.y===t.y&&(n=o,o=r),o++;return n}function d(t){N.splice(t,1)}function g(t){var e=m(t);return-1!==e?d(e):p(t),e}function v(){I=null,angular.forEach(N,function(t){t.x===E.x&&t.y===E.y&&(I=t)}),f()}function y(){var t={},e={},n=0,o=0;angular.forEach(N,function(r){t[r.x]||(t[r.x]=!0,n++),e[r.y]||(e[r.y]=!0,o++)}),A.cols=n,A.rows=o}function b(){e(function(){y()})}function x(t){var e=t.relative,n={x:Math.floor(e.x/R.w),y:Math.floor(e.y/R.h)};$=!0,M=g(n),v(),b()}function w(t){var e=t.relative;if(T={x:e.x,y:e.y},E={x:Math.floor(e.x/R.w),y:Math.floor(e.y/R.h)},$){var n=m(E);-1===M&&-1===n?p(E):M>=0&&-1!==n&&d(n)}v()}function S(t){$&&($=!1,b())}function k(t){var e=r[0].offsetWidth,n=r[0].offsetHeight;C.w=e,C.h=n,f()}var E,I,$,M,T={x:0,y:0},C={w:0,h:0},R={w:40,h:40,w2:20,h2:20},A=t.beach,P=t.controls,N=A.items,L=new n(r[0]),O=new o;O.add("bg",R.w,R.h,function(t,e){t.setFill(t.colors.greyLight),t.ctx.beginPath(),t.ctx.arc(e.center().x,e.center().y,5,0,2*Math.PI,!1),t.ctx.fill()}),P.setCenter=function(){if(A.rows&&A.cols){var t=Math.floor(C.w/R.w),e=Math.floor(C.h/R.h),n=Number.POSITIVE_INFINITY,o=Number.POSITIVE_INFINITY;angular.forEach(N,function(t){n=Math.min(n,t.x),o=Math.min(o,t.y)});var r=Math.max(0,Math.floor((t-A.cols)/2)-1),i=Math.max(0,Math.floor((e-A.rows)/2)-1);angular.forEach(N,function(t){t.x=r+(t.x-n),t.y=i+(t.y-o)})}console.log("setCenter",A.rows,A.cols),f()};var V={down:x,move:w,up:S,resize:k},j=new i(r);j.add(V),t.$on("$destroy",function(){j.remove(V)}),k(),e(function(){f()})}return{restrict:"A",link:a}}])}(),function(){"use strict";var t=angular.module("app");t.directive("mapbox",["$http","$timeout","GoogleMaps",function(t,e,n){function o(t,o,r,i){function s(){x=c();var e=new mapboxgl.Map({container:o[0],style:"mapbox://styles/mapbox/streets-v9",interactive:!0,logoPosition:"bottom-right",center:[x.lng,x.lat],zoom:9});return w=e.getCanvasContainer(),e.on("mousedown",p),t.map.setAddress=function(e){console.log("setAddress",e),angular.extend(t.model,e),t.map.results=null,x=c(e.position.lat,e.position.lng),f()},t.map.search=function(){return console.log("address",t.map.address),t.map.results=null,l(t.map.address),!0},t.map.styles={RIVA:1,SATELLITE:2},t.map.style=t.map.styles.RIVA,t.map.styleToggle=function(){t.map.style===t.map.styles.RIVA?(t.map.style=t.map.styles.SATELLITE,e.setStyle("mapbox://styles/mapbox/satellite-v9")):(t.map.style=t.map.styles.RIVA,e.setStyle("mapbox://styles/mapbox/streets-v9"))},t.map.setStyle=function(n){t.map.style=n,t.map.style===t.map.styles.RIVA?e.setStyle("mapbox://styles/mapbox/streets-v9"):e.setStyle("mapbox://styles/mapbox/satellite-v9")},e}function a(){var t=document.createElement("div");t.id="point",t.className="marker";var e=new mapboxgl.Marker(t,{offset:[-10,-10]}).setLngLat([x.lng,x.lat]).addTo(v),n=angular.element(t);return n.on("mouseenter",function(t){w.style.cursor="move",k=!0,v.dragPan.disable()}),n.on("mouseleave",function(t){w.style.cursor="",k=!1,v.dragPan.enable()}),e}function c(e,n){var o=t.model.position||{};return e&&n?(o.lat=e,o.lng=n):(o.lat=o.lat||0,o.lng=o.lng||0,0===o.lat&&0===o.lng&&h()),console.log("setPosition",e,n),o}function l(o){b.geocode({address:o},function(o,r){e(function(){"OK"===r?t.map.results=n.parse(o):alert("Geocode was not successful for the following reason: "+r)})})}function u(o){console.log("reverseGeocode",o),b.geocode({location:o},function(o,r){e(function(){"OK"===r?t.map.results=n.parse(o):console.log("Geocoder failed due to: "+r)})})}function h(){navigator.geolocation?navigator.geolocation.getCurrentPosition(function(t){e(function(){x=c(t.coords.latitude,t.coords.longitude),f(),u(x)})},function(t){console.log("error",t)}):console.log("error","Browser doesn't support Geolocation")}function f(){y.setLngLat([x.lng,x.lat]),v.flyTo({center:[parseFloat(x.lng),parseFloat(x.lat)],zoom:15,speed:1.5,curve:1})}function p(){k&&(S=!0,w.style.cursor="grab",v.on("mousemove",m),v.once("mouseup",d))}function m(t){if(S){var e=t.lngLat;w.style.cursor="grabbing",y.setLngLat([e.lng,e.lat])}}function d(t){if(S){var n=t.lngLat;e(function(){x=c(n.lat,n.lng),u(n)}),w.style.cursor="",S=!1,v.off("mousemove",m)}}function g(){v=s(),y=a()}var v,y,b,x,w,S,k;n.geocoder().then(function(t){b=t,g()})}if(mapboxgl)return mapboxgl.accessToken="pk.eyJ1IjoiYWN0YXJpYW4iLCJhIjoiY2lqNWU3MnBzMDAyZndnbTM1cjMyd2N2MiJ9.CbuEGSvOAfIYggQv854pRQ",{restrict:"E",link:o}}]),t.directive("mapboxViewer",["$http","$timeout","GoogleMaps",function(t,e,n){function o(t,o,r,i){function s(){var e=new mapboxgl.Map({container:o[0],style:"mapbox://styles/mapbox/streets-v9",interactive:!0,logoPosition:"bottom-right",center:[g.lng,g.lat],zoom:9});return y=e.getCanvasContainer(),t.map.setAddress=function(e){console.log("setAddress",e),t.map.results=null,l(e.position)},t.map.search=function(){return console.log("address",t.map.address),t.map.results=null,c(t.map.address),!0},t.map.styles={RIVA:1,SATELLITE:2},t.map.style=t.map.styles.RIVA,t.map.styleToggle=function(){t.map.style===t.map.styles.RIVA?(t.map.style=t.map.styles.SATELLITE,e.setStyle("mapbox://styles/mapbox/satellite-v9")):(t.map.style=t.map.styles.RIVA,e.setStyle("mapbox://styles/mapbox/streets-v9"))},t.map.setStyle=function(n){t.map.style=n,t.map.style===t.map.styles.RIVA?e.setStyle("mapbox://styles/mapbox/streets-v9"):e.setStyle("mapbox://styles/mapbox/satellite-v9")},e}function a(t){var e=document.createElement("div");e.id="point",e.className="marker";var n=new mapboxgl.Marker(e,{offset:[-10,-10]}).setLngLat([t.position.lng,t.position.lat]).addTo(f);return angular.element(e).on("click",function(t){console.log("click",this)}),n}function c(o){d.geocode({address:o},function(o,r){e(function(){"OK"===r?t.map.results=n.parse(o):alert("Geocode was not successful for the following reason: "+r)})})}function l(t){f.flyTo({center:[parseFloat(t.lng),parseFloat(t.lat)],zoom:15,speed:1.5,curve:1})}function u(t){f.fitBounds(t,{speed:1.5,curve:1,padding:30,linear:!1,maxZoom:8})}function h(){f=s(),t.$watch("map.items",function(t){if(console.log(t),angular.forEach(p,function(t){f.removeLayer(t)}),p=[],t){var e=Number.POSITIVE_INFINITY,n=Number.NEGATIVE_INFINITY,o=Number.POSITIVE_INFINITY,r=Number.NEGATIVE_INFINITY;angular.forEach(t,function(t){m=a(t),p.push(m),e=Math.min(e,t.position.lat),n=Math.max(n,t.position.lat),o=Math.min(o,t.position.lng),r=Math.max(r,t.position.lng),v=new mapboxgl.LngLatBounds(new mapboxgl.LngLat(o,e),new mapboxgl.LngLat(r,n))}),u(v)}})}var f,p,m,d,g,v,y;g={lng:0,lat:0},n.geocoder().then(function(t){d=t,h()})}if(mapboxgl)return mapboxgl.accessToken="pk.eyJ1IjoiYWN0YXJpYW4iLCJhIjoiY2lqNWU3MnBzMDAyZndnbTM1cjMyd2N2MiJ9.CbuEGSvOAfIYggQv854pRQ",{restrict:"A",link:o}}]),t.service("GoogleMaps",["$q","$http",function(t,e){function n(){var e=t.defer();if(a)e.resolve(window.google.maps);else{window.googleMapsInit=function(){e.resolve(window.google.maps),window.googleMapsInit=null,a=!0};var n=document.createElement("script");n.setAttribute("async",null),n.setAttribute("defer",null),n.setAttribute("src","https://maps.googleapis.com/maps/api/js?key="+s+"&callback=googleMapsInit"),document.body.appendChild(n)}return e.promise}function o(){var e=t.defer();return n().then(function(t){var n=new t.Geocoder;e.resolve(n)},function(t){e.reject(t)}),e.promise}function r(t,e){var n={street:"route",number:"street_number",locality:"locality",postalCode:"postal_code",city:"administrative_area_level_3",province:"administrative_area_level_2",region:"administrative_area_level_1",country:"country"},o=null;return angular.forEach(e.address_components,function(e){angular.forEach(e.types,function(r){r===n[t]&&(o=e.long_name)})}),o}function i(t){var e=null;return t.length&&(e=t.filter(function(t){return!0}).map(function(t){return{name:t.formatted_address,street:r("street",t),number:r("number",t),locality:r("locality",t),postalCode:r("postalCode",t),city:r("city",t),province:r("province",t),region:r("region",t),country:r("country",t),position:{lng:t.geometry.location.lng(),lat:t.geometry.location.lat()}}})),console.log("googleMaps.parse",t,e),e}var s="AIzaSyAYuhIEO-41YT_GdYU6c1N7DyylT_OcMSY",a=!1;this.maps=n,this.geocoder=o,this.parse=i}])}(),function(){"use strict";var t=angular.module("app");t.factory("Rect",[function(){function t(t,e,n,o){this.x=t||0,this.y=e||0,this.w=n||0,this.h=o||0}return t.mult=function(t,e){return t.x*=e,t.y*=e,t.w*=e,t.h*=e,t},t.prototype={mult:function(e){return t.mult(this,e)},offset:function(t,e){return this.x+=t,this.y+=e,this},reduce:function(t){return this.offset(-t)},reduceRect:function(e){return this.offsetRect(t.mult(e,-1))},expandRect:function(t){return this.x-=t.x||0,this.y-=t.y||0,this.w+=t.w||0,this.h+=t.h||0,this},expand:function(t){return this.expandRect({x:t,y:t,w:2*t,h:2*t})},intersect:function(t){var e=this.x,n=this.y,o=this.w,r=this.h;return!(t.x>e+o||t.x+t.w<e||t.y>n+r||t.y+t.h<n)},top:function(){var t=this.x,e=this.y,n=this.w;this.h;return{x:t+n/2,y:e}},right:function(){var t=this.x,e=this.y;return{x:t+this.w,y:e+this.h/2}},bottom:function(){var t=this.x,e=this.y;return{x:t+this.w/2,y:e+this.h}},left:function(){var t=this.x,e=this.y;this.w;return{x:t,y:e+this.h/2}},center:function(){var t=this.x,e=this.y;return{x:t+this.w/2,y:e+this.h/2}},topLeft:function(){var t=this.x,e=this.y;this.w,this.h;return{x:t,y:e}},topRight:function(){var t=this.x,e=this.y,n=this.w;this.h;return{x:t+n,y:e}},bottomRight:function(){var t=this.x,e=this.y;return{x:t+this.w,y:e+this.h}},bottomLeft:function(){var t=this.x,e=this.y;this.w;return{x:t,y:e+this.h}},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setW:function(t){return this.w=t,this},setH:function(t){return this.h=t,this},setPos:function(t,e){return this.x=t,this.y=e,this},setSize:function(t,e){return this.w=t,this.h=e,this},copy:function(t){return this.x=t.x,this.y=t.y,this.w=t.w,this.h=t.h,this},clone:function(){return new t(this.x,this.y,this.w,this.h)},toString:function(){return"{"+this.x+","+this.y+","+this.w+","+this.h+"}"}},t}]),t.factory("Color",[function(){function t(t,e,n,o){if(arguments.length>1)this.r=t||0===t?t:0,this.g=e||0===e?e:0,this.b=n||0===n?n:0,this.a=o||0===o?o:255;else{var r=t||"0xffffff";r=parseInt(r),t.length>8?(this.r=r>>24&255,this.g=r>>16&255,this.b=r>>8&255,this.a=r>>0&255):(this.r=r>>16&255,this.g=r>>8&255,this.b=r>>0&255,this.a=255)}}return t.componentToHex=function(t){var e=t.toString(16);return 1==e.length?"0"+e:e},t.luma=function(t){return t.dot({r:95,g:100,b:60})},t.contrast=function(e){return new t(t.luma(e)>.6?"0x000000":"0xffffff")},t.darker=function(e,n,o){return o=o||0,new t(Math.max(Math.floor(e.r*o),Math.floor(e.r-255*n)),Math.max(Math.floor(e.g*o),Math.floor(e.g-255*n)),Math.max(Math.floor(e.b*o),Math.floor(e.b-255*n)),e.a)},t.lighter=function(e,n,o){return o=o||1,new t(Math.min(e.r+Math.floor((255-e.r)*o),Math.floor(e.r+255*n)),Math.min(e.g+Math.floor((255-e.g)*o),Math.floor(e.g+255*n)),Math.min(e.b+Math.floor((255-e.b)*o),Math.floor(e.b+255*n)),e.a)},t.prototype={toUint:function(){return(this.r<<24)+(this.g<<16)+(this.b<<8)+this.a},toHex:function(){return"#"+t.componentToHex(this.r)+t.componentToHex(this.g)+t.componentToHex(this.b)+t.componentToHex(this.a)},toRgba:function(){return"rgba("+this.r+","+this.g+","+this.b+","+(this.a/255).toFixed(3)+")"},dot:function(t){return this.r/255*(t.r/255)+this.g/255*(t.g/255)+this.b/255*(t.b/255)},alpha:function(t,e,n){return e=e||0,n=n||1,this.a=Math.floor(255*(e+t*(n-e))),this},makeSet:function(){return this.foreground=t.contrast(this),this.border=t.darker(this,.3),this.light=t.lighter(this,.3),this}},t}]),t.factory("Shape",[function(){function t(){}return t.shapeCircle=function(t,e,n,o,r,i){r=r||0,i=i||2*Math.PI,t.ctx.arc(e,n,o,r,i,!1)},t.shapeStar=function(t,e,n,o,r,s){var a,c,l=Math.PI/2*3,u=Math.PI/s,h=t.ctx;for(h.moveTo(e,n-o),i=0;i<s;i++)a=e+Math.cos(l)*o,c=n+Math.sin(l)*o,h.lineTo(a,c),l+=u,a=e+Math.cos(l)*r,c=n+Math.sin(l)*r,h.lineTo(a,c),l+=u;h.lineTo(e,n-o)},t.shapeRoundRect=function(t,e,n){var o=t.ctx,r=e.x,i=e.y,s=e.w,a=e.h;if(void 0===typeof n&&(n=4),"number"==typeof n)n={tl:n,tr:n,br:n,bl:n};else{var c={tl:0,tr:0,br:0,bl:0};for(var l in c)n[l]=n[l]||c[l]}o.moveTo(r+n.tl,i),o.lineTo(r+s-n.tr,i),o.quadraticCurveTo(r+s,i,r+s,i+n.tr),o.lineTo(r+s,i+a-n.br),o.quadraticCurveTo(r+s,i+a,r+s-n.br,i+a),o.lineTo(r+n.bl,i+a),o.quadraticCurveTo(r,i+a,r,i+a-n.bl),o.lineTo(r,i+n.tl),o.quadraticCurveTo(r,i,r+n.tl,i)},t.circle=function(){var e=Array.prototype.slice.call(arguments),n=e[0].ctx;n.beginPath(),t.shapeCircle.apply(this,e),n.closePath()},t.star=function(){var e=Array.prototype.slice.call(arguments),n=e[0].ctx;n.beginPath(),t.shapeStar.apply(this,e),n.closePath()},t.roundRect=function(){var e=Array.prototype.slice.call(arguments),n=e[0].ctx;n.beginPath(),t.shapeRoundRect.apply(this,e),n.closePath()},t}]),t.constant("PainterColors",{black:"0x14191e",white:"0xffffff",blue:"0x0023FF",red:"0xF21500",lightBlue:"0x79ccf2",lightYellow:"0xfff79a",greyLighter:"0xf8f8f8",greyLight:"0xeeeeee",greyMedium:"0xcccccc",grey:"0x90939b",map:"0x24292e"}),t.factory("Palette",["$q","Painter","Rect",function(t,e,n){function o(){this.painter=(new e).setSize(0,0),this.buffer=(new e).setSize(0,0),this.size={w:0,h:0},this.pool={},this.rows={}}return o.prototype={getRect:function(t,e){var o=this.painter,r=this.size,i=this.rows,s=new n(0,0,t,e),a=i[e]||{x:0,y:r.h};if(r.w=Math.max(r.w,a.x+t),r.h=Math.max(r.h,a.y+e),o.canvas.width||o.canvas.height){if(r.w>o.canvas.width||r.h>o.canvas.height){var c=o.canvas;o.setCanvas(document.createElement("canvas")),o.setSize(r.w,r.h),o.ctx.drawImage(c,0,0)}}else o.setSize(r.w,r.h);return s.x=a.x,s.y=a.y,a.x+=t,i[e]=a,s},add:function(e,n){var o=this;if(angular.isString(n)){var r=t.defer(),i=new Image;return i.onload=function(){o.addShape(e,i.width,i.height,function(t,e){t.ctx.drawImage(i,0,0)}),r.resolve(i)},i.onerror=function(){r.reject("connot load "+n)},i.src=n,r.promise}var s=Array.prototype.slice.call(arguments);return o.addShape.apply(o,s)},addShape:function(t,e,n,o){var r=this.painter,i=this.getRect(e,n);r.ctx.save(),r.ctx.rect(i.x,i.y,i.w,i.h),r.ctx.clip(),r.ctx.translate(i.x,i.y),o.call(r,r,i.clone().setPos(0,0)),r.ctx.restore(),this.pool[t]=i},draw:function(t,e,n,o,r){var i=this.pool[e];i&&t.drawRect(this.painter.canvas,i,{x:n,y:o,w:i.w,h:i.h},r)},tint:function(t,e,n,o,r,i){var s=this.pool[e];if(s){var a=this.painter,c=this.buffer.setSize(s.w,s.h);c.save(),c.setFill(r),c.fillRect(),c.ctx.globalCompositeOperation="destination-atop",c.ctx.drawImage(a.canvas,s.x,s.y,s.w,s.h,0,0,s.w,s.h),c.restore(),console.log(n,o,c.canvas,t.canvas),t.draw(c.canvas,{x:n,y:o},i)}},pattern:function(t,e,n,o,r,i,s){function a(e){var s=t.ctx;s.save(),s.translate(n,o),s.fillStyle=e,s.fillRect(-n,-o,r,i),s.translate(-n,-o),s.restore()}var c=this.pool[e];if(c){var l,u=c.img;if(u&&c.color==s)l=t.ctx.createPattern(u,"repeat"),a(l);else{var h=this.buffer.setSize(c.w,c.h);s?(c.color=s,h.save(),h.setFill(s),h.fillRect(),h.ctx.globalCompositeOperation="destination-atop",h.ctx.drawImage(this.painter.canvas,c.x,c.y,c.w,c.h,0,0,c.w,c.h),h.restore()):h.ctx.drawImage(this.painter.canvas,c.x,c.y,c.w,c.h,0,0,c.w,c.h),u=new Image,u.onload=function(){c.img=u,l=t.ctx.createPattern(u,"repeat"),a(l)},u.src=h.toDataURL()}}}},o}]),t.factory("Painter",["Shape","Rect","Color","PainterColors",function(t,e,n,o){function r(t){t=t||document.createElement("canvas"),this.rect=new e,this.drawingRect=new e,this.setColors(),this.setCanvas(t)}r.colors={},angular.forEach(o,function(t,e){r.colors[e]=new n(t).makeSet()});r.colors;return r.prototype={colors:r.colors,setColors:function(){var t=this.colors;angular.forEach(o,function(e,o){t[o]=new n(e).makeSet()})},setCanvas:function(t){this.canvas=t,this.setSize(t.offsetWidth,t.offsetHeight);var e=t.getContext("2d");return e.lineCap="square",this.ctx=e,this},setSize:function(t,e){return this.canvas.width=t,this.canvas.height=e,this.rect.w=t,this.rect.h=e,this},copy:function(t){return this.ctx.drawImage(t,0,0),this},clear:function(){return this.resize(),this},resize:function(){return this.setSize(this.canvas.offsetWidth,this.canvas.offsetHeight),this},setText:function(t,e,n,o){t=t||"11px monospace",e=e||"center",n=n||"middle",o=o||this.colors.black;var r=this.ctx;return r.font=t,r.textAlign=e,r.textBaseline=n,r.fillStyle=o.toRgba(),this},setFill:function(t){return t=t||this.colors.black,this.ctx.fillStyle=t.toRgba(),this},setStroke:function(t,e){t=t||this.colors.black;var n=this.ctx;return e=e||1,n.strokeStyle=t.toRgba(),n.lineWidth=e,this},fillText:function(t,e,n,o,r){return n&&(o=o||"",r=r||Math.floor(n/8),t.length>r&&(t=t.substr(0,Math.min(t.length,r)).trim()+o)),this.ctx.fillText(t,e.x,e.y),this},fillRect:function(t){t=t||this.rect;var e=this.ctx,n=t.x,o=t.y,r=t.w,i=t.h;return e.fillRect(n,o,r,i),this},strokeRect:function(t){t=t||this.rect;var e=this.ctx,n=t.x,o=t.y,r=t.w,i=t.h;return e.strokeRect(n,o,r,i),this},fill:function(){return this.ctx.fill(),this},stroke:function(){return this.ctx.stroke(),this},begin:function(){return this.ctx.beginPath(),this},close:function(){return this.ctx.closePath(),this},save:function(){return this.ctx.save(),this},restore:function(){return this.ctx.restore(),this},rotate:function(t){this.ctx.rotate(t*Math.PI/180)},translate:function(t){this.ctx.translate(t.x,t.y)},toDataURL:function(){return this.canvas.toDataURL()},draw:function(t,e,n){if(t){e.w=e.w||t.width,e.h=e.h||t.height;var o=this.ctx,r=this.drawingRect,i=r.x=e.x-e.w/2,s=r.y=e.y-e.h/2;r.w=e.w,r.h=e.h;o.save(),o.translate(i,s),n&&n.call(this),o.drawImage(t,0,0),o.restore()}return this},drawRect:function(t,e,n,o){if(t){e.w=e.w||t.width,e.h=e.h||t.height,n.w=n.w||t.width,n.h=n.h||t.height;var r=this.ctx,i=this.drawingRect,s=i.x=n.x-e.w/2,a=i.y=n.y-e.h/2;i.w=n.w,i.h=n.h;r.save(),r.translate(s,a),o&&o.call(this),r.drawImage(t,e.x,e.y,e.w,e.h,0,0,n.w,n.h),r.restore()}return this},flip:function(t){t=t||{x:1,y:-1};var e=this.ctx,n=this.drawingRect;e.translate(-1===t.x?n.w:0,-1===t.y?n.h:0),e.scale(t.x,t.y)}},r}])}(),function(){"use strict";angular.module("app").factory("Events",[function(){function t(t,e){var n=document.documentElement||document.body.parentNode||document.body,o={x:window.pageXOffset||n.scrollLeft,y:window.pageYOffset||n.scrollTop};if("resize"===t.type){var r={w:this.getWidth(),h:this.getHeight()};this.view=r}var s=i(e),a={x:s.offsetLeft,y:s.offsetTop},c=s.getBoundingClientRect(),l=this.getPage(t);if(l){var u={x:l.x-o.x-c.left,y:l.y-o.y-c.top},h={x:l.x-o.x,y:l.y-o.y};this.relative=u,this.absolute=h}"resize"===this.type&&console.log(this.type),this.originalEvent=t,this.element=e,this.node=s,this.offset=a,this.rect=c}function e(){return self.innerWidth?self.innerWidth:document.documentElement&&document.documentElement.clientWidth?document.documentElement.clientWidth:document.body?document.body.clientWidth:void 0}function n(){return self.innerHeight?self.innerHeight:document.documentElement&&document.documentElement.clientHeight?document.documentElement.clientHeight:document.body?document.body.clientHeight:void 0}function o(t){var e=["click","mousedown","mouseup","mousemove","mouseover","mouseout","mouseenter","mouseleave","contextmenu"],n=["touchstart","touchmove","touchend","touchcancel"],o=null;if(-1!==n.indexOf(t.type)){var r=null,i=t.originalEvent?t.originalEvent:t,s=i.touches.length?i.touches:i.changedTouches;s&&s.length&&(r=s[0]),r&&(o={x:r.pageX,y:r.pageY})}else-1!==e.indexOf(t.type)&&(o={x:t.pageX,y:t.pageY});return this.type=t.type,o}function r(e){function n(e){var n=new t(e,u.element);u.listeners.click.apply(this,[n])}function o(e){var n=new t(e,u.element);u.listeners.down.apply(this,[n]),u.removeTouchEvents()}function r(e){var n=new t(e,u.element);u.listeners.move.apply(this,[n])}function i(e){var n=new t(e,u.element);u.listeners.up.apply(this,[n])}function s(e){console.log("onResize",e);var n=new t(e,u.element);u.listeners.resize.apply(this,[n])}function a(e){var n=new t(e,u.element);u.listeners.down.apply(this,[n]),u.removeStandardEvents()}function c(e){var n=new t(e,u.element);u.listeners.move.apply(this,[n])}function l(e){var n=new t(e,u.element);u.listeners.up.apply(this,[n])}this.element=e,this.listeners={},this.standardEvents={click:{key:"click",callback:n},down:{key:"mousedown",callback:o},move:{key:"mousemove",callback:r},up:{key:"mouseup",callback:i},resize:{key:"resize",callback:s}},this.touchEvents={down:{key:"touchstart",callback:a},move:{key:"touchmove",callback:c},up:{key:"touchend",callback:l}};var u=this}function i(t){return t.length?t[0]:t}function s(t){return t.length?t:angular.element(t)}function a(t){var e=this,n=this.standardEvents,o=this.touchEvents,r=s(this.element),i=angular.element(window);return angular.forEach(t,function(t,s){if(e.listeners[s]){var a={};a[s]=e.listeners[s],c(a)}e.listeners[s]=t,n[s]&&("resize"===s?i.on(n[s].key,n[s].callback):r.on(n[s].key,n[s].callback)),o[s]&&r.on(o[s].key,o[s].callback)}),e}function c(t){var e=this,n=this.standardEvents,o=this.touchEvents,r=s(this.element),i=angular.element(window);return angular.forEach(t,function(t,s){n[s]&&("resize"===s?i.off(n[s].key,n[s].callback):r.off(n[s].key,n[s].callback)),o[s]&&r.off(o[s].key,o[s].callback),e.listeners[s]=null}),e}function l(){var t=this,e=t.standardEvents,n=(t.touchEvents,s(t.element));n.off("mousedown",e.down.callback),n.off("mousemove",e.move.callback),n.off("mouseup",e.up.callback)}function u(){var t=this,e=(t.standardEvents,t.touchEvents),n=s(t.element);n.off("touchstart",e.down.callback),n.off("touchmove",e.move.callback),n.off("touchend",e.up.callback)}return t.prototype={getPage:o,getWidth:e,getHeight:n},r.prototype={add:a,remove:c,removeStandardEvents:l,removeTouchEvents:u},r}])}(),function(){"use strict";angular.module("app").directive("ngClick",["Events",function(t){function e(e,n,o,r){function i(t){n.removeClass("animate"),n.offsetWidth,s.style.left=t.relative.x+"px",s.style.top=t.relative.y+"px",setTimeout(function(){n.addClass("animate"),setTimeout(function(){n.removeClass("animate")},1e3)},10)}n.addClass("material");var s=document.createElement("material");n[0].appendChild(s);var a={click:i},c=new t(n).add(a);e.$on("$destroy",function(){c.remove(a)})}return{restrict:"A",priority:0,link:e}}])}(),function(){"use strict";angular.module("app")}(),function(){"use strict";var t=angular.module("app");t.directive("controlMessages",[function(){return{restrict:"E",templateUrl:"partials/control-messages",transclude:{message:"?messageItems"},link:function(t,e,n,o){}}}]),t.directive("control",["$http","$templateCache","$compile","$parse",function(t,e,n,o){function r(t,e,n){t=t||"",e=e||"";var o=t.split(",");if(o.length>1){var r=o.shift();return angular.forEach(o,function(t,o){r=n?r.split("{"+o+"}").join("' + "+e+t+" + '"):r.split("{"+o+"}").join(e+t)}),n?"'"+r+"'":r}return e+t}var i=0;return{restrict:"A",templateUrl:function(t,e){var n="partials/forms/control";switch(e.control){case"select":n="partials/forms/control-select"}return n},scope:{ngModel:"=",required:"=",form:"@",title:"@",placeholder:"@"},require:"ngModel",compile:function(t,e){return{pre:function(t,e,n){if("select"===n.control){var s=n.label?n.label:"name",a=n.key?n.key:"id",c=n.min?" | filter:gte('"+a+"', "+n.min+")":"",l=r(s,"item.",!0);t.options=n.number?"item."+a+" as "+l+" disable when item.disabled for item in "+n.source+c:l+" disable when item.disabled for item in "+n.source+c+" track by item."+a,console.log("control.compile.pre",t.options)}var u=(t.type=n.control,t.form=t.form||"form",t.title=t.title||"untitled");t.placeholder=t.placeholder||u,t.field=u.replace(/[^0-9a-zA-Z]/g,"").split(" ").join("")+ ++i;t.validate=n.validate||n.control,t.format=n.format||null,t.precision=n.precision||null,t.validate=n.validate||n.control,t.minLength=n.min||0,t.maxLength=n.max||Number.POSITIVE_INFINITY,t.options=o(n.options)(t)||{},t.focus=!1,t.visible=!1,t.getType=function(){var e="text";switch(n.control){case"password":e=t.visible?"text":"password";break;default:e=n.control}return e},t.getClasses=function(){var e=o(t.form)(t.$parent),n=o(t.form+"."+t.field)(t.$parent);return{"control-focus":t.focus,"control-success":n.$valid,"control-error":n.$invalid&&(e.$submitted||n.$touched),"control-empty":!n.$viewValue}},t.getMessages=function(){var e=o(t.form)(t.$parent),n=o(t.form+"."+t.field)(t.$parent);return(e.$submitted||n.$touched)&&n.$error}}}}}}]),t.directive("numberPicker",["$parse","$timeout",function(t,e){return{restrict:"A",template:'<div class="input-group">   <span class="input-group-btn"><button class="btn btn-outline-primary" type="button">-</button></span>   <div ng-transclude></div>   <span class="input-group-btn"><button class="btn btn-outline-primary" type="button">+</button></span></div>',replace:!0,transclude:!0,link:function(n,o,r,i){function s(o){var i=t(r.min)(n),s=t(r.numberPicker),a=s.assign
;e(function(){a(n,Math.max(i,s(n)-1))})}function a(o){var i=t(r.max)(n),s=t(r.numberPicker),a=s.assign;e(function(){a(n,Math.min(i,s(n)+1))})}function c(){angular.element(u).off("touchstart mousedown",s),angular.element(h).off("touchstart mousedown",a)}var l=o[0],u=l.querySelectorAll(".input-group-btn > .btn")[0],h=l.querySelectorAll(".input-group-btn > .btn")[1];n.$on("$destroy",function(){c()}),function(){angular.element(u).on("touchstart mousedown",s),angular.element(h).on("touchstart mousedown",a)}()}}}])}(),function(){"use strict";angular.module("app").directive("validate",["$filter",function(t){return{require:"ngModel",link:function(e,n,o,r){function i(){f=!0,u&&(n[0].value=r.$modelValue||null,r.$modelValue||r.$setViewValue(null))}function s(){if(u&&!r.$invalid)switch(l){case"date":case"datetime":case"datetime-local":n[0].value=r.$modelValue?t("date")(r.$modelValue,u):" ";break;default:n[0].value=r.$modelValue?t("number")(r.$modelValue,h)+" "+u:" "}}function a(){f=!1,s()}function c(){n.off("focus",i),n.off("blur",a)}var l=o.validate,u=o.format||"",h=o.precision||2,f=!1;switch(l){case"date":case"datetime":case"datetime-local":r.$formatters.push(function(e){return e?t("date")(e,u):null});break;case"number":r.$parsers.unshift(function(t){var e=!1;return void 0!==t&&""!==t?(e=-1!==String(t).indexOf(Number(t).toString()),t=Number(t),r.$setValidity("number",e),e&&(r.$setValidity("positive",t>=.01),void 0!==o.min&&r.$setValidity("range",t>=Number(o.min)),void 0!==o.max&&r.$setValidity("range",t<=Number(o.max)))):(e=!0,t=Number(t),r.$setValidity("number",!0),r.$setValidity("positive",!0),void 0!==o.min&&r.$setValidity("range",!0),void 0!==o.max&&r.$setValidity("range",!0)),t}),r.$formatters.push(function(e){return e?t("number")(e,h)+" "+u:null});break;case"anynumber":r.$parsers.unshift(function(t){var e=!1;return void 0!==t&&""!==t?(e=-1!==String(t).indexOf(Number(t).toString()),t=Number(t),r.$setValidity("number",e),e&&(void 0!==o.min&&r.$setValidity("range",t>=Number(o.min)),void 0!==o.max&&r.$setValidity("range",t<=Number(o.max)))):(e=!0,t=Number(t),r.$setValidity("number",!0),void 0!==o.min&&r.$setValidity("range",!0),void 0!==o.max&&r.$setValidity("range",!0)),t}),r.$formatters.push(function(e){return e||0===e?t("number")(e,h)+" "+u:null})}e.$on("$destroy",function(){c()}),function(){n.on("focus",i),n.on("blur",a)}()}}}])}(),function(){"use strict";angular.module("app").factory("State",["$timeout",function(t){function e(){this.isReady=!1,this.idle()}function n(){this.isBusy=!1,this.isError=!1,this.isErroring=!1,this.isSuccess=!1,this.isSuccessing=!1,this.button=null,this.errors=[]}function o(){return!this.isBusy&&!this.isErroring&&!this.isSuccessing}function r(t){return!this.isBusy&&(this.isBusy=!0,this.isError=!1,this.isErroring=!1,this.isSuccess=!1,this.isSuccessing=!1,this.errors=[],this.key=t,!0)}function i(){this.isBusy=!1,this.isError=!1,this.isErroring=!1,this.isSuccess=!0,this.isSuccessing=!0,this.errors=[],t(function(){this.isSuccessing=!1,this.key=null}.bind(this),p)}function s(e){this.isBusy=!1,this.isError=!0,this.isErroring=!0,this.isSuccess=!1,this.isSuccessing=!1,this.errors.push(e),t(function(){this.isErroring=!1,this.key=null}.bind(this),p)}function a(){this.isReady=!0,this.success()}function c(){return this.isError?this.errors[this.errors.length-1]:null}function l(){return{busy:this.isBusy,ready:this.isReady,successing:this.isSuccessing,success:this.isSuccess,errorring:this.isErroring,error:this.isError}}function u(t,e){var n={ready:"submit",busy:"sending",error:"error",success:"success"};e&&angular.extend(n,e);var o=n.ready;return this.key===t&&(this.isBusy?o=n.busy:this.isSuccess?o=n.success:this.isError&&(o=n.error)),o}function h(t,e){var n=this,o=null;return this.key===t&&(o={ready:n.isReady,busy:n.isBusy,successing:n.isSuccessing,success:n.isSuccess,errorring:n.isErroring,error:n.isError},e&&angular.forEach(e,function(t,e){o[t]=o[e]})),o}function f(t){return this.key&&this.key!==t}var p=2e3;return e.prototype={idle:n,busy:r,enabled:o,error:s,ready:a,success:i,errorMessage:c,submitClass:l,labels:u,classes:h,disabled:f},e}])}(),function(){"use strict";var t=angular.module("app");t.factory("Cookie",["$q","$window",function(t,e){function n(){}return n.TIMEOUT=3e5,n._set=function(t,n,o){var r;if(o){var i=new Date;i.setTime(i.getTime()+24*o*60*60*1e3),r="; expires="+i.toGMTString()}else r="";e.document.cookie=t+"="+n+r+"; path=/"},n.set=function(t,e,o){try{var r=[],i=JSON.stringify(e,function(t,e){if("pool"!==t){if("object"==typeof e&&null!==e){if(-1!==r.indexOf(e))return;r.push(e)}return e}});r=null,n._set(t,i,o)}catch(n){console.log("Cookie.set.error serializing",t,e,n)}},n.get=function(t){for(var n=t+"=",o=e.document.cookie.split(";"),r=0;r<o.length;r++){for(var i=o[r];" "==i.charAt(0);)i=i.substring(1,i.length);if(0===i.indexOf(n)){var s=i.substring(n.length,i.length),a=null;try{a=JSON.parse(s)}catch(t){console.log("Cookie.get.error parsing",key,t)}return a}}return null},n.delete=function(t){n._set(t,"",-1)},n.on=function(e){function o(){if(a>c)i.reject("timeout");else{var t=n.get(e);t?i.resolve(t):(a+=s,r=setTimeout(o,s))}}var r,i=t.defer(),s=1e3,a=0,c=n.TIMEOUT;return o(),i.promise},n}]),t.factory("LocalStorage",["$q","$window","Cookie",function(t,e,n){function o(){}return o.isSupported=function(){var t=!1;try{t="localStorage"in e&&null!==e.localStorage,t?(e.localStorage.setItem("test","1"),e.localStorage.removeItem("test")):t=!1}catch(e){t=!1}return t}(),o.isSupported?(o.set=function(t,n){try{var o=[],r=JSON.stringify(n,function(t,e){if("pool"!==t){if("object"==typeof e&&null!==e){if(-1!==o.indexOf(e))return;o.push(e)}return e}});o=null,e.localStorage.setItem(t,r)}catch(e){console.log("LocalStorage.set.error serializing",t,n,e)}},o.get=function(t){var n=null;if(void 0!==e.localStorage[t])try{n=JSON.parse(e.localStorage[t])}catch(e){console.log("LocalStorage.get.error parsing",t,e)}return n},o.delete=function(t){e.localStorage.removeItem(t)},o.on=function(o){function r(t){if(clearTimeout(i),t.originalEvent.key==o)try{var e=JSON.parse(t.originalEvent.newValue);s.resolve(e)}catch(t){console.log("LocalStorage.on.error parsing",o,t),s.reject("error parsing "+o)}}var i,s=t.defer(),a=n.TIMEOUT;return angular.element(e).on("storage",r),i=setTimeout(function(){s.reject("timeout")},a),s.promise}):(console.log("LocalStorage.unsupported switching to cookies"),o.set=n.set,o.get=n.get,o.delete=n.delete,o.on=n.on),o}]),t.factory("SessionStorage",["$q","$window","Cookie",function(t,e,n){function o(){}return o.isSupported=function(){var t=!1;try{t="sessionStorage"in e&&void 0!==e.sessionStorage,t?(e.sessionStorage.setItem("test","1"),e.sessionStorage.removeItem("test")):t=!1}catch(e){t=!1}return t}(),o.isSupported?(o.set=function(t,n){try{var o=[],r=JSON.stringify(n,function(t,e){if("pool"!==t){if("object"==typeof e&&null!==e){if(-1!==o.indexOf(e))return;o.push(e)}return e}});o=null,e.sessionStorage.setItem(t,r)}catch(e){console.log("SessionStorage.set.error serializing",t,n,e)}},o.get=function(t){var n=null;if(void 0!==e.sessionStorage[t])try{n=JSON.parse(e.sessionStorage[t])}catch(e){console.log("SessionStorage.get.error parsing",t,e)}return n},o.delete=function(t){e.sessionStorage.removeItem(t)},o.on=function(o){function r(t){if(clearTimeout(i),t.originalEvent.key===o)try{var e=JSON.parse(t.originalEvent.newValue);s.resolve(e)}catch(t){console.log("SessionStorage.on.error parsing",o,t),s.reject("error parsing "+o)}}var i,s=t.defer(),a=n.TIMEOUT;return angular.element(e).on("storage",r),i=setTimeout(function(){s.reject("timeout")},a),s.promise}):(console.log("SessionStorage.unsupported switching to cookies"),o.set=n.set,o.get=n.get,o.delete=n.delete,o.on=n.on),o}])}(),function(){"use strict";angular.module("app").factory("Hash",[function(){function t(e,n){e=e||"id",n=n?t.get(n):{},Object.defineProperties(this,{key:{value:e,enumerable:!1,writable:!1},pool:{value:n,enumerable:!1,writable:!1},length:{value:0,enumerable:!1,writable:!0}})}function e(t){return void 0!==this.pool[t]}function n(t){return this.pool[t]}function o(t){var e=this,n=this.key;return t?e.getId(t[n]):null}function r(t){var e=this;return this.pool[t[this.key]]=t,e.push(t),t}function i(t){var e=this,n=e.get(t);if(n)for(var o,r=0,i=Object.keys(t);r<i.length;r++)o=i[r],n[o]=t[o];else n=e.set(t);return n}function s(t){var e=this,n=this.pool,o=this.key,r=e.get(t);if(r){var i=e.indexOf(r);-1!==i&&e.splice(i,1),delete n[r[o]]}return e}function a(t){var e=this;if(!t)return e;for(var n=0;n<t.length;)e.add(t[n]),n++;return e}function c(t){var e=this;if(!t)return e;for(var n=0;n<t.length;)e.remove(t[n]),n++;return e}function l(){var t,e=this,n=e.key,o=e.pool,r=0;for(e.length;e.length;)t=e.shift(),delete o[t[n]],r++;return e}function u(t){var e=this;if(t)for(var n=0;n<e.length;)t(e[n],n),n++;return e}function h(t,e){var n=this;return t=t||this.key,n.sort(function(n,o){var r=e?o:n,i=e?n:o;return r[t]-i[t]}),n}function f(t){return this.forward(t,!0)}function p(t){if(t.key!==this.key||t.length!==this.length)return!0;for(var e=!1,n=0,o=this.length,r=this.key;e&&n<o;)e=this[n][r]!==t[n][r],n++}function m(){var t=this,e=this.pool,n=this.key;Object.keys(e).forEach(function(t){delete e[t]}),angular.forEach(t,function(t){e[t[n]]=t})}var d={};return t.get=function(t){return d[t]=d[t]||{}},t.prototype=new Array,t.prototype.has=e,t.prototype.getId=n,t.prototype.get=o,t.prototype.set=r,t.prototype.add=i,t.prototype.remove=s,t.prototype.each=u,t.prototype.addMany=a,t.prototype.removeMany=c,t.prototype.removeAll=l,t.prototype.forward=h,t.prototype.backward=f,t.prototype.differs=p,t.prototype.updatePool=m,t}])}(),function(){"use strict";angular.module("app").directive("header",[function(){return{restrict:"E",templateUrl:"partials/header",transclude:{header:"?headerItems"},link:function(t,e,n,o){}}}])}(),function(){"use strict";angular.module("app").service("Router",["$location","$timeout",function(t,e){function n(n,o){function r(){t.$$lastRequestedPath=t.path(),t.path(n)}o?e(function(){r()},o):r()}function o(n,o){function r(){n=t.$$lastRequestedPath||n,t.$$lastRequestedPath=null,t.path(n)}o?e(function(){r()},o):r()}var r=this;r.redirect=n,r.retry=o}])}();